/*! For license information please see sdk.client.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.sdkClient=t():e.sdkClient=t()}(self,(()=>(()=>{var e={130:(e,t,r)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,a=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key),"symbol"===n(a)?a:String(a)),i)}var a}Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;var a=r(704),o="awaitqueue",c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t?(this._debug=(0,a.default)("".concat(o,":").concat(t)),this._warn=(0,a.default)("".concat(o,":WARN:").concat(t)),this._error=(0,a.default)("".concat(o,":ERROR:").concat(t))):(this._debug=(0,a.default)(o),this._warn=(0,a.default)("".concat(o,":WARN")),this._error=(0,a.default)("".concat(o,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}var t,r;return t=e,(r=[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}])&&i(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.Logger=c},811:(e,t,r)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(){i=function(){return t};var e,t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},c="function"==typeof Symbol?Symbol:{},s=c.iterator||"@@iterator",u=c.asyncIterator||"@@asyncIterator",p=c.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var i=t&&t.prototype instanceof b?t:b,a=Object.create(i.prototype),c=new C(n||[]);return o(a,"_invoke",{value:j(e,r,c)}),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",m="suspendedYield",v="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};l(S,s,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(D([])));k&&k!==r&&a.call(k,s)&&(S=k);var P=_.prototype=b.prototype=Object.create(S);function R(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(i,o,c,s){var u=f(e[i],e,o);if("throw"!==u.type){var p=u.arg,l=p.value;return l&&"object"==n(l)&&a.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,c,s)}),(function(e){r("throw",e,c,s)})):t.resolve(l).then((function(e){p.value=e,c(p)}),(function(e){return r("throw",e,c,s)}))}s(u.arg)}var i;o(this,"_invoke",{value:function(e,n){function a(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(a,a):a()}})}function j(t,r,n){var i=h;return function(a,o){if(i===v)throw new Error("Generator is already running");if(i===y){if("throw"===a)throw o;return{value:e,done:!0}}for(n.method=a,n.arg=o;;){var c=n.delegate;if(c){var s=E(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=v;var u=f(t,r,n);if("normal"===u.type){if(i=n.done?y:m,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=y,n.method="throw",n.arg=u.arg)}}}function E(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,E(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(i,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var o=a.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(a.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=_,o(P,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,p,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,p,"GeneratorFunction")),e.prototype=Object.create(P),e},t.awrap=function(e){return{__await:e}},R(O.prototype),l(O.prototype,u,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,i,a){void 0===a&&(a=Promise);var o=new O(d(e,r,n,i),a);return t.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},R(P),l(P,p,"Generator"),l(P,s,(function(){return this})),l(P,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,i){return c.type="throw",c.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],c=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=a.call(o,"catchLoc"),u=a.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;L(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a,o,c=[],s=!0,u=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);s=!0);}catch(e){u=!0,i=e}finally{try{if(!s&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw i}}return c}}(e,t)||o(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function s(e,t,r,n,i,a,o){try{var c=e[a](o),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,i)}function u(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){s(a,n,i,o,c,"next",e)}function c(e){s(a,n,i,o,c,"throw",e)}o(void 0)}))}}function p(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,a=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key),"symbol"===n(a)?a:String(a)),i)}var a}function l(e,t,r){return t&&p(e.prototype,t),r&&p(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&b(e,t)}function h(e){var t=g();return function(){var r,i=w(e);if(t){var a=w(this).constructor;r=Reflect.construct(i,arguments,a)}else r=i.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return m(e)}(this,r)}}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e){var t="function"==typeof Map?new Map:void 0;return v=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return y(e,arguments,w(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),b(r,e)},v(e)}function y(e,t,r){return y=g()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&b(i,r.prototype),i},y.apply(null,arguments)}function g(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function b(e,t){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},b(e,t)}function w(e){return w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},w(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.AwaitQueue=t.AwaitQueueRemovedTaskError=t.AwaitQueueStoppedError=void 0;var _=new(r(130).Logger),S=function(e){f(r,e);var t=h(r);function r(e){var n;return d(this,r),(n=t.call(this,null!=e?e:"AwaitQueue stopped")).name="AwaitQueueStoppedError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(m(n),r),n}return l(r)}(v(Error));t.AwaitQueueStoppedError=S;var x=function(e){f(r,e);var t=h(r);function r(e){var n;return d(this,r),(n=t.call(this,null!=e?e:"AwaitQueue task removed")).name="AwaitQueueRemovedTaskError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(m(n),r),n}return l(r)}(v(Error));t.AwaitQueueRemovedTaskError=x;var k=function(){function e(){d(this,e),this.pendingTasks=new Map,this.nextTaskId=0,this.stopping=!1}var t,r;return l(e,[{key:"size",get:function(){return this.pendingTasks.size}},{key:"push",value:(r=u(i().mark((function e(t,r){var n,o=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null!==(n=r)&&void 0!==n?n:t.name,_.debug("push() [name:".concat(r,"]")),"function"==typeof t){e.next=4;break}throw new TypeError("given task is not a function");case 4:if(r)try{Object.defineProperty(t,"name",{value:r})}catch(e){}return e.abrupt("return",new Promise((function(e,n){var i={id:o.nextTaskId++,task:t,name:r,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:function(t){if(!i.completed){i.completed=!0,o.pendingTasks.delete(i.id),_.debug("resolving task [name:".concat(i.name,"]")),e(t);var r=a(o.pendingTasks.values(),1)[0];r&&!r.executedAt&&o.execute(r)}},reject:function(e){if(!i.completed&&(i.completed=!0,o.pendingTasks.delete(i.id),_.debug("rejecting task [name:".concat(i.name,"]: %s"),String(e)),n(e),!o.stopping)){var t=a(o.pendingTasks.values(),1)[0];t&&!t.executedAt&&o.execute(t)}}};o.pendingTasks.set(i.id,i),1===o.pendingTasks.size&&o.execute(i)})));case 6:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"stop",value:function(){_.debug("stop()"),this.stopping=!0;var e,t=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=o(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){s=!0,a=e},f:function(){try{c||null==r.return||r.return()}finally{if(s)throw a}}}}(this.pendingTasks.values());try{for(t.s();!(e=t.n()).done;){var r=e.value;_.debug("stop() | stopping task [name:".concat(r.name,"]")),r.reject(new S)}}catch(e){t.e(e)}finally{t.f()}this.stopping=!1}},{key:"remove",value:function(e){_.debug("remove() [taskIdx:".concat(e,"]"));var t=Array.from(this.pendingTasks.values())[e];t?t.reject(new x):_.debug("stop() | no task with given idx [taskIdx:".concat(e,"]"))}},{key:"dump",value:function(){var e=Date.now(),t=0;return Array.from(this.pendingTasks.values()).map((function(r){return{idx:t++,task:r.task,name:r.name,enqueuedTime:r.executedAt?r.executedAt-r.enqueuedAt:e-r.enqueuedAt,executionTime:r.executedAt?e-r.executedAt:0}}))}},{key:"execute",value:(t=u(i().mark((function e(t){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_.debug("execute() [name:".concat(t.name,"]")),!t.executedAt){e.next=3;break}throw new Error("task already being executed");case 3:return t.executedAt=Date.now(),e.prev=4,e.next=7,t.task();case 7:r=e.sent,t.resolve(r),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),t.reject(e.t0);case 14:case"end":return e.stop()}}),e,null,[[4,11]])}))),function(e){return t.apply(this,arguments)})}]),e}();t.AwaitQueue=k},75:function(e,t,r){var n,i,a,o;function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}e=r.nmd(e),o=function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==c(e)&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=90)}({17:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n=r(18),i=function(){function e(){}return e.getFirstMatch=function(e,t){var r=t.match(e);return r&&r.length>0&&r[1]||""},e.getSecondMatch=function(e,t){var r=t.match(e);return r&&r.length>1&&r[2]||""},e.matchAndReturnConst=function(e,t,r){if(e.test(t))return r},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,r,n){void 0===n&&(n=!1);var i=e.getVersionPrecision(t),a=e.getVersionPrecision(r),o=Math.max(i,a),c=0,s=e.map([t,r],(function(t){var r=o-e.getVersionPrecision(t),n=t+new Array(r+1).join(".0");return e.map(n.split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));for(n&&(c=o-Math.min(i,a)),o-=1;o>=c;){if(s[0][o]>s[1][o])return 1;if(s[0][o]===s[1][o]){if(o===c)return 0;o-=1}else if(s[0][o]<s[1][o])return-1}},e.map=function(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r+=1)n.push(t(e[r]));return n},e.find=function(e,t){var r,n;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,n=e.length;r<n;r+=1){var i=e[r];if(t(i,r))return i}},e.assign=function(e){for(var t,r,n=e,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];if(Object.assign)return Object.assign.apply(Object,[e].concat(a));var s=function(){var e=a[t];"object"==c(e)&&null!==e&&Object.keys(e).forEach((function(t){n[t]=e[t]}))};for(t=0,r=a.length;t<r;t+=1)s();return e},e.getBrowserAlias=function(e){return n.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return n.BROWSER_MAP[e]||""},e}();t.default=i,e.exports=t.default},18:function(e,t,r){"use strict";t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(91))&&n.__esModule?n:{default:n},a=r(18);var o=function(){function e(){}var t;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new i.default(e,t)},e.parse=function(e){return new i.default(e).getResult()},(t=[{key:"BROWSER_MAP",get:function(){return a.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return a.ENGINE_MAP}},{key:"OS_MAP",get:function(){return a.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return a.PLATFORMS_MAP}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(e,t),e}();t.default=o,e.exports=t.default},91:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n=u(r(92)),i=u(r(93)),a=u(r(94)),o=u(r(95)),s=u(r(17));function u(e){return e&&e.__esModule?e:{default:e}}var p=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=s.default.find(n.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=s.default.find(i.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=s.default.find(a.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=s.default.find(o.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return s.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,r={},n=0,i={},a=0;if(Object.keys(e).forEach((function(t){var o=e[t];"string"==typeof o?(i[t]=o,a+=1):"object"==c(o)&&(r[t]=o,n+=1)})),n>0){var o=Object.keys(r),u=s.default.find(o,(function(e){return t.isOS(e)}));if(u){var p=this.satisfies(r[u]);if(void 0!==p)return p}var l=s.default.find(o,(function(e){return t.isPlatform(e)}));if(l){var d=this.satisfies(r[l]);if(void 0!==d)return d}}if(a>0){var f=Object.keys(i),h=s.default.find(f,(function(e){return t.isBrowser(e,!0)}));if(void 0!==h)return this.compareVersion(i[h])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var r=this.getBrowserName().toLowerCase(),n=e.toLowerCase(),i=s.default.getBrowserTypeByAlias(n);return t&&i&&(n=i.toLowerCase()),n===r},t.compareVersion=function(e){var t=[0],r=e,n=!1,i=this.getBrowserVersion();if("string"==typeof i)return">"===e[0]||"<"===e[0]?(r=e.substr(1),"="===e[1]?(n=!0,r=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?r=e.substr(1):"~"===e[0]&&(n=!0,r=e.substr(1)),t.indexOf(s.default.compareVersions(i,r,n))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some((function(e){return t.is(e)}))},e}();t.default=p,e.exports=t.default},92:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},a=/version\/(\d+(\.?_?\d+)+)/i,o=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},r=i.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},r=i.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},r=i.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},r=i.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},r=i.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},r=i.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},r=i.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},r=i.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},r=i.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},r=i.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},r=i.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},r=i.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},r=i.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},r=i.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},r=i.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return r&&(t.version=r),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},r=i.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},r=i.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},r=i.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},r=i.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},r=i.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},r=i.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},r=i.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},r=i.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},r=i.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},r=i.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},r=i.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},r=i.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t={name:"Android Browser"},r=i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},r=i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},r=i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:i.default.getFirstMatch(t,e),version:i.default.getSecondMatch(t,e)}}}];t.default=o,e.exports=t.default},93:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},a=r(18),o=[{test:[/Roku\/DVP/],describe:function(e){var t=i.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:a.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=i.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:a.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=i.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),r=i.default.getWindowsVersionName(t);return{name:a.OS_MAP.Windows,version:t,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:a.OS_MAP.iOS},r=i.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return r&&(t.version=r),t}},{test:[/macintosh/i],describe:function(e){var t=i.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),r=i.default.getMacOSVersionName(t),n={name:a.OS_MAP.MacOS,version:t};return r&&(n.versionName=r),n}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=i.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:a.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t=i.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),r=i.default.getAndroidVersionName(t),n={name:a.OS_MAP.Android,version:t};return r&&(n.versionName=r),n}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=i.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),r={name:a.OS_MAP.WebOS};return t&&t.length&&(r.version=t),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=i.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||i.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||i.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:a.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=i.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:a.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=i.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:a.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:a.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:a.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=i.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:a.OS_MAP.PlayStation4,version:t}}}];t.default=o,e.exports=t.default},94:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},a=r(18),o=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=i.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",r={type:a.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(r.model=t),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),r=e.test(/like (ipod|iphone)/i);return t&&!r},describe:function(e){var t=i.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:a.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:a.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.tv}}}];t.default=o,e.exports=t.default},95:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},a=r(18),o=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:a.ENGINE_MAP.Blink};var t=i.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:a.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:a.ENGINE_MAP.Trident},r=i.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:a.ENGINE_MAP.Presto},r=i.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=e.test(/gecko/i),r=e.test(/like gecko/i);return t&&!r},describe:function(e){var t={name:a.ENGINE_MAP.Gecko},r=i.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:a.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:a.ENGINE_MAP.WebKit},r=i.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}}];t.default=o,e.exports=t.default}})},"object"==c(t)&&"object"==c(e)?e.exports=o():(i=[],void 0===(a="function"==typeof(n=o)?n.apply(t,i):n)||(e.exports=a))},704:(e,t,r)=>{var n;t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(n++,"%c"===e&&(i=n))})),t.splice(i,0,r)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(n=!1,function(){n||(n=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||function(){},e.exports=r(572)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},572:(e,t,r)=>{function n(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}e.exports=function(e){function t(e){var r,n,a,o=null;function c(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];if(c.enabled){var a=c,o=Number(new Date),s=o-(r||o);a.diff=s,a.prev=r,a.curr=o,r=o,n[0]=t.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");var u=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,(function(e,r){if("%%"===e)return"%";u++;var i=t.formatters[r];if("function"==typeof i){var o=n[u];e=i.call(a,o),n.splice(u,1),u--}return e})),t.formatArgs.call(a,n),(a.log||t.log).apply(a,n)}}return c.namespace=e,c.useColors=t.useColors(),c.color=t.selectColor(e),c.extend=i,c.destroy=t.destroy,Object.defineProperty(c,"enabled",{enumerable:!0,configurable:!1,get:function(){return null!==o?o:(n!==t.namespaces&&(n=t.namespaces,a=t.enabled(e)),a)},set:function(e){o=e}}),"function"==typeof t.init&&t.init(c),c}function i(e,r){var n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function a(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){var e=[].concat(n(t.names.map(a)),n(t.skips.map(a).map((function(e){return"-"+e})))).join(",");return t.enable(""),e},t.enable=function(e){var r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(r=0;r<i;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;var r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(573),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((function(r){t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){for(var r=0,n=0;n<e.length;n++)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},713:e=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}var r,n="object"===("undefined"==typeof Reflect?"undefined":t(Reflect))?Reflect:null,i=n&&"function"==typeof n.apply?n.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};r=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(r,n){function i(r){e.removeListener(t,a),n(r)}function a(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}v(e,t,a,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&v(e,"error",t,{once:!0})}(e,i)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var c=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+t(e))}function u(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function p(e,t,r,n){var i,a,o,c;if(s(r),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),a=e._events),o=a[t]),void 0===o)o=a[t]=r,++e._eventsCount;else if("function"==typeof o?o=a[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(i=u(e))>0&&o.length>i&&!o.warned){o.warned=!0;var p=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");p.name="MaxListenersExceededWarning",p.emitter=e,p.type=t,p.count=o.length,c=p,console&&console.warn&&console.warn(c)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=l.bind(n);return i.listener=r,n.wrapFn=i,i}function f(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):m(i,i.length)}function h(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function m(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function v(e,r,n,i){if("function"==typeof e.on)i.once?e.once(r,n):e.on(r,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+t(e));e.addEventListener(r,(function t(a){i.once&&e.removeEventListener(r,t),n(a)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,a=this._events;if(void 0!==a)n=n&&void 0===a.error;else if(!n)return!1;if(n){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var c=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw c.context=o,c}var s=a[e];if(void 0===s)return!1;if("function"==typeof s)i(s,this,t);else{var u=s.length,p=m(s,u);for(r=0;r<u;++r)i(p[r],this,t)}return!0},o.prototype.addListener=function(e,t){return p(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return p(this,e,t,!0)},o.prototype.once=function(e,t){return s(t),this.on(e,d(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,d(this,e,t)),this},o.prototype.removeListener=function(e,t){var r,n,i,a,o;if(s(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,a=r.length-1;a>=0;a--)if(r[a]===t||r[a].listener===t){o=r[a].listener,i=a;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,a=Object.keys(r);for(n=0;n<a.length;++n)"removeListener"!==(i=a[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},o.prototype.listeners=function(e){return f(this,e,!0)},o.prototype.rawListeners=function(e){return f(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},o.prototype.listenerCount=h,o.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},407:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,a=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key),"symbol"===n(a)?a:String(a)),i)}var a}function a(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var c=r(704)("h264-profile-level-id");c.log=console.info.bind(console),t.ProfileConstrainedBaseline=1,t.ProfileBaseline=2,t.ProfileMain=3,t.ProfileConstrainedHigh=4,t.ProfileHigh=5;t.Level1_b=0,t.Level1=10,t.Level1_1=11,t.Level1_2=12,t.Level1_3=13,t.Level2=20,t.Level2_1=21,t.Level2_2=22,t.Level3=30,t.Level3_1=31,t.Level3_2=32,t.Level4=40,t.Level4_1=41,t.Level4_2=42,t.Level5=50,t.Level5_1=51,t.Level5_2=52;var s=a((function e(t,r){o(this,e),this.profile=t,this.level=r}));t.ProfileLevelId=s;var u=new s(1,31),p=function(){function e(t){o(this,e),this._mask=~f("x",t),this._maskedValue=f("1",t)}return a(e,[{key:"isMatch",value:function(e){return this._maskedValue===(e&this._mask)}}]),e}(),l=a((function e(t,r,n){o(this,e),this.profile_idc=t,this.profile_iop=r,this.profile=n})),d=[new l(66,new p("x1xx0000"),1),new l(77,new p("1xxx0000"),1),new l(88,new p("11xx0000"),1),new l(66,new p("x0xx0000"),2),new l(88,new p("10xx0000"),2),new l(77,new p("0x0x0000"),3),new l(100,new p("00000000"),5),new l(100,new p("00001100"),4)];function f(e,t){return(t[0]===e)<<7|(t[1]===e)<<6|(t[2]===e)<<5|(t[3]===e)<<4|(t[4]===e)<<3|(t[5]===e)<<2|(t[6]===e)<<1|(t[7]===e)<<0}function h(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})["level-asymmetry-allowed"];return 1===e||"1"===e}t.parseProfileLevelId=function(e){if("string"!=typeof e||6!==e.length)return null;var t=parseInt(e,16);if(0===t)return null;var r,n=255&t,i=t>>8&255,a=t>>16&255;switch(n){case 11:r=0!=(16&i)?0:11;break;case 10:case 12:case 13:case 20:case 21:case 22:case 30:case 31:case 32:case 40:case 41:case 42:case 50:case 51:case 52:r=n;break;default:return c("parseProfileLevelId() | unrecognized level_idc:%s",n),null}for(var o=0,u=d;o<u.length;o++){var p=u[o];if(a===p.profile_idc&&p.profile_iop.isMatch(i))return new s(p.profile,r)}return c("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination"),null},t.profileLevelIdToString=function(e){if(0==e.level)switch(e.profile){case 1:return"42f00b";case 2:return"42100b";case 3:return"4d100b";default:return c("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",e.profile),null}var t;switch(e.profile){case 1:t="42e0";break;case 2:t="4200";break;case 3:t="4d00";break;case 4:t="640c";break;case 5:t="6400";break;default:return c("profileLevelIdToString() | unrecognized profile:%s",e.profile),null}var r=e.level.toString(16);return 1===r.length&&(r="0".concat(r)),"".concat(t).concat(r)},t.parseSdpProfileLevelId=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})["profile-level-id"];return e?t.parseProfileLevelId(e):u},t.isSameProfile=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.parseSdpProfileLevelId(e),i=t.parseSdpProfileLevelId(r);return Boolean(n&&i&&n.profile===i.profile)},t.generateProfileLevelIdForAnswer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e["profile-level-id"]&&!r["profile-level-id"])return c("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;var n=t.parseSdpProfileLevelId(e),i=t.parseSdpProfileLevelId(r);if(!n)throw new TypeError("invalid local_profile_level_id");if(!i)throw new TypeError("invalid remote_profile_level_id");if(n.profile!==i.profile)throw new TypeError("H264 Profile mismatch");var a,o,u=h(e)&&h(r),p=n.level,l=function(e,t){return 0===e?10!==t&&0!==t:0===t?10!==e:e<t}(a=p,o=i.level)?a:o,d=u?p:l;return c("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",n.profile,d),t.profileLevelIdToString(new s(n.profile,d))}},729:(e,t,r)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(){i=function(){return t};var e,t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},c="function"==typeof Symbol?Symbol:{},s=c.iterator||"@@iterator",u=c.asyncIterator||"@@asyncIterator",p=c.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var i=t&&t.prototype instanceof b?t:b,a=Object.create(i.prototype),c=new C(n||[]);return o(a,"_invoke",{value:j(e,r,c)}),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",m="suspendedYield",v="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};l(S,s,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(D([])));k&&k!==r&&a.call(k,s)&&(S=k);var P=_.prototype=b.prototype=Object.create(S);function R(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(i,o,c,s){var u=f(e[i],e,o);if("throw"!==u.type){var p=u.arg,l=p.value;return l&&"object"==n(l)&&a.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,c,s)}),(function(e){r("throw",e,c,s)})):t.resolve(l).then((function(e){p.value=e,c(p)}),(function(e){return r("throw",e,c,s)}))}s(u.arg)}var i;o(this,"_invoke",{value:function(e,n){function a(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(a,a):a()}})}function j(t,r,n){var i=h;return function(a,o){if(i===v)throw new Error("Generator is already running");if(i===y){if("throw"===a)throw o;return{value:e,done:!0}}for(n.method=a,n.arg=o;;){var c=n.delegate;if(c){var s=E(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=v;var u=f(t,r,n);if("normal"===u.type){if(i=n.done?y:m,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=y,n.method="throw",n.arg=u.arg)}}}function E(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,E(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(i,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var o=a.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(a.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=_,o(P,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,p,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,p,"GeneratorFunction")),e.prototype=Object.create(P),e},t.awrap=function(e){return{__await:e}},R(O.prototype),l(O.prototype,u,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,i,a){void 0===a&&(a=Promise);var o=new O(d(e,r,n,i),a);return t.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},R(P),l(P,p,"Generator"),l(P,s,(function(){return this})),l(P,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,i){return c.type="throw",c.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],c=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=a.call(o,"catchLoc"),u=a.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;L(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function a(e,t,r,n,i,a,o){try{var c=e[a](o),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,i)}function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,a=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key),"symbol"===n(a)?a:String(a)),i)}var a}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.Consumer=void 0;var p=r(647),l=r(938),d=r(561),f=new p.Logger("Consumer"),h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(g,e);var t,r,p,h,m,v,y=(m=g,v=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=u(m);if(v){var r=u(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return s(e)}(this,e)});function g(e){var t,r=e.id,n=e.localId,i=e.producerId,a=e.rtpReceiver,o=e.track,c=e.rtpParameters,u=e.appData;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),(t=y.call(this))._closed=!1,t._observer=new l.EnhancedEventEmitter,f.debug("constructor()"),t._id=r,t._localId=n,t._producerId=i,t._rtpReceiver=a,t._track=o,t._rtpParameters=c,t._paused=!o.enabled,t._appData=u||{},t.onTrackEnded=t.onTrackEnded.bind(s(t)),t.handleTrack(),t}return t=g,r=[{key:"id",get:function(){return this._id}},{key:"localId",get:function(){return this._localId}},{key:"producerId",get:function(){return this._producerId}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._track.kind}},{key:"rtpReceiver",get:function(){return this._rtpReceiver}},{key:"track",get:function(){return this._track}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"paused",get:function(){return this._paused}},{key:"appData",get:function(){return this._appData},set:function(e){throw new Error("cannot override appData object")}},{key:"observer",get:function(){return this._observer}},{key:"close",value:function(){this._closed||(f.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}},{key:"transportClosed",value:function(){this._closed||(f.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}},{key:"getStats",value:(p=i().mark((function e(){var t=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=2;break}throw new d.InvalidStateError("closed");case 2:return e.abrupt("return",new Promise((function(e,r){t.safeEmit("@getstats",e,r)})));case 3:case"end":return e.stop()}}),e,this)})),h=function(){var e=this,t=arguments;return new Promise((function(r,n){var i=p.apply(e,t);function o(e){a(i,r,n,o,c,"next",e)}function c(e){a(i,r,n,o,c,"throw",e)}o(void 0)}))},function(){return h.apply(this,arguments)})},{key:"pause",value:function(){f.debug("pause()"),this._closed?f.error("pause() | Consumer closed"):this._paused?f.debug("pause() | Consumer is already paused"):(this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause"))}},{key:"resume",value:function(){f.debug("resume()"),this._closed?f.error("resume() | Consumer closed"):this._paused?(this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")):f.debug("resume() | Consumer is already resumed")}},{key:"onTrackEnded",value:function(){f.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}},{key:"handleTrack",value:function(){this._track.addEventListener("ended",this.onTrackEnded)}},{key:"destroyTrack",value:function(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch(e){}}}],r&&o(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),g}(l.EnhancedEventEmitter);t.Consumer=h},174:(e,t,r)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,a=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key),"symbol"===n(a)?a:String(a)),i)}var a}function a(e,t){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},a(e,t)}function o(e){return o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},o(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.DataConsumer=void 0;var c=r(647),s=r(938),u=new c.Logger("DataConsumer"),p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(d,e);var t,r,c,p,l=(c=d,p=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=o(c);if(p){var r=o(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function d(e){var t,r=e.id,n=e.dataProducerId,i=e.dataChannel,a=e.sctpStreamParameters,o=e.appData;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),(t=l.call(this))._closed=!1,t._observer=new s.EnhancedEventEmitter,u.debug("constructor()"),t._id=r,t._dataProducerId=n,t._dataChannel=i,t._sctpStreamParameters=a,t._appData=o||{},t.handleDataChannel(),t}return t=d,(r=[{key:"id",get:function(){return this._id}},{key:"dataProducerId",get:function(){return this._dataProducerId}},{key:"closed",get:function(){return this._closed}},{key:"sctpStreamParameters",get:function(){return this._sctpStreamParameters}},{key:"readyState",get:function(){return this._dataChannel.readyState}},{key:"label",get:function(){return this._dataChannel.label}},{key:"protocol",get:function(){return this._dataChannel.protocol}},{key:"binaryType",get:function(){return this._dataChannel.binaryType},set:function(e){this._dataChannel.binaryType=e}},{key:"appData",get:function(){return this._appData},set:function(e){throw new Error("cannot override appData object")}},{key:"observer",get:function(){return this._observer}},{key:"close",value:function(){this._closed||(u.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}},{key:"transportClosed",value:function(){this._closed||(u.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}},{key:"handleDataChannel",value:function(){var e=this;this._dataChannel.addEventListener("open",(function(){e._closed||(u.debug('DataChannel "open" event'),e.safeEmit("open"))})),this._dataChannel.addEventListener("error",(function(t){if(!e._closed){var r=t.error;r||(r=new Error("unknown DataChannel error")),"sctp-failure"===r.errorDetail?u.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",r.sctpCauseCode,r.message):u.error('DataChannel "error" event: %o',r),e.safeEmit("error",r)}})),this._dataChannel.addEventListener("close",(function(){e._closed||(u.warn('DataChannel "close" event'),e._closed=!0,e.emit("@close"),e.safeEmit("close"),e._observer.safeEmit("close"))})),this._dataChannel.addEventListener("message",(function(t){e._closed||e.safeEmit("message",t.data)}))}}])&&i(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),d}(s.EnhancedEventEmitter);t.DataConsumer=p},953:(e,t,r)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,a=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key),"symbol"===n(a)?a:String(a)),i)}var a}function a(e,t){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},a(e,t)}function o(e){return o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},o(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.DataProducer=void 0;var c=r(647),s=r(938),u=r(561),p=new c.Logger("DataProducer"),l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(f,e);var t,r,c,l,d=(c=f,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=o(c);if(l){var r=o(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function f(e){var t,r=e.id,n=e.dataChannel,i=e.sctpStreamParameters,a=e.appData;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(t=d.call(this))._closed=!1,t._observer=new s.EnhancedEventEmitter,p.debug("constructor()"),t._id=r,t._dataChannel=n,t._sctpStreamParameters=i,t._appData=a||{},t.handleDataChannel(),t}return t=f,(r=[{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"sctpStreamParameters",get:function(){return this._sctpStreamParameters}},{key:"readyState",get:function(){return this._dataChannel.readyState}},{key:"label",get:function(){return this._dataChannel.label}},{key:"protocol",get:function(){return this._dataChannel.protocol}},{key:"bufferedAmount",get:function(){return this._dataChannel.bufferedAmount}},{key:"bufferedAmountLowThreshold",get:function(){return this._dataChannel.bufferedAmountLowThreshold},set:function(e){this._dataChannel.bufferedAmountLowThreshold=e}},{key:"appData",get:function(){return this._appData},set:function(e){throw new Error("cannot override appData object")}},{key:"observer",get:function(){return this._observer}},{key:"close",value:function(){this._closed||(p.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}},{key:"transportClosed",value:function(){this._closed||(p.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}},{key:"send",value:function(e){if(p.debug("send()"),this._closed)throw new u.InvalidStateError("closed");this._dataChannel.send(e)}},{key:"handleDataChannel",value:function(){var e=this;this._dataChannel.addEventListener("open",(function(){e._closed||(p.debug('DataChannel "open" event'),e.safeEmit("open"))})),this._dataChannel.addEventListener("error",(function(t){if(!e._closed){var r=t.error;r||(r=new Error("unknown DataChannel error")),"sctp-failure"===r.errorDetail?p.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",r.sctpCauseCode,r.message):p.error('DataChannel "error" event: %o',r),e.safeEmit("error",r)}})),this._dataChannel.addEventListener("close",(function(){e._closed||(p.warn('DataChannel "close" event'),e._closed=!0,e.emit("@close"),e.safeEmit("close"),e._observer.safeEmit("close"))})),this._dataChannel.addEventListener("message",(function(){e._closed||p.warn('DataChannel "message" event in a DataProducer, message discarded')})),this._dataChannel.addEventListener("bufferedamountlow",(function(){e._closed||e.safeEmit("bufferedamountlow")}))}}])&&i(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),f}(s.EnhancedEventEmitter);t.DataProducer=l},296:function(e,t,r){"use strict";function n(){n=function(){return t};var e,t={},r=Object.prototype,i=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},c="function"==typeof Symbol?Symbol:{},s=c.iterator||"@@iterator",u=c.asyncIterator||"@@asyncIterator",p=c.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var i=t&&t.prototype instanceof b?t:b,o=Object.create(i.prototype),c=new C(n||[]);return a(o,"_invoke",{value:j(e,r,c)}),o}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",m="suspendedYield",v="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};l(S,s,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(D([])));k&&k!==r&&i.call(k,s)&&(S=k);var P=_.prototype=b.prototype=Object.create(S);function R(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(n,a,c,s){var u=f(e[n],e,a);if("throw"!==u.type){var p=u.arg,l=p.value;return l&&"object"==o(l)&&i.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,c,s)}),(function(e){r("throw",e,c,s)})):t.resolve(l).then((function(e){p.value=e,c(p)}),(function(e){return r("throw",e,c,s)}))}s(u.arg)}var n;a(this,"_invoke",{value:function(e,i){function a(){return new t((function(t,n){r(e,i,t,n)}))}return n=n?n.then(a,a):a()}})}function j(t,r,n){var i=h;return function(a,o){if(i===v)throw new Error("Generator is already running");if(i===y){if("throw"===a)throw o;return{value:e,done:!0}}for(n.method=a,n.arg=o;;){var c=n.delegate;if(c){var s=E(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=v;var u=f(t,r,n);if("normal"===u.type){if(i=n.done?y:m,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=y,n.method="throw",n.arg=u.arg)}}}function E(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,E(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(i,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var o=a.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,a=function r(){for(;++n<t.length;)if(i.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(o(t)+" is not iterable")}return w.prototype=_,a(P,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,p,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,p,"GeneratorFunction")),e.prototype=Object.create(P),e},t.awrap=function(e){return{__await:e}},R(O.prototype),l(O.prototype,u,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,i,a){void 0===a&&(a=Promise);var o=new O(d(e,r,n,i),a);return t.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},R(P),l(P,p,"Generator"),l(P,s,(function(){return this})),l(P,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,i){return c.type="throw",c.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],c=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=i.call(o,"catchLoc"),u=i.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;L(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function i(e,t,r,n,i,a,o){try{var c=e[a](o),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,i)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,i=function(e,t){if("object"!==o(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===o(i)?i:String(i)),n)}var i}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}var c=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),u=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&c(t,e,r);return s(t,e),t},p=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Device=t.detectDevice=void 0;var l=p(r(75)),d=r(647),f=r(938),h=r(561),m=u(r(650)),v=u(r(646)),y=r(995),g=r(285),b=r(670),w=r(459),_=r(102),S=r(618),x=r(622),k=r(433),P=r(5),R=r(487),O=r(483),j=new d.Logger("Device");function E(){if("object"===("undefined"==typeof navigator?"undefined":o(navigator))&&"ReactNative"===navigator.product)return"undefined"==typeof RTCPeerConnection?void j.warn("this._detectDevice() | unsupported react-native-webrtc without RTCPeerConnection, forgot to call registerGlobals()?"):"undefined"!=typeof RTCRtpTransceiver?(j.debug("this._detectDevice() | ReactNative UnifiedPlan handler chosen"),"ReactNativeUnifiedPlan"):(j.debug("this._detectDevice() | ReactNative PlanB handler chosen"),"ReactNative");if("object"!==("undefined"==typeof navigator?"undefined":o(navigator))||"string"!=typeof navigator.userAgent)j.warn("this._detectDevice() | unknown device");else{var e=navigator.userAgent,t=l.default.getParser(e),r=t.getEngine();if(t.satisfies({chrome:">=74",chromium:">=74","microsoft edge":">=88"}))return"Chrome74";if(t.satisfies({chrome:">=70",chromium:">=70"}))return"Chrome70";if(t.satisfies({chrome:">=67",chromium:">=67"}))return"Chrome67";if(t.satisfies({chrome:">=55",chromium:">=55"}))return"Chrome55";if(t.satisfies({firefox:">=60"}))return"Firefox60";if(t.satisfies({ios:{OS:">=14.3",firefox:">=30.0"}}))return"Safari12";if(t.satisfies({safari:">=12.0"})&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(t.satisfies({safari:">=11"}))return"Safari11";if(t.satisfies({"microsoft edge":">=11"})&&t.satisfies({"microsoft edge":"<=18"}))return"Edge11";if(r.name&&"blink"===r.name.toLowerCase()){var n=e.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(n){var i=Number(n[1]);return i>=74?"Chrome74":i>=70?"Chrome70":i>=67?"Chrome67":"Chrome55"}return"Chrome74"}j.warn("this._detectDevice() | browser not supported [name:%s, version:%s]",t.getBrowserName(),t.getBrowserVersion())}}t.detectDevice=E;var T=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.handlerName,n=t.handlerFactory,i=t.Handler;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._loaded=!1,this._observer=new f.EnhancedEventEmitter,j.debug("constructor()"),i){if(j.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),"string"!=typeof i)throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");r=i}if(r&&n)throw new TypeError("just one of handlerName or handlerInterface can be given");if(n)this._handlerFactory=n;else{if(r)j.debug("constructor() | handler given: %s",r);else{if(!(r=E()))throw new h.UnsupportedError("device not supported");j.debug("constructor() | detected handler: %s",r)}switch(r){case"Chrome74":this._handlerFactory=g.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=b.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=w.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=_.Chrome55.createFactory();break;case"Firefox60":this._handlerFactory=S.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=x.Safari12.createFactory();break;case"Safari11":this._handlerFactory=k.Safari11.createFactory();break;case"Edge11":this._handlerFactory=P.Edge11.createFactory();break;case"ReactNativeUnifiedPlan":this._handlerFactory=R.ReactNativeUnifiedPlan.createFactory();break;case"ReactNative":this._handlerFactory=O.ReactNative.createFactory();break;default:throw new TypeError('unknown handlerName "'.concat(r,'"'))}}var a=this._handlerFactory();this._handlerName=a.name,a.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}var t,r,c,s;return t=e,r=[{key:"handlerName",get:function(){return this._handlerName}},{key:"loaded",get:function(){return this._loaded}},{key:"rtpCapabilities",get:function(){if(!this._loaded)throw new h.InvalidStateError("not loaded");return this._recvRtpCapabilities}},{key:"sctpCapabilities",get:function(){if(!this._loaded)throw new h.InvalidStateError("not loaded");return this._sctpCapabilities}},{key:"observer",get:function(){return this._observer}},{key:"load",value:(c=n().mark((function e(t){var r,i,a;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.routerRtpCapabilities,j.debug("load() [routerRtpCapabilities:%o]",r),r=m.clone(r,void 0),e.prev=3,!this._loaded){e.next=6;break}throw new h.InvalidStateError("already loaded");case 6:return v.validateRtpCapabilities(r),i=this._handlerFactory(),e.next=10,i.getNativeRtpCapabilities();case 10:return a=e.sent,j.debug("load() | got native RTP capabilities:%o",a),v.validateRtpCapabilities(a),this._extendedRtpCapabilities=v.getExtendedRtpCapabilities(a,r),j.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=v.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=v.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=v.getRecvRtpCapabilities(this._extendedRtpCapabilities),v.validateRtpCapabilities(this._recvRtpCapabilities),j.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),e.next=22,i.getNativeSctpCapabilities();case 22:this._sctpCapabilities=e.sent,j.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),v.validateSctpCapabilities(this._sctpCapabilities),j.debug("load() succeeded"),this._loaded=!0,i.close(),e.next=34;break;case 30:throw e.prev=30,e.t0=e.catch(3),i&&i.close(),e.t0;case 34:case"end":return e.stop()}}),e,this,[[3,30]])})),s=function(){var e=this,t=arguments;return new Promise((function(r,n){var a=c.apply(e,t);function o(e){i(a,r,n,o,s,"next",e)}function s(e){i(a,r,n,o,s,"throw",e)}o(void 0)}))},function(e){return s.apply(this,arguments)})},{key:"canProduce",value:function(e){if(!this._loaded)throw new h.InvalidStateError("not loaded");if("audio"!==e&&"video"!==e)throw new TypeError('invalid kind "'.concat(e,'"'));return this._canProduceByKind[e]}},{key:"createSendTransport",value:function(e){var t=e.id,r=e.iceParameters,n=e.iceCandidates,i=e.dtlsParameters,a=e.sctpParameters,o=e.iceServers,c=e.iceTransportPolicy,s=e.additionalSettings,u=e.proprietaryConstraints,p=e.appData;return j.debug("createSendTransport()"),this.createTransport({direction:"send",id:t,iceParameters:r,iceCandidates:n,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:c,additionalSettings:s,proprietaryConstraints:u,appData:p})}},{key:"createRecvTransport",value:function(e){var t=e.id,r=e.iceParameters,n=e.iceCandidates,i=e.dtlsParameters,a=e.sctpParameters,o=e.iceServers,c=e.iceTransportPolicy,s=e.additionalSettings,u=e.proprietaryConstraints,p=e.appData;return j.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:t,iceParameters:r,iceCandidates:n,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:c,additionalSettings:s,proprietaryConstraints:u,appData:p})}},{key:"createTransport",value:function(e){var t=e.direction,r=e.id,n=e.iceParameters,i=e.iceCandidates,a=e.dtlsParameters,c=e.sctpParameters,s=e.iceServers,u=e.iceTransportPolicy,p=e.additionalSettings,l=e.proprietaryConstraints,d=e.appData;if(!this._loaded)throw new h.InvalidStateError("not loaded");if("string"!=typeof r)throw new TypeError("missing id");if("object"!==o(n))throw new TypeError("missing iceParameters");if(!Array.isArray(i))throw new TypeError("missing iceCandidates");if("object"!==o(a))throw new TypeError("missing dtlsParameters");if(c&&"object"!==o(c))throw new TypeError("wrong sctpParameters");if(d&&"object"!==o(d))throw new TypeError("if given, appData must be an object");var f=new y.Transport({direction:t,id:r,iceParameters:n,iceCandidates:i,dtlsParameters:a,sctpParameters:c,iceServers:s,iceTransportPolicy:u,additionalSettings:p,proprietaryConstraints:l,appData:d,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",f),f}}],r&&a(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.Device=T},938:(e,t,r)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,a=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key),"symbol"===n(a)?a:String(a)),i)}var a}function a(){return a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},a.apply(this,arguments)}function o(e,t){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},o(e,t)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.EnhancedEventEmitter=void 0;var s=r(713),u=new(r(647).Logger)("EnhancedEventEmitter"),p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&o(e,t)}(d,e);var t,r,s,p,l=(s=d,p=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=c(s);if(p){var r=c(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function d(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),(e=l.call(this)).setMaxListeners(1/0),e}return t=d,r=[{key:"emit",value:function(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return(t=a(c(d.prototype),"emit",this)).call.apply(t,[this,e].concat(n))}},{key:"safeEmit",value:function(e){var t=a(c(d.prototype),"listenerCount",this).call(this,e);try{for(var r,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return(r=a(c(d.prototype),"emit",this)).call.apply(r,[this,e].concat(i))}catch(r){return u.error("safeEmit() | event listener threw an error [eventName:%s]:%o",e,r),Boolean(t)}}},{key:"on",value:function(e,t){return a(c(d.prototype),"on",this).call(this,e,t),this}},{key:"off",value:function(e,t){return a(c(d.prototype),"off",this).call(this,e,t),this}},{key:"addListener",value:function(e,t){return a(c(d.prototype),"on",this).call(this,e,t),this}},{key:"prependListener",value:function(e,t){return a(c(d.prototype),"prependListener",this).call(this,e,t),this}},{key:"once",value:function(e,t){return a(c(d.prototype),"once",this).call(this,e,t),this}},{key:"prependOnceListener",value:function(e,t){return a(c(d.prototype),"prependOnceListener",this).call(this,e,t),this}},{key:"removeListener",value:function(e,t){return a(c(d.prototype),"off",this).call(this,e,t),this}},{key:"removeAllListeners",value:function(e){return a(c(d.prototype),"removeAllListeners",this).call(this,e),this}},{key:"listenerCount",value:function(e){return a(c(d.prototype),"listenerCount",this).call(this,e)}},{key:"listeners",value:function(e){return a(c(d.prototype),"listeners",this).call(this,e)}},{key:"rawListeners",value:function(e){return a(c(d.prototype),"rawListeners",this).call(this,e)}}],r&&i(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),d}(s.EventEmitter);t.EnhancedEventEmitter=p},647:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,a=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key),"symbol"===n(a)?a:String(a)),i)}var a}var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;var o=a(r(704)),c="mediasoup-client",s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t?(this._debug=(0,o.default)("".concat(c,":").concat(t)),this._warn=(0,o.default)("".concat(c,":WARN:").concat(t)),this._error=(0,o.default)("".concat(c,":ERROR:").concat(t))):(this._debug=(0,o.default)(c),this._warn=(0,o.default)("".concat(c,":WARN")),this._error=(0,o.default)("".concat(c,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}var t,r;return t=e,(r=[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}])&&i(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.Logger=s},274:(e,t,r)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(){i=function(){return t};var e,t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},c="function"==typeof Symbol?Symbol:{},s=c.iterator||"@@iterator",u=c.asyncIterator||"@@asyncIterator",p=c.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var i=t&&t.prototype instanceof b?t:b,a=Object.create(i.prototype),c=new C(n||[]);return o(a,"_invoke",{value:j(e,r,c)}),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",m="suspendedYield",v="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};l(S,s,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(D([])));k&&k!==r&&a.call(k,s)&&(S=k);var P=_.prototype=b.prototype=Object.create(S);function R(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(i,o,c,s){var u=f(e[i],e,o);if("throw"!==u.type){var p=u.arg,l=p.value;return l&&"object"==n(l)&&a.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,c,s)}),(function(e){r("throw",e,c,s)})):t.resolve(l).then((function(e){p.value=e,c(p)}),(function(e){return r("throw",e,c,s)}))}s(u.arg)}var i;o(this,"_invoke",{value:function(e,n){function a(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(a,a):a()}})}function j(t,r,n){var i=h;return function(a,o){if(i===v)throw new Error("Generator is already running");if(i===y){if("throw"===a)throw o;return{value:e,done:!0}}for(n.method=a,n.arg=o;;){var c=n.delegate;if(c){var s=E(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=v;var u=f(t,r,n);if("normal"===u.type){if(i=n.done?y:m,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=y,n.method="throw",n.arg=u.arg)}}}function E(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,E(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(i,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var o=a.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(a.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=_,o(P,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,p,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,p,"GeneratorFunction")),e.prototype=Object.create(P),e},t.awrap=function(e){return{__await:e}},R(O.prototype),l(O.prototype,u,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,i,a){void 0===a&&(a=Promise);var o=new O(d(e,r,n,i),a);return t.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},R(P),l(P,p,"Generator"),l(P,s,(function(){return this})),l(P,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,i){return c.type="throw",c.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],c=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=a.call(o,"catchLoc"),u=a.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;L(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function a(e,t,r,n,i,a,o){try{var c=e[a](o),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,i)}function o(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function c(e){a(o,n,i,c,s,"next",e)}function s(e){a(o,n,i,c,s,"throw",e)}c(void 0)}))}}function c(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,a=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key),"symbol"===n(a)?a:String(a)),i)}var a}function s(e,t){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},s(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.Producer=void 0;var l=r(647),d=r(938),f=r(561),h=new l.Logger("Producer"),m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&s(e,t)}(w,e);var t,r,a,l,m,v,y,g,b=(y=w,g=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=p(y);if(g){var r=p(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return u(e)}(this,e)});function w(e){var t,r=e.id,n=e.localId,i=e.rtpSender,a=e.track,o=e.rtpParameters,c=e.stopTracks,s=e.disableTrackOnPause,p=e.zeroRtpOnPause,l=e.appData;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,w),(t=b.call(this))._closed=!1,t._observer=new d.EnhancedEventEmitter,h.debug("constructor()"),t._id=r,t._localId=n,t._rtpSender=i,t._track=a,t._kind=a.kind,t._rtpParameters=o,t._paused=!!s&&!a.enabled,t._maxSpatialLayer=void 0,t._stopTracks=c,t._disableTrackOnPause=s,t._zeroRtpOnPause=p,t._appData=l||{},t.onTrackEnded=t.onTrackEnded.bind(u(t)),t.handleTrack(),t}return t=w,r=[{key:"id",get:function(){return this._id}},{key:"localId",get:function(){return this._localId}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._kind}},{key:"rtpSender",get:function(){return this._rtpSender}},{key:"track",get:function(){return this._track}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"paused",get:function(){return this._paused}},{key:"maxSpatialLayer",get:function(){return this._maxSpatialLayer}},{key:"appData",get:function(){return this._appData},set:function(e){throw new Error("cannot override appData object")}},{key:"observer",get:function(){return this._observer}},{key:"close",value:function(){this._closed||(h.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}},{key:"transportClosed",value:function(){this._closed||(h.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}},{key:"getStats",value:(v=o(i().mark((function e(){var t=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=2;break}throw new f.InvalidStateError("closed");case 2:return e.abrupt("return",new Promise((function(e,r){t.safeEmit("@getstats",e,r)})));case 3:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"pause",value:function(){var e=this;h.debug("pause()"),this._closed?h.error("pause() | Producer closed"):(this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((function(t,r){e.safeEmit("@pause",t,r)})).catch((function(){})),this._observer.safeEmit("pause"))}},{key:"resume",value:function(){var e=this;h.debug("resume()"),this._closed?h.error("resume() | Producer closed"):(this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((function(t,r){e.safeEmit("@resume",t,r)})).catch((function(){})),this._observer.safeEmit("resume"))}},{key:"replaceTrack",value:(m=o(i().mark((function e(t){var r,n=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.track,h.debug("replaceTrack() [track:%o]",r),!this._closed){e.next=7;break}if(r&&this._stopTracks)try{r.stop()}catch(e){}throw new f.InvalidStateError("closed");case 7:if(!r||"ended"!==r.readyState){e.next=9;break}throw new f.InvalidStateError("track ended");case 9:if(r!==this._track){e.next=12;break}return h.debug("replaceTrack() | same track, ignored"),e.abrupt("return");case 12:return e.next=14,new Promise((function(e,t){n.safeEmit("@replacetrack",r,e,t)}));case 14:this.destroyTrack(),this._track=r,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack();case 18:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(l=o(i().mark((function e(t){var r=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=4;break}throw new f.InvalidStateError("closed");case 4:if("video"===this._kind){e.next=8;break}throw new f.UnsupportedError("not a video Producer");case 8:if("number"==typeof t){e.next=10;break}throw new TypeError("invalid spatialLayer");case 10:if(t!==this._maxSpatialLayer){e.next=12;break}return e.abrupt("return");case 12:return e.next=14,new Promise((function(e,n){r.safeEmit("@setmaxspatiallayer",t,e,n)})).catch((function(){}));case 14:this._maxSpatialLayer=t;case 15:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(a=o(i().mark((function e(t){var r=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=4;break}throw new f.InvalidStateError("closed");case 4:if("object"===n(t)){e.next=6;break}throw new TypeError("invalid params");case 6:return e.next=8,new Promise((function(e,n){r.safeEmit("@setrtpencodingparameters",t,e,n)}));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"onTrackEnded",value:function(){h.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}},{key:"handleTrack",value:function(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}},{key:"destroyTrack",value:function(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch(e){}}}],r&&c(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),w}(d.EnhancedEventEmitter);t.Producer=m},354:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},852:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},995:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(){i=function(){return t};var e,t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},c="function"==typeof Symbol?Symbol:{},s=c.iterator||"@@iterator",u=c.asyncIterator||"@@asyncIterator",p=c.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var i=t&&t.prototype instanceof b?t:b,a=Object.create(i.prototype),c=new C(n||[]);return o(a,"_invoke",{value:j(e,r,c)}),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",m="suspendedYield",v="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};l(S,s,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(D([])));k&&k!==r&&a.call(k,s)&&(S=k);var P=_.prototype=b.prototype=Object.create(S);function R(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(i,o,c,s){var u=f(e[i],e,o);if("throw"!==u.type){var p=u.arg,l=p.value;return l&&"object"==n(l)&&a.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,c,s)}),(function(e){r("throw",e,c,s)})):t.resolve(l).then((function(e){p.value=e,c(p)}),(function(e){return r("throw",e,c,s)}))}s(u.arg)}var i;o(this,"_invoke",{value:function(e,n){function a(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(a,a):a()}})}function j(t,r,n){var i=h;return function(a,o){if(i===v)throw new Error("Generator is already running");if(i===y){if("throw"===a)throw o;return{value:e,done:!0}}for(n.method=a,n.arg=o;;){var c=n.delegate;if(c){var s=E(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=v;var u=f(t,r,n);if("normal"===u.type){if(i=n.done?y:m,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=y,n.method="throw",n.arg=u.arg)}}}function E(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,E(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(i,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var o=a.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(a.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=_,o(P,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,p,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,p,"GeneratorFunction")),e.prototype=Object.create(P),e},t.awrap=function(e){return{__await:e}},R(O.prototype),l(O.prototype,u,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,i,a){void 0===a&&(a=Promise);var o=new O(d(e,r,n,i),a);return t.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},R(P),l(P,p,"Generator"),l(P,s,(function(){return this})),l(P,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,i){return c.type="throw",c.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],c=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=a.call(o,"catchLoc"),u=a.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;L(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function a(e,t,r,n,i,a,o){try{var c=e[a](o),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,i)}function o(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function c(e){a(o,n,i,c,s,"next",e)}function s(e){a(o,n,i,c,s,"throw",e)}c(void 0)}))}}function c(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=s(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){c=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(c)throw a}}}}function s(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function p(e,t){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},p(e,t)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function d(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,a=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key),"symbol"===n(a)?a:String(a)),i)}var a}function f(e,t,r){return t&&d(e.prototype,t),r&&d(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var m=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),v=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),y=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&m(t,e,r);return v(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Transport=void 0;var g=r(811),b=r(647),w=r(938),_=r(561),S=y(r(650)),x=y(r(646)),k=r(274),P=r(729),R=r(953),O=r(174),j=new b.Logger("Transport"),E=f((function e(t){var r=this;h(this,e),this.consumerOptions=t,this.promise=new Promise((function(e,t){r.resolve=e,r.reject=t}))})),T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}(D,e);var t,r,a,d,m,v,y,b,T,L,C=(T=D,L=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=l(T);if(L){var r=l(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function D(e){var t,r=e.direction,n=e.id,i=e.iceParameters,a=e.iceCandidates,o=e.dtlsParameters,c=e.sctpParameters,s=e.iceServers,u=e.iceTransportPolicy,p=e.additionalSettings,l=e.proprietaryConstraints,d=e.appData,f=e.handlerFactory,m=e.extendedRtpCapabilities,v=e.canProduceByKind;return h(this,D),(t=C.call(this))._closed=!1,t._connectionState="new",t._producers=new Map,t._consumers=new Map,t._dataProducers=new Map,t._dataConsumers=new Map,t._probatorConsumerCreated=!1,t._awaitQueue=new g.AwaitQueue,t._pendingConsumerTasks=[],t._consumerCreationInProgress=!1,t._pendingPauseConsumers=new Map,t._consumerPauseInProgress=!1,t._pendingResumeConsumers=new Map,t._consumerResumeInProgress=!1,t._pendingCloseConsumers=new Map,t._consumerCloseInProgress=!1,t._observer=new w.EnhancedEventEmitter,j.debug("constructor() [id:%s, direction:%s]",n,r),t._id=n,t._direction=r,t._extendedRtpCapabilities=m,t._canProduceByKind=v,t._maxSctpMessageSize=c?c.maxMessageSize:null,delete(p=S.clone(p,{})).iceServers,delete p.iceTransportPolicy,delete p.bundlePolicy,delete p.rtcpMuxPolicy,delete p.sdpSemantics,t._handler=f(),t._handler.run({direction:r,iceParameters:i,iceCandidates:a,dtlsParameters:o,sctpParameters:c,iceServers:s,iceTransportPolicy:u,additionalSettings:p,proprietaryConstraints:l,extendedRtpCapabilities:m}),t._appData=d||{},t.handleHandler(),t}return f(D,[{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"direction",get:function(){return this._direction}},{key:"handler",get:function(){return this._handler}},{key:"connectionState",get:function(){return this._connectionState}},{key:"appData",get:function(){return this._appData},set:function(e){throw new Error("cannot override appData object")}},{key:"observer",get:function(){return this._observer}},{key:"close",value:function(){if(!this._closed){j.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close();var e,t=c(this._producers.values());try{for(t.s();!(e=t.n()).done;)e.value.transportClosed()}catch(e){t.e(e)}finally{t.f()}this._producers.clear();var r,n=c(this._consumers.values());try{for(n.s();!(r=n.n()).done;)r.value.transportClosed()}catch(e){n.e(e)}finally{n.f()}this._consumers.clear();var i,a=c(this._dataProducers.values());try{for(a.s();!(i=a.n()).done;)i.value.transportClosed()}catch(e){a.e(e)}finally{a.f()}this._dataProducers.clear();var o,s=c(this._dataConsumers.values());try{for(s.s();!(o=s.n()).done;)o.value.transportClosed()}catch(e){s.e(e)}finally{s.f()}this._dataConsumers.clear(),this._observer.safeEmit("close")}}},{key:"getStats",value:(b=o(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=2;break}throw new _.InvalidStateError("closed");case 2:return e.abrupt("return",this._handler.getTransportStats());case 3:case"end":return e.stop()}}),e,this)}))),function(){return b.apply(this,arguments)})},{key:"restartIce",value:(y=o(i().mark((function e(t){var r,n=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.iceParameters,j.debug("restartIce()"),!this._closed){e.next=6;break}throw new _.InvalidStateError("closed");case 6:if(r){e.next=8;break}throw new TypeError("missing iceParameters");case 8:return e.abrupt("return",this._awaitQueue.push(o(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n._handler.restartIce(r));case 1:case"end":return e.stop()}}),e)}))),"transport.restartIce()"));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"updateIceServers",value:(v=o(i().mark((function e(){var t,r=this,n=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(n.length>0&&void 0!==n[0]?n[0]:{}).iceServers,j.debug("updateIceServers()"),!this._closed){e.next=6;break}throw new _.InvalidStateError("closed");case 6:if(Array.isArray(t)){e.next=8;break}throw new TypeError("missing iceServers");case 8:return e.abrupt("return",this._awaitQueue.push(o(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r._handler.updateIceServers(t));case 1:case"end":return e.stop()}}),e)}))),"transport.updateIceServers()"));case 9:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"produce",value:(m=o(i().mark((function e(){var t,r,a,c,s,u,p,l,d,f,h,m,v,y=this,g=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(t=g.length>0&&void 0!==g[0]?g[0]:{}).track,a=t.encodings,c=t.codecOptions,s=t.codec,u=t.stopTracks,p=void 0===u||u,l=t.disableTrackOnPause,d=void 0===l||l,f=t.zeroRtpOnPause,h=void 0!==f&&f,m=t.appData,v=void 0===m?{}:m,j.debug("produce() [track:%o]",r),!this._closed){e.next=6;break}throw new _.InvalidStateError("closed");case 6:if(r){e.next=10;break}throw new TypeError("missing track");case 10:if("send"===this._direction){e.next=14;break}throw new _.UnsupportedError("not a sending Transport");case 14:if(this._canProduceByKind[r.kind]){e.next=18;break}throw new _.UnsupportedError("cannot produce ".concat(r.kind));case 18:if("ended"!==r.readyState){e.next=22;break}throw new _.InvalidStateError("track ended");case 22:if(0!==this.listenerCount("connect")||"new"!==this._connectionState){e.next=26;break}throw new TypeError('no "connect" listener set into this transport');case 26:if(0!==this.listenerCount("produce")){e.next=30;break}throw new TypeError('no "produce" listener set into this transport');case 30:if(!v||"object"===n(v)){e.next=32;break}throw new TypeError("if given, appData must be an object");case 32:return e.abrupt("return",this._awaitQueue.push(o(i().mark((function e(){var t,n,o,u,l,f,m,g;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a||Array.isArray(a)){e.next=4;break}throw TypeError("encodings must be an array");case 4:a&&0===a.length?t=void 0:a&&(t=a.map((function(e){var t={active:!0};return!1===e.active&&(t.active=!1),"boolean"==typeof e.dtx&&(t.dtx=e.dtx),"string"==typeof e.scalabilityMode&&(t.scalabilityMode=e.scalabilityMode),"number"==typeof e.scaleResolutionDownBy&&(t.scaleResolutionDownBy=e.scaleResolutionDownBy),"number"==typeof e.maxBitrate&&(t.maxBitrate=e.maxBitrate),"number"==typeof e.maxFramerate&&(t.maxFramerate=e.maxFramerate),"boolean"==typeof e.adaptivePtime&&(t.adaptivePtime=e.adaptivePtime),"string"==typeof e.priority&&(t.priority=e.priority),"string"==typeof e.networkPriority&&(t.networkPriority=e.networkPriority),t})));case 5:return e.next=7,y._handler.send({track:r,encodings:t,codecOptions:c,codec:s});case 7:return n=e.sent,o=n.localId,u=n.rtpParameters,l=n.rtpSender,e.prev=11,x.validateRtpParameters(u),e.next=15,new Promise((function(e,t){y.safeEmit("produce",{kind:r.kind,rtpParameters:u,appData:v},e,t)}));case 15:return f=e.sent,m=f.id,g=new k.Producer({id:m,localId:o,rtpSender:l,track:r,rtpParameters:u,stopTracks:p,disableTrackOnPause:d,zeroRtpOnPause:h,appData:v}),y._producers.set(g.id,g),y.handleProducer(g),y._observer.safeEmit("newproducer",g),e.abrupt("return",g);case 24:throw e.prev=24,e.t0=e.catch(11),y._handler.stopSending(o).catch((function(){})),e.t0;case 28:case"end":return e.stop()}}),e,null,[[11,24]])}))),"transport.produce()").catch((function(e){if(p)try{r.stop()}catch(e){}throw e})));case 33:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"consume",value:(d=o(i().mark((function e(t){var r,a,o,c,s,u,p,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.id,a=t.producerId,o=t.kind,c=t.rtpParameters,s=t.streamId,u=t.appData,p=void 0===u?{}:u,j.debug("consume()"),c=S.clone(c,void 0),!this._closed){e.next=7;break}throw new _.InvalidStateError("closed");case 7:if("recv"===this._direction){e.next=11;break}throw new _.UnsupportedError("not a receiving Transport");case 11:if("string"==typeof r){e.next=15;break}throw new TypeError("missing id");case 15:if("string"==typeof a){e.next=19;break}throw new TypeError("missing producerId");case 19:if("audio"===o||"video"===o){e.next=23;break}throw new TypeError("invalid kind '".concat(o,"'"));case 23:if(0!==this.listenerCount("connect")||"new"!==this._connectionState){e.next=27;break}throw new TypeError('no "connect" listener set into this transport');case 27:if(!p||"object"===n(p)){e.next=29;break}throw new TypeError("if given, appData must be an object");case 29:if(x.canReceive(c,this._extendedRtpCapabilities)){e.next=32;break}throw new _.UnsupportedError("cannot consume this Producer");case 32:return l=new E({id:r,producerId:a,kind:o,rtpParameters:c,streamId:s,appData:p}),this._pendingConsumerTasks.push(l),!1===this._consumerCreationInProgress&&this.createPendingConsumers(),e.abrupt("return",l.promise);case 36:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"produceData",value:(a=o(i().mark((function e(){var t,r,a,c,s,u,p,l,d,f,h,m=this,v=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(t=v.length>0&&void 0!==v[0]?v[0]:{}).ordered,a=void 0===r||r,c=t.maxPacketLifeTime,s=t.maxRetransmits,u=t.label,p=void 0===u?"":u,l=t.protocol,d=void 0===l?"":l,f=t.appData,h=void 0===f?{}:f,j.debug("produceData()"),!this._closed){e.next=6;break}throw new _.InvalidStateError("closed");case 6:if("send"===this._direction){e.next=10;break}throw new _.UnsupportedError("not a sending Transport");case 10:if(this._maxSctpMessageSize){e.next=14;break}throw new _.UnsupportedError("SCTP not enabled by remote Transport");case 14:if(0!==this.listenerCount("connect")||"new"!==this._connectionState){e.next=18;break}throw new TypeError('no "connect" listener set into this transport');case 18:if(0!==this.listenerCount("producedata")){e.next=22;break}throw new TypeError('no "producedata" listener set into this transport');case 22:if(!h||"object"===n(h)){e.next=24;break}throw new TypeError("if given, appData must be an object");case 24:return(c||s)&&(a=!1),e.abrupt("return",this._awaitQueue.push(o(i().mark((function e(){var t,r,n,o,u,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m._handler.sendDataChannel({ordered:a,maxPacketLifeTime:c,maxRetransmits:s,label:p,protocol:d});case 2:return t=e.sent,r=t.dataChannel,n=t.sctpStreamParameters,x.validateSctpStreamParameters(n),e.next=8,new Promise((function(e,t){m.safeEmit("producedata",{sctpStreamParameters:n,label:p,protocol:d,appData:h},e,t)}));case 8:return o=e.sent,u=o.id,l=new R.DataProducer({id:u,dataChannel:r,sctpStreamParameters:n,appData:h}),m._dataProducers.set(l.id,l),m.handleDataProducer(l),m._observer.safeEmit("newdataproducer",l),e.abrupt("return",l);case 15:case"end":return e.stop()}}),e)}))),"transport.produceData()"));case 26:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"consumeData",value:(r=o(i().mark((function e(t){var r,a,c,s,u,p,l,d,f,h=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.id,a=t.dataProducerId,c=t.sctpStreamParameters,s=t.label,u=void 0===s?"":s,p=t.protocol,l=void 0===p?"":p,d=t.appData,f=void 0===d?{}:d,j.debug("consumeData()"),c=S.clone(c,void 0),!this._closed){e.next=7;break}throw new _.InvalidStateError("closed");case 7:if("recv"===this._direction){e.next=11;break}throw new _.UnsupportedError("not a receiving Transport");case 11:if(this._maxSctpMessageSize){e.next=15;break}throw new _.UnsupportedError("SCTP not enabled by remote Transport");case 15:if("string"==typeof r){e.next=19;break}throw new TypeError("missing id");case 19:if("string"==typeof a){e.next=23;break}throw new TypeError("missing dataProducerId");case 23:if(0!==this.listenerCount("connect")||"new"!==this._connectionState){e.next=27;break}throw new TypeError('no "connect" listener set into this transport');case 27:if(!f||"object"===n(f)){e.next=29;break}throw new TypeError("if given, appData must be an object");case 29:return x.validateSctpStreamParameters(c),e.abrupt("return",this._awaitQueue.push(o(i().mark((function e(){var t,n,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h._handler.receiveDataChannel({sctpStreamParameters:c,label:u,protocol:l});case 2:return t=e.sent,n=t.dataChannel,o=new O.DataConsumer({id:r,dataProducerId:a,dataChannel:n,sctpStreamParameters:c,appData:f}),h._dataConsumers.set(o.id,o),h.handleDataConsumer(o),h._observer.safeEmit("newdataconsumer",o),e.abrupt("return",o);case 9:case"end":return e.stop()}}),e)}))),"transport.consumeData()"));case 31:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"createPendingConsumers",value:(t=o(i().mark((function e(){var t=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._consumerCreationInProgress=!0,this._awaitQueue.push(o(i().mark((function e(){var r,n,a,o,p,l,d,f,h,m,v,y,g,b,w,_,S,k,R,O,E,T,L,C,D,M,I,A;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t._pendingConsumerTasks.length){e.next=3;break}return j.debug("createPendingConsumers() | there is no Consumer to be created"),e.abrupt("return");case 3:i=t._pendingConsumerTasks,r=function(e){if(Array.isArray(e))return u(e)}(i)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(i)||s(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),t._pendingConsumerTasks=[],n=void 0,a=[],o=c(r);try{for(o.s();!(p=o.n()).done;)l=p.value,d=l.consumerOptions,f=d.id,h=d.kind,m=d.rtpParameters,v=d.streamId,a.push({trackId:f,kind:h,rtpParameters:m,streamId:v})}catch(e){o.e(e)}finally{o.f()}return e.prev=9,e.next=12,t._handler.receive(a);case 12:for(y=e.sent,g=0;g<y.length;g++)b=r[g],w=y[g],_=b.consumerOptions,S=_.id,k=_.producerId,R=_.kind,O=_.rtpParameters,E=_.appData,T=w.localId,L=w.rtpReceiver,C=w.track,D=new P.Consumer({id:S,localId:T,producerId:k,rtpReceiver:L,track:C,rtpParameters:O,appData:E}),t._consumers.set(D.id,D),t.handleConsumer(D),t._probatorConsumerCreated||n||"video"!==R||(n=D),t._observer.safeEmit("newconsumer",D),b.resolve(D);e.next=20;break;case 16:e.prev=16,e.t0=e.catch(9),M=c(r);try{for(M.s();!(I=M.n()).done;)I.value.reject(e.t0)}catch(e){M.e(e)}finally{M.f()}case 20:if(!n){e.next=32;break}return e.prev=21,A=x.generateProbatorRtpParameters(n.rtpParameters),e.next=25,t._handler.receive([{trackId:"probator",kind:"video",rtpParameters:A}]);case 25:j.debug("createPendingConsumers() | Consumer for RTP probation created"),t._probatorConsumerCreated=!0,e.next=32;break;case 29:e.prev=29,e.t1=e.catch(21),j.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",e.t1);case 32:case"end":return e.stop()}var i}),e,null,[[9,16],[21,29]])}))),"transport.createPendingConsumers()").then((function(){t._consumerCreationInProgress=!1,t._pendingConsumerTasks.length>0&&t.createPendingConsumers()})).catch((function(){}));case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"pausePendingConsumers",value:function(){var e=this;this._consumerPauseInProgress=!0,this._awaitQueue.push(o(i().mark((function t(){var r,n;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e._pendingPauseConsumers.size){t.next=3;break}return j.debug("pausePendingConsumers() | there is no Consumer to be paused"),t.abrupt("return");case 3:return r=Array.from(e._pendingPauseConsumers.values()),e._pendingPauseConsumers.clear(),t.prev=5,n=r.map((function(e){return e.localId})),t.next=9,e._handler.pauseReceiving(n);case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(5),j.error("pausePendingConsumers() | failed to pause Consumers:",t.t0);case 14:case"end":return t.stop()}}),t,null,[[5,11]])}))),"transport.pausePendingConsumers").then((function(){e._consumerPauseInProgress=!1,e._pendingPauseConsumers.size>0&&e.pausePendingConsumers()})).catch((function(){}))}},{key:"resumePendingConsumers",value:function(){var e=this;this._consumerResumeInProgress=!0,this._awaitQueue.push(o(i().mark((function t(){var r,n;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e._pendingResumeConsumers.size){t.next=3;break}return j.debug("resumePendingConsumers() | there is no Consumer to be resumed"),t.abrupt("return");case 3:return r=Array.from(e._pendingResumeConsumers.values()),e._pendingResumeConsumers.clear(),t.prev=5,n=r.map((function(e){return e.localId})),t.next=9,e._handler.resumeReceiving(n);case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(5),j.error("resumePendingConsumers() | failed to resume Consumers:",t.t0);case 14:case"end":return t.stop()}}),t,null,[[5,11]])}))),"transport.resumePendingConsumers").then((function(){e._consumerResumeInProgress=!1,e._pendingResumeConsumers.size>0&&e.resumePendingConsumers()})).catch((function(){}))}},{key:"closePendingConsumers",value:function(){var e=this;this._consumerCloseInProgress=!0,this._awaitQueue.push(o(i().mark((function t(){var r;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e._pendingCloseConsumers.size){t.next=3;break}return j.debug("closePendingConsumers() | there is no Consumer to be closed"),t.abrupt("return");case 3:return r=Array.from(e._pendingCloseConsumers.values()),e._pendingCloseConsumers.clear(),t.prev=5,t.next=8,e._handler.stopReceiving(r.map((function(e){return e.localId})));case 8:t.next=13;break;case 10:t.prev=10,t.t0=t.catch(5),j.error("closePendingConsumers() | failed to close Consumers:",t.t0);case 13:case"end":return t.stop()}}),t,null,[[5,10]])}))),"transport.closePendingConsumers").then((function(){e._consumerCloseInProgress=!1,e._pendingCloseConsumers.size>0&&e.closePendingConsumers()})).catch((function(){}))}},{key:"handleHandler",value:function(){var e=this,t=this._handler;t.on("@connect",(function(t,r,n){var i=t.dtlsParameters;e._closed?n(new _.InvalidStateError("closed")):e.safeEmit("connect",{dtlsParameters:i},r,n)})),t.on("@connectionstatechange",(function(t){t!==e._connectionState&&(j.debug("connection state changed to %s",t),e._connectionState=t,e._closed||e.safeEmit("connectionstatechange",t))}))}},{key:"handleProducer",value:function(e){var t=this;e.on("@close",(function(){t._producers.delete(e.id),t._closed||t._awaitQueue.push(o(i().mark((function r(){return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t._handler.stopSending(e.localId));case 1:case"end":return r.stop()}}),r)}))),"producer @close event").catch((function(e){return j.warn("producer.close() failed:%o",e)}))})),e.on("@pause",(function(r,n){t._awaitQueue.push(o(i().mark((function r(){return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t._handler.pauseSending(e.localId));case 1:case"end":return r.stop()}}),r)}))),"producer @pause event").then(r).catch(n)})),e.on("@resume",(function(r,n){t._awaitQueue.push(o(i().mark((function r(){return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t._handler.resumeSending(e.localId));case 1:case"end":return r.stop()}}),r)}))),"producer @resume event").then(r).catch(n)})),e.on("@replacetrack",(function(r,n,a){t._awaitQueue.push(o(i().mark((function n(){return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t._handler.replaceTrack(e.localId,r));case 1:case"end":return n.stop()}}),n)}))),"producer @replacetrack event").then(n).catch(a)})),e.on("@setmaxspatiallayer",(function(r,n,a){t._awaitQueue.push(o(i().mark((function n(){return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t._handler.setMaxSpatialLayer(e.localId,r));case 1:case"end":return n.stop()}}),n)}))),"producer @setmaxspatiallayer event").then(n).catch(a)})),e.on("@setrtpencodingparameters",(function(r,n,a){t._awaitQueue.push(o(i().mark((function n(){return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t._handler.setRtpEncodingParameters(e.localId,r));case 1:case"end":return n.stop()}}),n)}))),"producer @setrtpencodingparameters event").then(n).catch(a)})),e.on("@getstats",(function(r,n){if(t._closed)return n(new _.InvalidStateError("closed"));t._handler.getSenderStats(e.localId).then(r).catch(n)}))}},{key:"handleConsumer",value:function(e){var t=this;e.on("@close",(function(){t._consumers.delete(e.id),t._pendingPauseConsumers.delete(e.id),t._pendingResumeConsumers.delete(e.id),t._closed||(t._pendingCloseConsumers.set(e.id,e),!1===t._consumerCloseInProgress&&t.closePendingConsumers())})),e.on("@pause",(function(){t._pendingResumeConsumers.has(e.id)&&t._pendingResumeConsumers.delete(e.id),t._pendingPauseConsumers.set(e.id,e),!1===t._consumerPauseInProgress&&t.pausePendingConsumers()})),e.on("@resume",(function(){t._pendingPauseConsumers.has(e.id)&&t._pendingPauseConsumers.delete(e.id),t._pendingResumeConsumers.set(e.id,e),!1===t._consumerResumeInProgress&&t.resumePendingConsumers()})),e.on("@getstats",(function(r,n){if(t._closed)return n(new _.InvalidStateError("closed"));t._handler.getReceiverStats(e.localId).then(r).catch(n)}))}},{key:"handleDataProducer",value:function(e){var t=this;e.on("@close",(function(){t._dataProducers.delete(e.id)}))}},{key:"handleDataConsumer",value:function(e){var t=this;e.on("@close",(function(){t._dataConsumers.delete(e.id)}))}}]),D}(w.EnhancedEventEmitter);t.Transport=T},561:(e,t)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,a=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key),"symbol"===r(a)?a:String(a)),i)}var a}function i(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}function c(e){var t=l();return function(){var n,i=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return s(e)}(this,n)}}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){var t="function"==typeof Map?new Map:void 0;return u=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return p(e,arguments,f(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),d(r,e)},u(e)}function p(e,t,r){return p=l()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&d(i,r.prototype),i},p.apply(null,arguments)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function d(e,t){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},d(e,t)}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidStateError=t.UnsupportedError=void 0;var h=function(e){o(r,e);var t=c(r);function r(e){var n;return a(this,r),(n=t.call(this,e)).name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(s(n),r):n.stack=new Error(e).stack,n}return i(r)}(u(Error));t.UnsupportedError=h;var m=function(e){o(r,e);var t=c(r);function r(e){var n;return a(this,r),(n=t.call(this,e)).name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(s(n),r):n.stack=new Error(e).stack,n}return i(r)}(u(Error));t.InvalidStateError=m},102:function(e,t,r){"use strict";function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},n.apply(this,arguments)}function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){s=!0,a=e},f:function(){try{c||null==r.return||r.return()}finally{if(s)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(){s=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},c=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",p=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var i=t&&t.prototype instanceof b?t:b,o=Object.create(i.prototype),c=new C(n||[]);return a(o,"_invoke",{value:j(e,r,c)}),o}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",m="suspendedYield",v="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};l(S,c,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(D([])));k&&k!==r&&n.call(k,c)&&(S=k);var P=_.prototype=b.prototype=Object.create(S);function R(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(a,o,c,s){var u=f(e[a],e,o);if("throw"!==u.type){var p=u.arg,l=p.value;return l&&"object"==i(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,c,s)}),(function(e){r("throw",e,c,s)})):t.resolve(l).then((function(e){p.value=e,c(p)}),(function(e){return r("throw",e,c,s)}))}s(u.arg)}var o;a(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function j(t,r,n){var i=h;return function(a,o){if(i===v)throw new Error("Generator is already running");if(i===y){if("throw"===a)throw o;return{value:e,done:!0}}for(n.method=a,n.arg=o;;){var c=n.delegate;if(c){var s=E(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=v;var u=f(t,r,n);if("normal"===u.type){if(i=n.done?y:m,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=y,n.method="throw",n.arg=u.arg)}}}function E(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,E(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(i,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var o=a.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function r(){for(;++a<t.length;)if(n.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(i(t)+" is not iterable")}return w.prototype=_,a(P,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,p,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,p,"GeneratorFunction")),e.prototype=Object.create(P),e},t.awrap=function(e){return{__await:e}},R(O.prototype),l(O.prototype,u,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,i,a){void 0===a&&(a=Promise);var o=new O(d(e,r,n,i),a);return t.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},R(P),l(P,p,"Generator"),l(P,c,(function(){return this})),l(P,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return c.type="throw",c.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],c=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;L(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function u(e,t,r,n,i,a,o){try{var c=e[a](o),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,i)}function p(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){u(a,n,i,o,c,"next",e)}function c(e){u(a,n,i,o,c,"throw",e)}o(void 0)}))}}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,d(n.key),n)}}function d(e){var t=function(e,t){if("object"!==i(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===i(t)?t:String(t)}function f(e,t){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},f(e,t)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}var m=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),v=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),y=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&m(t,e,r);return v(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome55=void 0;var g=y(r(669)),b=r(647),w=r(561),_=y(r(650)),S=y(r(646)),x=y(r(683)),k=y(r(978)),P=r(244),R=r(384),O=new b.Logger("Chrome55"),j={OS:1024,MIS:1024},E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}(Q,e);var t,r,o,u,m,v,y,b,P,E,T,L,C,D,M,I,A,F,N,B,G,z,U,K,V,Y,q=(V=Q,Y=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=h(V);if(Y){var r=h(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function Q(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Q),(e=q.call(this))._sendStream=new MediaStream,e._mapSendLocalIdTrack=new Map,e._nextSendLocalId=0,e._mapRecvLocalIdInfo=new Map,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=Q,r=[{key:"name",get:function(){return"Chrome55"}},{key:"close",value:function(){if(O.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}},{key:"getNativeRtpCapabilities",value:(K=p(s().mark((function e(){var t,r,n,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),e.prev=2,e.next=5,t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 5:r=e.sent;try{t.close()}catch(e){}return n=g.parse(r.sdp),i=x.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",i);case 12:e.prev=12,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[2,12]])}))),function(){return K.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(U=p(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:j});case 2:case"end":return e.stop()}}),e)}))),function(){return U.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,i=e.iceCandidates,a=e.dtlsParameters,o=e.sctpParameters,s=e.iceServers,u=e.iceTransportPolicy,p=e.additionalSettings,l=e.proprietaryConstraints,f=e.extendedRtpCapabilities;O.debug("run()"),this._direction=r,this._remoteSdp=new R.RemoteSdp({iceParameters:n,iceCandidates:i,dtlsParameters:a,sctpParameters:o,planB:!0}),this._sendingRtpParametersByKind={audio:S.getSendingRtpParameters("audio",f),video:S.getSendingRtpParameters("video",f)},this._sendingRemoteRtpParametersByKind={audio:S.getSendingRemoteRtpParameters("audio",f),video:S.getSendingRemoteRtpParameters("video",f)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){var n,i,a;n=e,i=t,a=r[t],(i=d(i))in n?Object.defineProperty(n,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[i]=a})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({iceServers:s||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},p),l),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(function(){t.emit("@connectionstatechange",t._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(function(){switch(O.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:(z=p(s().mark((function e(t){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:O.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return z.apply(this,arguments)})},{key:"restartIce",value:(G=p(s().mark((function e(t){var r,n,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,O.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return a=e.sent,O.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),e.next=27,this._pc.setLocalDescription(a);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return G.apply(this,arguments)})},{key:"getTransportStats",value:(B=p(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return B.apply(this,arguments)})},{key:"send",value:(N=p(s().mark((function e(t){var r,i,o,c,u,p,l,d,f,h,m,v,y,b,w;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,i=t.encodings,o=t.codecOptions,c=t.codec,this.assertSendDirection(),O.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),c&&O.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(r),this._pc.addStream(this._sendStream),e.next=8,this._pc.createOffer();case 8:if(p=e.sent,l=g.parse(p.sdp),(f=_.clone(this._sendingRtpParametersByKind[r.kind],{})).codecs=S.reduceCodecs(f.codecs),(h=_.clone(this._sendingRemoteRtpParametersByKind[r.kind],{})).codecs=S.reduceCodecs(h.codecs),this._transportReady){e.next=17;break}return e.next=17,this.setupTransport({localDtlsRole:null!==(u=this._forcedLocalDtlsRole)&&void 0!==u?u:"client",localSdpObject:l});case 17:return"video"===r.kind&&i&&i.length>1&&(O.debug("send() | enabling simulcast"),l=g.parse(p.sdp),d=l.media.find((function(e){return"video"===e.type})),k.addLegacySimulcast({offerMediaObject:d,track:r,numStreams:i.length}),p={type:"offer",sdp:g.write(l)}),O.debug("send() | calling pc.setLocalDescription() [offer:%o]",p),e.next=21,this._pc.setLocalDescription(p);case 21:if(l=g.parse(this._pc.localDescription.sdp),d=l.media.find((function(e){return e.type===r.kind})),f.rtcp.cname=x.getCname({offerMediaObject:d}),f.encodings=k.getRtpEncodings({offerMediaObject:d,track:r}),i)for(m=0;m<f.encodings.length;++m)i[m]&&n(f.encodings[m],i[m]);if(f.encodings.length>1&&"video/vp8"===f.codecs[0].mimeType.toLowerCase()){v=a(f.encodings);try{for(v.s();!(y=v.n()).done;)y.value.scalabilityMode="S1T3"}catch(e){v.e(e)}finally{v.f()}}return this._remoteSdp.send({offerMediaObject:d,offerRtpParameters:f,answerRtpParameters:h,codecOptions:o}),b={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("send() | calling pc.setRemoteDescription() [answer:%o]",b),e.next=32,this._pc.setRemoteDescription(b);case 32:return w=String(this._nextSendLocalId),this._nextSendLocalId++,this._mapSendLocalIdTrack.set(w,r),e.abrupt("return",{localId:w,rtpParameters:f});case 36:case"end":return e.stop()}}),e,this)}))),function(e){return N.apply(this,arguments)})},{key:"stopSending",value:(F=p(s().mark((function e(t){var r,n,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),O.debug("stopSending() [localId:%s]",t),r=this._mapSendLocalIdTrack.get(t)){e.next=5;break}throw new Error("track not found");case 5:return this._mapSendLocalIdTrack.delete(t),this._sendStream.removeTrack(r),this._pc.addStream(this._sendStream),e.next=10,this._pc.createOffer();case 10:return n=e.sent,O.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.prev=12,e.next=15,this._pc.setLocalDescription(n);case 15:e.next=23;break;case 17:if(e.prev=17,e.t0=e.catch(12),0!==this._sendStream.getTracks().length){e.next=22;break}return O.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.t0.toString()),e.abrupt("return");case 22:throw e.t0;case 23:if("stable"!==this._pc.signalingState){e.next=25;break}return e.abrupt("return");case 25:return i={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=29,this._pc.setRemoteDescription(i);case 29:case"end":return e.stop()}}),e,this,[[12,17]])}))),function(e){return F.apply(this,arguments)})},{key:"pauseSending",value:(A=p(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return A.apply(this,arguments)})},{key:"resumeSending",value:(I=p(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return I.apply(this,arguments)})},{key:"replaceTrack",value:(M=p(s().mark((function e(t,r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new w.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return M.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(D=p(s().mark((function e(t,r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new w.UnsupportedError(" not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return D.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(C=p(s().mark((function e(t,r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new w.UnsupportedError("not supported");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return C.apply(this,arguments)})},{key:"getSenderStats",value:(L=p(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new w.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return L.apply(this,arguments)})},{key:"sendDataChannel",value:(T=p(s().mark((function e(t){var r,n,i,a,o,c,u,p,l,d,f,h,m;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,a=t.label,o=t.protocol,this.assertSendDirection(),u={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmitTime:n,maxRetransmits:i,protocol:o},O.debug("sendDataChannel() [options:%o]",u),p=this._pc.createDataChannel(a,u),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%j.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(l=e.sent,d=g.parse(l.sdp),f=d.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this.setupTransport({localDtlsRole:null!==(c=this._forcedLocalDtlsRole)&&void 0!==c?c:"client",localSdpObject:d});case 15:return O.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=18,this._pc.setLocalDescription(l);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:f}),h={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=23,this._pc.setRemoteDescription(h);case 23:this._hasDataChannelMediaSection=!0;case 24:return m={streamId:u.id,ordered:u.ordered,maxPacketLifeTime:u.maxPacketLifeTime,maxRetransmits:u.maxRetransmits},e.abrupt("return",{dataChannel:p,sctpStreamParameters:m});case 26:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"receive",value:(E=p(s().mark((function e(t){var r,n,i,o,c,u,p,l,d,f,h,m,v,y,b,w,_,S,k,P=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),n=[],i=a(t);try{for(i.s();!(o=i.n()).done;)c=o.value,u=c.trackId,p=c.kind,l=c.rtpParameters,d=c.streamId,O.debug("receive() [trackId:%s, kind:%s]",u,p),f=p,this._remoteSdp.receive({mid:f,kind:p,offerRtpParameters:l,streamId:d||l.rtcp.cname,trackId:u})}catch(e){i.e(e)}finally{i.f()}return h={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",h),e.next=8,this._pc.setRemoteDescription(h);case 8:return e.next=10,this._pc.createAnswer();case 10:m=e.sent,v=g.parse(m.sdp),y=a(t),e.prev=13,w=s().mark((function e(){var t,r,n,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=b.value,r=t.kind,n=t.rtpParameters,i=r,a=v.media.find((function(e){return String(e.mid)===i})),x.applyCodecParameters({offerRtpParameters:n,answerMediaObject:a});case 5:case"end":return e.stop()}}),e)})),y.s();case 16:if((b=y.n()).done){e.next=20;break}return e.delegateYield(w(),"t0",18);case 18:e.next=16;break;case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(13),y.e(e.t1);case 25:return e.prev=25,y.f(),e.finish(25);case 28:if(m={type:"answer",sdp:g.write(v)},this._transportReady){e.next=32;break}return e.next=32,this.setupTransport({localDtlsRole:null!==(r=this._forcedLocalDtlsRole)&&void 0!==r?r:"client",localSdpObject:v});case 32:return O.debug("receive() | calling pc.setLocalDescription() [answer:%o]",m),e.next=35,this._pc.setLocalDescription(m);case 35:_=a(t),e.prev=36,k=s().mark((function e(){var t,r,i,a,o,c,u,p,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=S.value,r=t.kind,i=t.trackId,a=t.rtpParameters,o=r,c=i,u=t.streamId||a.rtcp.cname,p=P._pc.getRemoteStreams().find((function(e){return e.id===u})),l=p.getTrackById(c)){e.next=9;break}throw new Error("remote track not found");case 9:P._mapRecvLocalIdInfo.set(c,{mid:o,rtpParameters:a}),n.push({localId:c,track:l});case 11:case"end":return e.stop()}}),e)})),_.s();case 39:if((S=_.n()).done){e.next=43;break}return e.delegateYield(k(),"t2",41);case 41:e.next=39;break;case 43:e.next=48;break;case 45:e.prev=45,e.t3=e.catch(36),_.e(e.t3);case 48:return e.prev=48,_.f(),e.finish(48);case 51:return e.abrupt("return",n);case 52:case"end":return e.stop()}}),e,this,[[13,22,25,28],[36,45,48,51]])}))),function(e){return E.apply(this,arguments)})},{key:"stopReceiving",value:(P=p(s().mark((function e(t){var r,n,i,o,c,u,p,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=a(t);try{for(r.s();!(n=r.n()).done;)i=n.value,O.debug("stopReceiving() [localId:%s]",i),o=this._mapRecvLocalIdInfo.get(i)||{},c=o.mid,u=o.rtpParameters,this._mapRecvLocalIdInfo.delete(i),this._remoteSdp.planBStopReceiving({mid:c,offerRtpParameters:u})}catch(e){r.e(e)}finally{r.f()}return p={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",p),e.next=7,this._pc.setRemoteDescription(p);case 7:return e.next=9,this._pc.createAnswer();case 9:return l=e.sent,O.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",l),e.next=13,this._pc.setLocalDescription(l);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return P.apply(this,arguments)})},{key:"pauseReceiving",value:(b=p(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return b.apply(this,arguments)})},{key:"resumeReceiving",value:(y=p(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return y.apply(this,arguments)})},{key:"getReceiverStats",value:(v=p(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new w.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return v.apply(this,arguments)})},{key:"receiveDataChannel",value:(m=p(s().mark((function e(t){var r,n,i,a,o,c,u,p,l,d,f,h,m;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this.assertRecvDirection(),o=r.streamId,c=r.ordered,u=r.maxPacketLifeTime,p=r.maxRetransmits,l={negotiated:!0,id:o,ordered:c,maxPacketLifeTime:u,maxRetransmitTime:u,maxRetransmits:p,protocol:i},O.debug("receiveDataChannel() [options:%o]",l),d=this._pc.createDataChannel(n,l),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),f={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=12,this._pc.setRemoteDescription(f);case 12:return e.next=14,this._pc.createAnswer();case 14:if(h=e.sent,this._transportReady){e.next=19;break}return m=g.parse(h.sdp),e.next=19,this.setupTransport({localDtlsRole:null!==(a=this._forcedLocalDtlsRole)&&void 0!==a?a:"client",localSdpObject:m});case 19:return O.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=22,this._pc.setLocalDescription(h);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:d});case 24:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"setupTransport",value:(u=p(s().mark((function e(t){var r,n,i,a=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=g.parse(this._pc.localDescription.sdp)),(i=x.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,new Promise((function(e,t){a.safeEmit("@connect",{dtlsParameters:i},e,t)}));case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}],o=[{key:"createFactory",value:function(){return function(){return new Q}}}],r&&l(t.prototype,r),o&&l(t,o),Object.defineProperty(t,"prototype",{writable:!1}),Q}(P.HandlerInterface);t.Chrome55=E},459:function(e,t,r){"use strict";function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},n.apply(this,arguments)}function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){s=!0,a=e},f:function(){try{c||null==r.return||r.return()}finally{if(s)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){var n,i,a;n=e,i=t,a=r[t],(i=f(i))in n?Object.defineProperty(n,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[i]=a})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(){u=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},c=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",p=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var i=t&&t.prototype instanceof b?t:b,o=Object.create(i.prototype),c=new C(n||[]);return a(o,"_invoke",{value:j(e,r,c)}),o}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",m="suspendedYield",v="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};l(S,c,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(D([])));k&&k!==r&&n.call(k,c)&&(S=k);var P=_.prototype=b.prototype=Object.create(S);function R(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(a,o,c,s){var u=f(e[a],e,o);if("throw"!==u.type){var p=u.arg,l=p.value;return l&&"object"==i(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,c,s)}),(function(e){r("throw",e,c,s)})):t.resolve(l).then((function(e){p.value=e,c(p)}),(function(e){return r("throw",e,c,s)}))}s(u.arg)}var o;a(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function j(t,r,n){var i=h;return function(a,o){if(i===v)throw new Error("Generator is already running");if(i===y){if("throw"===a)throw o;return{value:e,done:!0}}for(n.method=a,n.arg=o;;){var c=n.delegate;if(c){var s=E(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=v;var u=f(t,r,n);if("normal"===u.type){if(i=n.done?y:m,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=y,n.method="throw",n.arg=u.arg)}}}function E(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,E(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(i,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var o=a.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function r(){for(;++a<t.length;)if(n.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(i(t)+" is not iterable")}return w.prototype=_,a(P,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,p,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,p,"GeneratorFunction")),e.prototype=Object.create(P),e},t.awrap=function(e){return{__await:e}},R(O.prototype),l(O.prototype,s,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,i,a){void 0===a&&(a=Promise);var o=new O(d(e,r,n,i),a);return t.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},R(P),l(P,p,"Generator"),l(P,c,(function(){return this})),l(P,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return c.type="throw",c.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],c=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;L(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function p(e,t,r,n,i,a,o){try{var c=e[a](o),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,i)}function l(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){p(a,n,i,o,c,"next",e)}function c(e){p(a,n,i,o,c,"throw",e)}o(void 0)}))}}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function f(e){var t=function(e,t){if("object"!==i(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===i(t)?t:String(t)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}var v=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),y=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),g=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&v(t,e,r);return y(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome67=void 0;var b=g(r(669)),w=r(647),_=g(r(650)),S=g(r(646)),x=g(r(683)),k=g(r(978)),P=r(244),R=r(384),O=new w.Logger("Chrome67"),j={OS:1024,MIS:1024},E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(Y,e);var t,r,o,c,p,f,v,y,g,w,P,E,T,L,C,D,M,I,A,F,N,B,G,z,U,K,V=(U=Y,K=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=m(U);if(K){var r=m(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function Y(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Y),(e=V.call(this))._sendStream=new MediaStream,e._mapSendLocalIdRtpSender=new Map,e._nextSendLocalId=0,e._mapRecvLocalIdInfo=new Map,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=Y,r=[{key:"name",get:function(){return"Chrome67"}},{key:"close",value:function(){if(O.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}},{key:"getNativeRtpCapabilities",value:(z=l(u().mark((function e(){var t,r,n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),e.prev=2,e.next=5,t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 5:r=e.sent;try{t.close()}catch(e){}return n=b.parse(r.sdp),i=x.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",i);case 12:e.prev=12,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[2,12]])}))),function(){return z.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(G=l(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:j});case 2:case"end":return e.stop()}}),e)}))),function(){return G.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,i=e.iceCandidates,a=e.dtlsParameters,o=e.sctpParameters,c=e.iceServers,u=e.iceTransportPolicy,p=e.additionalSettings,l=e.proprietaryConstraints,d=e.extendedRtpCapabilities;O.debug("run()"),this._direction=r,this._remoteSdp=new R.RemoteSdp({iceParameters:n,iceCandidates:i,dtlsParameters:a,sctpParameters:o,planB:!0}),this._sendingRtpParametersByKind={audio:S.getSendingRtpParameters("audio",d),video:S.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:S.getSendingRemoteRtpParameters("audio",d),video:S.getSendingRemoteRtpParameters("video",d)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection(s({iceServers:c||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},p),l),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(function(){t.emit("@connectionstatechange",t._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(function(){switch(O.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:(B=l(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:O.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"restartIce",value:(N=l(u().mark((function e(t){var r,n,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,O.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return a=e.sent,O.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),e.next=27,this._pc.setLocalDescription(a);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return N.apply(this,arguments)})},{key:"getTransportStats",value:(F=l(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return F.apply(this,arguments)})},{key:"send",value:(A=l(u().mark((function e(t){var r,i,o,c,s,p,l,d,f,h,m,v,y,g,w,P;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,i=t.encodings,o=t.codecOptions,c=t.codec,this.assertSendDirection(),O.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),c&&O.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(r),this._pc.addTrack(r,this._sendStream),e.next=8,this._pc.createOffer();case 8:if(p=e.sent,l=b.parse(p.sdp),(f=_.clone(this._sendingRtpParametersByKind[r.kind],{})).codecs=S.reduceCodecs(f.codecs),(h=_.clone(this._sendingRemoteRtpParametersByKind[r.kind],{})).codecs=S.reduceCodecs(h.codecs),this._transportReady){e.next=17;break}return e.next=17,this.setupTransport({localDtlsRole:null!==(s=this._forcedLocalDtlsRole)&&void 0!==s?s:"client",localSdpObject:l});case 17:return"video"===r.kind&&i&&i.length>1&&(O.debug("send() | enabling simulcast"),l=b.parse(p.sdp),d=l.media.find((function(e){return"video"===e.type})),k.addLegacySimulcast({offerMediaObject:d,track:r,numStreams:i.length}),p={type:"offer",sdp:b.write(l)}),O.debug("send() | calling pc.setLocalDescription() [offer:%o]",p),e.next=21,this._pc.setLocalDescription(p);case 21:if(l=b.parse(this._pc.localDescription.sdp),d=l.media.find((function(e){return e.type===r.kind})),f.rtcp.cname=x.getCname({offerMediaObject:d}),f.encodings=k.getRtpEncodings({offerMediaObject:d,track:r}),i)for(m=0;m<f.encodings.length;++m)i[m]&&n(f.encodings[m],i[m]);if(f.encodings.length>1&&"video/vp8"===f.codecs[0].mimeType.toLowerCase()){v=a(f.encodings);try{for(v.s();!(y=v.n()).done;)y.value.scalabilityMode="S1T3"}catch(e){v.e(e)}finally{v.f()}}return this._remoteSdp.send({offerMediaObject:d,offerRtpParameters:f,answerRtpParameters:h,codecOptions:o}),g={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("send() | calling pc.setRemoteDescription() [answer:%o]",g),e.next=32,this._pc.setRemoteDescription(g);case 32:return w=String(this._nextSendLocalId),this._nextSendLocalId++,P=this._pc.getSenders().find((function(e){return e.track===r})),this._mapSendLocalIdRtpSender.set(w,P),e.abrupt("return",{localId:w,rtpParameters:f,rtpSender:P});case 37:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"stopSending",value:(I=l(u().mark((function e(t){var r,n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),O.debug("stopSending() [localId:%s]",t),r=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return this._pc.removeTrack(r),r.track&&this._sendStream.removeTrack(r.track),this._mapSendLocalIdRtpSender.delete(t),e.next=10,this._pc.createOffer();case 10:return n=e.sent,O.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.prev=12,e.next=15,this._pc.setLocalDescription(n);case 15:e.next=23;break;case 17:if(e.prev=17,e.t0=e.catch(12),0!==this._sendStream.getTracks().length){e.next=22;break}return O.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.t0.toString()),e.abrupt("return");case 22:throw e.t0;case 23:if("stable"!==this._pc.signalingState){e.next=25;break}return e.abrupt("return");case 25:return i={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=29,this._pc.setRemoteDescription(i);case 29:case"end":return e.stop()}}),e,this,[[12,17]])}))),function(e){return I.apply(this,arguments)})},{key:"pauseSending",value:(M=l(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return M.apply(this,arguments)})},{key:"resumeSending",value:(D=l(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return D.apply(this,arguments)})},{key:"replaceTrack",value:(C=l(u().mark((function e(t,r){var n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),r?O.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):O.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return i=n.track,e.next=8,n.replaceTrack(r);case 8:i&&this._sendStream.removeTrack(i),r&&this._sendStream.addTrack(r);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return C.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(L=l(u().mark((function e(t,r){var n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),O.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return(i=n.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=9,n.setParameters(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return L.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(T=l(u().mark((function e(t,r){var n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),O.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return(i=n.getParameters()).encodings.forEach((function(e,t){i.encodings[t]=s(s({},e),r)})),e.next=9,n.setParameters(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return T.apply(this,arguments)})},{key:"getSenderStats",value:(E=l(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),r=this._mapSendLocalIdRtpSender.get(t)){e.next=4;break}throw new Error("associated RTCRtpSender not found");case 4:return e.abrupt("return",r.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"sendDataChannel",value:(P=l(u().mark((function e(t){var r,n,i,a,o,c,s,p,l,d,f,h,m;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,a=t.label,o=t.protocol,this.assertSendDirection(),s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmitTime:n,maxRetransmits:i,protocol:o},O.debug("sendDataChannel() [options:%o]",s),p=this._pc.createDataChannel(a,s),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%j.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(l=e.sent,d=b.parse(l.sdp),f=d.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this.setupTransport({localDtlsRole:null!==(c=this._forcedLocalDtlsRole)&&void 0!==c?c:"client",localSdpObject:d});case 15:return O.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=18,this._pc.setLocalDescription(l);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:f}),h={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=23,this._pc.setRemoteDescription(h);case 23:this._hasDataChannelMediaSection=!0;case 24:return m={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits},e.abrupt("return",{dataChannel:p,sctpStreamParameters:m});case 26:case"end":return e.stop()}}),e,this)}))),function(e){return P.apply(this,arguments)})},{key:"receive",value:(w=l(u().mark((function e(t){var r,n,i,o,c,s,p,l,d,f,h,m,v,y,g,w,_,S,k,P=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),n=[],i=a(t);try{for(i.s();!(o=i.n()).done;)c=o.value,s=c.trackId,p=c.kind,l=c.rtpParameters,d=c.streamId,O.debug("receive() [trackId:%s, kind:%s]",s,p),f=p,this._remoteSdp.receive({mid:f,kind:p,offerRtpParameters:l,streamId:d||l.rtcp.cname,trackId:s})}catch(e){i.e(e)}finally{i.f()}return h={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",h),e.next=8,this._pc.setRemoteDescription(h);case 8:return e.next=10,this._pc.createAnswer();case 10:m=e.sent,v=b.parse(m.sdp),y=a(t),e.prev=13,w=u().mark((function e(){var t,r,n,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=g.value,r=t.kind,n=t.rtpParameters,i=r,a=v.media.find((function(e){return String(e.mid)===i})),x.applyCodecParameters({offerRtpParameters:n,answerMediaObject:a});case 5:case"end":return e.stop()}}),e)})),y.s();case 16:if((g=y.n()).done){e.next=20;break}return e.delegateYield(w(),"t0",18);case 18:e.next=16;break;case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(13),y.e(e.t1);case 25:return e.prev=25,y.f(),e.finish(25);case 28:if(m={type:"answer",sdp:b.write(v)},this._transportReady){e.next=32;break}return e.next=32,this.setupTransport({localDtlsRole:null!==(r=this._forcedLocalDtlsRole)&&void 0!==r?r:"client",localSdpObject:v});case 32:return O.debug("receive() | calling pc.setLocalDescription() [answer:%o]",m),e.next=35,this._pc.setLocalDescription(m);case 35:_=a(t),e.prev=36,k=u().mark((function e(){var t,r,i,a,o,c,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=S.value,r=t.kind,i=t.trackId,a=t.rtpParameters,o=i,c=r,s=P._pc.getReceivers().find((function(e){return e.track&&e.track.id===o}))){e.next=7;break}throw new Error("new RTCRtpReceiver not");case 7:P._mapRecvLocalIdInfo.set(o,{mid:c,rtpParameters:a,rtpReceiver:s}),n.push({localId:o,track:s.track,rtpReceiver:s});case 9:case"end":return e.stop()}}),e)})),_.s();case 39:if((S=_.n()).done){e.next=43;break}return e.delegateYield(k(),"t2",41);case 41:e.next=39;break;case 43:e.next=48;break;case 45:e.prev=45,e.t3=e.catch(36),_.e(e.t3);case 48:return e.prev=48,_.f(),e.finish(48);case 51:return e.abrupt("return",n);case 52:case"end":return e.stop()}}),e,this,[[13,22,25,28],[36,45,48,51]])}))),function(e){return w.apply(this,arguments)})},{key:"stopReceiving",value:(g=l(u().mark((function e(t){var r,n,i,o,c,s,p,l;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=a(t);try{for(r.s();!(n=r.n()).done;)i=n.value,O.debug("stopReceiving() [localId:%s]",i),o=this._mapRecvLocalIdInfo.get(i)||{},c=o.mid,s=o.rtpParameters,this._mapRecvLocalIdInfo.delete(i),this._remoteSdp.planBStopReceiving({mid:c,offerRtpParameters:s})}catch(e){r.e(e)}finally{r.f()}return p={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",p),e.next=7,this._pc.setRemoteDescription(p);case 7:return e.next=9,this._pc.createAnswer();case 9:return l=e.sent,O.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",l),e.next=13,this._pc.setLocalDescription(l);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"pauseReceiving",value:(y=l(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return y.apply(this,arguments)})},{key:"resumeReceiving",value:(v=l(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return v.apply(this,arguments)})},{key:"getReceiverStats",value:(f=l(u().mark((function e(t){var r,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertRecvDirection(),r=this._mapRecvLocalIdInfo.get(t)||{},n=r.rtpReceiver){e.next=4;break}throw new Error("associated RTCRtpReceiver not found");case 4:return e.abrupt("return",n.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"receiveDataChannel",value:(p=l(u().mark((function e(t){var r,n,i,a,o,c,s,p,l,d,f,h,m;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this.assertRecvDirection(),o=r.streamId,c=r.ordered,s=r.maxPacketLifeTime,p=r.maxRetransmits,l={negotiated:!0,id:o,ordered:c,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:p,protocol:i},O.debug("receiveDataChannel() [options:%o]",l),d=this._pc.createDataChannel(n,l),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),f={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=12,this._pc.setRemoteDescription(f);case 12:return e.next=14,this._pc.createAnswer();case 14:if(h=e.sent,this._transportReady){e.next=19;break}return m=b.parse(h.sdp),e.next=19,this.setupTransport({localDtlsRole:null!==(a=this._forcedLocalDtlsRole)&&void 0!==a?a:"client",localSdpObject:m});case 19:return O.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=22,this._pc.setLocalDescription(h);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:d});case 24:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"setupTransport",value:(c=l(u().mark((function e(t){var r,n,i,a=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=b.parse(this._pc.localDescription.sdp)),(i=x.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,new Promise((function(e,t){a.safeEmit("@connect",{dtlsParameters:i},e,t)}));case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}],o=[{key:"createFactory",value:function(){return function(){return new Y}}}],r&&d(t.prototype,r),o&&d(t,o),Object.defineProperty(t,"prototype",{writable:!1}),Y}(P.HandlerInterface);t.Chrome67=E},670:function(e,t,r){"use strict";function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},n.apply(this,arguments)}function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){s=!0,a=e},f:function(){try{c||null==r.return||r.return()}finally{if(s)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){var n,i,a;n=e,i=t,a=r[t],(i=f(i))in n?Object.defineProperty(n,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[i]=a})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(){u=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},c=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",p=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var i=t&&t.prototype instanceof b?t:b,o=Object.create(i.prototype),c=new C(n||[]);return a(o,"_invoke",{value:j(e,r,c)}),o}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",m="suspendedYield",v="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};l(S,c,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(D([])));k&&k!==r&&n.call(k,c)&&(S=k);var P=_.prototype=b.prototype=Object.create(S);function R(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(a,o,c,s){var u=f(e[a],e,o);if("throw"!==u.type){var p=u.arg,l=p.value;return l&&"object"==i(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,c,s)}),(function(e){r("throw",e,c,s)})):t.resolve(l).then((function(e){p.value=e,c(p)}),(function(e){return r("throw",e,c,s)}))}s(u.arg)}var o;a(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function j(t,r,n){var i=h;return function(a,o){if(i===v)throw new Error("Generator is already running");if(i===y){if("throw"===a)throw o;return{value:e,done:!0}}for(n.method=a,n.arg=o;;){var c=n.delegate;if(c){var s=E(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=v;var u=f(t,r,n);if("normal"===u.type){if(i=n.done?y:m,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=y,n.method="throw",n.arg=u.arg)}}}function E(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,E(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(i,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var o=a.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function r(){for(;++a<t.length;)if(n.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(i(t)+" is not iterable")}return w.prototype=_,a(P,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,p,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,p,"GeneratorFunction")),e.prototype=Object.create(P),e},t.awrap=function(e){return{__await:e}},R(O.prototype),l(O.prototype,s,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,i,a){void 0===a&&(a=Promise);var o=new O(d(e,r,n,i),a);return t.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},R(P),l(P,p,"Generator"),l(P,c,(function(){return this})),l(P,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return c.type="throw",c.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],c=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;L(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function p(e,t,r,n,i,a,o){try{var c=e[a](o),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,i)}function l(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){p(a,n,i,o,c,"next",e)}function c(e){p(a,n,i,o,c,"throw",e)}o(void 0)}))}}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function f(e){var t=function(e,t){if("object"!==i(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===i(t)?t:String(t)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}var v=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),y=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),g=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&v(t,e,r);return y(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome70=void 0;var b=g(r(669)),w=r(647),_=g(r(650)),S=g(r(646)),x=g(r(683)),k=g(r(569)),P=r(244),R=r(384),O=r(209),j=new w.Logger("Chrome70"),E={OS:1024,MIS:1024},T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(q,e);var t,r,o,c,p,f,v,y,g,w,P,T,L,C,D,M,I,A,F,N,B,G,z,U,K,V,Y=(K=q,V=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=m(K);if(V){var r=m(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function q(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,q),(e=Y.call(this))._mapMidTransceiver=new Map,e._sendStream=new MediaStream,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=q,r=[{key:"name",get:function(){return"Chrome70"}},{key:"close",value:function(){if(j.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}},{key:"getNativeRtpCapabilities",value:(U=l(u().mark((function e(){var t,r,n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"}),e.prev=2,t.addTransceiver("audio"),t.addTransceiver("video"),e.next=7,t.createOffer();case 7:r=e.sent;try{t.close()}catch(e){}return n=b.parse(r.sdp),i=x.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",i);case 14:e.prev=14,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 18:case"end":return e.stop()}}),e,null,[[2,14]])}))),function(){return U.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(z=l(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:E});case 2:case"end":return e.stop()}}),e)}))),function(){return z.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,i=e.iceCandidates,a=e.dtlsParameters,o=e.sctpParameters,c=e.iceServers,u=e.iceTransportPolicy,p=e.additionalSettings,l=e.proprietaryConstraints,d=e.extendedRtpCapabilities;j.debug("run()"),this._direction=r,this._remoteSdp=new R.RemoteSdp({iceParameters:n,iceCandidates:i,dtlsParameters:a,sctpParameters:o}),this._sendingRtpParametersByKind={audio:S.getSendingRtpParameters("audio",d),video:S.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:S.getSendingRemoteRtpParameters("audio",d),video:S.getSendingRemoteRtpParameters("video",d)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection(s({iceServers:c||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},p),l),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(function(){t.emit("@connectionstatechange",t._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(function(){switch(j.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:(G=l(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:j.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return G.apply(this,arguments)})},{key:"restartIce",value:(B=l(u().mark((function e(t){var r,n,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(j.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,j.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},j.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},j.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return a=e.sent,j.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),e.next=27,this._pc.setLocalDescription(a);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"getTransportStats",value:(N=l(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return N.apply(this,arguments)})},{key:"send",value:(F=l(u().mark((function e(t){var r,i,o,c,s,p,l,d,f,h,m,v,y,g,w,P,R,E,T,L,C,D,M;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,i=t.encodings,o=t.codecOptions,c=t.codec,this.assertSendDirection(),j.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),(p=_.clone(this._sendingRtpParametersByKind[r.kind],{})).codecs=S.reduceCodecs(p.codecs,c),(l=_.clone(this._sendingRemoteRtpParametersByKind[r.kind],{})).codecs=S.reduceCodecs(l.codecs,c),d=this._remoteSdp.getNextMediaSectionIdx(),f=this._pc.addTransceiver(r,{direction:"sendonly",streams:[this._sendStream]}),e.next=11,this._pc.createOffer();case 11:if(h=e.sent,m=b.parse(h.sdp),this._transportReady){e.next=16;break}return e.next=16,this.setupTransport({localDtlsRole:null!==(s=this._forcedLocalDtlsRole)&&void 0!==s?s:"client",localSdpObject:m});case 16:return i&&i.length>1&&(j.debug("send() | enabling legacy simulcast"),m=b.parse(h.sdp),v=m.media[d.idx],k.addLegacySimulcast({offerMediaObject:v,numStreams:i.length}),h={type:"offer",sdp:b.write(m)}),y=!1,g=(0,O.parse)((i||[{}])[0].scalabilityMode),i&&1===i.length&&g.spatialLayers>1&&"video/vp9"===p.codecs[0].mimeType.toLowerCase()&&(j.debug("send() | enabling legacy simulcast for VP9 SVC"),y=!0,m=b.parse(h.sdp),v=m.media[d.idx],k.addLegacySimulcast({offerMediaObject:v,numStreams:g.spatialLayers}),h={type:"offer",sdp:b.write(m)}),j.debug("send() | calling pc.setLocalDescription() [offer:%o]",h),e.next=23,this._pc.setLocalDescription(h);case 23:if(!i){e.next=38;break}j.debug("send() | applying given encodings"),w=f.sender.getParameters(),P=0;case 27:if(!(P<(w.encodings||[]).length)){e.next=36;break}if(R=w.encodings[P],E=i[P]){e.next=32;break}return e.abrupt("break",36);case 32:w.encodings[P]=n(R,E);case 33:++P,e.next=27;break;case 36:return e.next=38,f.sender.setParameters(w);case 38:if(T=f.mid,p.mid=T,m=b.parse(this._pc.localDescription.sdp),v=m.media[d.idx],p.rtcp.cname=x.getCname({offerMediaObject:v}),p.encodings=k.getRtpEncodings({offerMediaObject:v}),i)for(L=0;L<p.encodings.length;++L)i[L]&&n(p.encodings[L],i[L]);if(y&&(p.encodings=[p.encodings[0]]),p.encodings.length>1&&("video/vp8"===p.codecs[0].mimeType.toLowerCase()||"video/h264"===p.codecs[0].mimeType.toLowerCase())){C=a(p.encodings);try{for(C.s();!(D=C.n()).done;)D.value.scalabilityMode="S1T3"}catch(e){C.e(e)}finally{C.f()}}return this._remoteSdp.send({offerMediaObject:v,reuseMid:d.reuseMid,offerRtpParameters:p,answerRtpParameters:l,codecOptions:o}),M={type:"answer",sdp:this._remoteSdp.getSdp()},j.debug("send() | calling pc.setRemoteDescription() [answer:%o]",M),e.next=52,this._pc.setRemoteDescription(M);case 52:return this._mapMidTransceiver.set(T,f),e.abrupt("return",{localId:T,rtpParameters:p,rtpSender:f.sender});case 54:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"stopSending",value:(A=l(u().mark((function e(t){var r,n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),j.debug("stopSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch(e){}return e.next=11,this._pc.createOffer();case 11:return n=e.sent,j.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=15,this._pc.setLocalDescription(n);case 15:return i={type:"answer",sdp:this._remoteSdp.getSdp()},j.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=19,this._pc.setRemoteDescription(i);case 19:this._mapMidTransceiver.delete(t);case 20:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"pauseSending",value:(I=l(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return I.apply(this,arguments)})},{key:"resumeSending",value:(M=l(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return M.apply(this,arguments)})},{key:"replaceTrack",value:(D=l(u().mark((function e(t,r){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),r?j.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):j.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return e.next=7,n.sender.replaceTrack(r);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return D.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(C=l(u().mark((function e(t,r){var n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),j.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=n.sender.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=9,n.sender.setParameters(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return C.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(L=l(u().mark((function e(t,r){var n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),j.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=n.sender.getParameters()).encodings.forEach((function(e,t){i.encodings[t]=s(s({},e),r)})),e.next=9,n.sender.setParameters(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return L.apply(this,arguments)})},{key:"getSenderStats",value:(T=l(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.sender.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"sendDataChannel",value:(P=l(u().mark((function e(t){var r,n,i,a,o,c,s,p,l,d,f,h,m;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,a=t.label,o=t.protocol,this.assertSendDirection(),s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmitTime:n,maxRetransmits:i,protocol:o},j.debug("sendDataChannel() [options:%o]",s),p=this._pc.createDataChannel(a,s),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%E.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(l=e.sent,d=b.parse(l.sdp),f=d.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this.setupTransport({localDtlsRole:null!==(c=this._forcedLocalDtlsRole)&&void 0!==c?c:"client",localSdpObject:d});case 15:return j.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=18,this._pc.setLocalDescription(l);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:f}),h={type:"answer",sdp:this._remoteSdp.getSdp()},j.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=23,this._pc.setRemoteDescription(h);case 23:this._hasDataChannelMediaSection=!0;case 24:return m={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits},e.abrupt("return",{dataChannel:p,sctpStreamParameters:m});case 26:case"end":return e.stop()}}),e,this)}))),function(e){return P.apply(this,arguments)})},{key:"receive",value:(w=l(u().mark((function e(t){var r,n,i,o,c,s,p,l,d,f,h,m,v,y,g,w,_,S,k,P,R=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),n=[],i=new Map,o=a(t);try{for(o.s();!(c=o.n()).done;)s=c.value,p=s.trackId,l=s.kind,d=s.rtpParameters,f=s.streamId,j.debug("receive() [trackId:%s, kind:%s]",p,l),h=d.mid||String(this._mapMidTransceiver.size),i.set(p,h),this._remoteSdp.receive({mid:h,kind:l,offerRtpParameters:d,streamId:f||d.rtcp.cname,trackId:p})}catch(e){o.e(e)}finally{o.f()}return m={type:"offer",sdp:this._remoteSdp.getSdp()},j.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",m),e.next=9,this._pc.setRemoteDescription(m);case 9:return e.next=11,this._pc.createAnswer();case 11:v=e.sent,y=b.parse(v.sdp),g=a(t),e.prev=14,_=u().mark((function e(){var t,r,n,a,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=w.value,r=t.trackId,n=t.rtpParameters,a=i.get(r),o=y.media.find((function(e){return String(e.mid)===a})),x.applyCodecParameters({offerRtpParameters:n,answerMediaObject:o});case 5:case"end":return e.stop()}}),e)})),g.s();case 17:if((w=g.n()).done){e.next=21;break}return e.delegateYield(_(),"t0",19);case 19:e.next=17;break;case 21:e.next=26;break;case 23:e.prev=23,e.t1=e.catch(14),g.e(e.t1);case 26:return e.prev=26,g.f(),e.finish(26);case 29:if(v={type:"answer",sdp:b.write(y)},this._transportReady){e.next=33;break}return e.next=33,this.setupTransport({localDtlsRole:null!==(r=this._forcedLocalDtlsRole)&&void 0!==r?r:"client",localSdpObject:y});case 33:return j.debug("receive() | calling pc.setLocalDescription() [answer:%o]",v),e.next=36,this._pc.setLocalDescription(v);case 36:S=a(t),e.prev=37,P=u().mark((function e(){var t,r,a,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=k.value,r=t.trackId,a=i.get(r),o=R._pc.getTransceivers().find((function(e){return e.mid===a}))){e.next=6;break}throw new Error("new RTCRtpTransceiver not found");case 6:R._mapMidTransceiver.set(a,o),n.push({localId:a,track:o.receiver.track,rtpReceiver:o.receiver});case 8:case"end":return e.stop()}}),e)})),S.s();case 40:if((k=S.n()).done){e.next=44;break}return e.delegateYield(P(),"t2",42);case 42:e.next=40;break;case 44:e.next=49;break;case 46:e.prev=46,e.t3=e.catch(37),S.e(e.t3);case 49:return e.prev=49,S.f(),e.finish(49);case 52:return e.abrupt("return",n);case 53:case"end":return e.stop()}}),e,this,[[14,23,26,29],[37,46,49,52]])}))),function(e){return w.apply(this,arguments)})},{key:"stopReceiving",value:(g=l(u().mark((function e(t){var r,n,i,o,c,s,p,l,d;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=a(t),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=13;break}if(i=n.value,j.debug("stopReceiving() [localId:%s]",i),o=this._mapMidTransceiver.get(i)){e.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:this._remoteSdp.closeMediaSection(o.mid);case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return c={type:"offer",sdp:this._remoteSdp.getSdp()},j.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",c),e.next=25,this._pc.setRemoteDescription(c);case 25:return e.next=27,this._pc.createAnswer();case 27:return s=e.sent,j.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),e.next=31,this._pc.setLocalDescription(s);case 31:p=a(t);try{for(p.s();!(l=p.n()).done;)d=l.value,this._mapMidTransceiver.delete(d)}catch(e){p.e(e)}finally{p.f()}case 33:case"end":return e.stop()}}),e,this,[[2,15,18,21]])}))),function(e){return g.apply(this,arguments)})},{key:"pauseReceiving",value:(y=l(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return y.apply(this,arguments)})},{key:"resumeReceiving",value:(v=l(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return v.apply(this,arguments)})},{key:"getReceiverStats",value:(f=l(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertRecvDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.receiver.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"receiveDataChannel",value:(p=l(u().mark((function e(t){var r,n,i,a,o,c,s,p,l,d,f,h,m;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this.assertRecvDirection(),o=r.streamId,c=r.ordered,s=r.maxPacketLifeTime,p=r.maxRetransmits,l={negotiated:!0,id:o,ordered:c,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:p,protocol:i},j.debug("receiveDataChannel() [options:%o]",l),d=this._pc.createDataChannel(n,l),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation(),f={type:"offer",sdp:this._remoteSdp.getSdp()},j.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=12,this._pc.setRemoteDescription(f);case 12:return e.next=14,this._pc.createAnswer();case 14:if(h=e.sent,this._transportReady){e.next=19;break}return m=b.parse(h.sdp),e.next=19,this.setupTransport({localDtlsRole:null!==(a=this._forcedLocalDtlsRole)&&void 0!==a?a:"client",localSdpObject:m});case 19:return j.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=22,this._pc.setLocalDescription(h);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:d});case 24:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"setupTransport",value:(c=l(u().mark((function e(t){var r,n,i,a=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=b.parse(this._pc.localDescription.sdp)),(i=x.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,new Promise((function(e,t){a.safeEmit("@connect",{dtlsParameters:i},e,t)}));case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}],o=[{key:"createFactory",value:function(){return function(){return new q}}}],r&&d(t.prototype,r),o&&d(t,o),Object.defineProperty(t,"prototype",{writable:!1}),q}(P.HandlerInterface);t.Chrome70=T},285:function(e,t,r){"use strict";function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},n.apply(this,arguments)}function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){s=!0,a=e},f:function(){try{c||null==r.return||r.return()}finally{if(s)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){var n,i,a;n=e,i=t,a=r[t],(i=f(i))in n?Object.defineProperty(n,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[i]=a})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(){u=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},c=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",p=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var i=t&&t.prototype instanceof b?t:b,o=Object.create(i.prototype),c=new C(n||[]);return a(o,"_invoke",{value:j(e,r,c)}),o}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",m="suspendedYield",v="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};l(S,c,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(D([])));k&&k!==r&&n.call(k,c)&&(S=k);var P=_.prototype=b.prototype=Object.create(S);function R(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(a,o,c,s){var u=f(e[a],e,o);if("throw"!==u.type){var p=u.arg,l=p.value;return l&&"object"==i(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,c,s)}),(function(e){r("throw",e,c,s)})):t.resolve(l).then((function(e){p.value=e,c(p)}),(function(e){return r("throw",e,c,s)}))}s(u.arg)}var o;a(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function j(t,r,n){var i=h;return function(a,o){if(i===v)throw new Error("Generator is already running");if(i===y){if("throw"===a)throw o;return{value:e,done:!0}}for(n.method=a,n.arg=o;;){var c=n.delegate;if(c){var s=E(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=v;var u=f(t,r,n);if("normal"===u.type){if(i=n.done?y:m,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=y,n.method="throw",n.arg=u.arg)}}}function E(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,E(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(i,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var o=a.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function r(){for(;++a<t.length;)if(n.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(i(t)+" is not iterable")}return w.prototype=_,a(P,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,p,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,p,"GeneratorFunction")),e.prototype=Object.create(P),e},t.awrap=function(e){return{__await:e}},R(O.prototype),l(O.prototype,s,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,i,a){void 0===a&&(a=Promise);var o=new O(d(e,r,n,i),a);return t.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},R(P),l(P,p,"Generator"),l(P,c,(function(){return this})),l(P,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return c.type="throw",c.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],c=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;L(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function p(e,t,r,n,i,a,o){try{var c=e[a](o),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,i)}function l(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){p(a,n,i,o,c,"next",e)}function c(e){p(a,n,i,o,c,"throw",e)}o(void 0)}))}}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function f(e){var t=function(e,t){if("object"!==i(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===i(t)?t:String(t)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}var v=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),y=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),g=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&v(t,e,r);return y(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome74=void 0;var b=g(r(669)),w=r(647),_=g(r(650)),S=g(r(646)),x=g(r(683)),k=g(r(569)),P=r(244),R=r(384),O=r(209),j=new w.Logger("Chrome74"),E={OS:1024,MIS:1024},T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(q,e);var t,r,o,c,p,f,v,y,g,w,P,T,L,C,D,M,I,A,F,N,B,G,z,U,K,V,Y=(K=q,V=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=m(K);if(V){var r=m(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function q(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,q),(e=Y.call(this))._mapMidTransceiver=new Map,e._sendStream=new MediaStream,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=q,r=[{key:"name",get:function(){return"Chrome74"}},{key:"close",value:function(){if(j.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}},{key:"getNativeRtpCapabilities",value:(U=l(u().mark((function e(){var t,r,n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"}),e.prev=2,t.addTransceiver("audio"),t.addTransceiver("video"),e.next=7,t.createOffer();case 7:r=e.sent;try{t.close()}catch(e){}return n=b.parse(r.sdp),i=x.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",i);case 14:e.prev=14,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 18:case"end":return e.stop()}}),e,null,[[2,14]])}))),function(){return U.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(z=l(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:E});case 2:case"end":return e.stop()}}),e)}))),function(){return z.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,i=e.iceCandidates,a=e.dtlsParameters,o=e.sctpParameters,c=e.iceServers,u=e.iceTransportPolicy,p=e.additionalSettings,l=e.proprietaryConstraints,d=e.extendedRtpCapabilities;j.debug("run()"),this._direction=r,this._remoteSdp=new R.RemoteSdp({iceParameters:n,iceCandidates:i,dtlsParameters:a,sctpParameters:o}),this._sendingRtpParametersByKind={audio:S.getSendingRtpParameters("audio",d),video:S.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:S.getSendingRemoteRtpParameters("audio",d),video:S.getSendingRemoteRtpParameters("video",d)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection(s({iceServers:c||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},p),l),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(function(){t.emit("@connectionstatechange",t._pc.connectionState)})):(j.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",(function(){switch(t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}})))}},{key:"updateIceServers",value:(G=l(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:j.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return G.apply(this,arguments)})},{key:"restartIce",value:(B=l(u().mark((function e(t){var r,n,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(j.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,j.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},j.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},j.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return a=e.sent,j.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),e.next=27,this._pc.setLocalDescription(a);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"getTransportStats",value:(N=l(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return N.apply(this,arguments)})},{key:"send",value:(F=l(u().mark((function e(t){var r,i,o,c,s,p,l,d,f,h,m,v,y,g,w,P,R,E,T;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,i=t.encodings,o=t.codecOptions,c=t.codec,this.assertSendDirection(),j.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),i&&i.length>1&&i.forEach((function(e,t){e.rid="r".concat(t)})),(p=_.clone(this._sendingRtpParametersByKind[r.kind],{})).codecs=S.reduceCodecs(p.codecs,c),(l=_.clone(this._sendingRemoteRtpParametersByKind[r.kind],{})).codecs=S.reduceCodecs(l.codecs,c),d=this._remoteSdp.getNextMediaSectionIdx(),f=this._pc.addTransceiver(r,{direction:"sendonly",streams:[this._sendStream],sendEncodings:i}),e.next=12,this._pc.createOffer();case 12:if(h=e.sent,m=b.parse(h.sdp),this._transportReady){e.next=17;break}return e.next=17,this.setupTransport({localDtlsRole:null!==(s=this._forcedLocalDtlsRole)&&void 0!==s?s:"client",localSdpObject:m});case 17:return y=!1,g=(0,O.parse)((i||[{}])[0].scalabilityMode),i&&1===i.length&&g.spatialLayers>1&&"video/vp9"===p.codecs[0].mimeType.toLowerCase()&&(j.debug("send() | enabling legacy simulcast for VP9 SVC"),y=!0,m=b.parse(h.sdp),v=m.media[d.idx],k.addLegacySimulcast({offerMediaObject:v,numStreams:g.spatialLayers}),h={type:"offer",sdp:b.write(m)}),j.debug("send() | calling pc.setLocalDescription() [offer:%o]",h),e.next=23,this._pc.setLocalDescription(h);case 23:if(w=f.mid,p.mid=w,m=b.parse(this._pc.localDescription.sdp),v=m.media[d.idx],p.rtcp.cname=x.getCname({offerMediaObject:v}),i?1===i.length?(n((P=k.getRtpEncodings({offerMediaObject:v}))[0],i[0]),y&&(P=[P[0]]),p.encodings=P):p.encodings=i:p.encodings=k.getRtpEncodings({offerMediaObject:v}),p.encodings.length>1&&("video/vp8"===p.codecs[0].mimeType.toLowerCase()||"video/h264"===p.codecs[0].mimeType.toLowerCase())){R=a(p.encodings);try{for(R.s();!(E=R.n()).done;)E.value.scalabilityMode="S1T3"}catch(e){R.e(e)}finally{R.f()}}return this._remoteSdp.send({offerMediaObject:v,reuseMid:d.reuseMid,offerRtpParameters:p,answerRtpParameters:l,codecOptions:o,extmapAllowMixed:!0}),T={type:"answer",sdp:this._remoteSdp.getSdp()},j.debug("send() | calling pc.setRemoteDescription() [answer:%o]",T),e.next=35,this._pc.setRemoteDescription(T);case 35:return this._mapMidTransceiver.set(w,f),e.abrupt("return",{localId:w,rtpParameters:p,rtpSender:f.sender});case 37:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"stopSending",value:(A=l(u().mark((function e(t){var r,n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),j.debug("stopSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch(e){}return e.next=11,this._pc.createOffer();case 11:return n=e.sent,j.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=15,this._pc.setLocalDescription(n);case 15:return i={type:"answer",sdp:this._remoteSdp.getSdp()},j.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=19,this._pc.setRemoteDescription(i);case 19:this._mapMidTransceiver.delete(t);case 20:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"pauseSending",value:(I=l(u().mark((function e(t){var r,n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),j.debug("pauseSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return r.direction="inactive",this._remoteSdp.pauseMediaSection(t),e.next=9,this._pc.createOffer();case 9:return n=e.sent,j.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=13,this._pc.setLocalDescription(n);case 13:return i={type:"answer",sdp:this._remoteSdp.getSdp()},j.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=17,this._pc.setRemoteDescription(i);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return I.apply(this,arguments)})},{key:"resumeSending",value:(M=l(u().mark((function e(t){var r,n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),j.debug("resumeSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t),this._remoteSdp.resumeSendingMediaSection(t),r){e.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return r.direction="sendonly",e.next=9,this._pc.createOffer();case 9:return n=e.sent,j.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=13,this._pc.setLocalDescription(n);case 13:return i={type:"answer",sdp:this._remoteSdp.getSdp()},j.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=17,this._pc.setRemoteDescription(i);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)})},{key:"replaceTrack",value:(D=l(u().mark((function e(t,r){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),r?j.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):j.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return e.next=7,n.sender.replaceTrack(r);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return D.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(C=l(u().mark((function e(t,r){var n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),j.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=n.sender.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=9,n.sender.setParameters(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return C.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(L=l(u().mark((function e(t,r){var n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),j.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=n.sender.getParameters()).encodings.forEach((function(e,t){i.encodings[t]=s(s({},e),r)})),e.next=9,n.sender.setParameters(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return L.apply(this,arguments)})},{key:"getSenderStats",value:(T=l(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.sender.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"sendDataChannel",value:(P=l(u().mark((function e(t){var r,n,i,a,o,c,s,p,l,d,f,h,m;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,a=t.label,o=t.protocol,this.assertSendDirection(),s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmits:i,protocol:o},j.debug("sendDataChannel() [options:%o]",s),p=this._pc.createDataChannel(a,s),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%E.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(l=e.sent,d=b.parse(l.sdp),f=d.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this.setupTransport({localDtlsRole:null!==(c=this._forcedLocalDtlsRole)&&void 0!==c?c:"client",localSdpObject:d});case 15:return j.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=18,this._pc.setLocalDescription(l);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:f}),h={type:"answer",sdp:this._remoteSdp.getSdp()},j.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=23,this._pc.setRemoteDescription(h);case 23:this._hasDataChannelMediaSection=!0;case 24:return m={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits},e.abrupt("return",{dataChannel:p,sctpStreamParameters:m});case 26:case"end":return e.stop()}}),e,this)}))),function(e){return P.apply(this,arguments)})},{key:"receive",value:(w=l(u().mark((function e(t){var r,n,i,o,c,s,p,l,d,f,h,m,v,y,g,w,_,S,k,P,R=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),n=[],i=new Map,o=a(t);try{for(o.s();!(c=o.n()).done;)s=c.value,p=s.trackId,l=s.kind,d=s.rtpParameters,f=s.streamId,j.debug("receive() [trackId:%s, kind:%s]",p,l),h=d.mid||String(this._mapMidTransceiver.size),i.set(p,h),this._remoteSdp.receive({mid:h,kind:l,offerRtpParameters:d,streamId:f||d.rtcp.cname,trackId:p})}catch(e){o.e(e)}finally{o.f()}return m={type:"offer",sdp:this._remoteSdp.getSdp()},j.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",m),e.next=9,this._pc.setRemoteDescription(m);case 9:return e.next=11,this._pc.createAnswer();case 11:v=e.sent,y=b.parse(v.sdp),g=a(t),e.prev=14,_=u().mark((function e(){var t,r,n,a,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=w.value,r=t.trackId,n=t.rtpParameters,a=i.get(r),o=y.media.find((function(e){return String(e.mid)===a})),x.applyCodecParameters({offerRtpParameters:n,answerMediaObject:o});case 5:case"end":return e.stop()}}),e)})),g.s();case 17:if((w=g.n()).done){e.next=21;break}return e.delegateYield(_(),"t0",19);case 19:e.next=17;break;case 21:e.next=26;break;case 23:e.prev=23,e.t1=e.catch(14),g.e(e.t1);case 26:return e.prev=26,g.f(),e.finish(26);case 29:if(v={type:"answer",sdp:b.write(y)},this._transportReady){e.next=33;break}return e.next=33,this.setupTransport({localDtlsRole:null!==(r=this._forcedLocalDtlsRole)&&void 0!==r?r:"client",localSdpObject:y});case 33:return j.debug("receive() | calling pc.setLocalDescription() [answer:%o]",v),e.next=36,this._pc.setLocalDescription(v);case 36:S=a(t),e.prev=37,P=u().mark((function e(){var t,r,a,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=k.value,r=t.trackId,a=i.get(r),o=R._pc.getTransceivers().find((function(e){return e.mid===a}))){e.next=8;break}throw new Error("new RTCRtpTransceiver not found");case 8:R._mapMidTransceiver.set(a,o),n.push({localId:a,track:o.receiver.track,rtpReceiver:o.receiver});case 10:case"end":return e.stop()}}),e)})),S.s();case 40:if((k=S.n()).done){e.next=44;break}return e.delegateYield(P(),"t2",42);case 42:e.next=40;break;case 44:e.next=49;break;case 46:e.prev=46,e.t3=e.catch(37),S.e(e.t3);case 49:return e.prev=49,S.f(),e.finish(49);case 52:return e.abrupt("return",n);case 53:case"end":return e.stop()}}),e,this,[[14,23,26,29],[37,46,49,52]])}))),function(e){return w.apply(this,arguments)})},{key:"stopReceiving",value:(g=l(u().mark((function e(t){var r,n,i,o,c,s,p,l,d;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=a(t),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=13;break}if(i=n.value,j.debug("stopReceiving() [localId:%s]",i),o=this._mapMidTransceiver.get(i)){e.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:this._remoteSdp.closeMediaSection(o.mid);case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return c={type:"offer",sdp:this._remoteSdp.getSdp()},j.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",c),e.next=25,this._pc.setRemoteDescription(c);case 25:return e.next=27,this._pc.createAnswer();case 27:return s=e.sent,j.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),e.next=31,this._pc.setLocalDescription(s);case 31:p=a(t);try{for(p.s();!(l=p.n()).done;)d=l.value,this._mapMidTransceiver.delete(d)}catch(e){p.e(e)}finally{p.f()}case 33:case"end":return e.stop()}}),e,this,[[2,15,18,21]])}))),function(e){return g.apply(this,arguments)})},{key:"pauseReceiving",value:(y=l(u().mark((function e(t){var r,n,i,o,c,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=a(t),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=14;break}if(i=n.value,j.debug("pauseReceiving() [localId:%s]",i),o=this._mapMidTransceiver.get(i)){e.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:o.direction="inactive",this._remoteSdp.pauseMediaSection(i);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:return c={type:"offer",sdp:this._remoteSdp.getSdp()},j.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",c),e.next=26,this._pc.setRemoteDescription(c);case 26:return e.next=28,this._pc.createAnswer();case 28:return s=e.sent,j.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),e.next=32,this._pc.setLocalDescription(s);case 32:case"end":return e.stop()}}),e,this,[[2,16,19,22]])}))),function(e){return y.apply(this,arguments)})},{key:"resumeReceiving",value:(v=l(u().mark((function e(t){var r,n,i,o,c,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=a(t),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=14;break}if(i=n.value,j.debug("resumeReceiving() [localId:%s]",i),o=this._mapMidTransceiver.get(i)){e.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:o.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:return c={type:"offer",sdp:this._remoteSdp.getSdp()},j.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",c),e.next=26,this._pc.setRemoteDescription(c);case 26:return e.next=28,this._pc.createAnswer();case 28:return s=e.sent,j.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),e.next=32,this._pc.setLocalDescription(s);case 32:case"end":return e.stop()}}),e,this,[[2,16,19,22]])}))),function(e){return v.apply(this,arguments)})},{key:"getReceiverStats",value:(f=l(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertRecvDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.receiver.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"receiveDataChannel",value:(p=l(u().mark((function e(t){var r,n,i,a,o,c,s,p,l,d,f,h,m;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this.assertRecvDirection(),o=r.streamId,c=r.ordered,s=r.maxPacketLifeTime,p=r.maxRetransmits,l={negotiated:!0,id:o,ordered:c,maxPacketLifeTime:s,maxRetransmits:p,protocol:i},j.debug("receiveDataChannel() [options:%o]",l),d=this._pc.createDataChannel(n,l),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation(),f={type:"offer",sdp:this._remoteSdp.getSdp()},j.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=12,this._pc.setRemoteDescription(f);case 12:return e.next=14,this._pc.createAnswer();case 14:if(h=e.sent,this._transportReady){e.next=19;break}return m=b.parse(h.sdp),e.next=19,this.setupTransport({localDtlsRole:null!==(a=this._forcedLocalDtlsRole)&&void 0!==a?a:"client",localSdpObject:m});case 19:return j.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=22,this._pc.setLocalDescription(h);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:d});case 24:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"setupTransport",value:(c=l(u().mark((function e(t){var r,n,i,a=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=b.parse(this._pc.localDescription.sdp)),(i=x.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,new Promise((function(e,t){a.safeEmit("@connect",{dtlsParameters:i},e,t)}));case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}],o=[{key:"createFactory",value:function(){return function(){return new q}}}],r&&d(t.prototype,r),o&&d(t,o),Object.defineProperty(t,"prototype",{writable:!1}),q}(P.HandlerInterface);t.Chrome74=T},5:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){var n,i,a;n=e,i=t,a=r[t],(i=d(i))in n?Object.defineProperty(n,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[i]=a})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(){o=function(){return t};var e,t={},r=Object.prototype,i=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},c="function"==typeof Symbol?Symbol:{},s=c.iterator||"@@iterator",u=c.asyncIterator||"@@asyncIterator",p=c.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var i=t&&t.prototype instanceof b?t:b,o=Object.create(i.prototype),c=new C(n||[]);return a(o,"_invoke",{value:j(e,r,c)}),o}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",m="suspendedYield",v="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};l(S,s,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(D([])));k&&k!==r&&i.call(k,s)&&(S=k);var P=_.prototype=b.prototype=Object.create(S);function R(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(a,o,c,s){var u=f(e[a],e,o);if("throw"!==u.type){var p=u.arg,l=p.value;return l&&"object"==n(l)&&i.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,c,s)}),(function(e){r("throw",e,c,s)})):t.resolve(l).then((function(e){p.value=e,c(p)}),(function(e){return r("throw",e,c,s)}))}s(u.arg)}var o;a(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function j(t,r,n){var i=h;return function(a,o){if(i===v)throw new Error("Generator is already running");if(i===y){if("throw"===a)throw o;return{value:e,done:!0}}for(n.method=a,n.arg=o;;){var c=n.delegate;if(c){var s=E(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=v;var u=f(t,r,n);if("normal"===u.type){if(i=n.done?y:m,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=y,n.method="throw",n.arg=u.arg)}}}function E(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,E(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(i,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var o=a.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function r(){for(;++a<t.length;)if(i.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=_,a(P,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,p,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,p,"GeneratorFunction")),e.prototype=Object.create(P),e},t.awrap=function(e){return{__await:e}},R(O.prototype),l(O.prototype,u,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,i,a){void 0===a&&(a=Promise);var o=new O(d(e,r,n,i),a);return t.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},R(P),l(P,p,"Generator"),l(P,s,(function(){return this})),l(P,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,i){return c.type="throw",c.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],c=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=i.call(o,"catchLoc"),u=i.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;L(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function c(e,t,r,n,i,a,o){try{var c=e[a](o),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,i)}function s(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){c(a,n,i,o,s,"next",e)}function s(e){c(a,n,i,o,s,"throw",e)}o(void 0)}))}}function u(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){c=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(c)throw a}}}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,d(n.key),n)}}function d(e){var t=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===n(t)?t:String(t)}function f(e,t){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},f(e,t)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}var m=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),v=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),y=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&m(t,e,r);return v(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Edge11=void 0;var g=r(647),b=r(561),w=y(r(650)),_=y(r(646)),S=y(r(530)),x=r(244),k=new g.Logger("Edge11"),P=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}(z,e);var t,r,i,c,p,d,m,v,y,g,x,P,R,O,j,E,T,L,C,D,M,I,A,F,N,B,G=(N=z,B=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=h(N);if(B){var r=h(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function z(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,z),(e=G.call(this))._rtpSenders=new Map,e._rtpReceivers=new Map,e._nextSendLocalId=0,e._transportReady=!1,e}return t=z,r=[{key:"name",get:function(){return"Edge11"}},{key:"close",value:function(){k.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}var e,t=u(this._rtpSenders.values());try{for(t.s();!(e=t.n()).done;){var r=e.value;try{r.stop()}catch(e){}}}catch(e){t.e(e)}finally{t.f()}var n,i=u(this._rtpReceivers.values());try{for(i.s();!(n=i.n()).done;){var a=n.value;try{a.stop()}catch(e){}}}catch(e){i.e(e)}finally{i.f()}this.emit("@close")}},{key:"getNativeRtpCapabilities",value:(F=s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k.debug("getNativeRtpCapabilities()"),e.abrupt("return",S.getCapabilities());case 2:case"end":return e.stop()}}),e)}))),function(){return F.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(A=s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:{OS:0,MIS:0}});case 2:case"end":return e.stop()}}),e)}))),function(){return A.apply(this,arguments)})},{key:"run",value:function(e){e.direction;var t=e.iceParameters,r=e.iceCandidates,n=e.dtlsParameters,i=(e.sctpParameters,e.iceServers),a=e.iceTransportPolicy,o=(e.additionalSettings,e.proprietaryConstraints,e.extendedRtpCapabilities);k.debug("run()"),this._sendingRtpParametersByKind={audio:_.getSendingRtpParameters("audio",o),video:_.getSendingRtpParameters("video",o)},this._remoteIceParameters=t,this._remoteIceCandidates=r,this._remoteDtlsParameters=n,this._cname="CNAME-".concat(w.generateRandomNumber()),this.setIceGatherer({iceServers:i,iceTransportPolicy:a}),this.setIceTransport(),this.setDtlsTransport()}},{key:"updateIceServers",value:(I=s(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new b.UnsupportedError("not supported");case 1:case"end":return e.stop()}}),e)}))),function(e){return I.apply(this,arguments)})},{key:"restartIce",value:(M=s(o().mark((function e(t){var r,n,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k.debug("restartIce()"),this._remoteIceParameters=t,this._transportReady){e.next=4;break}return e.abrupt("return");case 4:k.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,t,"controlling"),r=u(this._remoteIceCandidates);try{for(r.s();!(n=r.n()).done;)i=n.value,this._iceTransport.addRemoteCandidate(i)}catch(e){r.e(e)}finally{r.f()}this._iceTransport.addRemoteCandidate({});case 9:case"end":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)})},{key:"getTransportStats",value:(D=s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._iceTransport.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return D.apply(this,arguments)})},{key:"send",value:(C=s(o().mark((function e(t){var r,n,i,a,c,s,p,l,d,f,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.track,n=t.encodings,t.codecOptions,i=t.codec,k.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),this._transportReady){e.next=5;break}return e.next=5,this.setupTransport({localDtlsRole:"server"});case 5:k.debug("send() | calling new RTCRtpSender()"),a=new RTCRtpSender(r,this._dtlsTransport),(c=w.clone(this._sendingRtpParametersByKind[r.kind],{})).codecs=_.reduceCodecs(c.codecs,i),s=c.codecs.some((function(e){return/.+\/rtx$/i.test(e.mimeType)})),n||(n=[{}]),p=u(n);try{for(p.s();!(l=p.n()).done;)(d=l.value).ssrc=w.generateRandomNumber(),s&&(d.rtx={ssrc:w.generateRandomNumber()})}catch(e){p.e(e)}finally{p.f()}return c.encodings=n,c.rtcp={cname:this._cname,reducedSize:!0,mux:!0},f=S.mangleRtpParameters(c),k.debug("send() | calling rtpSender.send() [params:%o]",f),e.next=19,a.send(f);case 19:return h=String(this._nextSendLocalId),this._nextSendLocalId++,this._rtpSenders.set(h,a),e.abrupt("return",{localId:h,rtpParameters:c,rtpSender:a});case 23:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"stopSending",value:(L=s(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k.debug("stopSending() [localId:%s]",t),r=this._rtpSenders.get(t)){e.next=4;break}throw new Error("RTCRtpSender not found");case 4:this._rtpSenders.delete(t),e.prev=5,k.debug("stopSending() | calling rtpSender.stop()"),r.stop(),e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(5),k.warn("stopSending() | rtpSender.stop() failed:%o",e.t0),e.t0;case 14:case"end":return e.stop()}}),e,this,[[5,10]])}))),function(e){return L.apply(this,arguments)})},{key:"pauseSending",value:(T=s(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return T.apply(this,arguments)})},{key:"resumeSending",value:(E=s(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return E.apply(this,arguments)})},{key:"replaceTrack",value:(j=s(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r?k.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):k.debug("replaceTrack() [localId:%s, no track]",t),n=this._rtpSenders.get(t)){e.next=4;break}throw new Error("RTCRtpSender not found");case 4:n.setTrack(r);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return j.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(O=s(o().mark((function e(t,r){var n,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._rtpSenders.get(t)){e.next=4;break}throw new Error("RTCRtpSender not found");case 4:return(i=n.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=8,n.setParameters(i);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return O.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(R=s(o().mark((function e(t,r){var n,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._rtpSenders.get(t)){e.next=4;break}throw new Error("RTCRtpSender not found");case 4:return(i=n.getParameters()).encodings.forEach((function(e,t){i.encodings[t]=a(a({},e),r)})),e.next=8,n.setParameters(i);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return R.apply(this,arguments)})},{key:"getSenderStats",value:(P=s(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._rtpSenders.get(t)){e.next=3;break}throw new Error("RTCRtpSender not found");case 3:return e.abrupt("return",r.getStats());case 4:case"end":return e.stop()}}),e,this)}))),function(e){return P.apply(this,arguments)})},{key:"sendDataChannel",value:(x=s(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new b.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return x.apply(this,arguments)})},{key:"receive",value:(g=s(o().mark((function e(t){var r,n,i,a,c,s,p,l,d,f,h,m,v,y,g;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],n=u(t);try{for(n.s();!(i=n.n()).done;)a=i.value,c=a.trackId,s=a.kind,k.debug("receive() [trackId:%s, kind:%s]",c,s)}catch(e){n.e(e)}finally{n.f()}if(this._transportReady){e.next=6;break}return e.next=6,this.setupTransport({localDtlsRole:"server"});case 6:p=u(t),e.prev=7,p.s();case 9:if((l=p.n()).done){e.next=24;break}return d=l.value,f=d.trackId,h=d.kind,m=d.rtpParameters,k.debug("receive() | calling new RTCRtpReceiver()"),(v=new RTCRtpReceiver(this._dtlsTransport,h)).addEventListener("error",(function(e){k.error('rtpReceiver "error" event [event:%o]',e)})),y=S.mangleRtpParameters(m),k.debug("receive() | calling rtpReceiver.receive() [params:%o]",y),e.next=19,v.receive(y);case 19:g=f,this._rtpReceivers.set(g,v),r.push({localId:g,track:v.track,rtpReceiver:v});case 22:e.next=9;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(7),p.e(e.t0);case 29:return e.prev=29,p.f(),e.finish(29);case 32:return e.abrupt("return",r);case 33:case"end":return e.stop()}}),e,this,[[7,26,29,32]])}))),function(e){return g.apply(this,arguments)})},{key:"stopReceiving",value:(y=s(o().mark((function e(t){var r,n,i,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=u(t),e.prev=1,r.s();case 3:if((n=r.n()).done){e.next=13;break}if(i=n.value,k.debug("stopReceiving() [localId:%s]",i),a=this._rtpReceivers.get(i)){e.next=9;break}throw new Error("RTCRtpReceiver not found");case 9:this._rtpReceivers.delete(i);try{k.debug("stopReceiving() | calling rtpReceiver.stop()"),a.stop()}catch(e){k.warn("stopReceiving() | rtpReceiver.stop() failed:%o",e)}case 11:e.next=3;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(1),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[1,15,18,21]])}))),function(e){return y.apply(this,arguments)})},{key:"pauseReceiving",value:(v=s(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return v.apply(this,arguments)})},{key:"resumeReceiving",value:(m=s(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return m.apply(this,arguments)})},{key:"getReceiverStats",value:(d=s(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._rtpReceivers.get(t)){e.next=3;break}throw new Error("RTCRtpReceiver not found");case 3:return e.abrupt("return",r.getStats());case 4:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"receiveDataChannel",value:(p=s(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new b.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return p.apply(this,arguments)})},{key:"setIceGatherer",value:function(e){var t=e.iceServers,r=e.iceTransportPolicy,n=new RTCIceGatherer({iceServers:t||[],gatherPolicy:r||"all"});n.addEventListener("error",(function(e){k.error('iceGatherer "error" event [event:%o]',e)}));try{n.gather()}catch(e){k.debug("setIceGatherer() | iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=n}},{key:"setIceTransport",value:function(){var e=this,t=new RTCIceTransport(this._iceGatherer);t.addEventListener("statechange",(function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}})),t.addEventListener("icestatechange",(function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}})),t.addEventListener("candidatepairchange",(function(e){k.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)})),this._iceTransport=t}},{key:"setDtlsTransport",value:function(){var e=this,t=new RTCDtlsTransport(this._iceTransport);t.addEventListener("statechange",(function(){k.debug('dtlsTransport "statechange" event [state:%s]',t.state)})),t.addEventListener("dtlsstatechange",(function(){k.debug('dtlsTransport "dtlsstatechange" event [state:%s]',t.state),"closed"===t.state&&e.emit("@connectionstatechange","closed")})),t.addEventListener("error",(function(e){k.error('dtlsTransport "error" event [event:%o]',e)})),this._dtlsTransport=t}},{key:"setupTransport",value:(c=s(o().mark((function e(t){var r,n,i,a,c,s=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,k.debug("setupTransport()"),(n=this._dtlsTransport.getLocalParameters()).role=r,e.next=6,new Promise((function(e,t){s.safeEmit("@connect",{dtlsParameters:n},e,t)}));case 6:this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling"),i=u(this._remoteIceCandidates);try{for(i.s();!(a=i.n()).done;)c=a.value,this._iceTransport.addRemoteCandidate(c)}catch(e){i.e(e)}finally{i.f()}this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter((function(e){return"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm})),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0;case 13:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})}],i=[{key:"createFactory",value:function(){return function(){return new z}}}],r&&l(t.prototype,r),i&&l(t,i),Object.defineProperty(t,"prototype",{writable:!1}),z}(x.HandlerInterface);t.Edge11=P},618:function(e,t,r){"use strict";function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},n.apply(this,arguments)}function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){s=!0,a=e},f:function(){try{c||null==r.return||r.return()}finally{if(s)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){var n,i,a;n=e,i=t,a=r[t],(i=f(i))in n?Object.defineProperty(n,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[i]=a})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(){u=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},c=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",p=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var i=t&&t.prototype instanceof b?t:b,o=Object.create(i.prototype),c=new C(n||[]);return a(o,"_invoke",{value:j(e,r,c)}),o}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",m="suspendedYield",v="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};l(S,c,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(D([])));k&&k!==r&&n.call(k,c)&&(S=k);var P=_.prototype=b.prototype=Object.create(S);function R(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(a,o,c,s){var u=f(e[a],e,o);if("throw"!==u.type){var p=u.arg,l=p.value;return l&&"object"==i(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,c,s)}),(function(e){r("throw",e,c,s)})):t.resolve(l).then((function(e){p.value=e,c(p)}),(function(e){return r("throw",e,c,s)}))}s(u.arg)}var o;a(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function j(t,r,n){var i=h;return function(a,o){if(i===v)throw new Error("Generator is already running");if(i===y){if("throw"===a)throw o;return{value:e,done:!0}}for(n.method=a,n.arg=o;;){var c=n.delegate;if(c){var s=E(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=v;var u=f(t,r,n);if("normal"===u.type){if(i=n.done?y:m,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=y,n.method="throw",n.arg=u.arg)}}}function E(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,E(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(i,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var o=a.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function r(){for(;++a<t.length;)if(n.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(i(t)+" is not iterable")}return w.prototype=_,a(P,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,p,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,p,"GeneratorFunction")),e.prototype=Object.create(P),e},t.awrap=function(e){return{__await:e}},R(O.prototype),l(O.prototype,s,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,i,a){void 0===a&&(a=Promise);var o=new O(d(e,r,n,i),a);return t.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},R(P),l(P,p,"Generator"),l(P,c,(function(){return this})),l(P,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return c.type="throw",c.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],c=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;L(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function p(e,t,r,n,i,a,o){try{var c=e[a](o),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,i)}function l(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){p(a,n,i,o,c,"next",e)}function c(e){p(a,n,i,o,c,"throw",e)}o(void 0)}))}}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function f(e){var t=function(e,t){if("object"!==i(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===i(t)?t:String(t)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}var v=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),y=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),g=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&v(t,e,r);return y(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Firefox60=void 0;var b=g(r(669)),w=r(647),_=r(561),S=g(r(650)),x=g(r(646)),k=g(r(683)),P=g(r(569)),R=r(244),O=r(384),j=new w.Logger("Firefox60"),E={OS:16,MIS:2048},T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(q,e);var t,r,o,c,p,f,v,y,g,w,R,T,L,C,D,M,I,A,F,N,B,G,z,U,K,V,Y=(K=q,V=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=m(K);if(V){var r=m(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function q(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,q),(e=Y.call(this))._mapMidTransceiver=new Map,e._sendStream=new MediaStream,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=q,r=[{key:"name",get:function(){return"Firefox60"}},{key:"close",value:function(){if(j.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}},{key:"getNativeRtpCapabilities",value:(U=l(u().mark((function e(){var t,r,n,i,a,o,c,s,p,l;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),(r=document.createElement("canvas")).getContext("2d"),n=r.captureStream(),i=n.getVideoTracks()[0],e.prev=6,t.addTransceiver("audio",{direction:"sendrecv"}),a=t.addTransceiver(i,{direction:"sendrecv"}),o=a.sender.getParameters(),c=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}],o.encodings=c,e.next=14,a.sender.setParameters(o);case 14:return e.next=16,t.createOffer();case 16:s=e.sent;try{r.remove()}catch(e){}try{i.stop()}catch(e){}try{t.close()}catch(e){}return p=b.parse(s.sdp),l=k.extractRtpCapabilities({sdpObject:p}),e.abrupt("return",l);case 25:e.prev=25,e.t0=e.catch(6);try{r.remove()}catch(e){}try{i.stop()}catch(e){}try{t.close()}catch(e){}throw e.t0;case 31:case"end":return e.stop()}}),e,null,[[6,25]])}))),function(){return U.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(z=l(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:E});case 2:case"end":return e.stop()}}),e)}))),function(){return z.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,i=e.iceCandidates,a=e.dtlsParameters,o=e.sctpParameters,c=e.iceServers,u=e.iceTransportPolicy,p=e.additionalSettings,l=e.proprietaryConstraints,d=e.extendedRtpCapabilities;j.debug("run()"),this._direction=r,this._remoteSdp=new O.RemoteSdp({iceParameters:n,iceCandidates:i,dtlsParameters:a,sctpParameters:o}),this._sendingRtpParametersByKind={audio:x.getSendingRtpParameters("audio",d),video:x.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:x.getSendingRemoteRtpParameters("audio",d),video:x.getSendingRemoteRtpParameters("video",d)},this._pc=new RTCPeerConnection(s({iceServers:c||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},p),l),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(function(){t.emit("@connectionstatechange",t._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(function(){switch(j.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:(G=l(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new _.UnsupportedError("not supported");case 1:case"end":return e.stop()}}),e)}))),function(e){return G.apply(this,arguments)})},{key:"restartIce",value:(B=l(u().mark((function e(t){var r,n,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(j.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,j.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},j.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},j.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return a=e.sent,j.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),e.next=27,this._pc.setLocalDescription(a);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"getTransportStats",value:(N=l(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return N.apply(this,arguments)})},{key:"send",value:(F=l(u().mark((function e(t){var r,i,o,c,s,p,l,d,f,h,m,v,y,g,w,_;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.track,i=t.encodings,o=t.codecOptions,c=t.codec,this.assertSendDirection(),j.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),i&&(i=S.clone(i,[])).length>1&&(i.forEach((function(e,t){e.rid="r".concat(t)})),i.reverse()),(s=S.clone(this._sendingRtpParametersByKind[r.kind],{})).codecs=x.reduceCodecs(s.codecs,c),(p=S.clone(this._sendingRemoteRtpParametersByKind[r.kind],{})).codecs=x.reduceCodecs(p.codecs,c),l=this._pc.addTransceiver(r,{direction:"sendonly",streams:[this._sendStream]}),!i){e.next=14;break}return(d=l.sender.getParameters()).encodings=i,e.next=14,l.sender.setParameters(d);case 14:return e.next=16,this._pc.createOffer();case 16:if(f=e.sent,h=b.parse(f.sdp),this._transportReady){e.next=21;break}return e.next=21,this.setupTransport({localDtlsRole:"client",localSdpObject:h});case 21:return j.debug("send() | calling pc.setLocalDescription() [offer:%o]",f),e.next=24,this._pc.setLocalDescription(f);case 24:if(m=l.mid,s.mid=m,h=b.parse(this._pc.localDescription.sdp),v=h.media[h.media.length-1],s.rtcp.cname=k.getCname({offerMediaObject:v}),i?1===i.length?(n((y=P.getRtpEncodings({offerMediaObject:v}))[0],i[0]),s.encodings=y):s.encodings=i.reverse():s.encodings=P.getRtpEncodings({offerMediaObject:v}),s.encodings.length>1&&("video/vp8"===s.codecs[0].mimeType.toLowerCase()||"video/h264"===s.codecs[0].mimeType.toLowerCase())){g=a(s.encodings);try{for(g.s();!(w=g.n()).done;)w.value.scalabilityMode="S1T3"}catch(e){g.e(e)}finally{g.f()}}return this._remoteSdp.send({offerMediaObject:v,offerRtpParameters:s,answerRtpParameters:p,codecOptions:o,extmapAllowMixed:!0}),_={type:"answer",sdp:this._remoteSdp.getSdp()},j.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_),e.next=36,this._pc.setRemoteDescription(_);case 36:return this._mapMidTransceiver.set(m,l),e.abrupt("return",{localId:m,rtpParameters:s,rtpSender:l.sender});case 38:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"stopSending",value:(A=l(u().mark((function e(t){var r,n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(j.debug("stopSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated transceiver not found");case 4:return r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.disableMediaSection(r.mid),e.next=9,this._pc.createOffer();case 9:return n=e.sent,j.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=13,this._pc.setLocalDescription(n);case 13:return i={type:"answer",sdp:this._remoteSdp.getSdp()},j.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=17,this._pc.setRemoteDescription(i);case 17:this._mapMidTransceiver.delete(t);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"pauseSending",value:(I=l(u().mark((function e(t){var r,n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),j.debug("pauseSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return r.direction="inactive",this._remoteSdp.pauseMediaSection(t),e.next=9,this._pc.createOffer();case 9:return n=e.sent,j.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=13,this._pc.setLocalDescription(n);case 13:return i={type:"answer",sdp:this._remoteSdp.getSdp()},j.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=17,this._pc.setRemoteDescription(i);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return I.apply(this,arguments)})},{key:"resumeSending",value:(M=l(u().mark((function e(t){var r,n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),j.debug("resumeSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return r.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(t),e.next=9,this._pc.createOffer();case 9:return n=e.sent,j.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=13,this._pc.setLocalDescription(n);case 13:return i={type:"answer",sdp:this._remoteSdp.getSdp()},j.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=17,this._pc.setRemoteDescription(i);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)})},{key:"replaceTrack",value:(D=l(u().mark((function e(t,r){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),r?j.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):j.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return e.next=7,n.sender.replaceTrack(r);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return D.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(C=l(u().mark((function e(t,r){var n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),j.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated transceiver not found");case 5:return i=n.sender.getParameters(),r=i.encodings.length-1-r,i.encodings.forEach((function(e,t){e.active=t>=r})),e.next=10,n.sender.setParameters(i);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return C.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(L=l(u().mark((function e(t,r){var n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),j.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=n.sender.getParameters()).encodings.forEach((function(e,t){i.encodings[t]=s(s({},e),r)})),e.next=9,n.sender.setParameters(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return L.apply(this,arguments)})},{key:"getSenderStats",value:(T=l(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.sender.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"sendDataChannel",value:(R=l(u().mark((function e(t){var r,n,i,a,o,c,s,p,l,d,f,h;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,a=t.label,o=t.protocol,this.assertSendDirection(),c={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmits:i,protocol:o},j.debug("sendDataChannel() [options:%o]",c),s=this._pc.createDataChannel(a,c),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%E.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(p=e.sent,l=b.parse(p.sdp),d=l.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this.setupTransport({localDtlsRole:"client",localSdpObject:l});case 15:return j.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",p),e.next=18,this._pc.setLocalDescription(p);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:d}),f={type:"answer",sdp:this._remoteSdp.getSdp()},j.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),e.next=23,this._pc.setRemoteDescription(f);case 23:this._hasDataChannelMediaSection=!0;case 24:return h={streamId:c.id,ordered:c.ordered,maxPacketLifeTime:c.maxPacketLifeTime,maxRetransmits:c.maxRetransmits},e.abrupt("return",{dataChannel:s,sctpStreamParameters:h});case 26:case"end":return e.stop()}}),e,this)}))),function(e){return R.apply(this,arguments)})},{key:"receive",value:(w=l(u().mark((function e(t){var r,n,i,o,c,s,p,l,d,f,h,m,v,y,g,w,_,S,x,P=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=[],n=new Map,i=a(t);try{for(i.s();!(o=i.n()).done;)c=o.value,s=c.trackId,p=c.kind,l=c.rtpParameters,d=c.streamId,j.debug("receive() [trackId:%s, kind:%s]",s,p),f=l.mid||String(this._mapMidTransceiver.size),n.set(s,f),this._remoteSdp.receive({mid:f,kind:p,offerRtpParameters:l,streamId:d||l.rtcp.cname,trackId:s})}catch(e){i.e(e)}finally{i.f()}return h={type:"offer",sdp:this._remoteSdp.getSdp()},j.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",h),e.next=9,this._pc.setRemoteDescription(h);case 9:return e.next=11,this._pc.createAnswer();case 11:m=e.sent,v=b.parse(m.sdp),y=a(t),e.prev=14,w=u().mark((function e(){var t,r,i,a,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=g.value,r=t.trackId,i=t.rtpParameters,a=n.get(r),o=v.media.find((function(e){return String(e.mid)===a})),k.applyCodecParameters({offerRtpParameters:i,answerMediaObject:o}),m={type:"answer",sdp:b.write(v)};case 6:case"end":return e.stop()}}),e)})),y.s();case 17:if((g=y.n()).done){e.next=21;break}return e.delegateYield(w(),"t0",19);case 19:e.next=17;break;case 21:e.next=26;break;case 23:e.prev=23,e.t1=e.catch(14),y.e(e.t1);case 26:return e.prev=26,y.f(),e.finish(26);case 29:if(this._transportReady){e.next=32;break}return e.next=32,this.setupTransport({localDtlsRole:"client",localSdpObject:v});case 32:return j.debug("receive() | calling pc.setLocalDescription() [answer:%o]",m),e.next=35,this._pc.setLocalDescription(m);case 35:_=a(t),e.prev=36,x=u().mark((function e(){var t,i,a,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=S.value,i=t.trackId,a=n.get(i),o=P._pc.getTransceivers().find((function(e){return e.mid===a}))){e.next=6;break}throw new Error("new RTCRtpTransceiver not found");case 6:P._mapMidTransceiver.set(a,o),r.push({localId:a,track:o.receiver.track,rtpReceiver:o.receiver});case 8:case"end":return e.stop()}}),e)})),_.s();case 39:if((S=_.n()).done){e.next=43;break}return e.delegateYield(x(),"t2",41);case 41:e.next=39;break;case 43:e.next=48;break;case 45:e.prev=45,e.t3=e.catch(36),_.e(e.t3);case 48:return e.prev=48,_.f(),e.finish(48);case 51:return e.abrupt("return",r);case 52:case"end":return e.stop()}}),e,this,[[14,23,26,29],[36,45,48,51]])}))),function(e){return w.apply(this,arguments)})},{key:"stopReceiving",value:(g=l(u().mark((function e(t){var r,n,i,o,c,s,p,l,d;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=a(t),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=13;break}if(i=n.value,j.debug("stopReceiving() [localId:%s]",i),o=this._mapMidTransceiver.get(i)){e.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:this._remoteSdp.closeMediaSection(o.mid);case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return c={type:"offer",sdp:this._remoteSdp.getSdp()},j.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",c),e.next=25,this._pc.setRemoteDescription(c);case 25:return e.next=27,this._pc.createAnswer();case 27:return s=e.sent,j.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),e.next=31,this._pc.setLocalDescription(s);case 31:p=a(t);try{for(p.s();!(l=p.n()).done;)d=l.value,this._mapMidTransceiver.delete(d)}catch(e){p.e(e)}finally{p.f()}case 33:case"end":return e.stop()}}),e,this,[[2,15,18,21]])}))),function(e){return g.apply(this,arguments)})},{key:"pauseReceiving",value:(y=l(u().mark((function e(t){var r,n,i,o,c,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=a(t),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=14;break}if(i=n.value,j.debug("pauseReceiving() [localId:%s]",i),o=this._mapMidTransceiver.get(i)){e.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:o.direction="inactive",this._remoteSdp.pauseMediaSection(i);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:return c={type:"offer",sdp:this._remoteSdp.getSdp()},j.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",c),e.next=26,this._pc.setRemoteDescription(c);case 26:return e.next=28,this._pc.createAnswer();case 28:return s=e.sent,j.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),e.next=32,this._pc.setLocalDescription(s);case 32:case"end":return e.stop()}}),e,this,[[2,16,19,22]])}))),function(e){return y.apply(this,arguments)})},{key:"resumeReceiving",value:(v=l(u().mark((function e(t){var r,n,i,o,c,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=a(t),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=14;break}if(i=n.value,j.debug("resumeReceiving() [localId:%s]",i),o=this._mapMidTransceiver.get(i)){e.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:o.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:return c={type:"offer",sdp:this._remoteSdp.getSdp()},j.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",c),e.next=26,this._pc.setRemoteDescription(c);case 26:return e.next=28,this._pc.createAnswer();case 28:return s=e.sent,j.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),e.next=32,this._pc.setLocalDescription(s);case 32:case"end":return e.stop()}}),e,this,[[2,16,19,22]])}))),function(e){return v.apply(this,arguments)})},{key:"getReceiverStats",value:(f=l(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertRecvDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.receiver.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"receiveDataChannel",value:(p=l(u().mark((function e(t){var r,n,i,a,o,c,s,p,l,d,f,h;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this.assertRecvDirection(),a=r.streamId,o=r.ordered,c=r.maxPacketLifeTime,s=r.maxRetransmits,p={negotiated:!0,id:a,ordered:o,maxPacketLifeTime:c,maxRetransmits:s,protocol:i},j.debug("receiveDataChannel() [options:%o]",p),l=this._pc.createDataChannel(n,p),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation(),d={type:"offer",sdp:this._remoteSdp.getSdp()},j.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d),e.next=12,this._pc.setRemoteDescription(d);case 12:return e.next=14,this._pc.createAnswer();case 14:if(f=e.sent,this._transportReady){e.next=19;break}return h=b.parse(f.sdp),e.next=19,this.setupTransport({localDtlsRole:"client",localSdpObject:h});case 19:return j.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),e.next=22,this._pc.setLocalDescription(f);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:l});case 24:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"setupTransport",value:(c=l(u().mark((function e(t){var r,n,i,a=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=b.parse(this._pc.localDescription.sdp)),(i=k.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,new Promise((function(e,t){a.safeEmit("@connect",{dtlsParameters:i},e,t)}));case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}],o=[{key:"createFactory",value:function(){return function(){return new q}}}],r&&d(t.prototype,r),o&&d(t,o),Object.defineProperty(t,"prototype",{writable:!1}),q}(R.HandlerInterface);t.Firefox60=T},244:(e,t,r)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.HandlerInterface=void 0;var o=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}(s,e);var t,r,o,c=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=a(r);if(o){var i=a(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),c.call(this)}return t=s,Object.defineProperty(t,"prototype",{writable:!1}),t}(r(938).EnhancedEventEmitter);t.HandlerInterface=o},483:function(e,t,r){"use strict";function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},n.apply(this,arguments)}function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){s=!0,a=e},f:function(){try{c||null==r.return||r.return()}finally{if(s)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(){s=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},c=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",p=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var i=t&&t.prototype instanceof b?t:b,o=Object.create(i.prototype),c=new C(n||[]);return a(o,"_invoke",{value:j(e,r,c)}),o}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",m="suspendedYield",v="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};l(S,c,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(D([])));k&&k!==r&&n.call(k,c)&&(S=k);var P=_.prototype=b.prototype=Object.create(S);function R(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(a,o,c,s){var u=f(e[a],e,o);if("throw"!==u.type){var p=u.arg,l=p.value;return l&&"object"==i(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,c,s)}),(function(e){r("throw",e,c,s)})):t.resolve(l).then((function(e){p.value=e,c(p)}),(function(e){return r("throw",e,c,s)}))}s(u.arg)}var o;a(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function j(t,r,n){var i=h;return function(a,o){if(i===v)throw new Error("Generator is already running");if(i===y){if("throw"===a)throw o;return{value:e,done:!0}}for(n.method=a,n.arg=o;;){var c=n.delegate;if(c){var s=E(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=v;var u=f(t,r,n);if("normal"===u.type){if(i=n.done?y:m,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=y,n.method="throw",n.arg=u.arg)}}}function E(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,E(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(i,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var o=a.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function r(){for(;++a<t.length;)if(n.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(i(t)+" is not iterable")}return w.prototype=_,a(P,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,p,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,p,"GeneratorFunction")),e.prototype=Object.create(P),e},t.awrap=function(e){return{__await:e}},R(O.prototype),l(O.prototype,u,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,i,a){void 0===a&&(a=Promise);var o=new O(d(e,r,n,i),a);return t.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},R(P),l(P,p,"Generator"),l(P,c,(function(){return this})),l(P,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return c.type="throw",c.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],c=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;L(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function u(e,t,r,n,i,a,o){try{var c=e[a](o),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,i)}function p(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){u(a,n,i,o,c,"next",e)}function c(e){u(a,n,i,o,c,"throw",e)}o(void 0)}))}}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,d(n.key),n)}}function d(e){var t=function(e,t){if("object"!==i(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===i(t)?t:String(t)}function f(e,t){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},f(e,t)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}var m=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),v=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),y=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&m(t,e,r);return v(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ReactNative=void 0;var g=y(r(669)),b=r(647),w=r(561),_=y(r(650)),S=y(r(646)),x=y(r(683)),k=y(r(978)),P=r(244),R=r(384),O=new b.Logger("ReactNative"),j={OS:1024,MIS:1024},E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}(Q,e);var t,r,o,u,m,v,y,b,P,E,T,L,C,D,M,I,A,F,N,B,G,z,U,K,V,Y,q=(V=Q,Y=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=h(V);if(Y){var r=h(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function Q(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Q),(e=q.call(this))._sendStream=new MediaStream,e._mapSendLocalIdTrack=new Map,e._nextSendLocalId=0,e._mapRecvLocalIdInfo=new Map,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=Q,r=[{key:"name",get:function(){return"ReactNative"}},{key:"close",value:function(){if(O.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}},{key:"getNativeRtpCapabilities",value:(K=p(s().mark((function e(){var t,r,n,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),e.prev=2,e.next=5,t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 5:r=e.sent;try{t.close()}catch(e){}return n=g.parse(r.sdp),i=x.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",i);case 12:e.prev=12,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[2,12]])}))),function(){return K.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(U=p(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:j});case 2:case"end":return e.stop()}}),e)}))),function(){return U.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,i=e.iceCandidates,a=e.dtlsParameters,o=e.sctpParameters,s=e.iceServers,u=e.iceTransportPolicy,p=e.additionalSettings,l=e.proprietaryConstraints,f=e.extendedRtpCapabilities;O.debug("run()"),this._direction=r,this._remoteSdp=new R.RemoteSdp({iceParameters:n,iceCandidates:i,dtlsParameters:a,sctpParameters:o,planB:!0}),this._sendingRtpParametersByKind={audio:S.getSendingRtpParameters("audio",f),video:S.getSendingRtpParameters("video",f)},this._sendingRemoteRtpParametersByKind={audio:S.getSendingRemoteRtpParameters("audio",f),video:S.getSendingRemoteRtpParameters("video",f)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){var n,i,a;n=e,i=t,a=r[t],(i=d(i))in n?Object.defineProperty(n,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[i]=a})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({iceServers:s||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},p),l),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(function(){t.emit("@connectionstatechange",t._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(function(){switch(O.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:(z=p(s().mark((function e(t){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:O.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return z.apply(this,arguments)})},{key:"restartIce",value:(G=p(s().mark((function e(t){var r,n,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,O.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return a=e.sent,O.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),e.next=27,this._pc.setLocalDescription(a);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return G.apply(this,arguments)})},{key:"getTransportStats",value:(B=p(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return B.apply(this,arguments)})},{key:"send",value:(N=p(s().mark((function e(t){var r,i,o,c,u,p,l,d,f,h,m,v,y,b,w;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,i=t.encodings,o=t.codecOptions,c=t.codec,this.assertSendDirection(),O.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),c&&O.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(r),this._pc.addStream(this._sendStream),e.next=8,this._pc.createOffer();case 8:if(p=e.sent,l=g.parse(p.sdp),(f=_.clone(this._sendingRtpParametersByKind[r.kind],{})).codecs=S.reduceCodecs(f.codecs),(h=_.clone(this._sendingRemoteRtpParametersByKind[r.kind],{})).codecs=S.reduceCodecs(h.codecs),this._transportReady){e.next=17;break}return e.next=17,this.setupTransport({localDtlsRole:null!==(u=this._forcedLocalDtlsRole)&&void 0!==u?u:"client",localSdpObject:l});case 17:return"video"===r.kind&&i&&i.length>1&&(O.debug("send() | enabling simulcast"),l=g.parse(p.sdp),d=l.media.find((function(e){return"video"===e.type})),k.addLegacySimulcast({offerMediaObject:d,track:r,numStreams:i.length}),p={type:"offer",sdp:g.write(l)}),O.debug("send() | calling pc.setLocalDescription() [offer:%o]",p),e.next=21,this._pc.setLocalDescription(p);case 21:if(l=g.parse(this._pc.localDescription.sdp),d=l.media.find((function(e){return e.type===r.kind})),f.rtcp.cname=x.getCname({offerMediaObject:d}),f.encodings=k.getRtpEncodings({offerMediaObject:d,track:r}),i)for(m=0;m<f.encodings.length;++m)i[m]&&n(f.encodings[m],i[m]);if(f.encodings.length>1&&("video/vp8"===f.codecs[0].mimeType.toLowerCase()||"video/h264"===f.codecs[0].mimeType.toLowerCase())){v=a(f.encodings);try{for(v.s();!(y=v.n()).done;)y.value.scalabilityMode="S1T3"}catch(e){v.e(e)}finally{v.f()}}return this._remoteSdp.send({offerMediaObject:d,offerRtpParameters:f,answerRtpParameters:h,codecOptions:o}),b={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("send() | calling pc.setRemoteDescription() [answer:%o]",b),e.next=32,this._pc.setRemoteDescription(b);case 32:return w=String(this._nextSendLocalId),this._nextSendLocalId++,this._mapSendLocalIdTrack.set(w,r),e.abrupt("return",{localId:w,rtpParameters:f});case 36:case"end":return e.stop()}}),e,this)}))),function(e){return N.apply(this,arguments)})},{key:"stopSending",value:(F=p(s().mark((function e(t){var r,n,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),O.debug("stopSending() [localId:%s]",t),r=this._mapSendLocalIdTrack.get(t)){e.next=5;break}throw new Error("track not found");case 5:return this._mapSendLocalIdTrack.delete(t),this._sendStream.removeTrack(r),this._pc.addStream(this._sendStream),e.next=10,this._pc.createOffer();case 10:return n=e.sent,O.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.prev=12,e.next=15,this._pc.setLocalDescription(n);case 15:e.next=23;break;case 17:if(e.prev=17,e.t0=e.catch(12),0!==this._sendStream.getTracks().length){e.next=22;break}return O.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.t0.toString()),e.abrupt("return");case 22:throw e.t0;case 23:if("stable"!==this._pc.signalingState){e.next=25;break}return e.abrupt("return");case 25:return i={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=29,this._pc.setRemoteDescription(i);case 29:case"end":return e.stop()}}),e,this,[[12,17]])}))),function(e){return F.apply(this,arguments)})},{key:"pauseSending",value:(A=p(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return A.apply(this,arguments)})},{key:"resumeSending",value:(I=p(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return I.apply(this,arguments)})},{key:"replaceTrack",value:(M=p(s().mark((function e(t,r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new w.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return M.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(D=p(s().mark((function e(t,r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new w.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return D.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(C=p(s().mark((function e(t,r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new w.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return C.apply(this,arguments)})},{key:"getSenderStats",value:(L=p(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new w.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return L.apply(this,arguments)})},{key:"sendDataChannel",value:(T=p(s().mark((function e(t){var r,n,i,a,o,c,u,p,l,d,f,h,m;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,a=t.label,o=t.protocol,this.assertSendDirection(),u={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmitTime:n,maxRetransmits:i,protocol:o},O.debug("sendDataChannel() [options:%o]",u),p=this._pc.createDataChannel(a,u),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%j.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(l=e.sent,d=g.parse(l.sdp),f=d.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this.setupTransport({localDtlsRole:null!==(c=this._forcedLocalDtlsRole)&&void 0!==c?c:"client",localSdpObject:d});case 15:return O.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=18,this._pc.setLocalDescription(l);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:f}),h={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=23,this._pc.setRemoteDescription(h);case 23:this._hasDataChannelMediaSection=!0;case 24:return m={streamId:u.id,ordered:u.ordered,maxPacketLifeTime:u.maxPacketLifeTime,maxRetransmits:u.maxRetransmits},e.abrupt("return",{dataChannel:p,sctpStreamParameters:m});case 26:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"receive",value:(E=p(s().mark((function e(t){var r,n,i,o,c,u,p,l,d,f,h,m,v,y,b,w,S,k,P,R,j=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),n=[],i=new Map,o=a(t);try{for(o.s();!(c=o.n()).done;)u=c.value,p=u.trackId,l=u.kind,d=u.rtpParameters,O.debug("receive() [trackId:%s, kind:%s]",p,l),f=l,h=u.streamId||d.rtcp.cname,O.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),h+="-hack-".concat(_.generateRandomNumber()),i.set(p,h),this._remoteSdp.receive({mid:f,kind:l,offerRtpParameters:d,streamId:h,trackId:p})}catch(e){o.e(e)}finally{o.f()}return m={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",m),e.next=9,this._pc.setRemoteDescription(m);case 9:return e.next=11,this._pc.createAnswer();case 11:v=e.sent,y=g.parse(v.sdp),b=a(t),e.prev=14,S=s().mark((function e(){var t,r,n,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=w.value,r=t.kind,n=t.rtpParameters,i=r,a=y.media.find((function(e){return String(e.mid)===i})),x.applyCodecParameters({offerRtpParameters:n,answerMediaObject:a});case 5:case"end":return e.stop()}}),e)})),b.s();case 17:if((w=b.n()).done){e.next=21;break}return e.delegateYield(S(),"t0",19);case 19:e.next=17;break;case 21:e.next=26;break;case 23:e.prev=23,e.t1=e.catch(14),b.e(e.t1);case 26:return e.prev=26,b.f(),e.finish(26);case 29:if(v={type:"answer",sdp:g.write(y)},this._transportReady){e.next=33;break}return e.next=33,this.setupTransport({localDtlsRole:null!==(r=this._forcedLocalDtlsRole)&&void 0!==r?r:"client",localSdpObject:y});case 33:return O.debug("receive() | calling pc.setLocalDescription() [answer:%o]",v),e.next=36,this._pc.setLocalDescription(v);case 36:k=a(t),e.prev=37,R=s().mark((function e(){var t,r,a,o,c,u,p,l,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=P.value,r=t.kind,a=t.trackId,o=t.rtpParameters,c=a,u=r,p=i.get(a),l=j._pc.getRemoteStreams().find((function(e){return e.id===p})),d=l.getTrackById(c)){e.next=9;break}throw new Error("remote track not found");case 9:j._mapRecvLocalIdInfo.set(c,{mid:u,rtpParameters:o}),n.push({localId:c,track:d});case 11:case"end":return e.stop()}}),e)})),k.s();case 40:if((P=k.n()).done){e.next=44;break}return e.delegateYield(R(),"t2",42);case 42:e.next=40;break;case 44:e.next=49;break;case 46:e.prev=46,e.t3=e.catch(37),k.e(e.t3);case 49:return e.prev=49,k.f(),e.finish(49);case 52:return e.abrupt("return",n);case 53:case"end":return e.stop()}}),e,this,[[14,23,26,29],[37,46,49,52]])}))),function(e){return E.apply(this,arguments)})},{key:"stopReceiving",value:(P=p(s().mark((function e(t){var r,n,i,o,c,u,p,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=a(t);try{for(r.s();!(n=r.n()).done;)i=n.value,O.debug("stopReceiving() [localId:%s]",i),o=this._mapRecvLocalIdInfo.get(i)||{},c=o.mid,u=o.rtpParameters,this._mapRecvLocalIdInfo.delete(i),this._remoteSdp.planBStopReceiving({mid:c,offerRtpParameters:u})}catch(e){r.e(e)}finally{r.f()}return p={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",p),e.next=7,this._pc.setRemoteDescription(p);case 7:return e.next=9,this._pc.createAnswer();case 9:return l=e.sent,O.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",l),e.next=13,this._pc.setLocalDescription(l);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return P.apply(this,arguments)})},{key:"pauseReceiving",value:(b=p(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return b.apply(this,arguments)})},{key:"resumeReceiving",value:(y=p(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return y.apply(this,arguments)})},{key:"getReceiverStats",value:(v=p(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new w.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return v.apply(this,arguments)})},{key:"receiveDataChannel",value:(m=p(s().mark((function e(t){var r,n,i,a,o,c,u,p,l,d,f,h,m;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this.assertRecvDirection(),o=r.streamId,c=r.ordered,u=r.maxPacketLifeTime,p=r.maxRetransmits,l={negotiated:!0,id:o,ordered:c,maxPacketLifeTime:u,maxRetransmitTime:u,maxRetransmits:p,protocol:i},O.debug("receiveDataChannel() [options:%o]",l),d=this._pc.createDataChannel(n,l),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),f={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=12,this._pc.setRemoteDescription(f);case 12:return e.next=14,this._pc.createAnswer();case 14:if(h=e.sent,this._transportReady){e.next=19;break}return m=g.parse(h.sdp),e.next=19,this.setupTransport({localDtlsRole:null!==(a=this._forcedLocalDtlsRole)&&void 0!==a?a:"client",localSdpObject:m});case 19:return O.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=22,this._pc.setLocalDescription(h);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:d});case 24:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"setupTransport",value:(u=p(s().mark((function e(t){var r,n,i,a=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=g.parse(this._pc.localDescription.sdp)),(i=x.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,new Promise((function(e,t){a.safeEmit("@connect",{dtlsParameters:i},e,t)}));case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}],o=[{key:"createFactory",value:function(){return function(){return new Q}}}],r&&l(t.prototype,r),o&&l(t,o),Object.defineProperty(t,"prototype",{writable:!1}),Q}(P.HandlerInterface);t.ReactNative=E},487:function(e,t,r){"use strict";function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},n.apply(this,arguments)}function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){s=!0,a=e},f:function(){try{c||null==r.return||r.return()}finally{if(s)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){var n,i,a;n=e,i=t,a=r[t],(i=f(i))in n?Object.defineProperty(n,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[i]=a})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(){u=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},c=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",p=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var i=t&&t.prototype instanceof b?t:b,o=Object.create(i.prototype),c=new C(n||[]);return a(o,"_invoke",{value:j(e,r,c)}),o}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",m="suspendedYield",v="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};l(S,c,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(D([])));k&&k!==r&&n.call(k,c)&&(S=k);var P=_.prototype=b.prototype=Object.create(S);function R(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(a,o,c,s){var u=f(e[a],e,o);if("throw"!==u.type){var p=u.arg,l=p.value;return l&&"object"==i(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,c,s)}),(function(e){r("throw",e,c,s)})):t.resolve(l).then((function(e){p.value=e,c(p)}),(function(e){return r("throw",e,c,s)}))}s(u.arg)}var o;a(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function j(t,r,n){var i=h;return function(a,o){if(i===v)throw new Error("Generator is already running");if(i===y){if("throw"===a)throw o;return{value:e,done:!0}}for(n.method=a,n.arg=o;;){var c=n.delegate;if(c){var s=E(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=v;var u=f(t,r,n);if("normal"===u.type){if(i=n.done?y:m,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=y,n.method="throw",n.arg=u.arg)}}}function E(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,E(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(i,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var o=a.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function r(){for(;++a<t.length;)if(n.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(i(t)+" is not iterable")}return w.prototype=_,a(P,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,p,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,p,"GeneratorFunction")),e.prototype=Object.create(P),e},t.awrap=function(e){return{__await:e}},R(O.prototype),l(O.prototype,s,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,i,a){void 0===a&&(a=Promise);var o=new O(d(e,r,n,i),a);return t.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},R(P),l(P,p,"Generator"),l(P,c,(function(){return this})),l(P,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return c.type="throw",c.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],c=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;L(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function p(e,t,r,n,i,a,o){try{var c=e[a](o),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,i)}function l(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){p(a,n,i,o,c,"next",e)}function c(e){p(a,n,i,o,c,"throw",e)}o(void 0)}))}}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function f(e){var t=function(e,t){if("object"!==i(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===i(t)?t:String(t)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}var v=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),y=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),g=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&v(t,e,r);return y(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ReactNativeUnifiedPlan=void 0;var b=g(r(669)),w=r(647),_=g(r(650)),S=g(r(646)),x=g(r(683)),k=g(r(569)),P=r(244),R=r(384),O=r(209),j=new w.Logger("ReactNativeUnifiedPlan"),E={OS:1024,MIS:1024},T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(q,e);var t,r,o,c,p,f,v,y,g,w,P,T,L,C,D,M,I,A,F,N,B,G,z,U,K,V,Y=(K=q,V=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=m(K);if(V){var r=m(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function q(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,q),(e=Y.call(this))._mapMidTransceiver=new Map,e._sendStream=new MediaStream,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=q,r=[{key:"name",get:function(){return"ReactNativeUnifiedPlan"}},{key:"close",value:function(){if(j.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}},{key:"getNativeRtpCapabilities",value:(U=l(u().mark((function e(){var t,r,n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"}),e.prev=2,t.addTransceiver("audio"),t.addTransceiver("video"),e.next=7,t.createOffer();case 7:r=e.sent;try{t.close()}catch(e){}return n=b.parse(r.sdp),i=x.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",i);case 14:e.prev=14,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 18:case"end":return e.stop()}}),e,null,[[2,14]])}))),function(){return U.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(z=l(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:E});case 2:case"end":return e.stop()}}),e)}))),function(){return z.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,i=e.iceCandidates,a=e.dtlsParameters,o=e.sctpParameters,c=e.iceServers,u=e.iceTransportPolicy,p=e.additionalSettings,l=e.proprietaryConstraints,d=e.extendedRtpCapabilities;j.debug("run()"),this._direction=r,this._remoteSdp=new R.RemoteSdp({iceParameters:n,iceCandidates:i,dtlsParameters:a,sctpParameters:o}),this._sendingRtpParametersByKind={audio:S.getSendingRtpParameters("audio",d),video:S.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:S.getSendingRemoteRtpParameters("audio",d),video:S.getSendingRemoteRtpParameters("video",d)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection(s({iceServers:c||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},p),l),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(function(){t.emit("@connectionstatechange",t._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(function(){switch(j.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:(G=l(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:j.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return G.apply(this,arguments)})},{key:"restartIce",value:(B=l(u().mark((function e(t){var r,n,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(j.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,j.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},j.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},j.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return a=e.sent,j.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),e.next=27,this._pc.setLocalDescription(a);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"getTransportStats",value:(N=l(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return N.apply(this,arguments)})},{key:"send",value:(F=l(u().mark((function e(t){var r,i,o,c,s,p,l,d,f,h,m,v,y,g,w,P,R,E,T;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,i=t.encodings,o=t.codecOptions,c=t.codec,this.assertSendDirection(),j.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),i&&i.length>1&&i.forEach((function(e,t){e.rid="r".concat(t)})),(p=_.clone(this._sendingRtpParametersByKind[r.kind],{})).codecs=S.reduceCodecs(p.codecs,c),(l=_.clone(this._sendingRemoteRtpParametersByKind[r.kind],{})).codecs=S.reduceCodecs(l.codecs,c),d=this._remoteSdp.getNextMediaSectionIdx(),f=this._pc.addTransceiver(r,{direction:"sendonly",streams:[this._sendStream],sendEncodings:i}),e.next=12,this._pc.createOffer();case 12:if(h=e.sent,m=b.parse(h.sdp),this._transportReady){e.next=17;break}return e.next=17,this.setupTransport({localDtlsRole:null!==(s=this._forcedLocalDtlsRole)&&void 0!==s?s:"client",localSdpObject:m});case 17:return y=!1,g=(0,O.parse)((i||[{}])[0].scalabilityMode),i&&1===i.length&&g.spatialLayers>1&&"video/vp9"===p.codecs[0].mimeType.toLowerCase()&&(j.debug("send() | enabling legacy simulcast for VP9 SVC"),y=!0,m=b.parse(h.sdp),v=m.media[d.idx],k.addLegacySimulcast({offerMediaObject:v,numStreams:g.spatialLayers}),h={type:"offer",sdp:b.write(m)}),j.debug("send() | calling pc.setLocalDescription() [offer:%o]",h),e.next=23,this._pc.setLocalDescription(h);case 23:if(w=f.mid,p.mid=w,m=b.parse(this._pc.localDescription.sdp),v=m.media[d.idx],p.rtcp.cname=x.getCname({offerMediaObject:v}),i?1===i.length?(n((P=k.getRtpEncodings({offerMediaObject:v}))[0],i[0]),y&&(P=[P[0]]),p.encodings=P):p.encodings=i:p.encodings=k.getRtpEncodings({offerMediaObject:v}),p.encodings.length>1&&("video/vp8"===p.codecs[0].mimeType.toLowerCase()||"video/h264"===p.codecs[0].mimeType.toLowerCase())){R=a(p.encodings);try{for(R.s();!(E=R.n()).done;)E.value.scalabilityMode="S1T3"}catch(e){R.e(e)}finally{R.f()}}return this._remoteSdp.send({offerMediaObject:v,reuseMid:d.reuseMid,offerRtpParameters:p,answerRtpParameters:l,codecOptions:o,extmapAllowMixed:!0}),T={type:"answer",sdp:this._remoteSdp.getSdp()},j.debug("send() | calling pc.setRemoteDescription() [answer:%o]",T),e.next=35,this._pc.setRemoteDescription(T);case 35:return this._mapMidTransceiver.set(w,f),e.abrupt("return",{localId:w,rtpParameters:p,rtpSender:f.sender});case 37:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"stopSending",value:(A=l(u().mark((function e(t){var r,n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),j.debug("stopSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch(e){}return e.next=11,this._pc.createOffer();case 11:return n=e.sent,j.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=15,this._pc.setLocalDescription(n);case 15:return i={type:"answer",sdp:this._remoteSdp.getSdp()},j.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=19,this._pc.setRemoteDescription(i);case 19:this._mapMidTransceiver.delete(t);case 20:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"pauseSending",value:(I=l(u().mark((function e(t){var r,n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),j.debug("pauseSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return r.direction="inactive",this._remoteSdp.pauseMediaSection(t),e.next=9,this._pc.createOffer();case 9:return n=e.sent,j.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=13,this._pc.setLocalDescription(n);case 13:return i={type:"answer",sdp:this._remoteSdp.getSdp()},j.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=17,this._pc.setRemoteDescription(i);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return I.apply(this,arguments)})},{key:"resumeSending",value:(M=l(u().mark((function e(t){var r,n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),j.debug("resumeSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t),this._remoteSdp.resumeSendingMediaSection(t),r){e.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return r.direction="sendonly",e.next=9,this._pc.createOffer();case 9:return n=e.sent,j.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=13,this._pc.setLocalDescription(n);case 13:return i={type:"answer",sdp:this._remoteSdp.getSdp()},j.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=17,this._pc.setRemoteDescription(i);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)})},{key:"replaceTrack",value:(D=l(u().mark((function e(t,r){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),r?j.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):j.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return e.next=7,n.sender.replaceTrack(r);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return D.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(C=l(u().mark((function e(t,r){var n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),j.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=n.sender.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=9,n.sender.setParameters(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return C.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(L=l(u().mark((function e(t,r){var n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),j.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=n.sender.getParameters()).encodings.forEach((function(e,t){i.encodings[t]=s(s({},e),r)})),e.next=9,n.sender.setParameters(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return L.apply(this,arguments)})},{key:"getSenderStats",value:(T=l(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.sender.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"sendDataChannel",value:(P=l(u().mark((function e(t){var r,n,i,a,o,c,s,p,l,d,f,h,m;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,a=t.label,o=t.protocol,this.assertSendDirection(),s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmits:i,protocol:o},j.debug("sendDataChannel() [options:%o]",s),p=this._pc.createDataChannel(a,s),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%E.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(l=e.sent,d=b.parse(l.sdp),f=d.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this.setupTransport({localDtlsRole:null!==(c=this._forcedLocalDtlsRole)&&void 0!==c?c:"client",localSdpObject:d});case 15:return j.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=18,this._pc.setLocalDescription(l);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:f}),h={type:"answer",sdp:this._remoteSdp.getSdp()},j.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=23,this._pc.setRemoteDescription(h);case 23:this._hasDataChannelMediaSection=!0;case 24:return m={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits},e.abrupt("return",{dataChannel:p,sctpStreamParameters:m});case 26:case"end":return e.stop()}}),e,this)}))),function(e){return P.apply(this,arguments)})},{key:"receive",value:(w=l(u().mark((function e(t){var r,n,i,o,c,s,p,l,d,f,h,m,v,y,g,w,_,S,k,P,R=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),n=[],i=new Map,o=a(t);try{for(o.s();!(c=o.n()).done;)s=c.value,p=s.trackId,l=s.kind,d=s.rtpParameters,f=s.streamId,j.debug("receive() [trackId:%s, kind:%s]",p,l),h=d.mid||String(this._mapMidTransceiver.size),i.set(p,h),this._remoteSdp.receive({mid:h,kind:l,offerRtpParameters:d,streamId:f||d.rtcp.cname,trackId:p})}catch(e){o.e(e)}finally{o.f()}return m={type:"offer",sdp:this._remoteSdp.getSdp()},j.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",m),e.next=9,this._pc.setRemoteDescription(m);case 9:return e.next=11,this._pc.createAnswer();case 11:v=e.sent,y=b.parse(v.sdp),g=a(t),e.prev=14,_=u().mark((function e(){var t,r,n,a,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=w.value,r=t.trackId,n=t.rtpParameters,a=i.get(r),o=y.media.find((function(e){return String(e.mid)===a})),x.applyCodecParameters({offerRtpParameters:n,answerMediaObject:o});case 5:case"end":return e.stop()}}),e)})),g.s();case 17:if((w=g.n()).done){e.next=21;break}return e.delegateYield(_(),"t0",19);case 19:e.next=17;break;case 21:e.next=26;break;case 23:e.prev=23,e.t1=e.catch(14),g.e(e.t1);case 26:return e.prev=26,g.f(),e.finish(26);case 29:if(v={type:"answer",sdp:b.write(y)},this._transportReady){e.next=33;break}return e.next=33,this.setupTransport({localDtlsRole:null!==(r=this._forcedLocalDtlsRole)&&void 0!==r?r:"client",localSdpObject:y});case 33:return j.debug("receive() | calling pc.setLocalDescription() [answer:%o]",v),e.next=36,this._pc.setLocalDescription(v);case 36:S=a(t),e.prev=37,P=u().mark((function e(){var t,r,a,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=k.value,r=t.trackId,a=i.get(r),o=R._pc.getTransceivers().find((function(e){return e.mid===a}))){e.next=8;break}throw new Error("new RTCRtpTransceiver not found");case 8:R._mapMidTransceiver.set(a,o),n.push({localId:a,track:o.receiver.track,rtpReceiver:o.receiver});case 10:case"end":return e.stop()}}),e)})),S.s();case 40:if((k=S.n()).done){e.next=44;break}return e.delegateYield(P(),"t2",42);case 42:e.next=40;break;case 44:e.next=49;break;case 46:e.prev=46,e.t3=e.catch(37),S.e(e.t3);case 49:return e.prev=49,S.f(),e.finish(49);case 52:return e.abrupt("return",n);case 53:case"end":return e.stop()}}),e,this,[[14,23,26,29],[37,46,49,52]])}))),function(e){return w.apply(this,arguments)})},{key:"stopReceiving",value:(g=l(u().mark((function e(t){var r,n,i,o,c,s,p,l,d;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=a(t),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=13;break}if(i=n.value,j.debug("stopReceiving() [localId:%s]",i),o=this._mapMidTransceiver.get(i)){e.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:this._remoteSdp.closeMediaSection(o.mid);case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return c={type:"offer",sdp:this._remoteSdp.getSdp()},j.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",c),e.next=25,this._pc.setRemoteDescription(c);case 25:return e.next=27,this._pc.createAnswer();case 27:return s=e.sent,j.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),e.next=31,this._pc.setLocalDescription(s);case 31:p=a(t);try{for(p.s();!(l=p.n()).done;)d=l.value,this._mapMidTransceiver.delete(d)}catch(e){p.e(e)}finally{p.f()}case 33:case"end":return e.stop()}}),e,this,[[2,15,18,21]])}))),function(e){return g.apply(this,arguments)})},{key:"pauseReceiving",value:(y=l(u().mark((function e(t){var r,n,i,o,c,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=a(t),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=14;break}if(i=n.value,j.debug("pauseReceiving() [localId:%s]",i),o=this._mapMidTransceiver.get(i)){e.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:o.direction="inactive",this._remoteSdp.pauseMediaSection(i);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:return c={type:"offer",sdp:this._remoteSdp.getSdp()},j.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",c),e.next=26,this._pc.setRemoteDescription(c);case 26:return e.next=28,this._pc.createAnswer();case 28:return s=e.sent,j.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),e.next=32,this._pc.setLocalDescription(s);case 32:case"end":return e.stop()}}),e,this,[[2,16,19,22]])}))),function(e){return y.apply(this,arguments)})},{key:"resumeReceiving",value:(v=l(u().mark((function e(t){var r,n,i,o,c,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=a(t),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=14;break}if(i=n.value,j.debug("resumeReceiving() [localId:%s]",i),o=this._mapMidTransceiver.get(i)){e.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:o.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:return c={type:"offer",sdp:this._remoteSdp.getSdp()},j.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",c),e.next=26,this._pc.setRemoteDescription(c);case 26:return e.next=28,this._pc.createAnswer();case 28:return s=e.sent,j.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),e.next=32,this._pc.setLocalDescription(s);case 32:case"end":return e.stop()}}),e,this,[[2,16,19,22]])}))),function(e){return v.apply(this,arguments)})},{key:"getReceiverStats",value:(f=l(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertRecvDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.receiver.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"receiveDataChannel",value:(p=l(u().mark((function e(t){var r,n,i,a,o,c,s,p,l,d,f,h,m;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this.assertRecvDirection(),o=r.streamId,c=r.ordered,s=r.maxPacketLifeTime,p=r.maxRetransmits,l={negotiated:!0,id:o,ordered:c,maxPacketLifeTime:s,maxRetransmits:p,protocol:i},j.debug("receiveDataChannel() [options:%o]",l),d=this._pc.createDataChannel(n,l),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation(),f={type:"offer",sdp:this._remoteSdp.getSdp()},j.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=12,this._pc.setRemoteDescription(f);case 12:return e.next=14,this._pc.createAnswer();case 14:if(h=e.sent,this._transportReady){e.next=19;break}return m=b.parse(h.sdp),e.next=19,this.setupTransport({localDtlsRole:null!==(a=this._forcedLocalDtlsRole)&&void 0!==a?a:"client",localSdpObject:m});case 19:return j.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=22,this._pc.setLocalDescription(h);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:d});case 24:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"setupTransport",value:(c=l(u().mark((function e(t){var r,n,i,a=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=b.parse(this._pc.localDescription.sdp)),(i=x.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,new Promise((function(e,t){a.safeEmit("@connect",{dtlsParameters:i},e,t)}));case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}],o=[{key:"createFactory",value:function(){return function(){return new q}}}],r&&d(t.prototype,r),o&&d(t,o),Object.defineProperty(t,"prototype",{writable:!1}),q}(P.HandlerInterface);t.ReactNativeUnifiedPlan=T},433:function(e,t,r){"use strict";function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},n.apply(this,arguments)}function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){s=!0,a=e},f:function(){try{c||null==r.return||r.return()}finally{if(s)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){var n,i,a;n=e,i=t,a=r[t],(i=f(i))in n?Object.defineProperty(n,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[i]=a})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(){u=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},c=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",p=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var i=t&&t.prototype instanceof b?t:b,o=Object.create(i.prototype),c=new C(n||[]);return a(o,"_invoke",{value:j(e,r,c)}),o}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",m="suspendedYield",v="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};l(S,c,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(D([])));k&&k!==r&&n.call(k,c)&&(S=k);var P=_.prototype=b.prototype=Object.create(S);function R(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(a,o,c,s){var u=f(e[a],e,o);if("throw"!==u.type){var p=u.arg,l=p.value;return l&&"object"==i(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,c,s)}),(function(e){r("throw",e,c,s)})):t.resolve(l).then((function(e){p.value=e,c(p)}),(function(e){return r("throw",e,c,s)}))}s(u.arg)}var o;a(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function j(t,r,n){var i=h;return function(a,o){if(i===v)throw new Error("Generator is already running");if(i===y){if("throw"===a)throw o;return{value:e,done:!0}}for(n.method=a,n.arg=o;;){var c=n.delegate;if(c){var s=E(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=v;var u=f(t,r,n);if("normal"===u.type){if(i=n.done?y:m,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=y,n.method="throw",n.arg=u.arg)}}}function E(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,E(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(i,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var o=a.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function r(){for(;++a<t.length;)if(n.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(i(t)+" is not iterable")}return w.prototype=_,a(P,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,p,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,p,"GeneratorFunction")),e.prototype=Object.create(P),e},t.awrap=function(e){return{__await:e}},R(O.prototype),l(O.prototype,s,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,i,a){void 0===a&&(a=Promise);var o=new O(d(e,r,n,i),a);return t.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},R(P),l(P,p,"Generator"),l(P,c,(function(){return this})),l(P,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return c.type="throw",c.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],c=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;L(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function p(e,t,r,n,i,a,o){try{var c=e[a](o),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,i)}function l(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){p(a,n,i,o,c,"next",e)}function c(e){p(a,n,i,o,c,"throw",e)}o(void 0)}))}}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function f(e){var t=function(e,t){if("object"!==i(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===i(t)?t:String(t)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}var v=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),y=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),g=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&v(t,e,r);return y(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Safari11=void 0;var b=g(r(669)),w=r(647),_=g(r(650)),S=g(r(646)),x=g(r(683)),k=g(r(978)),P=r(244),R=r(384),O=new w.Logger("Safari11"),j={OS:1024,MIS:1024},E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(Y,e);var t,r,o,c,p,f,v,y,g,w,P,E,T,L,C,D,M,I,A,F,N,B,G,z,U,K,V=(U=Y,K=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=m(U);if(K){var r=m(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function Y(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Y),(e=V.call(this))._sendStream=new MediaStream,e._mapSendLocalIdRtpSender=new Map,e._nextSendLocalId=0,e._mapRecvLocalIdInfo=new Map,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=Y,r=[{key:"name",get:function(){return"Safari11"}},{key:"close",value:function(){if(O.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}},{key:"getNativeRtpCapabilities",value:(z=l(u().mark((function e(){var t,r,n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),e.prev=2,e.next=5,t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 5:r=e.sent;try{t.close()}catch(e){}return n=b.parse(r.sdp),i=x.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",i);case 12:e.prev=12,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[2,12]])}))),function(){return z.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(G=l(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:j});case 2:case"end":return e.stop()}}),e)}))),function(){return G.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,i=e.iceCandidates,a=e.dtlsParameters,o=e.sctpParameters,c=e.iceServers,u=e.iceTransportPolicy,p=e.additionalSettings,l=e.proprietaryConstraints,d=e.extendedRtpCapabilities;O.debug("run()"),this._direction=r,this._remoteSdp=new R.RemoteSdp({iceParameters:n,iceCandidates:i,dtlsParameters:a,sctpParameters:o,planB:!0}),this._sendingRtpParametersByKind={audio:S.getSendingRtpParameters("audio",d),video:S.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:S.getSendingRemoteRtpParameters("audio",d),video:S.getSendingRemoteRtpParameters("video",d)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection(s({iceServers:c||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},p),l),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(function(){t.emit("@connectionstatechange",t._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(function(){switch(O.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:(B=l(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:O.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"restartIce",value:(N=l(u().mark((function e(t){var r,n,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,O.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return a=e.sent,O.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),e.next=27,this._pc.setLocalDescription(a);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return N.apply(this,arguments)})},{key:"getTransportStats",value:(F=l(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return F.apply(this,arguments)})},{key:"send",value:(A=l(u().mark((function e(t){var r,i,o,c,s,p,l,d,f,h,m,v,y,g,w,P;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,i=t.encodings,o=t.codecOptions,c=t.codec,this.assertSendDirection(),O.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),c&&O.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(r),this._pc.addTrack(r,this._sendStream),e.next=8,this._pc.createOffer();case 8:if(p=e.sent,l=b.parse(p.sdp),(f=_.clone(this._sendingRtpParametersByKind[r.kind],{})).codecs=S.reduceCodecs(f.codecs),(h=_.clone(this._sendingRemoteRtpParametersByKind[r.kind],{})).codecs=S.reduceCodecs(h.codecs),this._transportReady){e.next=17;break}return e.next=17,this.setupTransport({localDtlsRole:null!==(s=this._forcedLocalDtlsRole)&&void 0!==s?s:"client",localSdpObject:l});case 17:return"video"===r.kind&&i&&i.length>1&&(O.debug("send() | enabling simulcast"),l=b.parse(p.sdp),d=l.media.find((function(e){return"video"===e.type})),k.addLegacySimulcast({offerMediaObject:d,track:r,numStreams:i.length}),p={type:"offer",sdp:b.write(l)}),O.debug("send() | calling pc.setLocalDescription() [offer:%o]",p),e.next=21,this._pc.setLocalDescription(p);case 21:if(l=b.parse(this._pc.localDescription.sdp),d=l.media.find((function(e){return e.type===r.kind})),f.rtcp.cname=x.getCname({offerMediaObject:d}),f.encodings=k.getRtpEncodings({offerMediaObject:d,track:r}),i)for(m=0;m<f.encodings.length;++m)i[m]&&n(f.encodings[m],i[m]);if(f.encodings.length>1&&"video/vp8"===f.codecs[0].mimeType.toLowerCase()){v=a(f.encodings);try{for(v.s();!(y=v.n()).done;)y.value.scalabilityMode="S1T3"}catch(e){v.e(e)}finally{v.f()}}return this._remoteSdp.send({offerMediaObject:d,offerRtpParameters:f,answerRtpParameters:h,codecOptions:o}),g={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("send() | calling pc.setRemoteDescription() [answer:%o]",g),e.next=32,this._pc.setRemoteDescription(g);case 32:return w=String(this._nextSendLocalId),this._nextSendLocalId++,P=this._pc.getSenders().find((function(e){return e.track===r})),this._mapSendLocalIdRtpSender.set(w,P),e.abrupt("return",{localId:w,rtpParameters:f,rtpSender:P});case 37:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"stopSending",value:(I=l(u().mark((function e(t){var r,n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),r=this._mapSendLocalIdRtpSender.get(t)){e.next=4;break}throw new Error("associated RTCRtpSender not found");case 4:return r.track&&this._sendStream.removeTrack(r.track),this._mapSendLocalIdRtpSender.delete(t),e.next=8,this._pc.createOffer();case 8:return n=e.sent,O.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.prev=10,e.next=13,this._pc.setLocalDescription(n);case 13:e.next=21;break;case 15:if(e.prev=15,e.t0=e.catch(10),0!==this._sendStream.getTracks().length){e.next=20;break}return O.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.t0.toString()),e.abrupt("return");case 20:throw e.t0;case 21:if("stable"!==this._pc.signalingState){e.next=23;break}return e.abrupt("return");case 23:return i={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=27,this._pc.setRemoteDescription(i);case 27:case"end":return e.stop()}}),e,this,[[10,15]])}))),function(e){return I.apply(this,arguments)})},{key:"pauseSending",value:(M=l(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return M.apply(this,arguments)})},{key:"resumeSending",value:(D=l(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return D.apply(this,arguments)})},{key:"replaceTrack",value:(C=l(u().mark((function e(t,r){var n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),r?O.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):O.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return i=n.track,e.next=8,n.replaceTrack(r);case 8:i&&this._sendStream.removeTrack(i),r&&this._sendStream.addTrack(r);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return C.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(L=l(u().mark((function e(t,r){var n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),O.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return(i=n.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=9,n.setParameters(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return L.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(T=l(u().mark((function e(t,r){var n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),O.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return(i=n.getParameters()).encodings.forEach((function(e,t){i.encodings[t]=s(s({},e),r)})),e.next=9,n.setParameters(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return T.apply(this,arguments)})},{key:"getSenderStats",value:(E=l(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),r=this._mapSendLocalIdRtpSender.get(t)){e.next=4;break}throw new Error("associated RTCRtpSender not found");case 4:return e.abrupt("return",r.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"sendDataChannel",value:(P=l(u().mark((function e(t){var r,n,i,a,o,c,s,p,l,d,f,h,m;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,a=t.label,o=t.protocol,this.assertSendDirection(),s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmits:i,protocol:o},O.debug("sendDataChannel() [options:%o]",s),p=this._pc.createDataChannel(a,s),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%j.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(l=e.sent,d=b.parse(l.sdp),f=d.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this.setupTransport({localDtlsRole:null!==(c=this._forcedLocalDtlsRole)&&void 0!==c?c:"client",localSdpObject:d});case 15:return O.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=18,this._pc.setLocalDescription(l);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:f}),h={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=23,this._pc.setRemoteDescription(h);case 23:this._hasDataChannelMediaSection=!0;case 24:return m={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits},e.abrupt("return",{dataChannel:p,sctpStreamParameters:m});case 26:case"end":return e.stop()}}),e,this)}))),function(e){return P.apply(this,arguments)})},{key:"receive",value:(w=l(u().mark((function e(t){var r,n,i,o,c,s,p,l,d,f,h,m,v,y,g,w,_,S,k,P=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),n=[],i=a(t);try{for(i.s();!(o=i.n()).done;)c=o.value,s=c.trackId,p=c.kind,l=c.rtpParameters,d=c.streamId,O.debug("receive() [trackId:%s, kind:%s]",s,p),f=p,this._remoteSdp.receive({mid:f,kind:p,offerRtpParameters:l,streamId:d||l.rtcp.cname,trackId:s})}catch(e){i.e(e)}finally{i.f()}return h={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",h),e.next=8,this._pc.setRemoteDescription(h);case 8:return e.next=10,this._pc.createAnswer();case 10:m=e.sent,v=b.parse(m.sdp),y=a(t),e.prev=13,w=u().mark((function e(){var t,r,n,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=g.value,r=t.kind,n=t.rtpParameters,i=r,a=v.media.find((function(e){return String(e.mid)===i})),x.applyCodecParameters({offerRtpParameters:n,answerMediaObject:a});case 5:case"end":return e.stop()}}),e)})),y.s();case 16:if((g=y.n()).done){e.next=20;break}return e.delegateYield(w(),"t0",18);case 18:e.next=16;break;case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(13),y.e(e.t1);case 25:return e.prev=25,y.f(),e.finish(25);case 28:if(m={type:"answer",sdp:b.write(v)},this._transportReady){e.next=32;break}return e.next=32,this.setupTransport({localDtlsRole:null!==(r=this._forcedLocalDtlsRole)&&void 0!==r?r:"client",localSdpObject:v});case 32:return O.debug("receive() | calling pc.setLocalDescription() [answer:%o]",m),e.next=35,this._pc.setLocalDescription(m);case 35:_=a(t),e.prev=36,k=u().mark((function e(){var t,r,i,a,o,c,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=S.value,r=t.kind,i=t.trackId,a=t.rtpParameters,o=r,c=i,s=P._pc.getReceivers().find((function(e){return e.track&&e.track.id===c}))){e.next=7;break}throw new Error("new RTCRtpReceiver not");case 7:P._mapRecvLocalIdInfo.set(c,{mid:o,rtpParameters:a,rtpReceiver:s}),n.push({localId:c,track:s.track,rtpReceiver:s});case 9:case"end":return e.stop()}}),e)})),_.s();case 39:if((S=_.n()).done){e.next=43;break}return e.delegateYield(k(),"t2",41);case 41:e.next=39;break;case 43:e.next=48;break;case 45:e.prev=45,e.t3=e.catch(36),_.e(e.t3);case 48:return e.prev=48,_.f(),e.finish(48);case 51:return e.abrupt("return",n);case 52:case"end":return e.stop()}}),e,this,[[13,22,25,28],[36,45,48,51]])}))),function(e){return w.apply(this,arguments)})},{key:"stopReceiving",value:(g=l(u().mark((function e(t){var r,n,i,o,c,s,p,l;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=a(t);try{for(r.s();!(n=r.n()).done;)i=n.value,O.debug("stopReceiving() [localId:%s]",i),o=this._mapRecvLocalIdInfo.get(i)||{},c=o.mid,s=o.rtpParameters,this._mapRecvLocalIdInfo.delete(i),this._remoteSdp.planBStopReceiving({mid:c,offerRtpParameters:s})}catch(e){r.e(e)}finally{r.f()}return p={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",p),e.next=7,this._pc.setRemoteDescription(p);case 7:return e.next=9,this._pc.createAnswer();case 9:return l=e.sent,O.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",l),e.next=13,this._pc.setLocalDescription(l);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"getReceiverStats",value:(y=l(u().mark((function e(t){var r,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertRecvDirection(),r=this._mapRecvLocalIdInfo.get(t)||{},n=r.rtpReceiver){e.next=4;break}throw new Error("associated RTCRtpReceiver not found");case 4:return e.abrupt("return",n.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"pauseReceiving",value:(v=l(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return v.apply(this,arguments)})},{key:"resumeReceiving",value:(f=l(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return f.apply(this,arguments)})},{key:"receiveDataChannel",value:(p=l(u().mark((function e(t){var r,n,i,a,o,c,s,p,l,d,f,h,m;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this.assertRecvDirection(),o=r.streamId,c=r.ordered,s=r.maxPacketLifeTime,p=r.maxRetransmits,l={negotiated:!0,id:o,ordered:c,maxPacketLifeTime:s,maxRetransmits:p,protocol:i},O.debug("receiveDataChannel() [options:%o]",l),d=this._pc.createDataChannel(n,l),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),f={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=12,this._pc.setRemoteDescription(f);case 12:return e.next=14,this._pc.createAnswer();case 14:if(h=e.sent,this._transportReady){e.next=19;break}return m=b.parse(h.sdp),e.next=19,this.setupTransport({localDtlsRole:null!==(a=this._forcedLocalDtlsRole)&&void 0!==a?a:"client",localSdpObject:m});case 19:return O.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=22,this._pc.setLocalDescription(h);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:d});case 24:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"setupTransport",value:(c=l(u().mark((function e(t){var r,n,i,a=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=b.parse(this._pc.localDescription.sdp)),(i=x.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,new Promise((function(e,t){a.safeEmit("@connect",{dtlsParameters:i},e,t)}));case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}],o=[{key:"createFactory",value:function(){return function(){return new Y}}}],r&&d(t.prototype,r),o&&d(t,o),Object.defineProperty(t,"prototype",{writable:!1}),Y}(P.HandlerInterface);t.Safari11=E},622:function(e,t,r){"use strict";function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},n.apply(this,arguments)}function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){s=!0,a=e},f:function(){try{c||null==r.return||r.return()}finally{if(s)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){var n,i,a;n=e,i=t,a=r[t],(i=f(i))in n?Object.defineProperty(n,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[i]=a})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(){u=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},c=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",p=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var i=t&&t.prototype instanceof b?t:b,o=Object.create(i.prototype),c=new C(n||[]);return a(o,"_invoke",{value:j(e,r,c)}),o}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",m="suspendedYield",v="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};l(S,c,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(D([])));k&&k!==r&&n.call(k,c)&&(S=k);var P=_.prototype=b.prototype=Object.create(S);function R(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(a,o,c,s){var u=f(e[a],e,o);if("throw"!==u.type){var p=u.arg,l=p.value;return l&&"object"==i(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,c,s)}),(function(e){r("throw",e,c,s)})):t.resolve(l).then((function(e){p.value=e,c(p)}),(function(e){return r("throw",e,c,s)}))}s(u.arg)}var o;a(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function j(t,r,n){var i=h;return function(a,o){if(i===v)throw new Error("Generator is already running");if(i===y){if("throw"===a)throw o;return{value:e,done:!0}}for(n.method=a,n.arg=o;;){var c=n.delegate;if(c){var s=E(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=v;var u=f(t,r,n);if("normal"===u.type){if(i=n.done?y:m,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=y,n.method="throw",n.arg=u.arg)}}}function E(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,E(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(i,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var o=a.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function r(){for(;++a<t.length;)if(n.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(i(t)+" is not iterable")}return w.prototype=_,a(P,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,p,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,p,"GeneratorFunction")),e.prototype=Object.create(P),e},t.awrap=function(e){return{__await:e}},R(O.prototype),l(O.prototype,s,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,i,a){void 0===a&&(a=Promise);var o=new O(d(e,r,n,i),a);return t.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},R(P),l(P,p,"Generator"),l(P,c,(function(){return this})),l(P,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return c.type="throw",c.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],c=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;L(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function p(e,t,r,n,i,a,o){try{var c=e[a](o),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,i)}function l(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){p(a,n,i,o,c,"next",e)}function c(e){p(a,n,i,o,c,"throw",e)}o(void 0)}))}}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function f(e){var t=function(e,t){if("object"!==i(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===i(t)?t:String(t)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}var v=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),y=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),g=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&v(t,e,r);return y(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Safari12=void 0;var b=g(r(669)),w=r(647),_=g(r(650)),S=g(r(646)),x=g(r(683)),k=g(r(569)),P=r(244),R=r(384),O=new w.Logger("Safari12"),j={OS:1024,MIS:1024},E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(Y,e);var t,r,o,c,p,f,v,y,g,w,P,E,T,L,C,D,M,I,A,F,N,B,G,z,U,K,V=(U=Y,K=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=m(U);if(K){var r=m(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function Y(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Y),(e=V.call(this))._mapMidTransceiver=new Map,e._sendStream=new MediaStream,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=Y,r=[{key:"name",get:function(){return"Safari12"}},{key:"close",value:function(){if(O.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}},{key:"getNativeRtpCapabilities",value:(z=l(u().mark((function e(){var t,r,n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),e.prev=2,t.addTransceiver("audio"),t.addTransceiver("video"),e.next=7,t.createOffer();case 7:r=e.sent;try{t.close()}catch(e){}return n=b.parse(r.sdp),i=x.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",i);case 14:e.prev=14,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 18:case"end":return e.stop()}}),e,null,[[2,14]])}))),function(){return z.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(G=l(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:j});case 2:case"end":return e.stop()}}),e)}))),function(){return G.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,i=e.iceCandidates,a=e.dtlsParameters,o=e.sctpParameters,c=e.iceServers,u=e.iceTransportPolicy,p=e.additionalSettings,l=e.proprietaryConstraints,d=e.extendedRtpCapabilities;O.debug("run()"),this._direction=r,this._remoteSdp=new R.RemoteSdp({iceParameters:n,iceCandidates:i,dtlsParameters:a,sctpParameters:o}),this._sendingRtpParametersByKind={audio:S.getSendingRtpParameters("audio",d),video:S.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:S.getSendingRemoteRtpParameters("audio",d),video:S.getSendingRemoteRtpParameters("video",d)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection(s({iceServers:c||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},p),l),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(function(){t.emit("@connectionstatechange",t._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(function(){switch(O.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:(B=l(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:O.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"restartIce",value:(N=l(u().mark((function e(t){var r,n,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,O.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return a=e.sent,O.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),e.next=27,this._pc.setLocalDescription(a);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return N.apply(this,arguments)})},{key:"getTransportStats",value:(F=l(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return F.apply(this,arguments)})},{key:"send",value:(A=l(u().mark((function e(t){var r,i,o,c,s,p,l,d,f,h,m,v,y,g,w,P,R;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,i=t.encodings,o=t.codecOptions,c=t.codec,this.assertSendDirection(),O.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),(p=_.clone(this._sendingRtpParametersByKind[r.kind],{})).codecs=S.reduceCodecs(p.codecs,c),(l=_.clone(this._sendingRemoteRtpParametersByKind[r.kind],{})).codecs=S.reduceCodecs(l.codecs,c),d=this._remoteSdp.getNextMediaSectionIdx(),f=this._pc.addTransceiver(r,{direction:"sendonly",streams:[this._sendStream]}),e.next=11,this._pc.createOffer();case 11:if(h=e.sent,m=b.parse(h.sdp),this._transportReady){e.next=16;break}return e.next=16,this.setupTransport({localDtlsRole:null!==(s=this._forcedLocalDtlsRole)&&void 0!==s?s:"client",localSdpObject:m});case 16:return i&&i.length>1&&(O.debug("send() | enabling legacy simulcast"),m=b.parse(h.sdp),v=m.media[d.idx],k.addLegacySimulcast({offerMediaObject:v,numStreams:i.length}),h={type:"offer",sdp:b.write(m)}),O.debug("send() | calling pc.setLocalDescription() [offer:%o]",h),e.next=20,this._pc.setLocalDescription(h);case 20:if(y=f.mid,p.mid=y,m=b.parse(this._pc.localDescription.sdp),v=m.media[d.idx],p.rtcp.cname=x.getCname({offerMediaObject:v}),p.encodings=k.getRtpEncodings({offerMediaObject:v}),i)for(g=0;g<p.encodings.length;++g)i[g]&&n(p.encodings[g],i[g]);if(p.encodings.length>1&&("video/vp8"===p.codecs[0].mimeType.toLowerCase()||"video/h264"===p.codecs[0].mimeType.toLowerCase())){w=a(p.encodings);try{for(w.s();!(P=w.n()).done;)P.value.scalabilityMode="S1T3"}catch(e){w.e(e)}finally{w.f()}}return this._remoteSdp.send({offerMediaObject:v,reuseMid:d.reuseMid,offerRtpParameters:p,answerRtpParameters:l,codecOptions:o}),R={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("send() | calling pc.setRemoteDescription() [answer:%o]",R),e.next=33,this._pc.setRemoteDescription(R);case 33:return this._mapMidTransceiver.set(y,f),e.abrupt("return",{localId:y,rtpParameters:p,rtpSender:f.sender});case 35:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"stopSending",value:(I=l(u().mark((function e(t){var r,n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),O.debug("stopSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch(e){}return e.next=11,this._pc.createOffer();case 11:return n=e.sent,O.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=15,this._pc.setLocalDescription(n);case 15:return i={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=19,this._pc.setRemoteDescription(i);case 19:this._mapMidTransceiver.delete(t);case 20:case"end":return e.stop()}}),e,this)}))),function(e){return I.apply(this,arguments)})},{key:"pauseSending",value:(M=l(u().mark((function e(t){var r,n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),O.debug("pauseSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return r.direction="inactive",this._remoteSdp.pauseMediaSection(t),e.next=9,this._pc.createOffer();case 9:return n=e.sent,O.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=13,this._pc.setLocalDescription(n);case 13:return i={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=17,this._pc.setRemoteDescription(i);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)})},{key:"resumeSending",value:(D=l(u().mark((function e(t){var r,n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),O.debug("resumeSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return r.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(t),e.next=9,this._pc.createOffer();case 9:return n=e.sent,O.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=13,this._pc.setLocalDescription(n);case 13:return i={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=17,this._pc.setRemoteDescription(i);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return D.apply(this,arguments)})},{key:"replaceTrack",value:(C=l(u().mark((function e(t,r){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),r?O.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):O.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return e.next=7,n.sender.replaceTrack(r);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return C.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(L=l(u().mark((function e(t,r){var n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),O.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=n.sender.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=9,n.sender.setParameters(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return L.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(T=l(u().mark((function e(t,r){var n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),O.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=n.sender.getParameters()).encodings.forEach((function(e,t){i.encodings[t]=s(s({},e),r)})),e.next=9,n.sender.setParameters(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return T.apply(this,arguments)})},{key:"getSenderStats",value:(E=l(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.sender.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"sendDataChannel",value:(P=l(u().mark((function e(t){var r,n,i,a,o,c,s,p,l,d,f,h,m;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,a=t.label,o=t.protocol,this.assertSendDirection(),s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmits:i,protocol:o},O.debug("sendDataChannel() [options:%o]",s),p=this._pc.createDataChannel(a,s),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%j.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(l=e.sent,d=b.parse(l.sdp),f=d.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this.setupTransport({localDtlsRole:null!==(c=this._forcedLocalDtlsRole)&&void 0!==c?c:"client",localSdpObject:d});case 15:return O.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=18,this._pc.setLocalDescription(l);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:f}),h={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=23,this._pc.setRemoteDescription(h);case 23:this._hasDataChannelMediaSection=!0;case 24:return m={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits},e.abrupt("return",{dataChannel:p,sctpStreamParameters:m});case 26:case"end":return e.stop()}}),e,this)}))),function(e){return P.apply(this,arguments)})},{key:"receive",value:(w=l(u().mark((function e(t){var r,n,i,o,c,s,p,l,d,f,h,m,v,y,g,w,_,S,k,P,R=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),n=[],i=new Map,o=a(t);try{for(o.s();!(c=o.n()).done;)s=c.value,p=s.trackId,l=s.kind,d=s.rtpParameters,f=s.streamId,O.debug("receive() [trackId:%s, kind:%s]",p,l),h=d.mid||String(this._mapMidTransceiver.size),i.set(p,h),this._remoteSdp.receive({mid:h,kind:l,offerRtpParameters:d,streamId:f||d.rtcp.cname,trackId:p})}catch(e){o.e(e)}finally{o.f()}return m={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",m),e.next=9,this._pc.setRemoteDescription(m);case 9:return e.next=11,this._pc.createAnswer();case 11:v=e.sent,y=b.parse(v.sdp),g=a(t),e.prev=14,_=u().mark((function e(){var t,r,n,a,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=w.value,r=t.trackId,n=t.rtpParameters,a=i.get(r),o=y.media.find((function(e){return String(e.mid)===a})),x.applyCodecParameters({offerRtpParameters:n,answerMediaObject:o});case 5:case"end":return e.stop()}}),e)})),g.s();case 17:if((w=g.n()).done){e.next=21;break}return e.delegateYield(_(),"t0",19);case 19:e.next=17;break;case 21:e.next=26;break;case 23:e.prev=23,e.t1=e.catch(14),g.e(e.t1);case 26:return e.prev=26,g.f(),e.finish(26);case 29:if(v={type:"answer",sdp:b.write(y)},this._transportReady){e.next=33;break}return e.next=33,this.setupTransport({localDtlsRole:null!==(r=this._forcedLocalDtlsRole)&&void 0!==r?r:"client",localSdpObject:y});case 33:return O.debug("receive() | calling pc.setLocalDescription() [answer:%o]",v),e.next=36,this._pc.setLocalDescription(v);case 36:S=a(t),e.prev=37,P=u().mark((function e(){var t,r,a,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=k.value,r=t.trackId,a=i.get(r),o=R._pc.getTransceivers().find((function(e){return e.mid===a}))){e.next=6;break}throw new Error("new RTCRtpTransceiver not found");case 6:R._mapMidTransceiver.set(a,o),n.push({localId:a,track:o.receiver.track,rtpReceiver:o.receiver});case 8:case"end":return e.stop()}}),e)})),S.s();case 40:if((k=S.n()).done){e.next=44;break}return e.delegateYield(P(),"t2",42);case 42:e.next=40;break;case 44:e.next=49;break;case 46:e.prev=46,e.t3=e.catch(37),S.e(e.t3);case 49:return e.prev=49,S.f(),e.finish(49);case 52:return e.abrupt("return",n);case 53:case"end":return e.stop()}}),e,this,[[14,23,26,29],[37,46,49,52]])}))),function(e){return w.apply(this,arguments)})},{key:"stopReceiving",value:(g=l(u().mark((function e(t){var r,n,i,o,c,s,p,l,d;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=a(t),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=13;break}if(i=n.value,O.debug("stopReceiving() [localId:%s]",i),o=this._mapMidTransceiver.get(i)){e.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:this._remoteSdp.closeMediaSection(o.mid);case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return c={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",c),e.next=25,this._pc.setRemoteDescription(c);case 25:return e.next=27,this._pc.createAnswer();case 27:return s=e.sent,O.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),e.next=31,this._pc.setLocalDescription(s);case 31:p=a(t);try{for(p.s();!(l=p.n()).done;)d=l.value,this._mapMidTransceiver.delete(d)}catch(e){p.e(e)}finally{p.f()}case 33:case"end":return e.stop()}}),e,this,[[2,15,18,21]])}))),function(e){return g.apply(this,arguments)})},{key:"pauseReceiving",value:(y=l(u().mark((function e(t){var r,n,i,o,c,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=a(t),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=14;break}if(i=n.value,O.debug("pauseReceiving() [localId:%s]",i),o=this._mapMidTransceiver.get(i)){e.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:o.direction="inactive",this._remoteSdp.pauseMediaSection(i);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:return c={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",c),e.next=26,this._pc.setRemoteDescription(c);case 26:return e.next=28,this._pc.createAnswer();case 28:return s=e.sent,O.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),e.next=32,this._pc.setLocalDescription(s);case 32:case"end":return e.stop()}}),e,this,[[2,16,19,22]])}))),function(e){return y.apply(this,arguments)})},{key:"resumeReceiving",value:(v=l(u().mark((function e(t){var r,n,i,o,c,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=a(t),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=14;break}if(i=n.value,O.debug("resumeReceiving() [localId:%s]",i),o=this._mapMidTransceiver.get(i)){e.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:o.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:return c={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",c),e.next=26,this._pc.setRemoteDescription(c);case 26:return e.next=28,this._pc.createAnswer();case 28:return s=e.sent,O.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),e.next=32,this._pc.setLocalDescription(s);case 32:case"end":return e.stop()}}),e,this,[[2,16,19,22]])}))),function(e){return v.apply(this,arguments)})},{key:"getReceiverStats",value:(f=l(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertRecvDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.receiver.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"receiveDataChannel",value:(p=l(u().mark((function e(t){var r,n,i,a,o,c,s,p,l,d,f,h,m;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this.assertRecvDirection(),o=r.streamId,c=r.ordered,s=r.maxPacketLifeTime,p=r.maxRetransmits,l={negotiated:!0,id:o,ordered:c,maxPacketLifeTime:s,maxRetransmits:p,protocol:i},O.debug("receiveDataChannel() [options:%o]",l),d=this._pc.createDataChannel(n,l),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation(),f={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=12,this._pc.setRemoteDescription(f);case 12:return e.next=14,this._pc.createAnswer();case 14:if(h=e.sent,this._transportReady){e.next=19;break}return m=b.parse(h.sdp),e.next=19,this.setupTransport({localDtlsRole:null!==(a=this._forcedLocalDtlsRole)&&void 0!==a?a:"client",localSdpObject:m});case 19:return O.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=22,this._pc.setLocalDescription(h);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:d});case 24:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"setupTransport",value:(c=l(u().mark((function e(t){var r,n,i,a=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=b.parse(this._pc.localDescription.sdp)),(i=x.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,new Promise((function(e,t){a.safeEmit("@connect",{dtlsParameters:i},e,t)}));case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}],o=[{key:"createFactory",value:function(){return function(){return new Y}}}],r&&d(t.prototype,r),o&&d(t,o),Object.defineProperty(t,"prototype",{writable:!1}),Y}(P.HandlerInterface);t.Safari12=E},530:function(e,t,r){"use strict";function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){s=!0,o=e},f:function(){try{c||null==r.return||r.return()}finally{if(s)throw o}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var a=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.mangleRtpParameters=t.getCapabilities=void 0;var s=c(r(650));t.getCapabilities=function(){var e,t=RTCRtpReceiver.getCapabilities(),r=s.clone(t,{}),i=n(r.codecs);try{for(i.s();!(e=i.n()).done;){var a=e.value;if(a.channels=a.numChannels,delete a.numChannels,a.mimeType=a.mimeType||"".concat(a.kind,"/").concat(a.name),a.parameters){var o=a.parameters;o.apt&&(o.apt=Number(o.apt)),o["packetization-mode"]&&(o["packetization-mode"]=Number(o["packetization-mode"]))}var c,u=n(a.rtcpFeedback||[]);try{for(u.s();!(c=u.n()).done;){var p=c.value;p.parameter||(p.parameter="")}}catch(e){u.e(e)}finally{u.f()}}}catch(e){i.e(e)}finally{i.f()}return r},t.mangleRtpParameters=function(e){var t=s.clone(e,{});t.mid&&(t.muxId=t.mid,delete t.mid);var r,i=n(t.codecs);try{for(i.s();!(r=i.n()).done;){var a=r.value;a.channels&&(a.numChannels=a.channels,delete a.channels),a.mimeType&&!a.name&&(a.name=a.mimeType.split("/")[1]),delete a.mimeType}}catch(e){i.e(e)}finally{i.f()}return t}},131:function(e,t,r){"use strict";function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=o(e);if(t){var i=o(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===c(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function o(e){return o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},o(e)}function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function s(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){c=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(c)throw a}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,i=function(e,t){if("object"!==c(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===c(i)?i:String(i)),n)}var i}function d(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var f=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),h=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),m=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&f(t,e,r);return h(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.OfferMediaSection=t.AnswerMediaSection=t.MediaSection=void 0;var v=m(r(650)),y=function(){function e(t){var r=t.iceParameters,n=t.iceCandidates,i=t.dtlsParameters,a=t.planB,o=void 0!==a&&a;if(p(this,e),this._mediaObject={},this._planB=o,r&&this.setIceParameters(r),n){this._mediaObject.candidates=[];var c,u=s(n);try{for(u.s();!(c=u.n()).done;){var l=c.value,d={component:1};d.foundation=l.foundation,d.ip=l.ip,d.port=l.port,d.priority=l.priority,d.transport=l.protocol,d.type=l.type,l.tcpType&&(d.tcptype=l.tcpType),this._mediaObject.candidates.push(d)}}catch(e){u.e(e)}finally{u.f()}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}i&&this.setDtlsRole(i.role)}return d(e,[{key:"mid",get:function(){return String(this._mediaObject.mid)}},{key:"closed",get:function(){return 0===this._mediaObject.port}},{key:"getObject",value:function(){return this._mediaObject}},{key:"setIceParameters",value:function(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}},{key:"pause",value:function(){this._mediaObject.direction="inactive"}},{key:"disable",value:function(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}},{key:"close",value:function(){this.disable(),this._mediaObject.port=0}}]),e}();t.MediaSection=y;var g=function(e){n(r,e);var t=a(r);function r(e){var n,i=e.iceParameters,a=e.iceCandidates,o=e.dtlsParameters,c=e.sctpParameters,u=e.plainRtpParameters,l=e.planB,d=void 0!==l&&l,f=e.offerMediaObject,h=e.offerRtpParameters,m=e.answerRtpParameters,y=e.codecOptions,g=e.extmapAllowMixed,b=void 0!==g&&g;switch(p(this,r),(n=t.call(this,{iceParameters:i,iceCandidates:a,dtlsParameters:o,planB:d}))._mediaObject.mid=String(f.mid),n._mediaObject.type=f.type,n._mediaObject.protocol=f.protocol,u?(n._mediaObject.connection={ip:u.ip,version:u.ipVersion},n._mediaObject.port=u.port):(n._mediaObject.connection={ip:"127.0.0.1",version:4},n._mediaObject.port=7),f.type){case"audio":case"video":n._mediaObject.direction="recvonly",n._mediaObject.rtp=[],n._mediaObject.rtcpFb=[],n._mediaObject.fmtp=[];var _,S=s(m.codecs);try{var x=function(){var e=_.value,t={payload:e.payloadType,codec:w(e),rate:e.clockRate};e.channels>1&&(t.encoding=e.channels),n._mediaObject.rtp.push(t);var r=v.clone(e.parameters,{});if(y){var i=y.opusStereo,a=y.opusFec,o=y.opusDtx,c=y.opusMaxPlaybackRate,u=y.opusMaxAverageBitrate,p=y.opusPtime,l=y.videoGoogleStartBitrate,d=y.videoGoogleMaxBitrate,f=y.videoGoogleMinBitrate,m=h.codecs.find((function(t){return t.payloadType===e.payloadType}));switch(e.mimeType.toLowerCase()){case"audio/opus":void 0!==i&&(m.parameters["sprop-stereo"]=i?1:0,r.stereo=i?1:0),void 0!==a&&(m.parameters.useinbandfec=a?1:0,r.useinbandfec=a?1:0),void 0!==o&&(m.parameters.usedtx=o?1:0,r.usedtx=o?1:0),void 0!==c&&(r.maxplaybackrate=c),void 0!==u&&(r.maxaveragebitrate=u),void 0!==p&&(m.parameters.ptime=p,r.ptime=p);break;case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":void 0!==l&&(r["x-google-start-bitrate"]=l),void 0!==d&&(r["x-google-max-bitrate"]=d),void 0!==f&&(r["x-google-min-bitrate"]=f)}}for(var g={payload:e.payloadType,config:""},b=0,S=Object.keys(r);b<S.length;b++){var x=S[b];g.config&&(g.config+=";"),g.config+="".concat(x,"=").concat(r[x])}g.config&&n._mediaObject.fmtp.push(g);var k,P=s(e.rtcpFeedback);try{for(P.s();!(k=P.n()).done;){var R=k.value;n._mediaObject.rtcpFb.push({payload:e.payloadType,type:R.type,subtype:R.parameter})}}catch(e){P.e(e)}finally{P.f()}};for(S.s();!(_=S.n()).done;)x()}catch(e){S.e(e)}finally{S.f()}n._mediaObject.payloads=m.codecs.map((function(e){return e.payloadType})).join(" "),n._mediaObject.ext=[];var k,P=s(m.headerExtensions);try{var R=function(){var e=k.value;if(!(f.ext||[]).some((function(t){return t.uri===e.uri})))return 1;n._mediaObject.ext.push({uri:e.uri,value:e.id})};for(P.s();!(k=P.n()).done;)R()}catch(e){P.e(e)}finally{P.f()}if(b&&"extmap-allow-mixed"===f.extmapAllowMixed&&(n._mediaObject.extmapAllowMixed="extmap-allow-mixed"),f.simulcast){n._mediaObject.simulcast={dir1:"recv",list1:f.simulcast.list1},n._mediaObject.rids=[];var O,j=s(f.rids||[]);try{for(j.s();!(O=j.n()).done;){var E=O.value;"send"===E.direction&&n._mediaObject.rids.push({id:E.id,direction:"recv"})}}catch(e){j.e(e)}finally{j.f()}}else if(f.simulcast_03){n._mediaObject.simulcast_03={value:f.simulcast_03.value.replace(/send/g,"recv")},n._mediaObject.rids=[];var T,L=s(f.rids||[]);try{for(L.s();!(T=L.n()).done;){var C=T.value;"send"===C.direction&&n._mediaObject.rids.push({id:C.id,direction:"recv"})}}catch(e){L.e(e)}finally{L.f()}}n._mediaObject.rtcpMux="rtcp-mux",n._mediaObject.rtcpRsize="rtcp-rsize",n._planB&&"video"===n._mediaObject.type&&(n._mediaObject.xGoogleFlag="conference");break;case"application":"number"==typeof f.sctpPort?(n._mediaObject.payloads="webrtc-datachannel",n._mediaObject.sctpPort=c.port,n._mediaObject.maxMessageSize=c.maxMessageSize):f.sctpmap&&(n._mediaObject.payloads=c.port,n._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:c.port,maxMessageSize:c.maxMessageSize})}return n}return d(r,[{key:"setDtlsRole",value:function(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}},{key:"resume",value:function(){this._mediaObject.direction="recvonly"}}]),r}(y);t.AnswerMediaSection=g;var b=function(e){n(r,e);var t=a(r);function r(e){var n,i=e.iceParameters,a=e.iceCandidates,o=e.dtlsParameters,c=e.sctpParameters,u=e.plainRtpParameters,l=e.planB,d=void 0!==l&&l,f=e.mid,h=e.kind,m=e.offerRtpParameters,v=e.streamId,y=e.trackId,g=e.oldDataChannelSpec,b=void 0!==g&&g;switch(p(this,r),(n=t.call(this,{iceParameters:i,iceCandidates:a,dtlsParameters:o,planB:d}))._mediaObject.mid=String(f),n._mediaObject.type=h,u?(n._mediaObject.connection={ip:u.ip,version:u.ipVersion},n._mediaObject.protocol="RTP/AVP",n._mediaObject.port=u.port):(n._mediaObject.connection={ip:"127.0.0.1",version:4},n._mediaObject.protocol=c?"UDP/DTLS/SCTP":"UDP/TLS/RTP/SAVPF",n._mediaObject.port=7),h){case"audio":case"video":n._mediaObject.direction="sendonly",n._mediaObject.rtp=[],n._mediaObject.rtcpFb=[],n._mediaObject.fmtp=[],n._planB||(n._mediaObject.msid="".concat(v||"-"," ").concat(y));var _,S=s(m.codecs);try{for(S.s();!(_=S.n()).done;){var x=_.value,k={payload:x.payloadType,codec:w(x),rate:x.clockRate};x.channels>1&&(k.encoding=x.channels),n._mediaObject.rtp.push(k);for(var P={payload:x.payloadType,config:""},R=0,O=Object.keys(x.parameters);R<O.length;R++){var j=O[R];P.config&&(P.config+=";"),P.config+="".concat(j,"=").concat(x.parameters[j])}P.config&&n._mediaObject.fmtp.push(P);var E,T=s(x.rtcpFeedback);try{for(T.s();!(E=T.n()).done;){var L=E.value;n._mediaObject.rtcpFb.push({payload:x.payloadType,type:L.type,subtype:L.parameter})}}catch(e){T.e(e)}finally{T.f()}}}catch(e){S.e(e)}finally{S.f()}n._mediaObject.payloads=m.codecs.map((function(e){return e.payloadType})).join(" "),n._mediaObject.ext=[];var C,D=s(m.headerExtensions);try{for(D.s();!(C=D.n()).done;){var M=C.value;n._mediaObject.ext.push({uri:M.uri,value:M.id})}}catch(e){D.e(e)}finally{D.f()}n._mediaObject.rtcpMux="rtcp-mux",n._mediaObject.rtcpRsize="rtcp-rsize";var I=m.encodings[0],A=I.ssrc,F=I.rtx&&I.rtx.ssrc?I.rtx.ssrc:void 0;n._mediaObject.ssrcs=[],n._mediaObject.ssrcGroups=[],m.rtcp.cname&&n._mediaObject.ssrcs.push({id:A,attribute:"cname",value:m.rtcp.cname}),n._planB&&n._mediaObject.ssrcs.push({id:A,attribute:"msid",value:"".concat(v||"-"," ").concat(y)}),F&&(m.rtcp.cname&&n._mediaObject.ssrcs.push({id:F,attribute:"cname",value:m.rtcp.cname}),n._planB&&n._mediaObject.ssrcs.push({id:F,attribute:"msid",value:"".concat(v||"-"," ").concat(y)}),n._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(A," ").concat(F)}));break;case"application":b?(n._mediaObject.payloads=c.port,n._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:c.port,maxMessageSize:c.maxMessageSize}):(n._mediaObject.payloads="webrtc-datachannel",n._mediaObject.sctpPort=c.port,n._mediaObject.maxMessageSize=c.maxMessageSize)}return n}return d(r,[{key:"setDtlsRole",value:function(e){this._mediaObject.setup="actpass"}},{key:"resume",value:function(){this._mediaObject.direction="sendonly"}},{key:"planBReceive",value:function(e){var t,r=this,n=e.offerRtpParameters,i=e.streamId,a=e.trackId,o=n.encodings[0],c=o.ssrc,u=o.rtx&&o.rtx.ssrc?o.rtx.ssrc:void 0,p=this._mediaObject.payloads.split(" "),l=s(n.codecs);try{for(l.s();!(t=l.n()).done;){var d=t.value;if(!p.includes(String(d.payloadType))){var f={payload:d.payloadType,codec:w(d),rate:d.clockRate};d.channels>1&&(f.encoding=d.channels),this._mediaObject.rtp.push(f);for(var h={payload:d.payloadType,config:""},m=0,v=Object.keys(d.parameters);m<v.length;m++){var y=v[m];h.config&&(h.config+=";"),h.config+="".concat(y,"=").concat(d.parameters[y])}h.config&&this._mediaObject.fmtp.push(h);var g,b=s(d.rtcpFeedback);try{for(b.s();!(g=b.n()).done;){var _=g.value;this._mediaObject.rtcpFb.push({payload:d.payloadType,type:_.type,subtype:_.parameter})}}catch(e){b.e(e)}finally{b.f()}}}}catch(e){l.e(e)}finally{l.f()}this._mediaObject.payloads+=" ".concat(n.codecs.filter((function(e){return!r._mediaObject.payloads.includes(e.payloadType)})).map((function(e){return e.payloadType})).join(" ")),this._mediaObject.payloads=this._mediaObject.payloads.trim(),n.rtcp.cname&&this._mediaObject.ssrcs.push({id:c,attribute:"cname",value:n.rtcp.cname}),this._mediaObject.ssrcs.push({id:c,attribute:"msid",value:"".concat(i||"-"," ").concat(a)}),u&&(n.rtcp.cname&&this._mediaObject.ssrcs.push({id:u,attribute:"cname",value:n.rtcp.cname}),this._mediaObject.ssrcs.push({id:u,attribute:"msid",value:"".concat(i||"-"," ").concat(a)}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(c," ").concat(u)}))}},{key:"planBStopReceiving",value:function(e){var t=e.offerRtpParameters.encodings[0],r=t.ssrc,n=t.rtx&&t.rtx.ssrc?t.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter((function(e){return e.id!==r&&e.id!==n})),n&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter((function(e){return e.ssrcs!=="".concat(r," ").concat(n)})))}}]),r}(y);function w(e){var t=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");return t[2]}t.OfferMediaSection=b},384:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){s=!0,o=e},f:function(){try{c||null==r.return||r.return()}finally{if(s)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,a=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key),"symbol"===n(a)?a:String(a)),i)}var a}var c=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),u=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&c(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteSdp=void 0;var p=u(r(669)),l=r(647),d=r(131),f=new l.Logger("RemoteSdp"),h=function(){function e(t){var r=t.iceParameters,n=t.iceCandidates,i=t.dtlsParameters,a=t.sctpParameters,o=t.plainRtpParameters,c=t.planB,s=void 0!==c&&c;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=r,this._iceCandidates=n,this._dtlsParameters=i,this._sctpParameters=a,this._plainRtpParameters=o,this._planB=s,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},r&&r.iceLite&&(this._sdpObject.icelite="ice-lite"),i){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};var u=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:i.fingerprints[u-1].algorithm,hash:i.fingerprints[u-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}o&&(this._sdpObject.origin.address=o.ip,this._sdpObject.origin.ipVer=o.ipVersion)}var t,r;return t=e,r=[{key:"updateIceParameters",value:function(e){f.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;var t,r=i(this._mediaSections);try{for(r.s();!(t=r.n()).done;)t.value.setIceParameters(e)}catch(e){r.e(e)}finally{r.f()}}},{key:"updateDtlsRole",value:function(e){f.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;var t,r=i(this._mediaSections);try{for(r.s();!(t=r.n()).done;)t.value.setDtlsRole(e)}catch(e){r.e(e)}finally{r.f()}}},{key:"getNextMediaSectionIdx",value:function(){for(var e=0;e<this._mediaSections.length;++e){var t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}},{key:"send",value:function(e){var t=e.offerMediaObject,r=e.reuseMid,n=e.offerRtpParameters,i=e.answerRtpParameters,a=e.codecOptions,o=e.extmapAllowMixed,c=void 0!==o&&o,s=new d.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:t,offerRtpParameters:n,answerRtpParameters:i,codecOptions:a,extmapAllowMixed:c});r?this._replaceMediaSection(s,r):this._midToIndex.has(s.mid)?this._replaceMediaSection(s):this._addMediaSection(s)}},{key:"receive",value:function(e){var t,r=e.mid,n=e.kind,i=e.offerRtpParameters,a=e.streamId,o=e.trackId,c=this._midToIndex.get(r);if(void 0!==c&&(t=this._mediaSections[c]),t)t.planBReceive({offerRtpParameters:i,streamId:a,trackId:o}),this._replaceMediaSection(t);else{t=new d.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:r,kind:n,offerRtpParameters:i,streamId:a,trackId:o});var s=this._mediaSections.find((function(e){return e.closed}));s?this._replaceMediaSection(t,s.mid):this._addMediaSection(t)}}},{key:"pauseMediaSection",value:function(e){this._findMediaSection(e).pause()}},{key:"resumeSendingMediaSection",value:function(e){this._findMediaSection(e).resume()}},{key:"resumeReceivingMediaSection",value:function(e){this._findMediaSection(e).resume()}},{key:"disableMediaSection",value:function(e){this._findMediaSection(e).disable()}},{key:"closeMediaSection",value:function(e){var t=this._findMediaSection(e);return e===this._firstMid?(f.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),this.disableMediaSection(e),!1):(t.close(),this._regenerateBundleMids(),!0)}},{key:"planBStopReceiving",value:function(e){var t=e.mid,r=e.offerRtpParameters,n=this._midToIndex.get(t);if(void 0===n)throw new Error("no media section found with mid '".concat(t,"'"));var i=this._mediaSections[n];i.planBStopReceiving({offerRtpParameters:r}),this._replaceMediaSection(i)}},{key:"sendSctpAssociation",value:function(e){var t=e.offerMediaObject,r=new d.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:t});this._addMediaSection(r)}},{key:"receiveSctpAssociation",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).oldDataChannelSpec,t=void 0!==e&&e,r=new d.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:t});this._addMediaSection(r)}},{key:"getSdp",value:function(){return this._sdpObject.origin.sessionVersion++,p.write(this._sdpObject)}},{key:"_addMediaSection",value:function(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}},{key:"_replaceMediaSection",value:function(e,t){if("string"==typeof t){var r=this._midToIndex.get(t);if(void 0===r)throw new Error("no media section found for reuseMid '".concat(t,"'"));var n=this._mediaSections[r];this._mediaSections[r]=e,this._midToIndex.delete(n.mid),this._midToIndex.set(e.mid,r),this._sdpObject.media[r]=e.getObject(),this._regenerateBundleMids()}else{var i=this._midToIndex.get(e.mid);if(void 0===i)throw new Error("no media section found with mid '".concat(e.mid,"'"));this._mediaSections[i]=e,this._sdpObject.media[i]=e.getObject()}}},{key:"_findMediaSection",value:function(e){var t=this._midToIndex.get(e);if(void 0===t)throw new Error("no media section found with mid '".concat(e,"'"));return this._mediaSections[t]}},{key:"_regenerateBundleMids",value:function(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter((function(e){return!e.closed})).map((function(e){return e.mid})).join(" "))}}],r&&o(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.RemoteSdp=h},683:function(e,t,r){"use strict";function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){s=!0,o=e},f:function(){try{c||null==r.return||r.return()}finally{if(s)throw o}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var a=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.applyCodecParameters=t.getCname=t.extractDtlsParameters=t.extractRtpCapabilities=void 0;var s=c(r(669));t.extractRtpCapabilities=function(e){var t,r=e.sdpObject,i=new Map,a=[],o=!1,c=!1,u=n(r.media);try{for(u.s();!(t=u.n()).done;){var p=t.value,l=p.type;switch(l){case"audio":if(o)continue;o=!0;break;case"video":if(c)continue;c=!0;break;default:continue}var d,f=n(p.rtp);try{for(f.s();!(d=f.n()).done;){var h=d.value,m={kind:l,mimeType:"".concat(l,"/").concat(h.codec),preferredPayloadType:h.payload,clockRate:h.rate,channels:h.encoding,parameters:{},rtcpFeedback:[]};i.set(m.preferredPayloadType,m)}}catch(e){f.e(e)}finally{f.f()}var v,y=n(p.fmtp||[]);try{for(y.s();!(v=y.n()).done;){var g=v.value,b=s.parseParams(g.config),w=i.get(g.payload);w&&(b&&b.hasOwnProperty("profile-level-id")&&(b["profile-level-id"]=String(b["profile-level-id"])),w.parameters=b)}}catch(e){y.e(e)}finally{y.f()}var _,S=n(p.rtcpFb||[]);try{for(S.s();!(_=S.n()).done;){var x=_.value,k=i.get(x.payload);if(k){var P={type:x.type,parameter:x.subtype};P.parameter||delete P.parameter,k.rtcpFeedback.push(P)}}}catch(e){S.e(e)}finally{S.f()}var R,O=n(p.ext||[]);try{for(O.s();!(R=O.n()).done;){var j=R.value;if(!j["encrypt-uri"]){var E={kind:l,uri:j.uri,preferredId:j.value};a.push(E)}}}catch(e){O.e(e)}finally{O.f()}}}catch(e){u.e(e)}finally{u.f()}return{codecs:Array.from(i.values()),headerExtensions:a}},t.extractDtlsParameters=function(e){var t=e.sdpObject,r=(t.media||[]).find((function(e){return e.iceUfrag&&0!==e.port}));if(!r)throw new Error("no active media section found");var n,i=r.fingerprint||t.fingerprint;switch(r.setup){case"active":n="client";break;case"passive":n="server";break;case"actpass":n="auto"}return{role:n,fingerprints:[{algorithm:i.type,value:i.hash}]}},t.getCname=function(e){var t=(e.offerMediaObject.ssrcs||[]).find((function(e){return"cname"===e.attribute}));return t?t.value:""},t.applyCodecParameters=function(e){var t,r=e.offerRtpParameters,i=e.answerMediaObject,a=n(r.codecs);try{var o=function(){var e=t.value,r=e.mimeType.toLowerCase();if("audio/opus"!==r)return 0;if(!(i.rtp||[]).find((function(t){return t.payload===e.payloadType})))return 0;i.fmtp=i.fmtp||[];var n=i.fmtp.find((function(t){return t.payload===e.payloadType}));n||(n={payload:e.payloadType,config:""},i.fmtp.push(n));var a=s.parseParams(n.config);if("audio/opus"===r){var o=e.parameters["sprop-stereo"];void 0!==o&&(a.stereo=o?1:0)}n.config="";for(var c=0,u=Object.keys(a);c<u.length;c++){var p=u[c];n.config&&(n.config+=";"),n.config+="".concat(p,"=").concat(a[p])}};for(a.s();!(t=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}}},978:(e,t)=>{"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a,o,c=[],s=!0,u=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);s=!0);}catch(e){u=!0,i=e}finally{try{if(!s&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw i}}return c}}(e,t)||i(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=i(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){s=!0,o=e},f:function(){try{c||null==r.return||r.return()}finally{if(s)throw o}}}}function i(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Object.defineProperty(t,"__esModule",{value:!0}),t.addLegacySimulcast=t.getRtpEncodings=void 0,t.getRtpEncodings=function(e){var t,i,a=e.offerMediaObject,o=e.track,c=new Set,s=n(a.ssrcs||[]);try{for(s.s();!(i=s.n()).done;){var u=i.value;if("msid"===u.attribute&&u.value.split(" ")[1]===o.id){var p=u.id;c.add(p),t||(t=p)}}}catch(e){s.e(e)}finally{s.f()}if(0===c.size)throw new Error("a=ssrc line with msid information not found [track.id:".concat(o.id,"]"));var l,d=new Map,f=n(a.ssrcGroups||[]);try{for(f.s();!(l=f.n()).done;){var h=l.value;if("FID"===h.semantics){var m=r(h.ssrcs.split(/\s+/),2),v=m[0],y=m[1];v=Number(v),y=Number(y),c.has(v)&&(c.delete(v),c.delete(y),d.set(v,y))}}}catch(e){f.e(e)}finally{f.f()}var g,b=n(c);try{for(b.s();!(g=b.n()).done;){var w=g.value;d.set(w,null)}}catch(e){b.e(e)}finally{b.f()}var _,S=[],x=n(d);try{for(x.s();!(_=x.n()).done;){var k=r(_.value,2),P=k[0],R=k[1],O={ssrc:P};R&&(O.rtx={ssrc:R}),S.push(O)}}catch(e){x.e(e)}finally{x.f()}return S},t.addLegacySimulcast=function(e){var t,r,n,i=e.offerMediaObject,a=e.track,o=e.numStreams;if(o<=1)throw new TypeError("numStreams must be greater than 1");if(!(i.ssrcs||[]).find((function(e){return"msid"===e.attribute&&e.value.split(" ")[1]===a.id&&(t=e.id,n=e.value.split(" ")[0],!0)})))throw new Error("a=ssrc line with msid information not found [track.id:".concat(a.id,"]"));(i.ssrcGroups||[]).some((function(e){if("FID"!==e.semantics)return!1;var n=e.ssrcs.split(/\s+/);return Number(n[0])===t&&(r=Number(n[1]),!0)}));var c=i.ssrcs.find((function(e){return"cname"===e.attribute&&e.id===t}));if(!c)throw new Error("a=ssrc line with cname information not found [track.id:".concat(a.id,"]"));for(var s=c.value,u=[],p=[],l=0;l<o;++l)u.push(t+l),r&&p.push(r+l);i.ssrcGroups=i.ssrcGroups||[],i.ssrcs=i.ssrcs||[],i.ssrcGroups.push({semantics:"SIM",ssrcs:u.join(" ")});for(var d=0;d<u.length;++d){var f=u[d];i.ssrcs.push({id:f,attribute:"cname",value:s}),i.ssrcs.push({id:f,attribute:"msid",value:"".concat(n," ").concat(a.id)})}for(var h=0;h<p.length;++h){var m=u[h],v=p[h];i.ssrcs.push({id:v,attribute:"cname",value:s}),i.ssrcs.push({id:v,attribute:"msid",value:"".concat(n," ").concat(a.id)}),i.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(m," ").concat(v)})}}},569:(e,t)=>{"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a,o,c=[],s=!0,u=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);s=!0);}catch(e){u=!0,i=e}finally{try{if(!s&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw i}}return c}}(e,t)||i(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=i(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){s=!0,o=e},f:function(){try{c||null==r.return||r.return()}finally{if(s)throw o}}}}function i(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Object.defineProperty(t,"__esModule",{value:!0}),t.addLegacySimulcast=t.getRtpEncodings=void 0,t.getRtpEncodings=function(e){var t,i=e.offerMediaObject,a=new Set,o=n(i.ssrcs||[]);try{for(o.s();!(t=o.n()).done;){var c=t.value.id;a.add(c)}}catch(e){o.e(e)}finally{o.f()}if(0===a.size)throw new Error("no a=ssrc lines found");var s,u=new Map,p=n(i.ssrcGroups||[]);try{for(p.s();!(s=p.n()).done;){var l=s.value;if("FID"===l.semantics){var d=r(l.ssrcs.split(/\s+/),2),f=d[0],h=d[1];f=Number(f),h=Number(h),a.has(f)&&(a.delete(f),a.delete(h),u.set(f,h))}}}catch(e){p.e(e)}finally{p.f()}var m,v=n(a);try{for(v.s();!(m=v.n()).done;){var y=m.value;u.set(y,null)}}catch(e){v.e(e)}finally{v.f()}var g,b=[],w=n(u);try{for(w.s();!(g=w.n()).done;){var _=r(g.value,2),S=_[0],x=_[1],k={ssrc:S};x&&(k.rtx={ssrc:x}),b.push(k)}}catch(e){w.e(e)}finally{w.f()}return b},t.addLegacySimulcast=function(e){var t=e.offerMediaObject,n=e.numStreams;if(n<=1)throw new TypeError("numStreams must be greater than 1");var i=(t.ssrcs||[]).find((function(e){return"msid"===e.attribute}));if(!i)throw new Error("a=ssrc line with msid information not found");var a,o=r(i.value.split(" "),2),c=o[0],s=o[1],u=i.id;(t.ssrcGroups||[]).some((function(e){if("FID"!==e.semantics)return!1;var t=e.ssrcs.split(/\s+/);return Number(t[0])===u&&(a=Number(t[1]),!0)}));var p=t.ssrcs.find((function(e){return"cname"===e.attribute}));if(!p)throw new Error("a=ssrc line with cname information not found");for(var l=p.value,d=[],f=[],h=0;h<n;++h)d.push(u+h),a&&f.push(a+h);t.ssrcGroups=[],t.ssrcs=[],t.ssrcGroups.push({semantics:"SIM",ssrcs:d.join(" ")});for(var m=0;m<d.length;++m){var v=d[m];t.ssrcs.push({id:v,attribute:"cname",value:l}),t.ssrcs.push({id:v,attribute:"msid",value:"".concat(c," ").concat(s)})}for(var y=0;y<f.length;++y){var g=d[y],b=f[y];t.ssrcs.push({id:b,attribute:"cname",value:l}),t.ssrcs.push({id:b,attribute:"msid",value:"".concat(c," ").concat(s)}),t.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(g," ").concat(b)})}}},717:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.debug=t.parseScalabilityMode=t.detectDevice=t.Device=t.version=t.types=void 0;var c=o(r(704));t.debug=c.default;var s=r(296);Object.defineProperty(t,"Device",{enumerable:!0,get:function(){return s.Device}}),Object.defineProperty(t,"detectDevice",{enumerable:!0,get:function(){return s.detectDevice}});var u=a(r(820));t.types=u,t.version="3.6.69";var p=r(209);Object.defineProperty(t,"parseScalabilityMode",{enumerable:!0,get:function(){return p.parse}})},646:function(e,t,r){"use strict";function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){s=!0,o=e},f:function(){try{c||null==r.return||r.return()}finally{if(s)throw o}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}var o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),c=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return c(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.canReceive=t.canSend=t.generateProbatorRtpParameters=t.reduceCodecs=t.getSendingRemoteRtpParameters=t.getSendingRtpParameters=t.getRecvRtpCapabilities=t.getExtendedRtpCapabilities=t.validateSctpStreamParameters=t.validateSctpParameters=t.validateNumSctpStreams=t.validateSctpCapabilities=t.validateRtcpParameters=t.validateRtpEncodingParameters=t.validateRtpHeaderExtensionParameters=t.validateRtpCodecParameters=t.validateRtpParameters=t.validateRtpHeaderExtension=t.validateRtcpFeedback=t.validateRtpCodecCapability=t.validateRtpCapabilities=void 0;var u=s(r(407)),p=s(r(650));function l(e){var t=new RegExp("^(audio|video)/(.+)","i");if("object"!==a(e))throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");var r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if(e.kind=r[1].toLowerCase(),e.preferredPayloadType&&"number"!=typeof e.preferredPayloadType)throw new TypeError("invalid codec.preferredPayloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===e.kind?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"===a(e.parameters)||(e.parameters={});for(var i=0,o=Object.keys(e.parameters);i<o.length;i++){var c=o[i],s=e.parameters[c];if(void 0===s&&(e.parameters[c]="",s=""),"string"!=typeof s&&"number"!=typeof s)throw new TypeError("invalid codec parameter [key:".concat(c,"s, value:").concat(s,"]"));if("apt"===c&&"number"!=typeof s)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);var u,p=n(e.rtcpFeedback);try{for(p.s();!(u=p.n()).done;)d(u.value)}catch(e){p.e(e)}finally{p.f()}}function d(e){if("object"!==a(e))throw new TypeError("fb is not an object");if(!e.type||"string"!=typeof e.type)throw new TypeError("missing fb.type");e.parameter&&"string"==typeof e.parameter||(e.parameter="")}function f(e){if("object"!==a(e))throw new TypeError("ext is not an object");if("audio"!==e.kind&&"video"!==e.kind)throw new TypeError("invalid ext.kind");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.preferredId)throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&"boolean"!=typeof e.preferredEncrypt)throw new TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&"string"!=typeof e.direction)throw new TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}function h(e){if("object"!==a(e))throw new TypeError("params is not an object");if(e.mid&&"string"!=typeof e.mid)throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");var t,r=n(e.codecs);try{for(r.s();!(t=r.n()).done;)m(t.value)}catch(e){r.e(e)}finally{r.f()}if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);var i,o=n(e.headerExtensions);try{for(o.s();!(i=o.n()).done;)v(i.value)}catch(e){o.e(e)}finally{o.f()}if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");e.encodings||(e.encodings=[]);var c,s=n(e.encodings);try{for(s.s();!(c=s.n()).done;)y(c.value)}catch(e){s.e(e)}finally{s.f()}if(e.rtcp&&"object"!==a(e.rtcp))throw new TypeError("params.rtcp is not an object");e.rtcp||(e.rtcp={}),g(e.rtcp)}function m(e){var t=new RegExp("^(audio|video)/(.+)","i");if("object"!==a(e))throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");var r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if("number"!=typeof e.payloadType)throw new TypeError("missing codec.payloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===r[1].toLowerCase()?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"===a(e.parameters)||(e.parameters={});for(var i=0,o=Object.keys(e.parameters);i<o.length;i++){var c=o[i],s=e.parameters[c];if(void 0===s&&(e.parameters[c]="",s=""),"string"!=typeof s&&"number"!=typeof s)throw new TypeError("invalid codec parameter [key:".concat(c,"s, value:").concat(s,"]"));if("apt"===c&&"number"!=typeof s)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);var u,p=n(e.rtcpFeedback);try{for(p.s();!(u=p.n()).done;)d(u.value)}catch(e){p.e(e)}finally{p.f()}}function v(e){if("object"!==a(e))throw new TypeError("ext is not an object");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.id)throw new TypeError("missing ext.id");if(e.encrypt&&"boolean"!=typeof e.encrypt)throw new TypeError("invalid ext.encrypt");e.encrypt||(e.encrypt=!1),e.parameters&&"object"===a(e.parameters)||(e.parameters={});for(var t=0,r=Object.keys(e.parameters);t<r.length;t++){var n=r[t],i=e.parameters[n];if(void 0===i&&(e.parameters[n]="",i=""),"string"!=typeof i&&"number"!=typeof i)throw new TypeError("invalid header extension parameter")}}function y(e){if("object"!==a(e))throw new TypeError("encoding is not an object");if(e.ssrc&&"number"!=typeof e.ssrc)throw new TypeError("invalid encoding.ssrc");if(e.rid&&"string"!=typeof e.rid)throw new TypeError("invalid encoding.rid");if(e.rtx&&"object"!==a(e.rtx))throw new TypeError("invalid encoding.rtx");if(e.rtx&&"number"!=typeof e.rtx.ssrc)throw new TypeError("missing encoding.rtx.ssrc");if(e.dtx&&"boolean"==typeof e.dtx||(e.dtx=!1),e.scalabilityMode&&"string"!=typeof e.scalabilityMode)throw new TypeError("invalid encoding.scalabilityMode")}function g(e){if("object"!==a(e))throw new TypeError("rtcp is not an object");if(e.cname&&"string"!=typeof e.cname)throw new TypeError("invalid rtcp.cname");e.reducedSize&&"boolean"==typeof e.reducedSize||(e.reducedSize=!0)}function b(e){if("object"!==a(e))throw new TypeError("numStreams is not an object");if("number"!=typeof e.OS)throw new TypeError("missing numStreams.OS");if("number"!=typeof e.MIS)throw new TypeError("missing numStreams.MIS")}function w(e){return!!e&&/.+\/rtx$/i.test(e.mimeType)}function _(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.strict,i=void 0!==n&&n,a=r.modify,o=void 0!==a&&a,c=e.mimeType.toLowerCase();if(c!==t.mimeType.toLowerCase())return!1;if(e.clockRate!==t.clockRate)return!1;if(e.channels!==t.channels)return!1;switch(c){case"video/h264":if(i){var s;if((e.parameters["packetization-mode"]||0)!==(t.parameters["packetization-mode"]||0))return!1;if(!u.isSameProfile(e.parameters,t.parameters))return!1;try{s=u.generateProfileLevelIdForAnswer(e.parameters,t.parameters)}catch(e){return!1}o&&(s?(e.parameters["profile-level-id"]=s,t.parameters["profile-level-id"]=s):(delete e.parameters["profile-level-id"],delete t.parameters["profile-level-id"]))}break;case"video/vp9":if(i&&(e.parameters["profile-id"]||0)!==(t.parameters["profile-id"]||0))return!1}return!0}function S(e,t){var r,i=[],a=n(e.rtcpFeedback||[]);try{var o=function(){var e=r.value,n=(t.rtcpFeedback||[]).find((function(t){return t.type===e.type&&(t.parameter===e.parameter||!t.parameter&&!e.parameter)}));n&&i.push(n)};for(a.s();!(r=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}return i}t.validateRtpCapabilities=function(e){if("object"!==a(e))throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");e.codecs||(e.codecs=[]);var t,r=n(e.codecs);try{for(r.s();!(t=r.n()).done;)l(t.value)}catch(e){r.e(e)}finally{r.f()}if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);var i,o=n(e.headerExtensions);try{for(o.s();!(i=o.n()).done;)f(i.value)}catch(e){o.e(e)}finally{o.f()}},t.validateRtpCodecCapability=l,t.validateRtcpFeedback=d,t.validateRtpHeaderExtension=f,t.validateRtpParameters=h,t.validateRtpCodecParameters=m,t.validateRtpHeaderExtensionParameters=v,t.validateRtpEncodingParameters=y,t.validateRtcpParameters=g,t.validateSctpCapabilities=function(e){if("object"!==a(e))throw new TypeError("caps is not an object");if(!e.numStreams||"object"!==a(e.numStreams))throw new TypeError("missing caps.numStreams");b(e.numStreams)},t.validateNumSctpStreams=b,t.validateSctpParameters=function(e){if("object"!==a(e))throw new TypeError("params is not an object");if("number"!=typeof e.port)throw new TypeError("missing params.port");if("number"!=typeof e.OS)throw new TypeError("missing params.OS");if("number"!=typeof e.MIS)throw new TypeError("missing params.MIS");if("number"!=typeof e.maxMessageSize)throw new TypeError("missing params.maxMessageSize")},t.validateSctpStreamParameters=function(e){if("object"!==a(e))throw new TypeError("params is not an object");if("number"!=typeof e.streamId)throw new TypeError("missing params.streamId");var t=!1;if("boolean"==typeof e.ordered?t=!0:e.ordered=!0,e.maxPacketLifeTime&&"number"!=typeof e.maxPacketLifeTime)throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&"number"!=typeof e.maxRetransmits)throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(t&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(t||!e.maxPacketLifeTime&&!e.maxRetransmits||(e.ordered=!1),e.label&&"string"!=typeof e.label)throw new TypeError("invalid params.label");if(e.protocol&&"string"!=typeof e.protocol)throw new TypeError("invalid params.protocol")},t.getExtendedRtpCapabilities=function(e,t){var r,i={codecs:[],headerExtensions:[]},a=n(t.codecs||[]);try{var o=function(){var t=r.value;if(w(t))return 0;var n=(e.codecs||[]).find((function(e){return _(e,t,{strict:!0,modify:!0})}));if(!n)return 0;var a={mimeType:n.mimeType,kind:n.kind,clockRate:n.clockRate,channels:n.channels,localPayloadType:n.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:t.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:n.parameters,remoteParameters:t.parameters,rtcpFeedback:S(n,t)};i.codecs.push(a)};for(a.s();!(r=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}var c,s=n(i.codecs);try{var u=function(){var r=c.value,n=e.codecs.find((function(e){return w(e)&&e.parameters.apt===r.localPayloadType})),i=t.codecs.find((function(e){return w(e)&&e.parameters.apt===r.remotePayloadType}));n&&i&&(r.localRtxPayloadType=n.preferredPayloadType,r.remoteRtxPayloadType=i.preferredPayloadType)};for(s.s();!(c=s.n()).done;)u()}catch(e){s.e(e)}finally{s.f()}var p,l=n(t.headerExtensions);try{var d=function(){var t=p.value,r=e.headerExtensions.find((function(e){return n=t,!((r=e).kind&&n.kind&&r.kind!==n.kind||r.uri!==n.uri);var r,n}));if(!r)return 1;var n={kind:t.kind,uri:t.uri,sendId:r.preferredId,recvId:t.preferredId,encrypt:r.preferredEncrypt,direction:"sendrecv"};switch(t.direction){case"sendrecv":n.direction="sendrecv";break;case"recvonly":n.direction="sendonly";break;case"sendonly":n.direction="recvonly";break;case"inactive":n.direction="inactive"}i.headerExtensions.push(n)};for(l.s();!(p=l.n()).done;)d()}catch(e){l.e(e)}finally{l.f()}return i},t.getRecvRtpCapabilities=function(e){var t,r={codecs:[],headerExtensions:[]},i=n(e.codecs);try{for(i.s();!(t=i.n()).done;){var a=t.value,o={mimeType:a.mimeType,kind:a.kind,preferredPayloadType:a.remotePayloadType,clockRate:a.clockRate,channels:a.channels,parameters:a.localParameters,rtcpFeedback:a.rtcpFeedback};if(r.codecs.push(o),a.remoteRtxPayloadType){var c={mimeType:"".concat(a.kind,"/rtx"),kind:a.kind,preferredPayloadType:a.remoteRtxPayloadType,clockRate:a.clockRate,parameters:{apt:a.remotePayloadType},rtcpFeedback:[]};r.codecs.push(c)}}}catch(e){i.e(e)}finally{i.f()}var s,u=n(e.headerExtensions);try{for(u.s();!(s=u.n()).done;){var p=s.value;if("sendrecv"===p.direction||"recvonly"===p.direction){var l={kind:p.kind,uri:p.uri,preferredId:p.recvId,preferredEncrypt:p.encrypt,direction:p.direction};r.headerExtensions.push(l)}}}catch(e){u.e(e)}finally{u.f()}return r},t.getSendingRtpParameters=function(e,t){var r,i={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},a=n(t.codecs);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o.kind===e){var c={mimeType:o.mimeType,payloadType:o.localPayloadType,clockRate:o.clockRate,channels:o.channels,parameters:o.localParameters,rtcpFeedback:o.rtcpFeedback};if(i.codecs.push(c),o.localRtxPayloadType){var s={mimeType:"".concat(o.kind,"/rtx"),payloadType:o.localRtxPayloadType,clockRate:o.clockRate,parameters:{apt:o.localPayloadType},rtcpFeedback:[]};i.codecs.push(s)}}}}catch(e){a.e(e)}finally{a.f()}var u,p=n(t.headerExtensions);try{for(p.s();!(u=p.n()).done;){var l=u.value;if(!(l.kind&&l.kind!==e||"sendrecv"!==l.direction&&"sendonly"!==l.direction)){var d={uri:l.uri,id:l.sendId,encrypt:l.encrypt,parameters:{}};i.headerExtensions.push(d)}}}catch(e){p.e(e)}finally{p.f()}return i},t.getSendingRemoteRtpParameters=function(e,t){var r,i={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},a=n(t.codecs);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o.kind===e){var c={mimeType:o.mimeType,payloadType:o.localPayloadType,clockRate:o.clockRate,channels:o.channels,parameters:o.remoteParameters,rtcpFeedback:o.rtcpFeedback};if(i.codecs.push(c),o.localRtxPayloadType){var s={mimeType:"".concat(o.kind,"/rtx"),payloadType:o.localRtxPayloadType,clockRate:o.clockRate,parameters:{apt:o.localPayloadType},rtcpFeedback:[]};i.codecs.push(s)}}}}catch(e){a.e(e)}finally{a.f()}var u,p=n(t.headerExtensions);try{for(p.s();!(u=p.n()).done;){var l=u.value;if(!(l.kind&&l.kind!==e||"sendrecv"!==l.direction&&"sendonly"!==l.direction)){var d={uri:l.uri,id:l.sendId,encrypt:l.encrypt,parameters:{}};i.headerExtensions.push(d)}}}catch(e){p.e(e)}finally{p.f()}if(i.headerExtensions.some((function(e){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.uri}))){var f,h=n(i.codecs);try{for(h.s();!(f=h.n()).done;){var m=f.value;m.rtcpFeedback=(m.rtcpFeedback||[]).filter((function(e){return"goog-remb"!==e.type}))}}catch(e){h.e(e)}finally{h.f()}}else if(i.headerExtensions.some((function(e){return"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.uri}))){var v,y=n(i.codecs);try{for(y.s();!(v=y.n()).done;){var g=v.value;g.rtcpFeedback=(g.rtcpFeedback||[]).filter((function(e){return"transport-cc"!==e.type}))}}catch(e){y.e(e)}finally{y.f()}}else{var b,w=n(i.codecs);try{for(w.s();!(b=w.n()).done;){var _=b.value;_.rtcpFeedback=(_.rtcpFeedback||[]).filter((function(e){return"transport-cc"!==e.type&&"goog-remb"!==e.type}))}}catch(e){w.e(e)}finally{w.f()}}return i},t.reduceCodecs=function(e,t){var r=[];if(t){for(var n=0;n<e.length;++n)if(_(e[n],t)){r.push(e[n]),w(e[n+1])&&r.push(e[n+1]);break}if(0===r.length)throw new TypeError("no matching codec found")}else r.push(e[0]),w(e[1])&&r.push(e[1]);return r},t.generateProbatorRtpParameters=function(e){h(e=p.clone(e,{}));var t={mid:"probator",codecs:[],headerExtensions:[],encodings:[{ssrc:1234}],rtcp:{cname:"probator"}};return t.codecs.push(e.codecs[0]),t.codecs[0].payloadType=127,t.headerExtensions=e.headerExtensions,t},t.canSend=function(e,t){return t.codecs.some((function(t){return t.kind===e}))},t.canReceive=function(e,t){if(h(e),0===e.codecs.length)return!1;var r=e.codecs[0];return t.codecs.some((function(e){return e.remotePayloadType===r.payloadType}))}},209:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=void 0;var r=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");t.parse=function(e){var t=r.exec(e||"");return t?{spatialLayers:Number(t[1]),temporalLayers:Number(t[2])}:{spatialLayers:1,temporalLayers:1}}},820:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(296),t),i(r(995),t),i(r(274),t),i(r(729),t),i(r(953),t),i(r(174),t),i(r(354),t),i(r(852),t),i(r(244),t),i(r(561),t)},650:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateRandomNumber=t.clone=void 0,t.clone=function(e,t){return void 0===e?t:JSON.parse(JSON.stringify(e))},t.generateRandomNumber=function(){return Math.round(1e7*Math.random())}},573:e=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}var r=1e3,n=60*r,i=60*n,a=24*i;function o(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}e.exports=function(e,c){c=c||{};var s,u,p=t(e);if("string"===p&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var o=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*a;case"hours":case"hour":case"hrs":case"hr":case"h":return o*i;case"minutes":case"minute":case"mins":case"min":case"m":return o*n;case"seconds":case"second":case"secs":case"sec":case"s":return o*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(e);if("number"===p&&isFinite(e))return c.long?(s=e,(u=Math.abs(s))>=a?o(s,u,a,"day"):u>=i?o(s,u,i,"hour"):u>=n?o(s,u,n,"minute"):u>=r?o(s,u,r,"second"):s+" ms"):function(e){var t=Math.abs(e);return t>=a?Math.round(e/a)+"d":t>=i?Math.round(e/i)+"h":t>=n?Math.round(e/n)+"m":t>=r?Math.round(e/r)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},468:e=>{var t=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",(t+=null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(t).forEach((function(e){t[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},669:(e,t,r)=>{var n=r(239),i=r(788);t.write=i,t.parse=n.parse,t.parseParams=n.parseParams,t.parseFmtpConfig=n.parseFmtpConfig,t.parsePayloads=n.parsePayloads,t.parseRemoteCandidates=n.parseRemoteCandidates,t.parseImageAttributes=n.parseImageAttributes,t.parseSimulcastStreamList=n.parseSimulcastStreamList},239:(e,t,r)=>{var n=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,r){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var a=e.push?{}:i?t[e.name]:t;!function(e,t,r,i){if(i&&!r)t[i]=n(e[1]);else for(var a=0;a<r.length;a+=1)null!=e[a+1]&&(t[r[a]]=n(e[a+1]))}(r.match(e.reg),a,e.names,e.name),e.push&&t[e.push].push(a)},a=r(468),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(o).forEach((function(e){var t=e[0],o=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var c=0;c<(a[t]||[]).length;c+=1){var s=a[t][c];if(s.reg.test(o))return i(s,n,o)}})),t.media=r,t};var c=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=n(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(c,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(n),i=0;i<r.length;i+=3)t.push({component:r[i],ip:r[i+1],port:r[i+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(c,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,r=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}}))}))}},788:(e,t,r)=>{var n=r(468),i=/%[sdv%]/g,a=function(e){var t=1,r=arguments,n=r.length;return e.replace(i,(function(e){if(t>=n)return e;var i=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},o=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var o=t.names[i];t.name?n.push(r[t.name][o]):n.push(r[t.names[i]])}else n.push(r[t.name]);return a.apply(null,n)},c=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||c,i=t.innerOrder||s,a=[];return r.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?a.push(o(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){a.push(o(t,r,e))}))}))})),e.media.forEach((function(e){a.push(o("m",n.m[0],e)),i.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?a.push(o(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){a.push(o(t,r,e))}))}))}))})),a.join("\r\n")+"\r\n"}}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var a=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.loaded=!0,a.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var n={};return(()=>{"use strict";r.r(n),r.d(n,{debug:()=>t,default:()=>i});var e=r(717);const t=r(704)("sdk-client"),i=e})(),n})()));
//# sourceMappingURL=sdk.client.min.js.map