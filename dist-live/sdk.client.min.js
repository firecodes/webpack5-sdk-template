/*! For license information please see sdk.client.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.sdkClient=t():e.sdkClient=t()}(self,(()=>(()=>{var e={9499:(e,t,r)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,i=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===n(i)?i:String(i)),o)}var i}Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;var i=r(1373),a="awaitqueue",s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t?(this._debug=(0,i.default)("".concat(a,":").concat(t)),this._warn=(0,i.default)("".concat(a,":WARN:").concat(t)),this._error=(0,i.default)("".concat(a,":ERROR:").concat(t))):(this._debug=(0,i.default)(a),this._warn=(0,i.default)("".concat(a,":WARN")),this._error=(0,i.default)("".concat(a,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}var t,r;return t=e,(r=[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}])&&o(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.Logger=s},4547:(e,t,r)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(){o=function(){return t};var e,t={},r=Object.prototype,i=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,i=Object.create(o.prototype),s=new L(n||[]);return a(i,"_invoke",{value:E(e,r,s)}),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var h="suspendedStart",v="suspendedYield",m="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};p(S,c,(function(){return this}));var k=Object.getPrototypeOf,x=k&&k(k(D([])));x&&x!==r&&i.call(x,c)&&(S=x);var R=_.prototype=b.prototype=Object.create(S);function P(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(o,a,s,c){var u=d(e[o],e,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==n(p)&&i.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,c)}))}c(u.arg)}var o;a(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(i,i):i()}})}function E(t,r,n){var o=h;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(i.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=_,a(R,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:w,configurable:!0}),w.displayName=p(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,p(e,l,"GeneratorFunction")),e.prototype=Object.create(R),e},t.awrap=function(e){return{__await:e}},P(O.prototype),p(O.prototype,u,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new O(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},P(R),p(R,l,"Generator"),p(R,c,(function(){return this})),p(R,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||a(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function u(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){c(i,n,o,a,s,"next",e)}function s(e){c(i,n,o,a,s,"throw",e)}a(void 0)}))}}function l(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,i=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===n(i)?i:String(i)),o)}var i}function p(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&b(e,t)}function h(e){var t=g();return function(){var r,o=w(e);if(t){var i=w(this).constructor;r=Reflect.construct(o,arguments,i)}else r=o.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return v(e)}(this,r)}}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e){var t="function"==typeof Map?new Map:void 0;return m=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return y(e,arguments,w(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),b(r,e)},m(e)}function y(e,t,r){return y=g()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&b(o,r.prototype),o},y.apply(null,arguments)}function g(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function b(e,t){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},b(e,t)}function w(e){return w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},w(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.AwaitQueue=t.AwaitQueueRemovedTaskError=t.AwaitQueueStoppedError=void 0;var _=new(r(9499).Logger),S=function(e){d(r,e);var t=h(r);function r(e){var n;return f(this,r),(n=t.call(this,null!=e?e:"AwaitQueue stopped")).name="AwaitQueueStoppedError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(v(n),r),n}return p(r)}(m(Error));t.AwaitQueueStoppedError=S;var k=function(e){d(r,e);var t=h(r);function r(e){var n;return f(this,r),(n=t.call(this,null!=e?e:"AwaitQueue task removed")).name="AwaitQueueRemovedTaskError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(v(n),r),n}return p(r)}(m(Error));t.AwaitQueueRemovedTaskError=k;var x=function(){function e(){f(this,e),this.pendingTasks=new Map,this.nextTaskId=0,this.stopping=!1}var t,r;return p(e,[{key:"size",get:function(){return this.pendingTasks.size}},{key:"push",value:(r=u(o().mark((function e(t,r){var n,a=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null!==(n=r)&&void 0!==n?n:t.name,_.debug("push() [name:".concat(r,"]")),"function"==typeof t){e.next=4;break}throw new TypeError("given task is not a function");case 4:if(r)try{Object.defineProperty(t,"name",{value:r})}catch(e){}return e.abrupt("return",new Promise((function(e,n){var o={id:a.nextTaskId++,task:t,name:r,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:function(t){if(!o.completed){o.completed=!0,a.pendingTasks.delete(o.id),_.debug("resolving task [name:".concat(o.name,"]")),e(t);var r=i(a.pendingTasks.values(),1)[0];r&&!r.executedAt&&a.execute(r)}},reject:function(e){if(!o.completed&&(o.completed=!0,a.pendingTasks.delete(o.id),_.debug("rejecting task [name:".concat(o.name,"]: %s"),String(e)),n(e),!a.stopping)){var t=i(a.pendingTasks.values(),1)[0];t&&!t.executedAt&&a.execute(t)}}};a.pendingTasks.set(o.id,o),1===a.pendingTasks.size&&a.execute(o)})));case 6:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"stop",value:function(){_.debug("stop()"),this.stopping=!0;var e,t=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=a(e))){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw i}}}}(this.pendingTasks.values());try{for(t.s();!(e=t.n()).done;){var r=e.value;_.debug("stop() | stopping task [name:".concat(r.name,"]")),r.reject(new S)}}catch(e){t.e(e)}finally{t.f()}this.stopping=!1}},{key:"remove",value:function(e){_.debug("remove() [taskIdx:".concat(e,"]"));var t=Array.from(this.pendingTasks.values())[e];t?t.reject(new k):_.debug("stop() | no task with given idx [taskIdx:".concat(e,"]"))}},{key:"dump",value:function(){var e=Date.now(),t=0;return Array.from(this.pendingTasks.values()).map((function(r){return{idx:t++,task:r.task,name:r.name,enqueuedTime:r.executedAt?r.executedAt-r.enqueuedAt:e-r.enqueuedAt,executionTime:r.executedAt?e-r.executedAt:0}}))}},{key:"execute",value:(t=u(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_.debug("execute() [name:".concat(t.name,"]")),!t.executedAt){e.next=3;break}throw new Error("task already being executed");case 3:return t.executedAt=Date.now(),e.prev=4,e.next=7,t.task();case 7:r=e.sent,t.resolve(r),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),t.reject(e.t0);case 14:case"end":return e.stop()}}),e,null,[[4,11]])}))),function(e){return t.apply(this,arguments)})}]),e}();t.AwaitQueue=x},1373:(e,t,r)=>{var n;t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var n=0,o=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(n++,"%c"===e&&(o=n))})),t.splice(o,0,r)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(n=!1,function(){n||(n=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||function(){},e.exports=r(9293)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},9293:(e,t,r)=>{function n(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}e.exports=function(e){function t(e){var r,n,i,a=null;function s(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];if(s.enabled){var i=s,a=Number(new Date),c=a-(r||a);i.diff=c,i.prev=r,i.curr=a,r=a,n[0]=t.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");var u=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,(function(e,r){if("%%"===e)return"%";u++;var o=t.formatters[r];if("function"==typeof o){var a=n[u];e=o.call(i,a),n.splice(u,1),u--}return e})),t.formatArgs.call(i,n),(i.log||t.log).apply(i,n)}}return s.namespace=e,s.useColors=t.useColors(),s.color=t.selectColor(e),s.extend=o,s.destroy=t.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:function(){return null!==a?a:(n!==t.namespaces&&(n=t.namespaces,i=t.enabled(e)),i)},set:function(e){a=e}}),"function"==typeof t.init&&t.init(s),s}function o(e,r){var n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){var e=[].concat(n(t.names.map(i)),n(t.skips.map(i).map((function(e){return"-"+e})))).join(",");return t.enable(""),e},t.enable=function(e){var r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),o=n.length;for(r=0;r<o;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;var r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(9622),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((function(r){t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){for(var r=0,n=0;n<e.length;n++)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},9257:e=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}var r=function(){if("object"===("undefined"==typeof self?"undefined":t(self))&&self)return self;if("object"===("undefined"==typeof window?"undefined":t(window))&&window)return window;throw new Error("Unable to resolve global `this`")};e.exports=function(){if(this)return this;if("object"===("undefined"==typeof globalThis?"undefined":t(globalThis))&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(e){return r()}try{return __global__||r()}finally{delete Object.prototype.__global__}}()},5090:e=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}var r,n="object"===("undefined"==typeof Reflect?"undefined":t(Reflect))?Reflect:null,o=n&&"function"==typeof n.apply?n.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};r=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(r,n){function o(r){e.removeListener(t,i),n(r)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",o),r([].slice.call(arguments))}m(e,t,i,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&m(e,"error",t,{once:!0})}(e,o)}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var s=10;function c(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+t(e))}function u(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function l(e,t,r,n){var o,i,a,s;if(c(r),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),a=i[t]),void 0===a)a=i[t]=r,++e._eventsCount;else if("function"==typeof a?a=i[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),(o=u(e))>0&&a.length>o&&!a.warned){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,s=l,console&&console.warn&&console.warn(s)}return e}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},o=p.bind(n);return o.listener=r,n.wrapFn=o,o}function d(e,t,r){var n=e._events;if(void 0===n)return[];var o=n[t];return void 0===o?[]:"function"==typeof o?r?[o.listener||o]:[o]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(o):v(o,o.length)}function h(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function v(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function m(e,r,n,o){if("function"==typeof e.on)o.once?e.once(r,n):e.on(r,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+t(e));e.addEventListener(r,(function t(i){o.once&&e.removeEventListener(r,t),n(i)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return u(this)},a.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var u=c.length,l=v(c,u);for(r=0;r<u;++r)o(l[r],this,t)}return!0},a.prototype.addListener=function(e,t){return l(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return l(this,e,t,!0)},a.prototype.once=function(e,t){return c(t),this.on(e,f(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,f(this,e,t)),this},a.prototype.removeListener=function(e,t){var r,n,o,i,a;if(c(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(o=-1,i=r.length-1;i>=0;i--)if(r[i]===t||r[i].listener===t){a=r[i].listener,o=i;break}if(o<0)return this;0===o?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,o),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,a||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var o,i=Object.keys(r);for(n=0;n<i.length;++n)"removeListener"!==(o=i[n])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},a.prototype.listeners=function(e){return d(this,e,!0)},a.prototype.rawListeners=function(e){return d(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},a.prototype.listenerCount=h,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},8205:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,i=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===n(i)?i:String(i)),o)}var i}function i(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=r(1373)("h264-profile-level-id");s.log=console.info.bind(console),t.ProfileConstrainedBaseline=1,t.ProfileBaseline=2,t.ProfileMain=3,t.ProfileConstrainedHigh=4,t.ProfileHigh=5;t.Level1_b=0,t.Level1=10,t.Level1_1=11,t.Level1_2=12,t.Level1_3=13,t.Level2=20,t.Level2_1=21,t.Level2_2=22,t.Level3=30,t.Level3_1=31,t.Level3_2=32,t.Level4=40,t.Level4_1=41,t.Level4_2=42,t.Level5=50,t.Level5_1=51,t.Level5_2=52;var c=i((function e(t,r){a(this,e),this.profile=t,this.level=r}));t.ProfileLevelId=c;var u=new c(1,31),l=function(){function e(t){a(this,e),this._mask=~d("x",t),this._maskedValue=d("1",t)}return i(e,[{key:"isMatch",value:function(e){return this._maskedValue===(e&this._mask)}}]),e}(),p=i((function e(t,r,n){a(this,e),this.profile_idc=t,this.profile_iop=r,this.profile=n})),f=[new p(66,new l("x1xx0000"),1),new p(77,new l("1xxx0000"),1),new p(88,new l("11xx0000"),1),new p(66,new l("x0xx0000"),2),new p(88,new l("10xx0000"),2),new p(77,new l("0x0x0000"),3),new p(100,new l("00000000"),5),new p(100,new l("00001100"),4)];function d(e,t){return(t[0]===e)<<7|(t[1]===e)<<6|(t[2]===e)<<5|(t[3]===e)<<4|(t[4]===e)<<3|(t[5]===e)<<2|(t[6]===e)<<1|(t[7]===e)<<0}function h(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})["level-asymmetry-allowed"];return 1===e||"1"===e}t.parseProfileLevelId=function(e){if("string"!=typeof e||6!==e.length)return null;var t=parseInt(e,16);if(0===t)return null;var r,n=255&t,o=t>>8&255,i=t>>16&255;switch(n){case 11:r=0!=(16&o)?0:11;break;case 10:case 12:case 13:case 20:case 21:case 22:case 30:case 31:case 32:case 40:case 41:case 42:case 50:case 51:case 52:r=n;break;default:return s("parseProfileLevelId() | unrecognized level_idc:%s",n),null}for(var a=0,u=f;a<u.length;a++){var l=u[a];if(i===l.profile_idc&&l.profile_iop.isMatch(o))return new c(l.profile,r)}return s("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination"),null},t.profileLevelIdToString=function(e){if(0==e.level)switch(e.profile){case 1:return"42f00b";case 2:return"42100b";case 3:return"4d100b";default:return s("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",e.profile),null}var t;switch(e.profile){case 1:t="42e0";break;case 2:t="4200";break;case 3:t="4d00";break;case 4:t="640c";break;case 5:t="6400";break;default:return s("profileLevelIdToString() | unrecognized profile:%s",e.profile),null}var r=e.level.toString(16);return 1===r.length&&(r="0".concat(r)),"".concat(t).concat(r)},t.parseSdpProfileLevelId=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})["profile-level-id"];return e?t.parseProfileLevelId(e):u},t.isSameProfile=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.parseSdpProfileLevelId(e),o=t.parseSdpProfileLevelId(r);return Boolean(n&&o&&n.profile===o.profile)},t.generateProfileLevelIdForAnswer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e["profile-level-id"]&&!r["profile-level-id"])return s("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;var n=t.parseSdpProfileLevelId(e),o=t.parseSdpProfileLevelId(r);if(!n)throw new TypeError("invalid local_profile_level_id");if(!o)throw new TypeError("invalid remote_profile_level_id");if(n.profile!==o.profile)throw new TypeError("H264 Profile mismatch");var i,a,u=h(e)&&h(r),l=n.level,p=function(e,t){return 0===e?10!==t&&0!==t:0===t?10!==e:e<t}(i=l,a=o.level)?i:a,f=u?l:p;return s("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",n.profile,f),t.profileLevelIdToString(new c(n.profile,f))}},9113:(e,t,r)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(){o=function(){return t};var e,t={},r=Object.prototype,i=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,i=Object.create(o.prototype),s=new L(n||[]);return a(i,"_invoke",{value:E(e,r,s)}),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var h="suspendedStart",v="suspendedYield",m="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};p(S,c,(function(){return this}));var k=Object.getPrototypeOf,x=k&&k(k(D([])));x&&x!==r&&i.call(x,c)&&(S=x);var R=_.prototype=b.prototype=Object.create(S);function P(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(o,a,s,c){var u=d(e[o],e,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==n(p)&&i.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,c)}))}c(u.arg)}var o;a(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(i,i):i()}})}function E(t,r,n){var o=h;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(i.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=_,a(R,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:w,configurable:!0}),w.displayName=p(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,p(e,l,"GeneratorFunction")),e.prototype=Object.create(R),e},t.awrap=function(e){return{__await:e}},P(O.prototype),p(O.prototype,u,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new O(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},P(R),p(R,l,"Generator"),p(R,c,(function(){return this})),p(R,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function i(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function a(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,i=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===n(i)?i:String(i)),o)}var i}function s(e,t){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},s(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.Consumer=void 0;var l=r(1916),p=r(5324),f=r(6020),d=new l.Logger("Consumer"),h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&s(e,t)}(g,e);var t,r,l,h,v,m,y=(v=g,m=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=u(v);if(m){var r=u(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return c(e)}(this,e)});function g(e){var t,r=e.id,n=e.localId,o=e.producerId,i=e.rtpReceiver,a=e.track,s=e.rtpParameters,u=e.appData;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),(t=y.call(this))._closed=!1,t._observer=new p.EnhancedEventEmitter,d.debug("constructor()"),t._id=r,t._localId=n,t._producerId=o,t._rtpReceiver=i,t._track=a,t._rtpParameters=s,t._paused=!a.enabled,t._appData=u||{},t.onTrackEnded=t.onTrackEnded.bind(c(t)),t.handleTrack(),t}return t=g,r=[{key:"id",get:function(){return this._id}},{key:"localId",get:function(){return this._localId}},{key:"producerId",get:function(){return this._producerId}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._track.kind}},{key:"rtpReceiver",get:function(){return this._rtpReceiver}},{key:"track",get:function(){return this._track}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"paused",get:function(){return this._paused}},{key:"appData",get:function(){return this._appData},set:function(e){this._appData=e}},{key:"observer",get:function(){return this._observer}},{key:"close",value:function(){this._closed||(d.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}},{key:"transportClosed",value:function(){this._closed||(d.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}},{key:"getStats",value:(l=o().mark((function e(){var t=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=2;break}throw new f.InvalidStateError("closed");case 2:return e.abrupt("return",new Promise((function(e,r){t.safeEmit("@getstats",e,r)})));case 3:case"end":return e.stop()}}),e,this)})),h=function(){var e=this,t=arguments;return new Promise((function(r,n){var o=l.apply(e,t);function a(e){i(o,r,n,a,s,"next",e)}function s(e){i(o,r,n,a,s,"throw",e)}a(void 0)}))},function(){return h.apply(this,arguments)})},{key:"pause",value:function(){d.debug("pause()"),this._closed?d.error("pause() | Consumer closed"):this._paused?d.debug("pause() | Consumer is already paused"):(this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause"))}},{key:"resume",value:function(){d.debug("resume()"),this._closed?d.error("resume() | Consumer closed"):this._paused?(this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")):d.debug("resume() | Consumer is already resumed")}},{key:"onTrackEnded",value:function(){d.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}},{key:"handleTrack",value:function(){this._track.addEventListener("ended",this.onTrackEnded)}},{key:"destroyTrack",value:function(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch(e){}}}],r&&a(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),g}(p.EnhancedEventEmitter);t.Consumer=h},6503:(e,t,r)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,i=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===n(i)?i:String(i)),o)}var i}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.DataConsumer=void 0;var s=r(1916),c=r(5324),u=new s.Logger("DataConsumer"),l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}(f,e);var t,r,s,l,p=(s=f,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=a(s);if(l){var r=a(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function f(e){var t,r=e.id,n=e.dataProducerId,o=e.dataChannel,i=e.sctpStreamParameters,a=e.appData;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(t=p.call(this))._closed=!1,t._observer=new c.EnhancedEventEmitter,u.debug("constructor()"),t._id=r,t._dataProducerId=n,t._dataChannel=o,t._sctpStreamParameters=i,t._appData=a||{},t.handleDataChannel(),t}return t=f,(r=[{key:"id",get:function(){return this._id}},{key:"dataProducerId",get:function(){return this._dataProducerId}},{key:"closed",get:function(){return this._closed}},{key:"sctpStreamParameters",get:function(){return this._sctpStreamParameters}},{key:"readyState",get:function(){return this._dataChannel.readyState}},{key:"label",get:function(){return this._dataChannel.label}},{key:"protocol",get:function(){return this._dataChannel.protocol}},{key:"binaryType",get:function(){return this._dataChannel.binaryType},set:function(e){this._dataChannel.binaryType=e}},{key:"appData",get:function(){return this._appData},set:function(e){this._appData=e}},{key:"observer",get:function(){return this._observer}},{key:"close",value:function(){this._closed||(u.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}},{key:"transportClosed",value:function(){this._closed||(u.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}},{key:"handleDataChannel",value:function(){var e=this;this._dataChannel.addEventListener("open",(function(){e._closed||(u.debug('DataChannel "open" event'),e.safeEmit("open"))})),this._dataChannel.addEventListener("error",(function(t){if(!e._closed){var r=t.error;r||(r=new Error("unknown DataChannel error")),"sctp-failure"===r.errorDetail?u.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",r.sctpCauseCode,r.message):u.error('DataChannel "error" event: %o',r),e.safeEmit("error",r)}})),this._dataChannel.addEventListener("close",(function(){e._closed||(u.warn('DataChannel "close" event'),e._closed=!0,e.emit("@close"),e.safeEmit("close"),e._observer.safeEmit("close"))})),this._dataChannel.addEventListener("message",(function(t){e._closed||e.safeEmit("message",t.data)}))}}])&&o(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),f}(c.EnhancedEventEmitter);t.DataConsumer=l},6487:(e,t,r)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,i=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===n(i)?i:String(i)),o)}var i}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.DataProducer=void 0;var s=r(1916),c=r(5324),u=r(6020),l=new s.Logger("DataProducer"),p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}(d,e);var t,r,s,p,f=(s=d,p=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=a(s);if(p){var r=a(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function d(e){var t,r=e.id,n=e.dataChannel,o=e.sctpStreamParameters,i=e.appData;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),(t=f.call(this))._closed=!1,t._observer=new c.EnhancedEventEmitter,l.debug("constructor()"),t._id=r,t._dataChannel=n,t._sctpStreamParameters=o,t._appData=i||{},t.handleDataChannel(),t}return t=d,(r=[{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"sctpStreamParameters",get:function(){return this._sctpStreamParameters}},{key:"readyState",get:function(){return this._dataChannel.readyState}},{key:"label",get:function(){return this._dataChannel.label}},{key:"protocol",get:function(){return this._dataChannel.protocol}},{key:"bufferedAmount",get:function(){return this._dataChannel.bufferedAmount}},{key:"bufferedAmountLowThreshold",get:function(){return this._dataChannel.bufferedAmountLowThreshold},set:function(e){this._dataChannel.bufferedAmountLowThreshold=e}},{key:"appData",get:function(){return this._appData},set:function(e){this._appData=e}},{key:"observer",get:function(){return this._observer}},{key:"close",value:function(){this._closed||(l.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}},{key:"transportClosed",value:function(){this._closed||(l.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}},{key:"send",value:function(e){if(l.debug("send()"),this._closed)throw new u.InvalidStateError("closed");this._dataChannel.send(e)}},{key:"handleDataChannel",value:function(){var e=this;this._dataChannel.addEventListener("open",(function(){e._closed||(l.debug('DataChannel "open" event'),e.safeEmit("open"))})),this._dataChannel.addEventListener("error",(function(t){if(!e._closed){var r=t.error;r||(r=new Error("unknown DataChannel error")),"sctp-failure"===r.errorDetail?l.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",r.sctpCauseCode,r.message):l.error('DataChannel "error" event: %o',r),e.safeEmit("error",r)}})),this._dataChannel.addEventListener("close",(function(){e._closed||(l.warn('DataChannel "close" event'),e._closed=!0,e.emit("@close"),e.safeEmit("close"),e._observer.safeEmit("close"))})),this._dataChannel.addEventListener("message",(function(){e._closed||l.warn('DataChannel "message" event in a DataProducer, message discarded')})),this._dataChannel.addEventListener("bufferedamountlow",(function(){e._closed||e.safeEmit("bufferedamountlow")}))}}])&&o(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),d}(c.EnhancedEventEmitter);t.DataProducer=p},8630:function(e,t,r){"use strict";function n(){n=function(){return t};var e,t={},r=Object.prototype,o=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,a=Object.create(o.prototype),s=new L(n||[]);return i(a,"_invoke",{value:E(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var h="suspendedStart",v="suspendedYield",m="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};p(S,c,(function(){return this}));var k=Object.getPrototypeOf,x=k&&k(k(D([])));x&&x!==r&&o.call(x,c)&&(S=x);var R=_.prototype=b.prototype=Object.create(S);function P(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(n,i,s,c){var u=d(e[n],e,i);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==a(p)&&o.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,c)}))}c(u.arg)}var n;i(this,"_invoke",{value:function(e,o){function i(){return new t((function(t,n){r(e,o,t,n)}))}return n=n?n.then(i,i):i()}})}function E(t,r,n){var o=h;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function r(){for(;++n<t.length;)if(o.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(a(t)+" is not iterable")}return w.prototype=_,i(R,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:w,configurable:!0}),w.displayName=p(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,p(e,l,"GeneratorFunction")),e.prototype=Object.create(R),e},t.awrap=function(e){return{__await:e}},P(O.prototype),p(O.prototype,u,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new O(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},P(R),p(R,l,"Generator"),p(R,c,(function(){return this})),p(R,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function o(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==a(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===a(o)?o:String(o)),n)}var o}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}var s=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),c=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),u=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return c(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Device=t.detectDevice=void 0;var l=r(7492),p=r(1916),f=r(5324),d=r(6020),h=u(r(5234)),v=u(r(6059)),m=r(2683),y=r(270),g=r(5031),b=r(6988),w=r(5149),_=r(3261),S=r(246),k=r(3614),x=r(6893),R=r(7042),P=r(2295),O=r(463),E=new p.Logger("Device");function T(){if("object"===("undefined"==typeof navigator?"undefined":a(navigator))&&"ReactNative"===navigator.product)return E.debug("detectDevice() | React-Native detected"),"undefined"==typeof RTCPeerConnection?void E.warn("detectDevice() | unsupported react-native-webrtc without RTCPeerConnection, forgot to call registerGlobals()?"):"undefined"!=typeof RTCRtpTransceiver?(E.debug("detectDevice() | ReactNative UnifiedPlan handler chosen"),"ReactNativeUnifiedPlan"):(E.debug("detectDevice() | ReactNative PlanB handler chosen"),"ReactNative");if("object"!==("undefined"==typeof navigator?"undefined":a(navigator))||"string"!=typeof navigator.userAgent)E.warn("detectDevice() | unknown device");else{var e,t,r,n,o,i,s=navigator.userAgent,c=new l.UAParser(s);E.debug("detectDevice() | browser detected [ua:%s, parsed:%o]",s,c.getResult());var u=c.getBrowser(),p=null===(e=u.name)||void 0===e?void 0:e.toLowerCase(),f=parseInt(null!==(t=u.major)&&void 0!==t?t:"0"),d=null===(r=c.getEngine().name)||void 0===r?void 0:r.toLowerCase(),h=c.getOS(),v=null===(n=h.name)||void 0===n?void 0:n.toLowerCase(),m=parseFloat(null!==(o=h.version)&&void 0!==o?o:"0"),y=null===(i=c.getDevice().model)||void 0===i?void 0:i.toLowerCase(),g="ios"===v||"ipad"===y,b=p&&["chrome","chromium","mobile chrome","chrome webview","chrome headless"].includes(p),w=p&&["firefox","mobile firefox","mobile focus"].includes(p),_=p&&["safari","mobile safari"].includes(p),S=p&&["edge"].includes(p);if((b||S)&&!g&&f>=111)return"Chrome111";if(b&&!g&&f>=74||S&&!g&&f>=88)return"Chrome74";if(b&&!g&&f>=70)return"Chrome70";if(b&&!g&&f>=67)return"Chrome67";if(b&&!g&&f>=55)return"Chrome55";if(w&&!g&&f>=60)return"Firefox60";if(w&&g&&m>=14.3)return"Safari12";if(_&&f>=12&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(_&&f>=11)return"Safari11";if(S&&!g&&f>=11&&f<=18)return"Edge11";if("webkit"===d&&g&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if("blink"===d){var k=s.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(k){var x=Number(k[1]);return x>=111?"Chrome111":x>=74?"Chrome74":x>=70?"Chrome70":x>=67?"Chrome67":"Chrome55"}return"Chrome111"}E.warn("detectDevice() | browser not supported [name:%s, version:%s]",p,f)}}t.detectDevice=T;var C=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.handlerName,n=t.handlerFactory,o=t.Handler;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._loaded=!1,this._observer=new f.EnhancedEventEmitter,E.debug("constructor()"),o){if(E.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),"string"!=typeof o)throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");r=o}if(r&&n)throw new TypeError("just one of handlerName or handlerInterface can be given");if(n)this._handlerFactory=n;else{if(r)E.debug("constructor() | handler given: %s",r);else{if(!(r=T()))throw new d.UnsupportedError("device not supported");E.debug("constructor() | detected handler: %s",r)}switch(r){case"Chrome111":this._handlerFactory=y.Chrome111.createFactory();break;case"Chrome74":this._handlerFactory=g.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=b.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=w.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=_.Chrome55.createFactory();break;case"Firefox60":this._handlerFactory=S.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=k.Safari12.createFactory();break;case"Safari11":this._handlerFactory=x.Safari11.createFactory();break;case"Edge11":this._handlerFactory=R.Edge11.createFactory();break;case"ReactNativeUnifiedPlan":this._handlerFactory=P.ReactNativeUnifiedPlan.createFactory();break;case"ReactNative":this._handlerFactory=O.ReactNative.createFactory();break;default:throw new TypeError('unknown handlerName "'.concat(r,'"'))}}var i=this._handlerFactory();this._handlerName=i.name,i.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}var t,r,s,c;return t=e,r=[{key:"handlerName",get:function(){return this._handlerName}},{key:"loaded",get:function(){return this._loaded}},{key:"rtpCapabilities",get:function(){if(!this._loaded)throw new d.InvalidStateError("not loaded");return this._recvRtpCapabilities}},{key:"sctpCapabilities",get:function(){if(!this._loaded)throw new d.InvalidStateError("not loaded");return this._sctpCapabilities}},{key:"observer",get:function(){return this._observer}},{key:"load",value:(s=n().mark((function e(t){var r,o,i;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.routerRtpCapabilities,E.debug("load() [routerRtpCapabilities:%o]",r),r=h.clone(r),e.prev=3,!this._loaded){e.next=6;break}throw new d.InvalidStateError("already loaded");case 6:return v.validateRtpCapabilities(r),o=this._handlerFactory(),e.next=10,o.getNativeRtpCapabilities();case 10:return i=e.sent,E.debug("load() | got native RTP capabilities:%o",i),v.validateRtpCapabilities(i),this._extendedRtpCapabilities=v.getExtendedRtpCapabilities(i,r),E.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=v.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=v.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=v.getRecvRtpCapabilities(this._extendedRtpCapabilities),v.validateRtpCapabilities(this._recvRtpCapabilities),E.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),e.next=22,o.getNativeSctpCapabilities();case 22:this._sctpCapabilities=e.sent,E.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),v.validateSctpCapabilities(this._sctpCapabilities),E.debug("load() succeeded"),this._loaded=!0,o.close(),e.next=34;break;case 30:throw e.prev=30,e.t0=e.catch(3),o&&o.close(),e.t0;case 34:case"end":return e.stop()}}),e,this,[[3,30]])})),c=function(){var e=this,t=arguments;return new Promise((function(r,n){var i=s.apply(e,t);function a(e){o(i,r,n,a,c,"next",e)}function c(e){o(i,r,n,a,c,"throw",e)}a(void 0)}))},function(e){return c.apply(this,arguments)})},{key:"canProduce",value:function(e){if(!this._loaded)throw new d.InvalidStateError("not loaded");if("audio"!==e&&"video"!==e)throw new TypeError('invalid kind "'.concat(e,'"'));return this._canProduceByKind[e]}},{key:"createSendTransport",value:function(e){var t=e.id,r=e.iceParameters,n=e.iceCandidates,o=e.dtlsParameters,i=e.sctpParameters,a=e.iceServers,s=e.iceTransportPolicy,c=e.additionalSettings,u=e.proprietaryConstraints,l=e.appData;return E.debug("createSendTransport()"),this.createTransport({direction:"send",id:t,iceParameters:r,iceCandidates:n,dtlsParameters:o,sctpParameters:i,iceServers:a,iceTransportPolicy:s,additionalSettings:c,proprietaryConstraints:u,appData:l})}},{key:"createRecvTransport",value:function(e){var t=e.id,r=e.iceParameters,n=e.iceCandidates,o=e.dtlsParameters,i=e.sctpParameters,a=e.iceServers,s=e.iceTransportPolicy,c=e.additionalSettings,u=e.proprietaryConstraints,l=e.appData;return E.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:t,iceParameters:r,iceCandidates:n,dtlsParameters:o,sctpParameters:i,iceServers:a,iceTransportPolicy:s,additionalSettings:c,proprietaryConstraints:u,appData:l})}},{key:"createTransport",value:function(e){var t=e.direction,r=e.id,n=e.iceParameters,o=e.iceCandidates,i=e.dtlsParameters,s=e.sctpParameters,c=e.iceServers,u=e.iceTransportPolicy,l=e.additionalSettings,p=e.proprietaryConstraints,f=e.appData;if(!this._loaded)throw new d.InvalidStateError("not loaded");if("string"!=typeof r)throw new TypeError("missing id");if("object"!==a(n))throw new TypeError("missing iceParameters");if(!Array.isArray(o))throw new TypeError("missing iceCandidates");if("object"!==a(i))throw new TypeError("missing dtlsParameters");if(s&&"object"!==a(s))throw new TypeError("wrong sctpParameters");if(f&&"object"!==a(f))throw new TypeError("if given, appData must be an object");var h=new m.Transport({direction:t,id:r,iceParameters:n,iceCandidates:o,dtlsParameters:i,sctpParameters:s,iceServers:c,iceTransportPolicy:u,additionalSettings:l,proprietaryConstraints:p,appData:f,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",h),h}}],r&&i(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.Device=C},5324:(e,t,r)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,i=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===n(i)?i:String(i)),o)}var i}function i(){return i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(arguments.length<3?e:r):o.value}},i.apply(this,arguments)}function a(e,t){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},a(e,t)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.EnhancedEventEmitter=void 0;var c=r(5090),u=new(r(1916).Logger)("EnhancedEventEmitter"),l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(f,e);var t,r,c,l,p=(c=f,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=s(c);if(l){var r=s(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function f(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(e=p.call(this)).setMaxListeners(1/0),e}return t=f,r=[{key:"emit",value:function(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return(t=i(s(f.prototype),"emit",this)).call.apply(t,[this,e].concat(n))}},{key:"safeEmit",value:function(e){var t=i(s(f.prototype),"listenerCount",this).call(this,e);try{for(var r,n=arguments.length,o=new Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];return(r=i(s(f.prototype),"emit",this)).call.apply(r,[this,e].concat(o))}catch(r){return u.error("safeEmit() | event listener threw an error [eventName:%s]:%o",e,r),Boolean(t)}}},{key:"on",value:function(e,t){return i(s(f.prototype),"on",this).call(this,e,t),this}},{key:"off",value:function(e,t){return i(s(f.prototype),"off",this).call(this,e,t),this}},{key:"addListener",value:function(e,t){return i(s(f.prototype),"on",this).call(this,e,t),this}},{key:"prependListener",value:function(e,t){return i(s(f.prototype),"prependListener",this).call(this,e,t),this}},{key:"once",value:function(e,t){return i(s(f.prototype),"once",this).call(this,e,t),this}},{key:"prependOnceListener",value:function(e,t){return i(s(f.prototype),"prependOnceListener",this).call(this,e,t),this}},{key:"removeListener",value:function(e,t){return i(s(f.prototype),"off",this).call(this,e,t),this}},{key:"removeAllListeners",value:function(e){return i(s(f.prototype),"removeAllListeners",this).call(this,e),this}},{key:"listenerCount",value:function(e){return i(s(f.prototype),"listenerCount",this).call(this,e)}},{key:"listeners",value:function(e){return i(s(f.prototype),"listeners",this).call(this,e)}},{key:"rawListeners",value:function(e){return i(s(f.prototype),"rawListeners",this).call(this,e)}}],r&&o(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),f}(c.EventEmitter);t.EnhancedEventEmitter=l},1916:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,i=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===n(i)?i:String(i)),o)}var i}var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;var a=i(r(1373)),s="mediasoup-client",c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t?(this._debug=(0,a.default)("".concat(s,":").concat(t)),this._warn=(0,a.default)("".concat(s,":WARN:").concat(t)),this._error=(0,a.default)("".concat(s,":ERROR:").concat(t))):(this._debug=(0,a.default)(s),this._warn=(0,a.default)("".concat(s,":WARN")),this._error=(0,a.default)("".concat(s,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}var t,r;return t=e,(r=[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}])&&o(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.Logger=c},4791:(e,t,r)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(){o=function(){return t};var e,t={},r=Object.prototype,i=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,i=Object.create(o.prototype),s=new L(n||[]);return a(i,"_invoke",{value:E(e,r,s)}),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var h="suspendedStart",v="suspendedYield",m="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};p(S,c,(function(){return this}));var k=Object.getPrototypeOf,x=k&&k(k(D([])));x&&x!==r&&i.call(x,c)&&(S=x);var R=_.prototype=b.prototype=Object.create(S);function P(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(o,a,s,c){var u=d(e[o],e,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==n(p)&&i.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,c)}))}c(u.arg)}var o;a(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(i,i):i()}})}function E(t,r,n){var o=h;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(i.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=_,a(R,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:w,configurable:!0}),w.displayName=p(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,p(e,l,"GeneratorFunction")),e.prototype=Object.create(R),e},t.awrap=function(e){return{__await:e}},P(O.prototype),p(O.prototype,u,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new O(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},P(R),p(R,l,"Generator"),p(R,c,(function(){return this})),p(R,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function i(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function a(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function s(e){i(a,n,o,s,c,"next",e)}function c(e){i(a,n,o,s,c,"throw",e)}s(void 0)}))}}function s(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,i=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===n(i)?i:String(i)),o)}var i}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.Producer=void 0;var p=r(1916),f=r(5324),d=r(6020),h=new p.Logger("Producer"),v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(w,e);var t,r,i,p,v,m,y,g,b=(y=w,g=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=l(y);if(g){var r=l(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return u(e)}(this,e)});function w(e){var t,r=e.id,n=e.localId,o=e.rtpSender,i=e.track,a=e.rtpParameters,s=e.stopTracks,c=e.disableTrackOnPause,l=e.zeroRtpOnPause,p=e.appData;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,w),(t=b.call(this))._closed=!1,t._observer=new f.EnhancedEventEmitter,h.debug("constructor()"),t._id=r,t._localId=n,t._rtpSender=o,t._track=i,t._kind=i.kind,t._rtpParameters=a,t._paused=!!c&&!i.enabled,t._maxSpatialLayer=void 0,t._stopTracks=s,t._disableTrackOnPause=c,t._zeroRtpOnPause=l,t._appData=p||{},t.onTrackEnded=t.onTrackEnded.bind(u(t)),t.handleTrack(),t}return t=w,r=[{key:"id",get:function(){return this._id}},{key:"localId",get:function(){return this._localId}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._kind}},{key:"rtpSender",get:function(){return this._rtpSender}},{key:"track",get:function(){return this._track}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"paused",get:function(){return this._paused}},{key:"maxSpatialLayer",get:function(){return this._maxSpatialLayer}},{key:"appData",get:function(){return this._appData},set:function(e){this._appData=e}},{key:"observer",get:function(){return this._observer}},{key:"close",value:function(){this._closed||(h.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}},{key:"transportClosed",value:function(){this._closed||(h.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}},{key:"getStats",value:(m=a(o().mark((function e(){var t=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=2;break}throw new d.InvalidStateError("closed");case 2:return e.abrupt("return",new Promise((function(e,r){t.safeEmit("@getstats",e,r)})));case 3:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"pause",value:function(){var e=this;h.debug("pause()"),this._closed?h.error("pause() | Producer closed"):(this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((function(t,r){e.safeEmit("@pause",t,r)})).catch((function(){})),this._observer.safeEmit("pause"))}},{key:"resume",value:function(){var e=this;h.debug("resume()"),this._closed?h.error("resume() | Producer closed"):(this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((function(t,r){e.safeEmit("@resume",t,r)})).catch((function(){})),this._observer.safeEmit("resume"))}},{key:"replaceTrack",value:(v=a(o().mark((function e(t){var r,n=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.track,h.debug("replaceTrack() [track:%o]",r),!this._closed){e.next=7;break}if(r&&this._stopTracks)try{r.stop()}catch(e){}throw new d.InvalidStateError("closed");case 7:if(!r||"ended"!==r.readyState){e.next=9;break}throw new d.InvalidStateError("track ended");case 9:if(r!==this._track){e.next=12;break}return h.debug("replaceTrack() | same track, ignored"),e.abrupt("return");case 12:return e.next=14,new Promise((function(e,t){n.safeEmit("@replacetrack",r,e,t)}));case 14:this.destroyTrack(),this._track=r,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack();case 18:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(p=a(o().mark((function e(t){var r=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=4;break}throw new d.InvalidStateError("closed");case 4:if("video"===this._kind){e.next=8;break}throw new d.UnsupportedError("not a video Producer");case 8:if("number"==typeof t){e.next=10;break}throw new TypeError("invalid spatialLayer");case 10:if(t!==this._maxSpatialLayer){e.next=12;break}return e.abrupt("return");case 12:return e.next=14,new Promise((function(e,n){r.safeEmit("@setmaxspatiallayer",t,e,n)})).catch((function(){}));case 14:this._maxSpatialLayer=t;case 15:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(i=a(o().mark((function e(t){var r=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=4;break}throw new d.InvalidStateError("closed");case 4:if("object"===n(t)){e.next=6;break}throw new TypeError("invalid params");case 6:return e.next=8,new Promise((function(e,n){r.safeEmit("@setrtpencodingparameters",t,e,n)}));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"onTrackEnded",value:function(){h.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}},{key:"handleTrack",value:function(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}},{key:"destroyTrack",value:function(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch(e){}}}],r&&s(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),w}(f.EnhancedEventEmitter);t.Producer=v},7562:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},5987:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},2683:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(){o=function(){return t};var e,t={},r=Object.prototype,i=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,i=Object.create(o.prototype),s=new L(n||[]);return a(i,"_invoke",{value:E(e,r,s)}),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var h="suspendedStart",v="suspendedYield",m="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};p(S,c,(function(){return this}));var k=Object.getPrototypeOf,x=k&&k(k(D([])));x&&x!==r&&i.call(x,c)&&(S=x);var R=_.prototype=b.prototype=Object.create(S);function P(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(o,a,s,c){var u=d(e[o],e,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==n(p)&&i.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,c)}))}c(u.arg)}var o;a(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(i,i):i()}})}function E(t,r,n){var o=h;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(i.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=_,a(R,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:w,configurable:!0}),w.displayName=p(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,p(e,l,"GeneratorFunction")),e.prototype=Object.create(R),e},t.awrap=function(e){return{__await:e}},P(O.prototype),p(O.prototype,u,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new O(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},P(R),p(R,l,"Generator"),p(R,c,(function(){return this})),p(R,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function i(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function a(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function s(e){i(a,n,o,s,c,"next",e)}function c(e){i(a,n,o,s,c,"throw",e)}s(void 0)}))}}function s(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=c(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function c(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}function f(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,i=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===n(i)?i:String(i)),o)}var i}function d(e,t,r){return t&&f(e.prototype,t),r&&f(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var v=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),m=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),y=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&v(t,e,r);return m(t,e),t},g=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Transport=void 0;var b=r(4547),w=g(r(6497)),_=r(1916),S=r(5324),k=r(6020),x=y(r(5234)),R=y(r(6059)),P=r(4791),O=r(9113),E=r(6487),T=r(6503),C=new _.Logger("Transport"),j=d((function e(t){var r=this;h(this,e),this.consumerOptions=t,this.promise=new Promise((function(e,t){r.resolve=e,r.reject=t}))})),L=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}(I,e);var t,r,i,f,v,m,y,g,_,L,D=(_=I,L=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=p(_);if(L){var r=p(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function I(e){var t,r=e.direction,n=e.id,o=e.iceParameters,i=e.iceCandidates,a=e.dtlsParameters,s=e.sctpParameters,c=e.iceServers,u=e.iceTransportPolicy,l=e.additionalSettings,p=e.proprietaryConstraints,f=e.appData,d=e.handlerFactory,v=e.extendedRtpCapabilities,m=e.canProduceByKind;return h(this,I),(t=D.call(this))._closed=!1,t._iceGatheringState="new",t._connectionState="new",t._producers=new Map,t._consumers=new Map,t._dataProducers=new Map,t._dataConsumers=new Map,t._probatorConsumerCreated=!1,t._awaitQueue=new b.AwaitQueue,t._pendingConsumerTasks=[],t._consumerCreationInProgress=!1,t._pendingPauseConsumers=new Map,t._consumerPauseInProgress=!1,t._pendingResumeConsumers=new Map,t._consumerResumeInProgress=!1,t._pendingCloseConsumers=new Map,t._consumerCloseInProgress=!1,t._observer=new S.EnhancedEventEmitter,C.debug("constructor() [id:%s, direction:%s]",n,r),t._id=n,t._direction=r,t._extendedRtpCapabilities=v,t._canProduceByKind=m,t._maxSctpMessageSize=s?s.maxMessageSize:null,delete(l=x.clone(l)||{}).iceServers,delete l.iceTransportPolicy,delete l.bundlePolicy,delete l.rtcpMuxPolicy,delete l.sdpSemantics,t._handler=d(),t._handler.run({direction:r,iceParameters:o,iceCandidates:i,dtlsParameters:a,sctpParameters:s,iceServers:c,iceTransportPolicy:u,additionalSettings:l,proprietaryConstraints:p,extendedRtpCapabilities:v}),t._appData=f||{},t.handleHandler(),t}return d(I,[{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"direction",get:function(){return this._direction}},{key:"handler",get:function(){return this._handler}},{key:"iceGatheringState",get:function(){return this._iceGatheringState}},{key:"connectionState",get:function(){return this._connectionState}},{key:"appData",get:function(){return this._appData},set:function(e){this._appData=e}},{key:"observer",get:function(){return this._observer}},{key:"close",value:function(){if(!this._closed){C.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close(),this._connectionState="closed";var e,t=s(this._producers.values());try{for(t.s();!(e=t.n()).done;)e.value.transportClosed()}catch(e){t.e(e)}finally{t.f()}this._producers.clear();var r,n=s(this._consumers.values());try{for(n.s();!(r=n.n()).done;)r.value.transportClosed()}catch(e){n.e(e)}finally{n.f()}this._consumers.clear();var o,i=s(this._dataProducers.values());try{for(i.s();!(o=i.n()).done;)o.value.transportClosed()}catch(e){i.e(e)}finally{i.f()}this._dataProducers.clear();var a,c=s(this._dataConsumers.values());try{for(c.s();!(a=c.n()).done;)a.value.transportClosed()}catch(e){c.e(e)}finally{c.f()}this._dataConsumers.clear(),this._observer.safeEmit("close")}}},{key:"getStats",value:(g=a(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=2;break}throw new k.InvalidStateError("closed");case 2:return e.abrupt("return",this._handler.getTransportStats());case 3:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"restartIce",value:(y=a(o().mark((function e(t){var r,n=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.iceParameters,C.debug("restartIce()"),!this._closed){e.next=6;break}throw new k.InvalidStateError("closed");case 6:if(r){e.next=8;break}throw new TypeError("missing iceParameters");case 8:return e.abrupt("return",this._awaitQueue.push(a(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._handler.restartIce(r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),"transport.restartIce()"));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"updateIceServers",value:(m=a(o().mark((function e(){var t,r=this,n=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(n.length>0&&void 0!==n[0]?n[0]:{}).iceServers,C.debug("updateIceServers()"),!this._closed){e.next=6;break}throw new k.InvalidStateError("closed");case 6:if(Array.isArray(t)){e.next=8;break}throw new TypeError("missing iceServers");case 8:return e.abrupt("return",this._awaitQueue.push(a(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r._handler.updateIceServers(t));case 1:case"end":return e.stop()}}),e)}))),"transport.updateIceServers()"));case 9:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"produce",value:(v=a(o().mark((function e(){var t,r,i,s,c,u,l,p,f,d,h,v,m,y=this,g=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(t=g.length>0&&void 0!==g[0]?g[0]:{}).track,i=t.encodings,s=t.codecOptions,c=t.codec,u=t.stopTracks,l=void 0===u||u,p=t.disableTrackOnPause,f=void 0===p||p,d=t.zeroRtpOnPause,h=void 0!==d&&d,v=t.appData,m=void 0===v?{}:v,C.debug("produce() [track:%o]",r),!this._closed){e.next=6;break}throw new k.InvalidStateError("closed");case 6:if(r){e.next=10;break}throw new TypeError("missing track");case 10:if("send"===this._direction){e.next=14;break}throw new k.UnsupportedError("not a sending Transport");case 14:if(this._canProduceByKind[r.kind]){e.next=18;break}throw new k.UnsupportedError("cannot produce ".concat(r.kind));case 18:if("ended"!==r.readyState){e.next=22;break}throw new k.InvalidStateError("track ended");case 22:if(0!==this.listenerCount("connect")||"new"!==this._connectionState){e.next=26;break}throw new TypeError('no "connect" listener set into this transport');case 26:if(0!==this.listenerCount("produce")){e.next=30;break}throw new TypeError('no "produce" listener set into this transport');case 30:if(!m||"object"===n(m)){e.next=32;break}throw new TypeError("if given, appData must be an object");case 32:return e.abrupt("return",this._awaitQueue.push(a(o().mark((function e(){var t,n,a,u,p,d,v,g;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i||Array.isArray(i)){e.next=4;break}throw TypeError("encodings must be an array");case 4:i&&0===i.length?t=void 0:i&&(t=i.map((function(e){var t={active:!0};return!1===e.active&&(t.active=!1),"boolean"==typeof e.dtx&&(t.dtx=e.dtx),"string"==typeof e.scalabilityMode&&(t.scalabilityMode=e.scalabilityMode),"number"==typeof e.scaleResolutionDownBy&&(t.scaleResolutionDownBy=e.scaleResolutionDownBy),"number"==typeof e.maxBitrate&&(t.maxBitrate=e.maxBitrate),"number"==typeof e.maxFramerate&&(t.maxFramerate=e.maxFramerate),"boolean"==typeof e.adaptivePtime&&(t.adaptivePtime=e.adaptivePtime),"string"==typeof e.priority&&(t.priority=e.priority),"string"==typeof e.networkPriority&&(t.networkPriority=e.networkPriority),t})));case 5:return e.next=7,y._handler.send({track:r,encodings:t,codecOptions:s,codec:c});case 7:return n=e.sent,a=n.localId,u=n.rtpParameters,p=n.rtpSender,e.prev=11,R.validateRtpParameters(u),e.next=15,new Promise((function(e,t){y.safeEmit("produce",{kind:r.kind,rtpParameters:u,appData:m},e,t)}));case 15:return d=e.sent,v=d.id,g=new P.Producer({id:v,localId:a,rtpSender:p,track:r,rtpParameters:u,stopTracks:l,disableTrackOnPause:f,zeroRtpOnPause:h,appData:m}),y._producers.set(g.id,g),y.handleProducer(g),y._observer.safeEmit("newproducer",g),e.abrupt("return",g);case 24:throw e.prev=24,e.t0=e.catch(11),y._handler.stopSending(a).catch((function(){})),e.t0;case 28:case"end":return e.stop()}}),e,null,[[11,24]])}))),"transport.produce()").catch((function(e){if(l)try{r.stop()}catch(e){}throw e})));case 33:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"consume",value:(f=a(o().mark((function e(t){var r,i,a,s,c,u,l,p,f=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.id,i=t.producerId,a=t.kind,s=t.rtpParameters,c=t.streamId,u=t.appData,l=void 0===u?{}:u,C.debug("consume()"),s=x.clone(s),!this._closed){e.next=7;break}throw new k.InvalidStateError("closed");case 7:if("recv"===this._direction){e.next=11;break}throw new k.UnsupportedError("not a receiving Transport");case 11:if("string"==typeof r){e.next=15;break}throw new TypeError("missing id");case 15:if("string"==typeof i){e.next=19;break}throw new TypeError("missing producerId");case 19:if("audio"===a||"video"===a){e.next=23;break}throw new TypeError("invalid kind '".concat(a,"'"));case 23:if(0!==this.listenerCount("connect")||"new"!==this._connectionState){e.next=27;break}throw new TypeError('no "connect" listener set into this transport');case 27:if(!l||"object"===n(l)){e.next=29;break}throw new TypeError("if given, appData must be an object");case 29:if(R.canReceive(s,this._extendedRtpCapabilities)){e.next=32;break}throw new k.UnsupportedError("cannot consume this Producer");case 32:return p=new j({id:r,producerId:i,kind:a,rtpParameters:s,streamId:c,appData:l}),this._pendingConsumerTasks.push(p),(0,w.default)((function(){f._closed||!1===f._consumerCreationInProgress&&f.createPendingConsumers()})),e.abrupt("return",p.promise);case 36:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"produceData",value:(i=a(o().mark((function e(){var t,r,i,s,c,u,l,p,f,d,h,v=this,m=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(t=m.length>0&&void 0!==m[0]?m[0]:{}).ordered,i=void 0===r||r,s=t.maxPacketLifeTime,c=t.maxRetransmits,u=t.label,l=void 0===u?"":u,p=t.protocol,f=void 0===p?"":p,d=t.appData,h=void 0===d?{}:d,C.debug("produceData()"),!this._closed){e.next=6;break}throw new k.InvalidStateError("closed");case 6:if("send"===this._direction){e.next=10;break}throw new k.UnsupportedError("not a sending Transport");case 10:if(this._maxSctpMessageSize){e.next=14;break}throw new k.UnsupportedError("SCTP not enabled by remote Transport");case 14:if(0!==this.listenerCount("connect")||"new"!==this._connectionState){e.next=18;break}throw new TypeError('no "connect" listener set into this transport');case 18:if(0!==this.listenerCount("producedata")){e.next=22;break}throw new TypeError('no "producedata" listener set into this transport');case 22:if(!h||"object"===n(h)){e.next=24;break}throw new TypeError("if given, appData must be an object");case 24:return(s||c)&&(i=!1),e.abrupt("return",this._awaitQueue.push(a(o().mark((function e(){var t,r,n,a,u,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v._handler.sendDataChannel({ordered:i,maxPacketLifeTime:s,maxRetransmits:c,label:l,protocol:f});case 2:return t=e.sent,r=t.dataChannel,n=t.sctpStreamParameters,R.validateSctpStreamParameters(n),e.next=8,new Promise((function(e,t){v.safeEmit("producedata",{sctpStreamParameters:n,label:l,protocol:f,appData:h},e,t)}));case 8:return a=e.sent,u=a.id,p=new E.DataProducer({id:u,dataChannel:r,sctpStreamParameters:n,appData:h}),v._dataProducers.set(p.id,p),v.handleDataProducer(p),v._observer.safeEmit("newdataproducer",p),e.abrupt("return",p);case 15:case"end":return e.stop()}}),e)}))),"transport.produceData()"));case 26:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"consumeData",value:(r=a(o().mark((function e(t){var r,i,s,c,u,l,p,f,d,h=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.id,i=t.dataProducerId,s=t.sctpStreamParameters,c=t.label,u=void 0===c?"":c,l=t.protocol,p=void 0===l?"":l,f=t.appData,d=void 0===f?{}:f,C.debug("consumeData()"),s=x.clone(s),!this._closed){e.next=7;break}throw new k.InvalidStateError("closed");case 7:if("recv"===this._direction){e.next=11;break}throw new k.UnsupportedError("not a receiving Transport");case 11:if(this._maxSctpMessageSize){e.next=15;break}throw new k.UnsupportedError("SCTP not enabled by remote Transport");case 15:if("string"==typeof r){e.next=19;break}throw new TypeError("missing id");case 19:if("string"==typeof i){e.next=23;break}throw new TypeError("missing dataProducerId");case 23:if(0!==this.listenerCount("connect")||"new"!==this._connectionState){e.next=27;break}throw new TypeError('no "connect" listener set into this transport');case 27:if(!d||"object"===n(d)){e.next=29;break}throw new TypeError("if given, appData must be an object");case 29:return R.validateSctpStreamParameters(s),e.abrupt("return",this._awaitQueue.push(a(o().mark((function e(){var t,n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h._handler.receiveDataChannel({sctpStreamParameters:s,label:u,protocol:p});case 2:return t=e.sent,n=t.dataChannel,a=new T.DataConsumer({id:r,dataProducerId:i,dataChannel:n,sctpStreamParameters:s,appData:d}),h._dataConsumers.set(a.id,a),h.handleDataConsumer(a),h._observer.safeEmit("newdataconsumer",a),e.abrupt("return",a);case 9:case"end":return e.stop()}}),e)}))),"transport.consumeData()"));case 31:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"createPendingConsumers",value:(t=a(o().mark((function e(){var t=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._consumerCreationInProgress=!0,this._awaitQueue.push(a(o().mark((function e(){var r,n,i,a,l,p,f,d,h,v,m,y,g,b,w,_,S,k,x,P,E,T,j,L,D,I,M,A;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t._pendingConsumerTasks.length){e.next=3;break}return C.debug("createPendingConsumers() | there is no Consumer to be created"),e.abrupt("return");case 3:o=t._pendingConsumerTasks,r=function(e){if(Array.isArray(e))return u(e)}(o)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(o)||c(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),t._pendingConsumerTasks=[],n=void 0,i=[],a=s(r);try{for(a.s();!(l=a.n()).done;)p=l.value,f=p.consumerOptions,d=f.id,h=f.kind,v=f.rtpParameters,m=f.streamId,i.push({trackId:d,kind:h,rtpParameters:v,streamId:m})}catch(e){a.e(e)}finally{a.f()}return e.prev=9,e.next=12,t._handler.receive(i);case 12:for(y=e.sent,g=0;g<y.length;++g)b=r[g],w=y[g],_=b.consumerOptions,S=_.id,k=_.producerId,x=_.kind,P=_.rtpParameters,E=_.appData,T=w.localId,j=w.rtpReceiver,L=w.track,D=new O.Consumer({id:S,localId:T,producerId:k,rtpReceiver:j,track:L,rtpParameters:P,appData:E}),t._consumers.set(D.id,D),t.handleConsumer(D),t._probatorConsumerCreated||n||"video"!==x||(n=D),t._observer.safeEmit("newconsumer",D),b.resolve(D);e.next=20;break;case 16:e.prev=16,e.t0=e.catch(9),I=s(r);try{for(I.s();!(M=I.n()).done;)M.value.reject(e.t0)}catch(e){I.e(e)}finally{I.f()}case 20:if(!n){e.next=32;break}return e.prev=21,A=R.generateProbatorRtpParameters(n.rtpParameters),e.next=25,t._handler.receive([{trackId:"probator",kind:"video",rtpParameters:A}]);case 25:C.debug("createPendingConsumers() | Consumer for RTP probation created"),t._probatorConsumerCreated=!0,e.next=32;break;case 29:e.prev=29,e.t1=e.catch(21),C.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",e.t1);case 32:case"end":return e.stop()}var o}),e,null,[[9,16],[21,29]])}))),"transport.createPendingConsumers()").then((function(){t._consumerCreationInProgress=!1,t._pendingConsumerTasks.length>0&&t.createPendingConsumers()})).catch((function(){}));case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"pausePendingConsumers",value:function(){var e=this;this._consumerPauseInProgress=!0,this._awaitQueue.push(a(o().mark((function t(){var r,n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e._pendingPauseConsumers.size){t.next=3;break}return C.debug("pausePendingConsumers() | there is no Consumer to be paused"),t.abrupt("return");case 3:return r=Array.from(e._pendingPauseConsumers.values()),e._pendingPauseConsumers.clear(),t.prev=5,n=r.map((function(e){return e.localId})),t.next=9,e._handler.pauseReceiving(n);case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(5),C.error("pausePendingConsumers() | failed to pause Consumers:",t.t0);case 14:case"end":return t.stop()}}),t,null,[[5,11]])}))),"transport.pausePendingConsumers").then((function(){e._consumerPauseInProgress=!1,e._pendingPauseConsumers.size>0&&e.pausePendingConsumers()})).catch((function(){}))}},{key:"resumePendingConsumers",value:function(){var e=this;this._consumerResumeInProgress=!0,this._awaitQueue.push(a(o().mark((function t(){var r,n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e._pendingResumeConsumers.size){t.next=3;break}return C.debug("resumePendingConsumers() | there is no Consumer to be resumed"),t.abrupt("return");case 3:return r=Array.from(e._pendingResumeConsumers.values()),e._pendingResumeConsumers.clear(),t.prev=5,n=r.map((function(e){return e.localId})),t.next=9,e._handler.resumeReceiving(n);case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(5),C.error("resumePendingConsumers() | failed to resume Consumers:",t.t0);case 14:case"end":return t.stop()}}),t,null,[[5,11]])}))),"transport.resumePendingConsumers").then((function(){e._consumerResumeInProgress=!1,e._pendingResumeConsumers.size>0&&e.resumePendingConsumers()})).catch((function(){}))}},{key:"closePendingConsumers",value:function(){var e=this;this._consumerCloseInProgress=!0,this._awaitQueue.push(a(o().mark((function t(){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e._pendingCloseConsumers.size){t.next=3;break}return C.debug("closePendingConsumers() | there is no Consumer to be closed"),t.abrupt("return");case 3:return r=Array.from(e._pendingCloseConsumers.values()),e._pendingCloseConsumers.clear(),t.prev=5,t.next=8,e._handler.stopReceiving(r.map((function(e){return e.localId})));case 8:t.next=13;break;case 10:t.prev=10,t.t0=t.catch(5),C.error("closePendingConsumers() | failed to close Consumers:",t.t0);case 13:case"end":return t.stop()}}),t,null,[[5,10]])}))),"transport.closePendingConsumers").then((function(){e._consumerCloseInProgress=!1,e._pendingCloseConsumers.size>0&&e.closePendingConsumers()})).catch((function(){}))}},{key:"handleHandler",value:function(){var e=this,t=this._handler;t.on("@connect",(function(t,r,n){var o=t.dtlsParameters;e._closed?n(new k.InvalidStateError("closed")):e.safeEmit("connect",{dtlsParameters:o},r,n)})),t.on("@icegatheringstatechange",(function(t){t!==e._iceGatheringState&&(C.debug("ICE gathering state changed to %s",t),e._iceGatheringState=t,e._closed||e.safeEmit("icegatheringstatechange",t))})),t.on("@connectionstatechange",(function(t){t!==e._connectionState&&(C.debug("connection state changed to %s",t),e._connectionState=t,e._closed||e.safeEmit("connectionstatechange",t))}))}},{key:"handleProducer",value:function(e){var t=this;e.on("@close",(function(){t._producers.delete(e.id),t._closed||t._awaitQueue.push(a(o().mark((function r(){return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t._handler.stopSending(e.localId);case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)}))),"producer @close event").catch((function(e){return C.warn("producer.close() failed:%o",e)}))})),e.on("@pause",(function(r,n){t._awaitQueue.push(a(o().mark((function r(){return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t._handler.pauseSending(e.localId);case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)}))),"producer @pause event").then(r).catch(n)})),e.on("@resume",(function(r,n){t._awaitQueue.push(a(o().mark((function r(){return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t._handler.resumeSending(e.localId);case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)}))),"producer @resume event").then(r).catch(n)})),e.on("@replacetrack",(function(r,n,i){t._awaitQueue.push(a(o().mark((function n(){return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t._handler.replaceTrack(e.localId,r);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n)}))),"producer @replacetrack event").then(n).catch(i)})),e.on("@setmaxspatiallayer",(function(r,n,i){t._awaitQueue.push(a(o().mark((function n(){return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t._handler.setMaxSpatialLayer(e.localId,r);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n)}))),"producer @setmaxspatiallayer event").then(n).catch(i)})),e.on("@setrtpencodingparameters",(function(r,n,i){t._awaitQueue.push(a(o().mark((function n(){return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t._handler.setRtpEncodingParameters(e.localId,r);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n)}))),"producer @setrtpencodingparameters event").then(n).catch(i)})),e.on("@getstats",(function(r,n){if(t._closed)return n(new k.InvalidStateError("closed"));t._handler.getSenderStats(e.localId).then(r).catch(n)}))}},{key:"handleConsumer",value:function(e){var t=this;e.on("@close",(function(){t._consumers.delete(e.id),t._pendingPauseConsumers.delete(e.id),t._pendingResumeConsumers.delete(e.id),t._closed||(t._pendingCloseConsumers.set(e.id,e),!1===t._consumerCloseInProgress&&t.closePendingConsumers())})),e.on("@pause",(function(){t._pendingResumeConsumers.has(e.id)&&t._pendingResumeConsumers.delete(e.id),t._pendingPauseConsumers.set(e.id,e),(0,w.default)((function(){t._closed||!1===t._consumerPauseInProgress&&t.pausePendingConsumers()}))})),e.on("@resume",(function(){t._pendingPauseConsumers.has(e.id)&&t._pendingPauseConsumers.delete(e.id),t._pendingResumeConsumers.set(e.id,e),(0,w.default)((function(){t._closed||!1===t._consumerResumeInProgress&&t.resumePendingConsumers()}))})),e.on("@getstats",(function(r,n){if(t._closed)return n(new k.InvalidStateError("closed"));t._handler.getReceiverStats(e.localId).then(r).catch(n)}))}},{key:"handleDataProducer",value:function(e){var t=this;e.on("@close",(function(){t._dataProducers.delete(e.id)}))}},{key:"handleDataConsumer",value:function(e){var t=this;e.on("@close",(function(){t._dataConsumers.delete(e.id)}))}}]),I}(S.EnhancedEventEmitter);t.Transport=L},6020:(e,t)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,i=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!==r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===r(i)?i:String(i)),o)}var i}function o(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}function s(e){var t=p();return function(){var n,o=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(o,arguments,i)}else n=o.apply(this,arguments);return function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return c(e)}(this,n)}}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){var t="function"==typeof Map?new Map:void 0;return u=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return l(e,arguments,d(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),f(r,e)},u(e)}function l(e,t,r){return l=p()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&f(o,r.prototype),o},l.apply(null,arguments)}function p(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function f(e,t){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},f(e,t)}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidStateError=t.UnsupportedError=void 0;var h=function(e){a(r,e);var t=s(r);function r(e){var n;return i(this,r),(n=t.call(this,e)).name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(c(n),r):n.stack=new Error(e).stack,n}return o(r)}(u(Error));t.UnsupportedError=h;var v=function(e){a(r,e);var t=s(r);function r(e){var n;return i(this,r),(n=t.call(this,e)).name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(c(n),r):n.stack=new Error(e).stack,n}return o(r)}(u(Error));t.InvalidStateError=v},270:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o.apply(this,arguments)}function i(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw i}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){var n,o,i;n=e,o=t,i=r[t],(o=d(o))in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(){u=function(){return t};var e,t={},r=Object.prototype,o=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,a=Object.create(o.prototype),s=new L(n||[]);return i(a,"_invoke",{value:E(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var h="suspendedStart",v="suspendedYield",m="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};p(S,s,(function(){return this}));var k=Object.getPrototypeOf,x=k&&k(k(D([])));x&&x!==r&&o.call(x,s)&&(S=x);var R=_.prototype=b.prototype=Object.create(S);function P(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(i,a,s,c){var u=d(e[i],e,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==n(p)&&o.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,c)}))}c(u.arg)}var a;i(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function E(t,r,n){var o=h;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function r(){for(;++i<t.length;)if(o.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=_,i(R,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:w,configurable:!0}),w.displayName=p(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,p(e,l,"GeneratorFunction")),e.prototype=Object.create(R),e},t.awrap=function(e){return{__await:e}},P(O.prototype),p(O.prototype,c,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new O(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},P(R),p(R,l,"Generator"),p(R,s,(function(){return this})),p(R,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function l(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function p(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){l(i,n,o,a,s,"next",e)}function s(e){l(i,n,o,a,s,"throw",e)}a(void 0)}))}}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,d(n.key),n)}}function d(e){var t=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===n(t)?t:String(t)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}var m=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),y=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),g=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&m(t,e,r);return y(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome111=void 0;var b=g(r(9652)),w=r(1916),_=g(r(5234)),S=g(r(6059)),k=g(r(5388)),x=g(r(8538)),R=g(r(337)),P=r(6020),O=r(3018),E=r(9196),T=r(9975),C=new w.Logger("Chrome111"),j={OS:1024,MIS:1024},L=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(H,e);var t,r,a,s,l,d,m,y,g,w,O,L,D,I,M,A,N,F,B,G,V,U,q,z,W,K,Y=(W=H,K=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=v(W);if(K){var r=v(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function H(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,H),(e=Y.call(this))._closed=!1,e._mapMidTransceiver=new Map,e._sendStream=new MediaStream,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=H,r=[{key:"name",get:function(){return"Chrome111"}},{key:"close",value:function(){if(C.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}}},{key:"getNativeRtpCapabilities",value:(z=p(u().mark((function e(){var t,r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"}),e.prev=2,t.addTransceiver("audio"),t.addTransceiver("video"),e.next=7,t.createOffer();case 7:r=e.sent;try{t.close()}catch(e){}return n=b.parse(r.sdp),o=k.extractRtpCapabilities({sdpObject:n}),R.addNackSuppportForOpus(o),e.abrupt("return",o);case 15:e.prev=15,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 19:case"end":return e.stop()}}),e,null,[[2,15]])}))),function(){return z.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(q=p(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:j});case 2:case"end":return e.stop()}}),e)}))),function(){return q.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,o=e.iceCandidates,i=e.dtlsParameters,a=e.sctpParameters,s=e.iceServers,u=e.iceTransportPolicy,l=e.additionalSettings,p=e.proprietaryConstraints,f=e.extendedRtpCapabilities;this.assertNotClosed(),C.debug("run()"),this._direction=r,this._remoteSdp=new E.RemoteSdp({iceParameters:n,iceCandidates:o,dtlsParameters:i,sctpParameters:a}),this._sendingRtpParametersByKind={audio:S.getSendingRtpParameters("audio",f),video:S.getSendingRtpParameters("video",f)},this._sendingRemoteRtpParametersByKind={audio:S.getSendingRemoteRtpParameters("audio",f),video:S.getSendingRemoteRtpParameters("video",f)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection(c({iceServers:s||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},l),p),this._pc.addEventListener("icegatheringstatechange",(function(){t.emit("@icegatheringstatechange",t._pc.iceGatheringState)})),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(function(){t.emit("@connectionstatechange",t._pc.connectionState)})):(C.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",(function(){switch(t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}})))}},{key:"updateIceServers",value:(U=p(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertNotClosed(),C.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return U.apply(this,arguments)})},{key:"restartIce",value:(V=p(u().mark((function e(t){var r,n,o,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),C.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=5;break}return e.abrupt("return");case 5:if("send"!==this._direction){e.next=18;break}return e.next=8,this._pc.createOffer({iceRestart:!0});case 8:return r=e.sent,C.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=12,this._pc.setLocalDescription(r);case 12:return n={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=16,this._pc.setRemoteDescription(n);case 16:e.next=28;break;case 18:return o={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",o),e.next=22,this._pc.setRemoteDescription(o);case 22:return e.next=24,this._pc.createAnswer();case 24:return i=e.sent,C.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),e.next=28,this._pc.setLocalDescription(i);case 28:case"end":return e.stop()}}),e,this)}))),function(e){return V.apply(this,arguments)})},{key:"getTransportStats",value:(G=p(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.assertNotClosed(),e.abrupt("return",this._pc.getStats());case 2:case"end":return e.stop()}}),e,this)}))),function(){return G.apply(this,arguments)})},{key:"send",value:(B=p(u().mark((function e(t){var r,n,a,s,c,l,p,f,d,h,v,m,y,g,w,R,P,O,E,j,L,D,I,M;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.track,n=t.encodings,a=t.codecOptions,s=t.codec,this.assertNotClosed(),this.assertSendDirection(),C.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),n&&n.length>1){n.forEach((function(e,t){e.rid="r".concat(t)})),c=1,l=1,p=i(n);try{for(p.s();!(f=p.n()).done;)d=f.value,(h=d.scalabilityMode?(0,T.parse)(d.scalabilityMode).temporalLayers:3)>l&&(l=h)}catch(e){p.e(e)}finally{p.f()}v=i(n);try{for(v.s();!(m=v.n()).done;)(y=m.value).rid="r".concat(c++),y.scalabilityMode="L1T".concat(l)}catch(e){v.e(e)}finally{v.f()}}return(g=_.clone(this._sendingRtpParametersByKind[r.kind])).codecs=S.reduceCodecs(g.codecs,s),(w=_.clone(this._sendingRemoteRtpParametersByKind[r.kind])).codecs=S.reduceCodecs(w.codecs,s),R=this._remoteSdp.getNextMediaSectionIdx(),P=this._pc.addTransceiver(r,{direction:"sendonly",streams:[this._sendStream],sendEncodings:n}),e.next=13,this._pc.createOffer();case 13:if(O=e.sent,E=b.parse(O.sdp),this._transportReady){e.next=18;break}return e.next=18,this.setupTransport({localDtlsRole:null!==(j=this._forcedLocalDtlsRole)&&void 0!==j?j:"client",localSdpObject:E});case 18:return C.debug("send() | calling pc.setLocalDescription() [offer:%o]",O),e.next=21,this._pc.setLocalDescription(O);case 21:return L=P.mid,g.mid=L,E=b.parse(this._pc.localDescription.sdp),D=E.media[R.idx],g.rtcp.cname=k.getCname({offerMediaObject:D}),n?1===n.length?(o((I=x.getRtpEncodings({offerMediaObject:D}))[0],n[0]),g.encodings=I):g.encodings=n:g.encodings=x.getRtpEncodings({offerMediaObject:D}),this._remoteSdp.send({offerMediaObject:D,reuseMid:R.reuseMid,offerRtpParameters:g,answerRtpParameters:w,codecOptions:a,extmapAllowMixed:!0}),M={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("send() | calling pc.setRemoteDescription() [answer:%o]",M),e.next=32,this._pc.setRemoteDescription(M);case 32:return this._mapMidTransceiver.set(L,P),e.abrupt("return",{localId:L,rtpParameters:g,rtpSender:P.sender});case 34:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"stopSending",value:(F=p(u().mark((function e(t){var r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),C.debug("stopSending() [localId:%s]",t),!this._closed){e.next=4;break}return e.abrupt("return");case 4:if(r=this._mapMidTransceiver.get(t)){e.next=7;break}throw new Error("associated RTCRtpTransceiver not found");case 7:if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch(e){}return e.next=13,this._pc.createOffer();case 13:return n=e.sent,C.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=17,this._pc.setLocalDescription(n);case 17:return o={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",o),e.next=21,this._pc.setRemoteDescription(o);case 21:this._mapMidTransceiver.delete(t);case 22:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"pauseSending",value:(N=p(u().mark((function e(t){var r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),C.debug("pauseSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return r.direction="inactive",this._remoteSdp.pauseMediaSection(t),e.next=10,this._pc.createOffer();case 10:return n=e.sent,C.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=14,this._pc.setLocalDescription(n);case 14:return o={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",o),e.next=18,this._pc.setRemoteDescription(o);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return N.apply(this,arguments)})},{key:"resumeSending",value:(A=p(u().mark((function e(t){var r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),C.debug("resumeSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t),this._remoteSdp.resumeSendingMediaSection(t),r){e.next=7;break}throw new Error("associated RTCRtpTransceiver not found");case 7:return r.direction="sendonly",e.next=10,this._pc.createOffer();case 10:return n=e.sent,C.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=14,this._pc.setLocalDescription(n);case 14:return o={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",o),e.next=18,this._pc.setRemoteDescription(o);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"replaceTrack",value:(M=p(u().mark((function e(t,r){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),r?C.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):C.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapMidTransceiver.get(t)){e.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return e.next=8,n.sender.replaceTrack(r);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return M.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(I=p(u().mark((function e(t,r){var n,o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),C.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapMidTransceiver.get(t)){e.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return(o=n.sender.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=10,n.sender.setParameters(o);case 10:return this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings),e.next=13,this._pc.createOffer();case 13:return i=e.sent,C.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",i),e.next=17,this._pc.setLocalDescription(i);case 17:return a={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),e.next=21,this._pc.setRemoteDescription(a);case 21:case"end":return e.stop()}}),e,this)}))),function(e,t){return I.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(D=p(u().mark((function e(t,r){var n,o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),C.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapMidTransceiver.get(t)){e.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return(o=n.sender.getParameters()).encodings.forEach((function(e,t){o.encodings[t]=c(c({},e),r)})),e.next=10,n.sender.setParameters(o);case 10:return this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings),e.next=13,this._pc.createOffer();case 13:return i=e.sent,C.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",i),e.next=17,this._pc.setLocalDescription(i);case 17:return a={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),e.next=21,this._pc.setRemoteDescription(a);case 21:case"end":return e.stop()}}),e,this)}))),function(e,t){return D.apply(this,arguments)})},{key:"getSenderStats",value:(L=p(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return e.abrupt("return",r.sender.getStats());case 6:case"end":return e.stop()}}),e,this)}))),function(e){return L.apply(this,arguments)})},{key:"sendDataChannel",value:(O=p(u().mark((function e(t){var r,n,o,i,a,s,c,l,p,f,d,h,v;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,o=t.maxRetransmits,i=t.label,a=t.protocol,this.assertNotClosed(),this.assertSendDirection(),s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmits:o,protocol:a},C.debug("sendDataChannel() [options:%o]",s),c=this._pc.createDataChannel(i,s),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%j.MIS,this._hasDataChannelMediaSection){e.next=25;break}return e.next=10,this._pc.createOffer();case 10:if(l=e.sent,p=b.parse(l.sdp),f=p.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=16;break}return e.next=16,this.setupTransport({localDtlsRole:null!==(d=this._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:p});case 16:return C.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=19,this._pc.setLocalDescription(l);case 19:return this._remoteSdp.sendSctpAssociation({offerMediaObject:f}),h={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=24,this._pc.setRemoteDescription(h);case 24:this._hasDataChannelMediaSection=!0;case 25:return v={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits},e.abrupt("return",{dataChannel:c,sctpStreamParameters:v});case 27:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"receive",value:(w=p(u().mark((function e(t){var r,n,o,a,s,c,l,p,f,d,h,v,m,y,g,w,_,S,x,R,P=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertNotClosed(),this.assertRecvDirection(),r=[],n=new Map,o=i(t);try{for(o.s();!(a=o.n()).done;)s=a.value,c=s.trackId,l=s.kind,p=s.rtpParameters,f=s.streamId,C.debug("receive() [trackId:%s, kind:%s]",c,l),d=p.mid||String(this._mapMidTransceiver.size),n.set(c,d),this._remoteSdp.receive({mid:d,kind:l,offerRtpParameters:p,streamId:f||p.rtcp.cname,trackId:c})}catch(e){o.e(e)}finally{o.f()}return h={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",h),e.next=10,this._pc.setRemoteDescription(h);case 10:return e.next=12,this._pc.createAnswer();case 12:v=e.sent,m=b.parse(v.sdp),y=i(t),e.prev=15,w=u().mark((function e(){var t,r,o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=g.value,r=t.trackId,o=t.rtpParameters,i=n.get(r),a=m.media.find((function(e){return String(e.mid)===i})),k.applyCodecParameters({offerRtpParameters:o,answerMediaObject:a});case 5:case"end":return e.stop()}}),e)})),y.s();case 18:if((g=y.n()).done){e.next=22;break}return e.delegateYield(w(),"t0",20);case 20:e.next=18;break;case 22:e.next=27;break;case 24:e.prev=24,e.t1=e.catch(15),y.e(e.t1);case 27:return e.prev=27,y.f(),e.finish(27);case 30:if(v={type:"answer",sdp:b.write(m)},this._transportReady){e.next=34;break}return e.next=34,this.setupTransport({localDtlsRole:null!==(_=this._forcedLocalDtlsRole)&&void 0!==_?_:"client",localSdpObject:m});case 34:return C.debug("receive() | calling pc.setLocalDescription() [answer:%o]",v),e.next=37,this._pc.setLocalDescription(v);case 37:S=i(t),e.prev=38,R=u().mark((function e(){var t,o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=x.value,o=t.trackId,i=n.get(o),a=P._pc.getTransceivers().find((function(e){return e.mid===i}))){e.next=8;break}throw new Error("new RTCRtpTransceiver not found");case 8:P._mapMidTransceiver.set(i,a),r.push({localId:i,track:a.receiver.track,rtpReceiver:a.receiver});case 10:case"end":return e.stop()}}),e)})),S.s();case 41:if((x=S.n()).done){e.next=45;break}return e.delegateYield(R(),"t2",43);case 43:e.next=41;break;case 45:e.next=50;break;case 47:e.prev=47,e.t3=e.catch(38),S.e(e.t3);case 50:return e.prev=50,S.f(),e.finish(50);case 53:return e.abrupt("return",r);case 54:case"end":return e.stop()}}),e,this,[[15,24,27,30],[38,47,50,53]])}))),function(e){return w.apply(this,arguments)})},{key:"stopReceiving",value:(g=p(u().mark((function e(t){var r,n,o,a,s,c,l,p,f;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertRecvDirection(),!this._closed){e.next=3;break}return e.abrupt("return");case 3:r=i(t),e.prev=4,r.s();case 6:if((n=r.n()).done){e.next=15;break}if(o=n.value,C.debug("stopReceiving() [localId:%s]",o),a=this._mapMidTransceiver.get(o)){e.next=12;break}throw new Error("associated RTCRtpTransceiver not found");case 12:this._remoteSdp.closeMediaSection(a.mid);case 13:e.next=6;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(4),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:return s={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.next=27,this._pc.setRemoteDescription(s);case 27:return e.next=29,this._pc.createAnswer();case 29:return c=e.sent,C.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",c),e.next=33,this._pc.setLocalDescription(c);case 33:l=i(t);try{for(l.s();!(p=l.n()).done;)f=p.value,this._mapMidTransceiver.delete(f)}catch(e){l.e(e)}finally{l.f()}case 35:case"end":return e.stop()}}),e,this,[[4,17,20,23]])}))),function(e){return g.apply(this,arguments)})},{key:"pauseReceiving",value:(y=p(u().mark((function e(t){var r,n,o,a,s,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertNotClosed(),this.assertRecvDirection(),r=i(t),e.prev=3,r.s();case 5:if((n=r.n()).done){e.next=15;break}if(o=n.value,C.debug("pauseReceiving() [localId:%s]",o),a=this._mapMidTransceiver.get(o)){e.next=11;break}throw new Error("associated RTCRtpTransceiver not found");case 11:a.direction="inactive",this._remoteSdp.pauseMediaSection(o);case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:return s={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.next=27,this._pc.setRemoteDescription(s);case 27:return e.next=29,this._pc.createAnswer();case 29:return c=e.sent,C.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",c),e.next=33,this._pc.setLocalDescription(c);case 33:case"end":return e.stop()}}),e,this,[[3,17,20,23]])}))),function(e){return y.apply(this,arguments)})},{key:"resumeReceiving",value:(m=p(u().mark((function e(t){var r,n,o,a,s,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertNotClosed(),this.assertRecvDirection(),r=i(t),e.prev=3,r.s();case 5:if((n=r.n()).done){e.next=15;break}if(o=n.value,C.debug("resumeReceiving() [localId:%s]",o),a=this._mapMidTransceiver.get(o)){e.next=11;break}throw new Error("associated RTCRtpTransceiver not found");case 11:a.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(o);case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:return s={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.next=27,this._pc.setRemoteDescription(s);case 27:return e.next=29,this._pc.createAnswer();case 29:return c=e.sent,C.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",c),e.next=33,this._pc.setLocalDescription(c);case 33:case"end":return e.stop()}}),e,this,[[3,17,20,23]])}))),function(e){return m.apply(this,arguments)})},{key:"getReceiverStats",value:(d=p(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertRecvDirection(),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return e.abrupt("return",r.receiver.getStats());case 6:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"receiveDataChannel",value:(l=p(u().mark((function e(t){var r,n,o,i,a,s,c,l,p,f,d,h,v;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,o=t.protocol,this.assertNotClosed(),this.assertRecvDirection(),i=r.streamId,a=r.ordered,s=r.maxPacketLifeTime,c=r.maxRetransmits,l={negotiated:!0,id:i,ordered:a,maxPacketLifeTime:s,maxRetransmits:c,protocol:o},C.debug("receiveDataChannel() [options:%o]",l),p=this._pc.createDataChannel(n,l),this._hasDataChannelMediaSection){e.next=24;break}return this._remoteSdp.receiveSctpAssociation(),f={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=13,this._pc.setRemoteDescription(f);case 13:return e.next=15,this._pc.createAnswer();case 15:if(d=e.sent,this._transportReady){e.next=20;break}return v=b.parse(d.sdp),e.next=20,this.setupTransport({localDtlsRole:null!==(h=this._forcedLocalDtlsRole)&&void 0!==h?h:"client",localSdpObject:v});case 20:return C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),e.next=23,this._pc.setLocalDescription(d);case 23:this._hasDataChannelMediaSection=!0;case 24:return e.abrupt("return",{dataChannel:p});case 25:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"setupTransport",value:(s=p(u().mark((function e(t){var r,n,o,i=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=b.parse(this._pc.localDescription.sdp)),(o=k.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,new Promise((function(e,t){i.safeEmit("@connect",{dtlsParameters:o},e,t)}));case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"assertNotClosed",value:function(){if(this._closed)throw new P.InvalidStateError("method called in a closed handler")}},{key:"assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}],a=[{key:"createFactory",value:function(){return function(){return new H}}}],r&&f(t.prototype,r),a&&f(t,a),Object.defineProperty(t,"prototype",{writable:!1}),H}(O.HandlerInterface);t.Chrome111=L},3261:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw a}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a.apply(this,arguments)}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(){c=function(){return t};var e,t={},r=Object.prototype,o=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",u=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,a=Object.create(o.prototype),s=new L(n||[]);return i(a,"_invoke",{value:E(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var h="suspendedStart",v="suspendedYield",m="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};p(S,s,(function(){return this}));var k=Object.getPrototypeOf,x=k&&k(k(D([])));x&&x!==r&&o.call(x,s)&&(S=x);var R=_.prototype=b.prototype=Object.create(S);function P(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(i,a,s,c){var u=d(e[i],e,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==n(p)&&o.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,c)}))}c(u.arg)}var a;i(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function E(t,r,n){var o=h;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function r(){for(;++i<t.length;)if(o.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=_,i(R,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:w,configurable:!0}),w.displayName=p(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,p(e,l,"GeneratorFunction")),e.prototype=Object.create(R),e},t.awrap=function(e){return{__await:e}},P(O.prototype),p(O.prototype,u,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new O(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},P(R),p(R,l,"Generator"),p(R,s,(function(){return this})),p(R,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function u(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function l(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){u(i,n,o,a,s,"next",e)}function s(e){u(i,n,o,a,s,"throw",e)}a(void 0)}))}}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function f(e){var t=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===n(t)?t:String(t)}function d(e,t){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},d(e,t)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}var v=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),m=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),y=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&v(t,e,r);return m(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome55=void 0;var g=y(r(9652)),b=r(1916),w=r(6020),_=y(r(5234)),S=y(r(6059)),k=y(r(5388)),x=y(r(5156)),R=r(3018),P=r(9196),O=new b.Logger("Chrome55"),E={OS:1024,MIS:1024},T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}(Y,e);var t,r,i,u,v,m,y,b,R,T,C,j,L,D,I,M,A,N,F,B,G,V,U,q,z,W,K=(z=Y,W=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=h(z);if(W){var r=h(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function Y(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Y),(e=K.call(this))._sendStream=new MediaStream,e._mapSendLocalIdTrack=new Map,e._nextSendLocalId=0,e._mapRecvLocalIdInfo=new Map,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=Y,r=[{key:"name",get:function(){return"Chrome55"}},{key:"close",value:function(){if(O.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}},{key:"getNativeRtpCapabilities",value:(q=l(c().mark((function e(){var t,r,n,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),e.prev=2,e.next=5,t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 5:r=e.sent;try{t.close()}catch(e){}return n=g.parse(r.sdp),o=k.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",o);case 12:e.prev=12,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[2,12]])}))),function(){return q.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(U=l(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:E});case 2:case"end":return e.stop()}}),e)}))),function(){return U.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,o=e.iceCandidates,i=e.dtlsParameters,a=e.sctpParameters,c=e.iceServers,u=e.iceTransportPolicy,l=e.additionalSettings,p=e.proprietaryConstraints,d=e.extendedRtpCapabilities;O.debug("run()"),this._direction=r,this._remoteSdp=new P.RemoteSdp({iceParameters:n,iceCandidates:o,dtlsParameters:i,sctpParameters:a,planB:!0}),this._sendingRtpParametersByKind={audio:S.getSendingRtpParameters("audio",d),video:S.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:S.getSendingRemoteRtpParameters("audio",d),video:S.getSendingRemoteRtpParameters("video",d)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){var n,o,i;n=e,o=t,i=r[t],(o=f(o))in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({iceServers:c||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},l),p),this._pc.addEventListener("icegatheringstatechange",(function(){t.emit("@icegatheringstatechange",t._pc.iceGatheringState)})),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(function(){t.emit("@connectionstatechange",t._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(function(){switch(O.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:(V=l(c().mark((function e(t){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:O.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return V.apply(this,arguments)})},{key:"restartIce",value:(G=l(c().mark((function e(t){var r,n,o,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,O.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return o={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",o),e.next=21,this._pc.setRemoteDescription(o);case 21:return e.next=23,this._pc.createAnswer();case 23:return i=e.sent,O.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),e.next=27,this._pc.setLocalDescription(i);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return G.apply(this,arguments)})},{key:"getTransportStats",value:(B=l(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return B.apply(this,arguments)})},{key:"send",value:(F=l(c().mark((function e(t){var r,n,i,s,u,l,p,f,d,h,v,m,y,b,w;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,n=t.encodings,i=t.codecOptions,s=t.codec,this.assertSendDirection(),O.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),s&&O.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(r),this._pc.addStream(this._sendStream),e.next=8,this._pc.createOffer();case 8:if(u=e.sent,l=g.parse(u.sdp),(f=_.clone(this._sendingRtpParametersByKind[r.kind])).codecs=S.reduceCodecs(f.codecs),(d=_.clone(this._sendingRemoteRtpParametersByKind[r.kind])).codecs=S.reduceCodecs(d.codecs),this._transportReady){e.next=17;break}return e.next=17,this.setupTransport({localDtlsRole:null!==(h=this._forcedLocalDtlsRole)&&void 0!==h?h:"client",localSdpObject:l});case 17:return"video"===r.kind&&n&&n.length>1&&(O.debug("send() | enabling simulcast"),l=g.parse(u.sdp),p=l.media.find((function(e){return"video"===e.type})),x.addLegacySimulcast({offerMediaObject:p,track:r,numStreams:n.length}),u={type:"offer",sdp:g.write(l)}),O.debug("send() | calling pc.setLocalDescription() [offer:%o]",u),e.next=21,this._pc.setLocalDescription(u);case 21:if(l=g.parse(this._pc.localDescription.sdp),p=l.media.find((function(e){return e.type===r.kind})),f.rtcp.cname=k.getCname({offerMediaObject:p}),f.encodings=x.getRtpEncodings({offerMediaObject:p,track:r}),n)for(v=0;v<f.encodings.length;++v)n[v]&&a(f.encodings[v],n[v]);if(f.encodings.length>1&&"video/vp8"===f.codecs[0].mimeType.toLowerCase()){m=o(f.encodings);try{for(m.s();!(y=m.n()).done;)y.value.scalabilityMode="L1T3"}catch(e){m.e(e)}finally{m.f()}}return this._remoteSdp.send({offerMediaObject:p,offerRtpParameters:f,answerRtpParameters:d,codecOptions:i}),b={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("send() | calling pc.setRemoteDescription() [answer:%o]",b),e.next=32,this._pc.setRemoteDescription(b);case 32:return w=String(this._nextSendLocalId),this._nextSendLocalId++,this._mapSendLocalIdTrack.set(w,r),e.abrupt("return",{localId:w,rtpParameters:f});case 36:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"stopSending",value:(N=l(c().mark((function e(t){var r,n,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),O.debug("stopSending() [localId:%s]",t),r=this._mapSendLocalIdTrack.get(t)){e.next=5;break}throw new Error("track not found");case 5:return this._mapSendLocalIdTrack.delete(t),this._sendStream.removeTrack(r),this._pc.addStream(this._sendStream),e.next=10,this._pc.createOffer();case 10:return n=e.sent,O.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.prev=12,e.next=15,this._pc.setLocalDescription(n);case 15:e.next=23;break;case 17:if(e.prev=17,e.t0=e.catch(12),0!==this._sendStream.getTracks().length){e.next=22;break}return O.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.t0.toString()),e.abrupt("return");case 22:throw e.t0;case 23:if("stable"!==this._pc.signalingState){e.next=25;break}return e.abrupt("return");case 25:return o={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",o),e.next=29,this._pc.setRemoteDescription(o);case 29:case"end":return e.stop()}}),e,this,[[12,17]])}))),function(e){return N.apply(this,arguments)})},{key:"pauseSending",value:(A=l(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return A.apply(this,arguments)})},{key:"resumeSending",value:(M=l(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return M.apply(this,arguments)})},{key:"replaceTrack",value:(I=l(c().mark((function e(t,r){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new w.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return I.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(D=l(c().mark((function e(t,r){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new w.UnsupportedError(" not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return D.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(L=l(c().mark((function e(t,r){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new w.UnsupportedError("not supported");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return L.apply(this,arguments)})},{key:"getSenderStats",value:(j=l(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new w.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return j.apply(this,arguments)})},{key:"sendDataChannel",value:(C=l(c().mark((function e(t){var r,n,o,i,a,s,u,l,p,f,d,h,v;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,o=t.maxRetransmits,i=t.label,a=t.protocol,this.assertSendDirection(),s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmitTime:n,maxRetransmits:o,protocol:a},O.debug("sendDataChannel() [options:%o]",s),u=this._pc.createDataChannel(i,s),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%E.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(l=e.sent,p=g.parse(l.sdp),f=p.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this.setupTransport({localDtlsRole:null!==(d=this._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:p});case 15:return O.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=18,this._pc.setLocalDescription(l);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:f}),h={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=23,this._pc.setRemoteDescription(h);case 23:this._hasDataChannelMediaSection=!0;case 24:return v={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits},e.abrupt("return",{dataChannel:u,sctpStreamParameters:v});case 26:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"receive",value:(T=l(c().mark((function e(t){var r,n,i,a,s,u,l,p,f,d,h,v,m,y,b,w,_,S,x,R=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=[],n=o(t);try{for(n.s();!(i=n.n()).done;)a=i.value,s=a.trackId,u=a.kind,l=a.rtpParameters,p=a.streamId,O.debug("receive() [trackId:%s, kind:%s]",s,u),f=u,this._remoteSdp.receive({mid:f,kind:u,offerRtpParameters:l,streamId:p||l.rtcp.cname,trackId:s})}catch(e){n.e(e)}finally{n.f()}return d={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",d),e.next=8,this._pc.setRemoteDescription(d);case 8:return e.next=10,this._pc.createAnswer();case 10:h=e.sent,v=g.parse(h.sdp),m=o(t),e.prev=13,b=c().mark((function e(){var t,r,n,o,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=y.value,r=t.kind,n=t.rtpParameters,o=r,i=v.media.find((function(e){return String(e.mid)===o})),k.applyCodecParameters({offerRtpParameters:n,answerMediaObject:i});case 5:case"end":return e.stop()}}),e)})),m.s();case 16:if((y=m.n()).done){e.next=20;break}return e.delegateYield(b(),"t0",18);case 18:e.next=16;break;case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(13),m.e(e.t1);case 25:return e.prev=25,m.f(),e.finish(25);case 28:if(h={type:"answer",sdp:g.write(v)},this._transportReady){e.next=32;break}return e.next=32,this.setupTransport({localDtlsRole:null!==(w=this._forcedLocalDtlsRole)&&void 0!==w?w:"client",localSdpObject:v});case 32:return O.debug("receive() | calling pc.setLocalDescription() [answer:%o]",h),e.next=35,this._pc.setLocalDescription(h);case 35:_=o(t),e.prev=36,x=c().mark((function e(){var t,n,o,i,a,s,u,l,p;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=S.value,n=t.kind,o=t.trackId,i=t.rtpParameters,a=n,s=o,u=t.streamId||i.rtcp.cname,l=R._pc.getRemoteStreams().find((function(e){return e.id===u})),p=l.getTrackById(s)){e.next=9;break}throw new Error("remote track not found");case 9:R._mapRecvLocalIdInfo.set(s,{mid:a,rtpParameters:i}),r.push({localId:s,track:p});case 11:case"end":return e.stop()}}),e)})),_.s();case 39:if((S=_.n()).done){e.next=43;break}return e.delegateYield(x(),"t2",41);case 41:e.next=39;break;case 43:e.next=48;break;case 45:e.prev=45,e.t3=e.catch(36),_.e(e.t3);case 48:return e.prev=48,_.f(),e.finish(48);case 51:return e.abrupt("return",r);case 52:case"end":return e.stop()}}),e,this,[[13,22,25,28],[36,45,48,51]])}))),function(e){return T.apply(this,arguments)})},{key:"stopReceiving",value:(R=l(c().mark((function e(t){var r,n,i,a,s,u,l,p;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=o(t);try{for(r.s();!(n=r.n()).done;)i=n.value,O.debug("stopReceiving() [localId:%s]",i),a=this._mapRecvLocalIdInfo.get(i)||{},s=a.mid,u=a.rtpParameters,this._mapRecvLocalIdInfo.delete(i),this._remoteSdp.planBStopReceiving({mid:s,offerRtpParameters:u})}catch(e){r.e(e)}finally{r.f()}return l={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),e.next=7,this._pc.setRemoteDescription(l);case 7:return e.next=9,this._pc.createAnswer();case 9:return p=e.sent,O.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",p),e.next=13,this._pc.setLocalDescription(p);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return R.apply(this,arguments)})},{key:"pauseReceiving",value:(b=l(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return b.apply(this,arguments)})},{key:"resumeReceiving",value:(y=l(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return y.apply(this,arguments)})},{key:"getReceiverStats",value:(m=l(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new w.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return m.apply(this,arguments)})},{key:"receiveDataChannel",value:(v=l(c().mark((function e(t){var r,n,o,i,a,s,u,l,p,f,d,h,v;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,o=t.protocol,this.assertRecvDirection(),i=r.streamId,a=r.ordered,s=r.maxPacketLifeTime,u=r.maxRetransmits,l={negotiated:!0,id:i,ordered:a,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:u,protocol:o},O.debug("receiveDataChannel() [options:%o]",l),p=this._pc.createDataChannel(n,l),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),f={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=12,this._pc.setRemoteDescription(f);case 12:return e.next=14,this._pc.createAnswer();case 14:if(d=e.sent,this._transportReady){e.next=19;break}return v=g.parse(d.sdp),e.next=19,this.setupTransport({localDtlsRole:null!==(h=this._forcedLocalDtlsRole)&&void 0!==h?h:"client",localSdpObject:v});case 19:return O.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),e.next=22,this._pc.setLocalDescription(d);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:p});case 24:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"setupTransport",value:(u=l(c().mark((function e(t){var r,n,o,i=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=g.parse(this._pc.localDescription.sdp)),(o=k.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,new Promise((function(e,t){i.safeEmit("@connect",{dtlsParameters:o},e,t)}));case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}],i=[{key:"createFactory",value:function(){return function(){return new Y}}}],r&&p(t.prototype,r),i&&p(t,i),Object.defineProperty(t,"prototype",{writable:!1}),Y}(R.HandlerInterface);t.Chrome55=T},5149:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw a}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a.apply(this,arguments)}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){var n,o,i;n=e,o=t,i=r[t],(o=d(o))in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(){u=function(){return t};var e,t={},r=Object.prototype,o=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,a=Object.create(o.prototype),s=new L(n||[]);return i(a,"_invoke",{value:E(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var h="suspendedStart",v="suspendedYield",m="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};p(S,s,(function(){return this}));var k=Object.getPrototypeOf,x=k&&k(k(D([])));x&&x!==r&&o.call(x,s)&&(S=x);var R=_.prototype=b.prototype=Object.create(S);function P(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(i,a,s,c){var u=d(e[i],e,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==n(p)&&o.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,c)}))}c(u.arg)}var a;i(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function E(t,r,n){var o=h;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function r(){for(;++i<t.length;)if(o.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=_,i(R,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:w,configurable:!0}),w.displayName=p(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,p(e,l,"GeneratorFunction")),e.prototype=Object.create(R),e},t.awrap=function(e){return{__await:e}},P(O.prototype),p(O.prototype,c,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new O(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},P(R),p(R,l,"Generator"),p(R,s,(function(){return this})),p(R,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function l(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function p(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){l(i,n,o,a,s,"next",e)}function s(e){l(i,n,o,a,s,"throw",e)}a(void 0)}))}}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,d(n.key),n)}}function d(e){var t=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===n(t)?t:String(t)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}var m=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),y=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),g=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&m(t,e,r);return y(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome67=void 0;var b=g(r(9652)),w=r(1916),_=g(r(5234)),S=g(r(6059)),k=g(r(5388)),x=g(r(5156)),R=r(3018),P=r(9196),O=new w.Logger("Chrome67"),E={OS:1024,MIS:1024},T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(W,e);var t,r,i,s,l,d,m,y,g,w,R,T,C,j,L,D,I,M,A,N,F,B,G,V,U,q,z=(U=W,q=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=v(U);if(q){var r=v(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function W(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,W),(e=z.call(this))._sendStream=new MediaStream,e._mapSendLocalIdRtpSender=new Map,e._nextSendLocalId=0,e._mapRecvLocalIdInfo=new Map,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=W,r=[{key:"name",get:function(){return"Chrome67"}},{key:"close",value:function(){if(O.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}},{key:"getNativeRtpCapabilities",value:(V=p(u().mark((function e(){var t,r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),e.prev=2,e.next=5,t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 5:r=e.sent;try{t.close()}catch(e){}return n=b.parse(r.sdp),o=k.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",o);case 12:e.prev=12,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[2,12]])}))),function(){return V.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(G=p(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:E});case 2:case"end":return e.stop()}}),e)}))),function(){return G.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,o=e.iceCandidates,i=e.dtlsParameters,a=e.sctpParameters,s=e.iceServers,u=e.iceTransportPolicy,l=e.additionalSettings,p=e.proprietaryConstraints,f=e.extendedRtpCapabilities;O.debug("run()"),this._direction=r,this._remoteSdp=new P.RemoteSdp({iceParameters:n,iceCandidates:o,dtlsParameters:i,sctpParameters:a,planB:!0}),this._sendingRtpParametersByKind={audio:S.getSendingRtpParameters("audio",f),video:S.getSendingRtpParameters("video",f)},this._sendingRemoteRtpParametersByKind={audio:S.getSendingRemoteRtpParameters("audio",f),video:S.getSendingRemoteRtpParameters("video",f)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection(c({iceServers:s||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},l),p),this._pc.addEventListener("icegatheringstatechange",(function(){t.emit("@icegatheringstatechange",t._pc.iceGatheringState)})),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(function(){t.emit("@connectionstatechange",t._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(function(){switch(O.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:(B=p(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:O.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"restartIce",value:(F=p(u().mark((function e(t){var r,n,o,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,O.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return o={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",o),e.next=21,this._pc.setRemoteDescription(o);case 21:return e.next=23,this._pc.createAnswer();case 23:return i=e.sent,O.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),e.next=27,this._pc.setLocalDescription(i);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"getTransportStats",value:(N=p(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return N.apply(this,arguments)})},{key:"send",value:(A=p(u().mark((function e(t){var r,n,i,s,c,l,p,f,d,h,v,m,y,g,w,R;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,n=t.encodings,i=t.codecOptions,s=t.codec,this.assertSendDirection(),O.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),s&&O.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(r),this._pc.addTrack(r,this._sendStream),e.next=8,this._pc.createOffer();case 8:if(c=e.sent,l=b.parse(c.sdp),(f=_.clone(this._sendingRtpParametersByKind[r.kind])).codecs=S.reduceCodecs(f.codecs),(d=_.clone(this._sendingRemoteRtpParametersByKind[r.kind])).codecs=S.reduceCodecs(d.codecs),this._transportReady){e.next=17;break}return e.next=17,this.setupTransport({localDtlsRole:null!==(h=this._forcedLocalDtlsRole)&&void 0!==h?h:"client",localSdpObject:l});case 17:return"video"===r.kind&&n&&n.length>1&&(O.debug("send() | enabling simulcast"),l=b.parse(c.sdp),p=l.media.find((function(e){return"video"===e.type})),x.addLegacySimulcast({offerMediaObject:p,track:r,numStreams:n.length}),c={type:"offer",sdp:b.write(l)}),O.debug("send() | calling pc.setLocalDescription() [offer:%o]",c),e.next=21,this._pc.setLocalDescription(c);case 21:if(l=b.parse(this._pc.localDescription.sdp),p=l.media.find((function(e){return e.type===r.kind})),f.rtcp.cname=k.getCname({offerMediaObject:p}),f.encodings=x.getRtpEncodings({offerMediaObject:p,track:r}),n)for(v=0;v<f.encodings.length;++v)n[v]&&a(f.encodings[v],n[v]);if(f.encodings.length>1&&"video/vp8"===f.codecs[0].mimeType.toLowerCase()){m=o(f.encodings);try{for(m.s();!(y=m.n()).done;)y.value.scalabilityMode="L1T3"}catch(e){m.e(e)}finally{m.f()}}return this._remoteSdp.send({offerMediaObject:p,offerRtpParameters:f,answerRtpParameters:d,codecOptions:i}),g={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("send() | calling pc.setRemoteDescription() [answer:%o]",g),e.next=32,this._pc.setRemoteDescription(g);case 32:return w=String(this._nextSendLocalId),this._nextSendLocalId++,R=this._pc.getSenders().find((function(e){return e.track===r})),this._mapSendLocalIdRtpSender.set(w,R),e.abrupt("return",{localId:w,rtpParameters:f,rtpSender:R});case 37:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"stopSending",value:(M=p(u().mark((function e(t){var r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),O.debug("stopSending() [localId:%s]",t),r=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return this._pc.removeTrack(r),r.track&&this._sendStream.removeTrack(r.track),this._mapSendLocalIdRtpSender.delete(t),e.next=10,this._pc.createOffer();case 10:return n=e.sent,O.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.prev=12,e.next=15,this._pc.setLocalDescription(n);case 15:e.next=23;break;case 17:if(e.prev=17,e.t0=e.catch(12),0!==this._sendStream.getTracks().length){e.next=22;break}return O.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.t0.toString()),e.abrupt("return");case 22:throw e.t0;case 23:if("stable"!==this._pc.signalingState){e.next=25;break}return e.abrupt("return");case 25:return o={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",o),e.next=29,this._pc.setRemoteDescription(o);case 29:case"end":return e.stop()}}),e,this,[[12,17]])}))),function(e){return M.apply(this,arguments)})},{key:"pauseSending",value:(I=p(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return I.apply(this,arguments)})},{key:"resumeSending",value:(D=p(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return D.apply(this,arguments)})},{key:"replaceTrack",value:(L=p(u().mark((function e(t,r){var n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),r?O.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):O.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return o=n.track,e.next=8,n.replaceTrack(r);case 8:o&&this._sendStream.removeTrack(o),r&&this._sendStream.addTrack(r);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return L.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(j=p(u().mark((function e(t,r){var n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),O.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return(o=n.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=9,n.setParameters(o);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return j.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(C=p(u().mark((function e(t,r){var n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),O.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return(o=n.getParameters()).encodings.forEach((function(e,t){o.encodings[t]=c(c({},e),r)})),e.next=9,n.setParameters(o);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return C.apply(this,arguments)})},{key:"getSenderStats",value:(T=p(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),r=this._mapSendLocalIdRtpSender.get(t)){e.next=4;break}throw new Error("associated RTCRtpSender not found");case 4:return e.abrupt("return",r.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"sendDataChannel",value:(R=p(u().mark((function e(t){var r,n,o,i,a,s,c,l,p,f,d,h,v;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,o=t.maxRetransmits,i=t.label,a=t.protocol,this.assertSendDirection(),s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmitTime:n,maxRetransmits:o,protocol:a},O.debug("sendDataChannel() [options:%o]",s),c=this._pc.createDataChannel(i,s),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%E.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(l=e.sent,p=b.parse(l.sdp),f=p.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this.setupTransport({localDtlsRole:null!==(d=this._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:p});case 15:return O.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=18,this._pc.setLocalDescription(l);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:f}),h={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=23,this._pc.setRemoteDescription(h);case 23:this._hasDataChannelMediaSection=!0;case 24:return v={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits},e.abrupt("return",{dataChannel:c,sctpStreamParameters:v});case 26:case"end":return e.stop()}}),e,this)}))),function(e){return R.apply(this,arguments)})},{key:"receive",value:(w=p(u().mark((function e(t){var r,n,i,a,s,c,l,p,f,d,h,v,m,y,g,w,_,S,x,R=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=[],n=o(t);try{for(n.s();!(i=n.n()).done;)a=i.value,s=a.trackId,c=a.kind,l=a.rtpParameters,p=a.streamId,O.debug("receive() [trackId:%s, kind:%s]",s,c),f=c,this._remoteSdp.receive({mid:f,kind:c,offerRtpParameters:l,streamId:p||l.rtcp.cname,trackId:s})}catch(e){n.e(e)}finally{n.f()}return d={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",d),e.next=8,this._pc.setRemoteDescription(d);case 8:return e.next=10,this._pc.createAnswer();case 10:h=e.sent,v=b.parse(h.sdp),m=o(t),e.prev=13,g=u().mark((function e(){var t,r,n,o,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=y.value,r=t.kind,n=t.rtpParameters,o=r,i=v.media.find((function(e){return String(e.mid)===o})),k.applyCodecParameters({offerRtpParameters:n,answerMediaObject:i});case 5:case"end":return e.stop()}}),e)})),m.s();case 16:if((y=m.n()).done){e.next=20;break}return e.delegateYield(g(),"t0",18);case 18:e.next=16;break;case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(13),m.e(e.t1);case 25:return e.prev=25,m.f(),e.finish(25);case 28:if(h={type:"answer",sdp:b.write(v)},this._transportReady){e.next=32;break}return e.next=32,this.setupTransport({localDtlsRole:null!==(w=this._forcedLocalDtlsRole)&&void 0!==w?w:"client",localSdpObject:v});case 32:return O.debug("receive() | calling pc.setLocalDescription() [answer:%o]",h),e.next=35,this._pc.setLocalDescription(h);case 35:_=o(t),e.prev=36,x=u().mark((function e(){var t,n,o,i,a,s,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=S.value,n=t.kind,o=t.trackId,i=t.rtpParameters,a=o,s=n,c=R._pc.getReceivers().find((function(e){return e.track&&e.track.id===a}))){e.next=7;break}throw new Error("new RTCRtpReceiver not");case 7:R._mapRecvLocalIdInfo.set(a,{mid:s,rtpParameters:i,rtpReceiver:c}),r.push({localId:a,track:c.track,rtpReceiver:c});case 9:case"end":return e.stop()}}),e)})),_.s();case 39:if((S=_.n()).done){e.next=43;break}return e.delegateYield(x(),"t2",41);case 41:e.next=39;break;case 43:e.next=48;break;case 45:e.prev=45,e.t3=e.catch(36),_.e(e.t3);case 48:return e.prev=48,_.f(),e.finish(48);case 51:return e.abrupt("return",r);case 52:case"end":return e.stop()}}),e,this,[[13,22,25,28],[36,45,48,51]])}))),function(e){return w.apply(this,arguments)})},{key:"stopReceiving",value:(g=p(u().mark((function e(t){var r,n,i,a,s,c,l,p;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=o(t);try{for(r.s();!(n=r.n()).done;)i=n.value,O.debug("stopReceiving() [localId:%s]",i),a=this._mapRecvLocalIdInfo.get(i)||{},s=a.mid,c=a.rtpParameters,this._mapRecvLocalIdInfo.delete(i),this._remoteSdp.planBStopReceiving({mid:s,offerRtpParameters:c})}catch(e){r.e(e)}finally{r.f()}return l={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),e.next=7,this._pc.setRemoteDescription(l);case 7:return e.next=9,this._pc.createAnswer();case 9:return p=e.sent,O.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",p),e.next=13,this._pc.setLocalDescription(p);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"pauseReceiving",value:(y=p(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return y.apply(this,arguments)})},{key:"resumeReceiving",value:(m=p(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return m.apply(this,arguments)})},{key:"getReceiverStats",value:(d=p(u().mark((function e(t){var r,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertRecvDirection(),r=this._mapRecvLocalIdInfo.get(t)||{},n=r.rtpReceiver){e.next=4;break}throw new Error("associated RTCRtpReceiver not found");case 4:return e.abrupt("return",n.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"receiveDataChannel",value:(l=p(u().mark((function e(t){var r,n,o,i,a,s,c,l,p,f,d,h,v;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,o=t.protocol,this.assertRecvDirection(),i=r.streamId,a=r.ordered,s=r.maxPacketLifeTime,c=r.maxRetransmits,l={negotiated:!0,id:i,ordered:a,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:c,protocol:o},O.debug("receiveDataChannel() [options:%o]",l),p=this._pc.createDataChannel(n,l),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),f={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=12,this._pc.setRemoteDescription(f);case 12:return e.next=14,this._pc.createAnswer();case 14:if(d=e.sent,this._transportReady){e.next=19;break}return v=b.parse(d.sdp),e.next=19,this.setupTransport({localDtlsRole:null!==(h=this._forcedLocalDtlsRole)&&void 0!==h?h:"client",localSdpObject:v});case 19:return O.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),e.next=22,this._pc.setLocalDescription(d);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:p});case 24:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"setupTransport",value:(s=p(u().mark((function e(t){var r,n,o,i=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=b.parse(this._pc.localDescription.sdp)),(o=k.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,new Promise((function(e,t){i.safeEmit("@connect",{dtlsParameters:o},e,t)}));case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}],i=[{key:"createFactory",value:function(){return function(){return new W}}}],r&&f(t.prototype,r),i&&f(t,i),Object.defineProperty(t,"prototype",{writable:!1}),W}(R.HandlerInterface);t.Chrome67=T},6988:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw a}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a.apply(this,arguments)}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){var n,o,i;n=e,o=t,i=r[t],(o=d(o))in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(){u=function(){return t};var e,t={},r=Object.prototype,o=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,a=Object.create(o.prototype),s=new L(n||[]);return i(a,"_invoke",{value:E(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var h="suspendedStart",v="suspendedYield",m="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};p(S,s,(function(){return this}));var k=Object.getPrototypeOf,x=k&&k(k(D([])));x&&x!==r&&o.call(x,s)&&(S=x);var R=_.prototype=b.prototype=Object.create(S);function P(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(i,a,s,c){var u=d(e[i],e,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==n(p)&&o.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,c)}))}c(u.arg)}var a;i(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function E(t,r,n){var o=h;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function r(){for(;++i<t.length;)if(o.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=_,i(R,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:w,configurable:!0}),w.displayName=p(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,p(e,l,"GeneratorFunction")),e.prototype=Object.create(R),e},t.awrap=function(e){return{__await:e}},P(O.prototype),p(O.prototype,c,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new O(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},P(R),p(R,l,"Generator"),p(R,s,(function(){return this})),p(R,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function l(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function p(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){l(i,n,o,a,s,"next",e)}function s(e){l(i,n,o,a,s,"throw",e)}a(void 0)}))}}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,d(n.key),n)}}function d(e){var t=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===n(t)?t:String(t)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}var m=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),y=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),g=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&m(t,e,r);return y(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome70=void 0;var b=g(r(9652)),w=r(1916),_=g(r(5234)),S=g(r(6059)),k=g(r(5388)),x=g(r(8538)),R=r(3018),P=r(9196),O=r(9975),E=new w.Logger("Chrome70"),T={OS:1024,MIS:1024},C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(K,e);var t,r,i,s,l,d,m,y,g,w,R,C,j,L,D,I,M,A,N,F,B,G,V,U,q,z,W=(q=K,z=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=v(q);if(z){var r=v(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function K(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,K),(e=W.call(this))._mapMidTransceiver=new Map,e._sendStream=new MediaStream,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=K,r=[{key:"name",get:function(){return"Chrome70"}},{key:"close",value:function(){if(E.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}},{key:"getNativeRtpCapabilities",value:(U=p(u().mark((function e(){var t,r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"}),e.prev=2,t.addTransceiver("audio"),t.addTransceiver("video"),e.next=7,t.createOffer();case 7:r=e.sent;try{t.close()}catch(e){}return n=b.parse(r.sdp),o=k.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",o);case 14:e.prev=14,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 18:case"end":return e.stop()}}),e,null,[[2,14]])}))),function(){return U.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(V=p(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:T});case 2:case"end":return e.stop()}}),e)}))),function(){return V.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,o=e.iceCandidates,i=e.dtlsParameters,a=e.sctpParameters,s=e.iceServers,u=e.iceTransportPolicy,l=e.additionalSettings,p=e.proprietaryConstraints,f=e.extendedRtpCapabilities;E.debug("run()"),this._direction=r,this._remoteSdp=new P.RemoteSdp({iceParameters:n,iceCandidates:o,dtlsParameters:i,sctpParameters:a}),this._sendingRtpParametersByKind={audio:S.getSendingRtpParameters("audio",f),video:S.getSendingRtpParameters("video",f)},this._sendingRemoteRtpParametersByKind={audio:S.getSendingRemoteRtpParameters("audio",f),video:S.getSendingRemoteRtpParameters("video",f)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection(c({iceServers:s||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},l),p),this._pc.addEventListener("icegatheringstatechange",(function(){t.emit("@icegatheringstatechange",t._pc.iceGatheringState)})),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(function(){t.emit("@connectionstatechange",t._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(function(){switch(E.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:(G=p(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:E.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return G.apply(this,arguments)})},{key:"restartIce",value:(B=p(u().mark((function e(t){var r,n,o,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(E.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,E.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},E.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return o={type:"offer",sdp:this._remoteSdp.getSdp()},E.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",o),e.next=21,this._pc.setRemoteDescription(o);case 21:return e.next=23,this._pc.createAnswer();case 23:return i=e.sent,E.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),e.next=27,this._pc.setLocalDescription(i);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"getTransportStats",value:(F=p(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return F.apply(this,arguments)})},{key:"send",value:(N=p(u().mark((function e(t){var r,n,i,s,c,l,p,f,d,h,v,m,y,g,w,R,P,T,C,j,L,D,I;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,n=t.encodings,i=t.codecOptions,s=t.codec,this.assertSendDirection(),E.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),(c=_.clone(this._sendingRtpParametersByKind[r.kind])).codecs=S.reduceCodecs(c.codecs,s),(l=_.clone(this._sendingRemoteRtpParametersByKind[r.kind])).codecs=S.reduceCodecs(l.codecs,s),p=this._remoteSdp.getNextMediaSectionIdx(),f=this._pc.addTransceiver(r,{direction:"sendonly",streams:[this._sendStream]}),e.next=11,this._pc.createOffer();case 11:if(d=e.sent,h=b.parse(d.sdp),this._transportReady){e.next=16;break}return e.next=16,this.setupTransport({localDtlsRole:null!==(m=this._forcedLocalDtlsRole)&&void 0!==m?m:"client",localSdpObject:h});case 16:return n&&n.length>1&&(E.debug("send() | enabling legacy simulcast"),h=b.parse(d.sdp),v=h.media[p.idx],x.addLegacySimulcast({offerMediaObject:v,numStreams:n.length}),d={type:"offer",sdp:b.write(h)}),y=!1,g=(0,O.parse)((n||[{}])[0].scalabilityMode),n&&1===n.length&&g.spatialLayers>1&&"video/vp9"===c.codecs[0].mimeType.toLowerCase()&&(E.debug("send() | enabling legacy simulcast for VP9 SVC"),y=!0,h=b.parse(d.sdp),v=h.media[p.idx],x.addLegacySimulcast({offerMediaObject:v,numStreams:g.spatialLayers}),d={type:"offer",sdp:b.write(h)}),E.debug("send() | calling pc.setLocalDescription() [offer:%o]",d),e.next=23,this._pc.setLocalDescription(d);case 23:if(!n){e.next=38;break}E.debug("send() | applying given encodings"),w=f.sender.getParameters(),R=0;case 27:if(!(R<(w.encodings||[]).length)){e.next=36;break}if(P=w.encodings[R],T=n[R]){e.next=32;break}return e.abrupt("break",36);case 32:w.encodings[R]=a(P,T);case 33:++R,e.next=27;break;case 36:return e.next=38,f.sender.setParameters(w);case 38:if(C=f.mid,c.mid=C,h=b.parse(this._pc.localDescription.sdp),v=h.media[p.idx],c.rtcp.cname=k.getCname({offerMediaObject:v}),c.encodings=x.getRtpEncodings({offerMediaObject:v}),n)for(j=0;j<c.encodings.length;++j)n[j]&&a(c.encodings[j],n[j]);if(y&&(c.encodings=[c.encodings[0]]),c.encodings.length>1&&("video/vp8"===c.codecs[0].mimeType.toLowerCase()||"video/h264"===c.codecs[0].mimeType.toLowerCase())){L=o(c.encodings);try{for(L.s();!(D=L.n()).done;)D.value.scalabilityMode="L1T3"}catch(e){L.e(e)}finally{L.f()}}return this._remoteSdp.send({offerMediaObject:v,reuseMid:p.reuseMid,offerRtpParameters:c,answerRtpParameters:l,codecOptions:i}),I={type:"answer",sdp:this._remoteSdp.getSdp()},E.debug("send() | calling pc.setRemoteDescription() [answer:%o]",I),e.next=52,this._pc.setRemoteDescription(I);case 52:return this._mapMidTransceiver.set(C,f),e.abrupt("return",{localId:C,rtpParameters:c,rtpSender:f.sender});case 54:case"end":return e.stop()}}),e,this)}))),function(e){return N.apply(this,arguments)})},{key:"stopSending",value:(A=p(u().mark((function e(t){var r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),E.debug("stopSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch(e){}return e.next=11,this._pc.createOffer();case 11:return n=e.sent,E.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=15,this._pc.setLocalDescription(n);case 15:return o={type:"answer",sdp:this._remoteSdp.getSdp()},E.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",o),e.next=19,this._pc.setRemoteDescription(o);case 19:this._mapMidTransceiver.delete(t);case 20:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"pauseSending",value:(M=p(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return M.apply(this,arguments)})},{key:"resumeSending",value:(I=p(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return I.apply(this,arguments)})},{key:"replaceTrack",value:(D=p(u().mark((function e(t,r){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),r?E.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):E.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return e.next=7,n.sender.replaceTrack(r);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return D.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(L=p(u().mark((function e(t,r){var n,o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),E.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(o=n.sender.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=9,n.sender.setParameters(o);case 9:return this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings),e.next=12,this._pc.createOffer();case 12:return i=e.sent,E.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",i),e.next=16,this._pc.setLocalDescription(i);case 16:return a={type:"answer",sdp:this._remoteSdp.getSdp()},E.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),e.next=20,this._pc.setRemoteDescription(a);case 20:case"end":return e.stop()}}),e,this)}))),function(e,t){return L.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(j=p(u().mark((function e(t,r){var n,o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),E.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(o=n.sender.getParameters()).encodings.forEach((function(e,t){o.encodings[t]=c(c({},e),r)})),e.next=9,n.sender.setParameters(o);case 9:return this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings),e.next=12,this._pc.createOffer();case 12:return i=e.sent,E.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",i),e.next=16,this._pc.setLocalDescription(i);case 16:return a={type:"answer",sdp:this._remoteSdp.getSdp()},E.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),e.next=20,this._pc.setRemoteDescription(a);case 20:case"end":return e.stop()}}),e,this)}))),function(e,t){return j.apply(this,arguments)})},{key:"getSenderStats",value:(C=p(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.sender.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"sendDataChannel",value:(R=p(u().mark((function e(t){var r,n,o,i,a,s,c,l,p,f,d,h,v;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,o=t.maxRetransmits,i=t.label,a=t.protocol,this.assertSendDirection(),s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmitTime:n,maxRetransmits:o,protocol:a},E.debug("sendDataChannel() [options:%o]",s),c=this._pc.createDataChannel(i,s),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%T.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(l=e.sent,p=b.parse(l.sdp),f=p.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this.setupTransport({localDtlsRole:null!==(d=this._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:p});case 15:return E.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=18,this._pc.setLocalDescription(l);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:f}),h={type:"answer",sdp:this._remoteSdp.getSdp()},E.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=23,this._pc.setRemoteDescription(h);case 23:this._hasDataChannelMediaSection=!0;case 24:return v={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits},e.abrupt("return",{dataChannel:c,sctpStreamParameters:v});case 26:case"end":return e.stop()}}),e,this)}))),function(e){return R.apply(this,arguments)})},{key:"receive",value:(w=p(u().mark((function e(t){var r,n,i,a,s,c,l,p,f,d,h,v,m,y,g,w,_,S,x,R,P=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=[],n=new Map,i=o(t);try{for(i.s();!(a=i.n()).done;)s=a.value,c=s.trackId,l=s.kind,p=s.rtpParameters,f=s.streamId,E.debug("receive() [trackId:%s, kind:%s]",c,l),d=p.mid||String(this._mapMidTransceiver.size),n.set(c,d),this._remoteSdp.receive({mid:d,kind:l,offerRtpParameters:p,streamId:f||p.rtcp.cname,trackId:c})}catch(e){i.e(e)}finally{i.f()}return h={type:"offer",sdp:this._remoteSdp.getSdp()},E.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",h),e.next=9,this._pc.setRemoteDescription(h);case 9:return e.next=11,this._pc.createAnswer();case 11:v=e.sent,m=b.parse(v.sdp),y=o(t),e.prev=14,w=u().mark((function e(){var t,r,o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=g.value,r=t.trackId,o=t.rtpParameters,i=n.get(r),a=m.media.find((function(e){return String(e.mid)===i})),k.applyCodecParameters({offerRtpParameters:o,answerMediaObject:a});case 5:case"end":return e.stop()}}),e)})),y.s();case 17:if((g=y.n()).done){e.next=21;break}return e.delegateYield(w(),"t0",19);case 19:e.next=17;break;case 21:e.next=26;break;case 23:e.prev=23,e.t1=e.catch(14),y.e(e.t1);case 26:return e.prev=26,y.f(),e.finish(26);case 29:if(v={type:"answer",sdp:b.write(m)},this._transportReady){e.next=33;break}return e.next=33,this.setupTransport({localDtlsRole:null!==(_=this._forcedLocalDtlsRole)&&void 0!==_?_:"client",localSdpObject:m});case 33:return E.debug("receive() | calling pc.setLocalDescription() [answer:%o]",v),e.next=36,this._pc.setLocalDescription(v);case 36:S=o(t),e.prev=37,R=u().mark((function e(){var t,o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=x.value,o=t.trackId,i=n.get(o),a=P._pc.getTransceivers().find((function(e){return e.mid===i}))){e.next=6;break}throw new Error("new RTCRtpTransceiver not found");case 6:P._mapMidTransceiver.set(i,a),r.push({localId:i,track:a.receiver.track,rtpReceiver:a.receiver});case 8:case"end":return e.stop()}}),e)})),S.s();case 40:if((x=S.n()).done){e.next=44;break}return e.delegateYield(R(),"t2",42);case 42:e.next=40;break;case 44:e.next=49;break;case 46:e.prev=46,e.t3=e.catch(37),S.e(e.t3);case 49:return e.prev=49,S.f(),e.finish(49);case 52:return e.abrupt("return",r);case 53:case"end":return e.stop()}}),e,this,[[14,23,26,29],[37,46,49,52]])}))),function(e){return w.apply(this,arguments)})},{key:"stopReceiving",value:(g=p(u().mark((function e(t){var r,n,i,a,s,c,l,p,f;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=o(t),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=13;break}if(i=n.value,E.debug("stopReceiving() [localId:%s]",i),a=this._mapMidTransceiver.get(i)){e.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:this._remoteSdp.closeMediaSection(a.mid);case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return s={type:"offer",sdp:this._remoteSdp.getSdp()},E.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.next=25,this._pc.setRemoteDescription(s);case 25:return e.next=27,this._pc.createAnswer();case 27:return c=e.sent,E.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",c),e.next=31,this._pc.setLocalDescription(c);case 31:l=o(t);try{for(l.s();!(p=l.n()).done;)f=p.value,this._mapMidTransceiver.delete(f)}catch(e){l.e(e)}finally{l.f()}case 33:case"end":return e.stop()}}),e,this,[[2,15,18,21]])}))),function(e){return g.apply(this,arguments)})},{key:"pauseReceiving",value:(y=p(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return y.apply(this,arguments)})},{key:"resumeReceiving",value:(m=p(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return m.apply(this,arguments)})},{key:"getReceiverStats",value:(d=p(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertRecvDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.receiver.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"receiveDataChannel",value:(l=p(u().mark((function e(t){var r,n,o,i,a,s,c,l,p,f,d,h,v;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,o=t.protocol,this.assertRecvDirection(),i=r.streamId,a=r.ordered,s=r.maxPacketLifeTime,c=r.maxRetransmits,l={negotiated:!0,id:i,ordered:a,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:c,protocol:o},E.debug("receiveDataChannel() [options:%o]",l),p=this._pc.createDataChannel(n,l),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation(),f={type:"offer",sdp:this._remoteSdp.getSdp()},E.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=12,this._pc.setRemoteDescription(f);case 12:return e.next=14,this._pc.createAnswer();case 14:if(d=e.sent,this._transportReady){e.next=19;break}return v=b.parse(d.sdp),e.next=19,this.setupTransport({localDtlsRole:null!==(h=this._forcedLocalDtlsRole)&&void 0!==h?h:"client",localSdpObject:v});case 19:return E.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),e.next=22,this._pc.setLocalDescription(d);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:p});case 24:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"setupTransport",value:(s=p(u().mark((function e(t){var r,n,o,i=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=b.parse(this._pc.localDescription.sdp)),(o=k.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,new Promise((function(e,t){i.safeEmit("@connect",{dtlsParameters:o},e,t)}));case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}],i=[{key:"createFactory",value:function(){return function(){return new K}}}],r&&f(t.prototype,r),i&&f(t,i),Object.defineProperty(t,"prototype",{writable:!1}),K}(R.HandlerInterface);t.Chrome70=C},5031:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw a}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a.apply(this,arguments)}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){var n,o,i;n=e,o=t,i=r[t],(o=d(o))in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(){u=function(){return t};var e,t={},r=Object.prototype,o=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,a=Object.create(o.prototype),s=new L(n||[]);return i(a,"_invoke",{value:E(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var h="suspendedStart",v="suspendedYield",m="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};p(S,s,(function(){return this}));var k=Object.getPrototypeOf,x=k&&k(k(D([])));x&&x!==r&&o.call(x,s)&&(S=x);var R=_.prototype=b.prototype=Object.create(S);function P(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(i,a,s,c){var u=d(e[i],e,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==n(p)&&o.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,c)}))}c(u.arg)}var a;i(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function E(t,r,n){var o=h;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function r(){for(;++i<t.length;)if(o.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=_,i(R,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:w,configurable:!0}),w.displayName=p(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,p(e,l,"GeneratorFunction")),e.prototype=Object.create(R),e},t.awrap=function(e){return{__await:e}},P(O.prototype),p(O.prototype,c,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new O(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},P(R),p(R,l,"Generator"),p(R,s,(function(){return this})),p(R,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function l(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function p(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){l(i,n,o,a,s,"next",e)}function s(e){l(i,n,o,a,s,"throw",e)}a(void 0)}))}}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,d(n.key),n)}}function d(e){var t=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===n(t)?t:String(t)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}var m=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),y=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),g=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&m(t,e,r);return y(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome74=void 0;var b=g(r(9652)),w=r(1916),_=g(r(5234)),S=g(r(6059)),k=g(r(5388)),x=g(r(8538)),R=g(r(337)),P=r(6020),O=r(3018),E=r(9196),T=r(9975),C=new w.Logger("Chrome74"),j={OS:1024,MIS:1024},L=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(H,e);var t,r,i,s,l,d,m,y,g,w,O,L,D,I,M,A,N,F,B,G,V,U,q,z,W,K,Y=(W=H,K=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=v(W);if(K){var r=v(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function H(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,H),(e=Y.call(this))._closed=!1,e._mapMidTransceiver=new Map,e._sendStream=new MediaStream,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=H,r=[{key:"name",get:function(){return"Chrome74"}},{key:"close",value:function(){if(C.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}}},{key:"getNativeRtpCapabilities",value:(z=p(u().mark((function e(){var t,r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"}),e.prev=2,t.addTransceiver("audio"),t.addTransceiver("video"),e.next=7,t.createOffer();case 7:r=e.sent;try{t.close()}catch(e){}return n=b.parse(r.sdp),o=k.extractRtpCapabilities({sdpObject:n}),R.addNackSuppportForOpus(o),e.abrupt("return",o);case 15:e.prev=15,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 19:case"end":return e.stop()}}),e,null,[[2,15]])}))),function(){return z.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(q=p(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:j});case 2:case"end":return e.stop()}}),e)}))),function(){return q.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,o=e.iceCandidates,i=e.dtlsParameters,a=e.sctpParameters,s=e.iceServers,u=e.iceTransportPolicy,l=e.additionalSettings,p=e.proprietaryConstraints,f=e.extendedRtpCapabilities;C.debug("run()"),this._direction=r,this._remoteSdp=new E.RemoteSdp({iceParameters:n,iceCandidates:o,dtlsParameters:i,sctpParameters:a}),this._sendingRtpParametersByKind={audio:S.getSendingRtpParameters("audio",f),video:S.getSendingRtpParameters("video",f)},this._sendingRemoteRtpParametersByKind={audio:S.getSendingRemoteRtpParameters("audio",f),video:S.getSendingRemoteRtpParameters("video",f)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection(c({iceServers:s||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},l),p),this._pc.addEventListener("icegatheringstatechange",(function(){t.emit("@icegatheringstatechange",t._pc.iceGatheringState)})),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(function(){t.emit("@connectionstatechange",t._pc.connectionState)})):(C.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",(function(){switch(t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}})))}},{key:"updateIceServers",value:(U=p(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertNotClosed(),C.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return U.apply(this,arguments)})},{key:"restartIce",value:(V=p(u().mark((function e(t){var r,n,o,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),C.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=5;break}return e.abrupt("return");case 5:if("send"!==this._direction){e.next=18;break}return e.next=8,this._pc.createOffer({iceRestart:!0});case 8:return r=e.sent,C.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=12,this._pc.setLocalDescription(r);case 12:return n={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=16,this._pc.setRemoteDescription(n);case 16:e.next=28;break;case 18:return o={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",o),e.next=22,this._pc.setRemoteDescription(o);case 22:return e.next=24,this._pc.createAnswer();case 24:return i=e.sent,C.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),e.next=28,this._pc.setLocalDescription(i);case 28:case"end":return e.stop()}}),e,this)}))),function(e){return V.apply(this,arguments)})},{key:"getTransportStats",value:(G=p(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.assertNotClosed(),e.abrupt("return",this._pc.getStats());case 2:case"end":return e.stop()}}),e,this)}))),function(){return G.apply(this,arguments)})},{key:"send",value:(B=p(u().mark((function e(t){var r,n,i,s,c,l,p,f,d,h,v,m,y,g,w,R,P,O,E,j;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,n=t.encodings,i=t.codecOptions,s=t.codec,this.assertNotClosed(),this.assertSendDirection(),C.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),n&&n.length>1&&n.forEach((function(e,t){e.rid="r".concat(t)})),(c=_.clone(this._sendingRtpParametersByKind[r.kind])).codecs=S.reduceCodecs(c.codecs,s),(l=_.clone(this._sendingRemoteRtpParametersByKind[r.kind])).codecs=S.reduceCodecs(l.codecs,s),p=this._remoteSdp.getNextMediaSectionIdx(),f=this._pc.addTransceiver(r,{direction:"sendonly",streams:[this._sendStream],sendEncodings:n}),e.next=13,this._pc.createOffer();case 13:if(d=e.sent,h=b.parse(d.sdp),this._transportReady){e.next=18;break}return e.next=18,this.setupTransport({localDtlsRole:null!==(m=this._forcedLocalDtlsRole)&&void 0!==m?m:"client",localSdpObject:h});case 18:return y=!1,g=(0,T.parse)((n||[{}])[0].scalabilityMode),n&&1===n.length&&g.spatialLayers>1&&"video/vp9"===c.codecs[0].mimeType.toLowerCase()&&(C.debug("send() | enabling legacy simulcast for VP9 SVC"),y=!0,h=b.parse(d.sdp),v=h.media[p.idx],x.addLegacySimulcast({offerMediaObject:v,numStreams:g.spatialLayers}),d={type:"offer",sdp:b.write(h)}),C.debug("send() | calling pc.setLocalDescription() [offer:%o]",d),e.next=24,this._pc.setLocalDescription(d);case 24:if(w=f.mid,c.mid=w,h=b.parse(this._pc.localDescription.sdp),v=h.media[p.idx],c.rtcp.cname=k.getCname({offerMediaObject:v}),n?1===n.length?(a((R=x.getRtpEncodings({offerMediaObject:v}))[0],n[0]),y&&(R=[R[0]]),c.encodings=R):c.encodings=n:c.encodings=x.getRtpEncodings({offerMediaObject:v}),c.encodings.length>1&&("video/vp8"===c.codecs[0].mimeType.toLowerCase()||"video/h264"===c.codecs[0].mimeType.toLowerCase())){P=o(c.encodings);try{for(P.s();!(O=P.n()).done;)(E=O.value).scalabilityMode?E.scalabilityMode="L1T".concat(g.temporalLayers):E.scalabilityMode="L1T3"}catch(e){P.e(e)}finally{P.f()}}return this._remoteSdp.send({offerMediaObject:v,reuseMid:p.reuseMid,offerRtpParameters:c,answerRtpParameters:l,codecOptions:i,extmapAllowMixed:!0}),j={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("send() | calling pc.setRemoteDescription() [answer:%o]",j),e.next=36,this._pc.setRemoteDescription(j);case 36:return this._mapMidTransceiver.set(w,f),e.abrupt("return",{localId:w,rtpParameters:c,rtpSender:f.sender});case 38:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"stopSending",value:(F=p(u().mark((function e(t){var r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),C.debug("stopSending() [localId:%s]",t),!this._closed){e.next=4;break}return e.abrupt("return");case 4:if(r=this._mapMidTransceiver.get(t)){e.next=7;break}throw new Error("associated RTCRtpTransceiver not found");case 7:if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch(e){}return e.next=13,this._pc.createOffer();case 13:return n=e.sent,C.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=17,this._pc.setLocalDescription(n);case 17:return o={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",o),e.next=21,this._pc.setRemoteDescription(o);case 21:this._mapMidTransceiver.delete(t);case 22:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"pauseSending",value:(N=p(u().mark((function e(t){var r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),C.debug("pauseSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return r.direction="inactive",this._remoteSdp.pauseMediaSection(t),e.next=10,this._pc.createOffer();case 10:return n=e.sent,C.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=14,this._pc.setLocalDescription(n);case 14:return o={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",o),e.next=18,this._pc.setRemoteDescription(o);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return N.apply(this,arguments)})},{key:"resumeSending",value:(A=p(u().mark((function e(t){var r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),C.debug("resumeSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t),this._remoteSdp.resumeSendingMediaSection(t),r){e.next=7;break}throw new Error("associated RTCRtpTransceiver not found");case 7:return r.direction="sendonly",e.next=10,this._pc.createOffer();case 10:return n=e.sent,C.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=14,this._pc.setLocalDescription(n);case 14:return o={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",o),e.next=18,this._pc.setRemoteDescription(o);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"replaceTrack",value:(M=p(u().mark((function e(t,r){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),r?C.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):C.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapMidTransceiver.get(t)){e.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return e.next=8,n.sender.replaceTrack(r);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return M.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(I=p(u().mark((function e(t,r){var n,o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),C.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapMidTransceiver.get(t)){e.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return(o=n.sender.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=10,n.sender.setParameters(o);case 10:return this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings),e.next=13,this._pc.createOffer();case 13:return i=e.sent,C.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",i),e.next=17,this._pc.setLocalDescription(i);case 17:return a={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),e.next=21,this._pc.setRemoteDescription(a);case 21:case"end":return e.stop()}}),e,this)}))),function(e,t){return I.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(D=p(u().mark((function e(t,r){var n,o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),C.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapMidTransceiver.get(t)){e.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return(o=n.sender.getParameters()).encodings.forEach((function(e,t){o.encodings[t]=c(c({},e),r)})),e.next=10,n.sender.setParameters(o);case 10:return this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings),e.next=13,this._pc.createOffer();case 13:return i=e.sent,C.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",i),e.next=17,this._pc.setLocalDescription(i);case 17:return a={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),e.next=21,this._pc.setRemoteDescription(a);case 21:case"end":return e.stop()}}),e,this)}))),function(e,t){return D.apply(this,arguments)})},{key:"getSenderStats",value:(L=p(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return e.abrupt("return",r.sender.getStats());case 6:case"end":return e.stop()}}),e,this)}))),function(e){return L.apply(this,arguments)})},{key:"sendDataChannel",value:(O=p(u().mark((function e(t){var r,n,o,i,a,s,c,l,p,f,d,h,v;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,o=t.maxRetransmits,i=t.label,a=t.protocol,this.assertNotClosed(),this.assertSendDirection(),s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmits:o,protocol:a},C.debug("sendDataChannel() [options:%o]",s),c=this._pc.createDataChannel(i,s),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%j.MIS,this._hasDataChannelMediaSection){e.next=25;break}return e.next=10,this._pc.createOffer();case 10:if(l=e.sent,p=b.parse(l.sdp),f=p.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=16;break}return e.next=16,this.setupTransport({localDtlsRole:null!==(d=this._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:p});case 16:return C.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=19,this._pc.setLocalDescription(l);case 19:return this._remoteSdp.sendSctpAssociation({offerMediaObject:f}),h={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=24,this._pc.setRemoteDescription(h);case 24:this._hasDataChannelMediaSection=!0;case 25:return v={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits},e.abrupt("return",{dataChannel:c,sctpStreamParameters:v});case 27:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"receive",value:(w=p(u().mark((function e(t){var r,n,i,a,s,c,l,p,f,d,h,v,m,y,g,w,_,S,x,R,P=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertNotClosed(),this.assertRecvDirection(),r=[],n=new Map,i=o(t);try{for(i.s();!(a=i.n()).done;)s=a.value,c=s.trackId,l=s.kind,p=s.rtpParameters,f=s.streamId,C.debug("receive() [trackId:%s, kind:%s]",c,l),d=p.mid||String(this._mapMidTransceiver.size),n.set(c,d),this._remoteSdp.receive({mid:d,kind:l,offerRtpParameters:p,streamId:f||p.rtcp.cname,trackId:c})}catch(e){i.e(e)}finally{i.f()}return h={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",h),e.next=10,this._pc.setRemoteDescription(h);case 10:return e.next=12,this._pc.createAnswer();case 12:v=e.sent,m=b.parse(v.sdp),y=o(t),e.prev=15,w=u().mark((function e(){var t,r,o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=g.value,r=t.trackId,o=t.rtpParameters,i=n.get(r),a=m.media.find((function(e){return String(e.mid)===i})),k.applyCodecParameters({offerRtpParameters:o,answerMediaObject:a});case 5:case"end":return e.stop()}}),e)})),y.s();case 18:if((g=y.n()).done){e.next=22;break}return e.delegateYield(w(),"t0",20);case 20:e.next=18;break;case 22:e.next=27;break;case 24:e.prev=24,e.t1=e.catch(15),y.e(e.t1);case 27:return e.prev=27,y.f(),e.finish(27);case 30:if(v={type:"answer",sdp:b.write(m)},this._transportReady){e.next=34;break}return e.next=34,this.setupTransport({localDtlsRole:null!==(_=this._forcedLocalDtlsRole)&&void 0!==_?_:"client",localSdpObject:m});case 34:return C.debug("receive() | calling pc.setLocalDescription() [answer:%o]",v),e.next=37,this._pc.setLocalDescription(v);case 37:S=o(t),e.prev=38,R=u().mark((function e(){var t,o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=x.value,o=t.trackId,i=n.get(o),a=P._pc.getTransceivers().find((function(e){return e.mid===i}))){e.next=8;break}throw new Error("new RTCRtpTransceiver not found");case 8:P._mapMidTransceiver.set(i,a),r.push({localId:i,track:a.receiver.track,rtpReceiver:a.receiver});case 10:case"end":return e.stop()}}),e)})),S.s();case 41:if((x=S.n()).done){e.next=45;break}return e.delegateYield(R(),"t2",43);case 43:e.next=41;break;case 45:e.next=50;break;case 47:e.prev=47,e.t3=e.catch(38),S.e(e.t3);case 50:return e.prev=50,S.f(),e.finish(50);case 53:return e.abrupt("return",r);case 54:case"end":return e.stop()}}),e,this,[[15,24,27,30],[38,47,50,53]])}))),function(e){return w.apply(this,arguments)})},{key:"stopReceiving",value:(g=p(u().mark((function e(t){var r,n,i,a,s,c,l,p,f;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertRecvDirection(),!this._closed){e.next=3;break}return e.abrupt("return");case 3:r=o(t),e.prev=4,r.s();case 6:if((n=r.n()).done){e.next=15;break}if(i=n.value,C.debug("stopReceiving() [localId:%s]",i),a=this._mapMidTransceiver.get(i)){e.next=12;break}throw new Error("associated RTCRtpTransceiver not found");case 12:this._remoteSdp.closeMediaSection(a.mid);case 13:e.next=6;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(4),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:return s={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.next=27,this._pc.setRemoteDescription(s);case 27:return e.next=29,this._pc.createAnswer();case 29:return c=e.sent,C.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",c),e.next=33,this._pc.setLocalDescription(c);case 33:l=o(t);try{for(l.s();!(p=l.n()).done;)f=p.value,this._mapMidTransceiver.delete(f)}catch(e){l.e(e)}finally{l.f()}case 35:case"end":return e.stop()}}),e,this,[[4,17,20,23]])}))),function(e){return g.apply(this,arguments)})},{key:"pauseReceiving",value:(y=p(u().mark((function e(t){var r,n,i,a,s,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertNotClosed(),this.assertRecvDirection(),r=o(t),e.prev=3,r.s();case 5:if((n=r.n()).done){e.next=15;break}if(i=n.value,C.debug("pauseReceiving() [localId:%s]",i),a=this._mapMidTransceiver.get(i)){e.next=11;break}throw new Error("associated RTCRtpTransceiver not found");case 11:a.direction="inactive",this._remoteSdp.pauseMediaSection(i);case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:return s={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.next=27,this._pc.setRemoteDescription(s);case 27:return e.next=29,this._pc.createAnswer();case 29:return c=e.sent,C.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",c),e.next=33,this._pc.setLocalDescription(c);case 33:case"end":return e.stop()}}),e,this,[[3,17,20,23]])}))),function(e){return y.apply(this,arguments)})},{key:"resumeReceiving",value:(m=p(u().mark((function e(t){var r,n,i,a,s,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertNotClosed(),this.assertRecvDirection(),r=o(t),e.prev=3,r.s();case 5:if((n=r.n()).done){e.next=15;break}if(i=n.value,C.debug("resumeReceiving() [localId:%s]",i),a=this._mapMidTransceiver.get(i)){e.next=11;break}throw new Error("associated RTCRtpTransceiver not found");case 11:a.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i);case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:return s={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.next=27,this._pc.setRemoteDescription(s);case 27:return e.next=29,this._pc.createAnswer();case 29:return c=e.sent,C.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",c),e.next=33,this._pc.setLocalDescription(c);case 33:case"end":return e.stop()}}),e,this,[[3,17,20,23]])}))),function(e){return m.apply(this,arguments)})},{key:"getReceiverStats",value:(d=p(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertRecvDirection(),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return e.abrupt("return",r.receiver.getStats());case 6:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"receiveDataChannel",value:(l=p(u().mark((function e(t){var r,n,o,i,a,s,c,l,p,f,d,h,v;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,o=t.protocol,this.assertNotClosed(),this.assertRecvDirection(),i=r.streamId,a=r.ordered,s=r.maxPacketLifeTime,c=r.maxRetransmits,l={negotiated:!0,id:i,ordered:a,maxPacketLifeTime:s,maxRetransmits:c,protocol:o},C.debug("receiveDataChannel() [options:%o]",l),p=this._pc.createDataChannel(n,l),this._hasDataChannelMediaSection){e.next=24;break}return this._remoteSdp.receiveSctpAssociation(),f={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=13,this._pc.setRemoteDescription(f);case 13:return e.next=15,this._pc.createAnswer();case 15:if(d=e.sent,this._transportReady){e.next=20;break}return v=b.parse(d.sdp),e.next=20,this.setupTransport({localDtlsRole:null!==(h=this._forcedLocalDtlsRole)&&void 0!==h?h:"client",localSdpObject:v});case 20:return C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),e.next=23,this._pc.setLocalDescription(d);case 23:this._hasDataChannelMediaSection=!0;case 24:return e.abrupt("return",{dataChannel:p});case 25:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"setupTransport",value:(s=p(u().mark((function e(t){var r,n,o,i=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=b.parse(this._pc.localDescription.sdp)),(o=k.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,new Promise((function(e,t){i.safeEmit("@connect",{dtlsParameters:o},e,t)}));case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"assertNotClosed",value:function(){if(this._closed)throw new P.InvalidStateError("method called in a closed handler")}},{key:"assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}],i=[{key:"createFactory",value:function(){return function(){return new H}}}],r&&f(t.prototype,r),i&&f(t,i),Object.defineProperty(t,"prototype",{writable:!1}),H}(O.HandlerInterface);t.Chrome74=L},7042:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){var n,o,i;n=e,o=t,i=r[t],(o=f(o))in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(){a=function(){return t};var e,t={},r=Object.prototype,o=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,a=Object.create(o.prototype),s=new L(n||[]);return i(a,"_invoke",{value:E(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var h="suspendedStart",v="suspendedYield",m="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};p(S,c,(function(){return this}));var k=Object.getPrototypeOf,x=k&&k(k(D([])));x&&x!==r&&o.call(x,c)&&(S=x);var R=_.prototype=b.prototype=Object.create(S);function P(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(i,a,s,c){var u=d(e[i],e,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==n(p)&&o.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,c)}))}c(u.arg)}var a;i(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function E(t,r,n){var o=h;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function r(){for(;++i<t.length;)if(o.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=_,i(R,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:w,configurable:!0}),w.displayName=p(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,p(e,l,"GeneratorFunction")),e.prototype=Object.create(R),e},t.awrap=function(e){return{__await:e}},P(O.prototype),p(O.prototype,u,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new O(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},P(R),p(R,l,"Generator"),p(R,c,(function(){return this})),p(R,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function s(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function c(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){s(i,n,o,a,c,"next",e)}function c(e){s(i,n,o,a,c,"throw",e)}a(void 0)}))}}function u(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function f(e){var t=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===n(t)?t:String(t)}function d(e,t){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},d(e,t)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}var v=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),m=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),y=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&v(t,e,r);return m(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Edge11=void 0;var g=r(1916),b=r(6020),w=y(r(5234)),_=y(r(6059)),S=y(r(6819)),k=r(3018),x=new g.Logger("Edge11"),R=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}(V,e);var t,r,o,s,l,f,v,m,y,g,k,R,P,O,E,T,C,j,L,D,I,M,A,N,F,B,G=(F=V,B=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=h(F);if(B){var r=h(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function V(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,V),(e=G.call(this))._rtpSenders=new Map,e._rtpReceivers=new Map,e._nextSendLocalId=0,e._transportReady=!1,e}return t=V,r=[{key:"name",get:function(){return"Edge11"}},{key:"close",value:function(){x.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}var e,t=u(this._rtpSenders.values());try{for(t.s();!(e=t.n()).done;){var r=e.value;try{r.stop()}catch(e){}}}catch(e){t.e(e)}finally{t.f()}var n,o=u(this._rtpReceivers.values());try{for(o.s();!(n=o.n()).done;){var i=n.value;try{i.stop()}catch(e){}}}catch(e){o.e(e)}finally{o.f()}this.emit("@close")}},{key:"getNativeRtpCapabilities",value:(N=c(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.debug("getNativeRtpCapabilities()"),e.abrupt("return",S.getCapabilities());case 2:case"end":return e.stop()}}),e)}))),function(){return N.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(A=c(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:{OS:0,MIS:0}});case 2:case"end":return e.stop()}}),e)}))),function(){return A.apply(this,arguments)})},{key:"run",value:function(e){e.direction;var t=e.iceParameters,r=e.iceCandidates,n=e.dtlsParameters,o=(e.sctpParameters,e.iceServers),i=e.iceTransportPolicy,a=(e.additionalSettings,e.proprietaryConstraints,e.extendedRtpCapabilities);x.debug("run()"),this._sendingRtpParametersByKind={audio:_.getSendingRtpParameters("audio",a),video:_.getSendingRtpParameters("video",a)},this._remoteIceParameters=t,this._remoteIceCandidates=r,this._remoteDtlsParameters=n,this._cname="CNAME-".concat(w.generateRandomNumber()),this.setIceGatherer({iceServers:o,iceTransportPolicy:i}),this.setIceTransport(),this.setDtlsTransport()}},{key:"updateIceServers",value:(M=c(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new b.UnsupportedError("not supported");case 1:case"end":return e.stop()}}),e)}))),function(e){return M.apply(this,arguments)})},{key:"restartIce",value:(I=c(a().mark((function e(t){var r,n,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(x.debug("restartIce()"),this._remoteIceParameters=t,this._transportReady){e.next=4;break}return e.abrupt("return");case 4:x.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,t,"controlling"),r=u(this._remoteIceCandidates);try{for(r.s();!(n=r.n()).done;)o=n.value,this._iceTransport.addRemoteCandidate(o)}catch(e){r.e(e)}finally{r.f()}this._iceTransport.addRemoteCandidate({});case 9:case"end":return e.stop()}}),e,this)}))),function(e){return I.apply(this,arguments)})},{key:"getTransportStats",value:(D=c(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._iceTransport.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return D.apply(this,arguments)})},{key:"send",value:(L=c(a().mark((function e(t){var r,n,o,i,s,c,l,p,f,d,h;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.track,n=t.encodings,t.codecOptions,o=t.codec,x.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),this._transportReady){e.next=5;break}return e.next=5,this.setupTransport({localDtlsRole:"server"});case 5:x.debug("send() | calling new RTCRtpSender()"),i=new RTCRtpSender(r,this._dtlsTransport),(s=w.clone(this._sendingRtpParametersByKind[r.kind])).codecs=_.reduceCodecs(s.codecs,o),c=s.codecs.some((function(e){return/.+\/rtx$/i.test(e.mimeType)})),n||(n=[{}]),l=u(n);try{for(l.s();!(p=l.n()).done;)(f=p.value).ssrc=w.generateRandomNumber(),c&&(f.rtx={ssrc:w.generateRandomNumber()})}catch(e){l.e(e)}finally{l.f()}return s.encodings=n,s.rtcp={cname:this._cname,reducedSize:!0,mux:!0},d=S.mangleRtpParameters(s),x.debug("send() | calling rtpSender.send() [params:%o]",d),e.next=19,i.send(d);case 19:return h=String(this._nextSendLocalId),this._nextSendLocalId++,this._rtpSenders.set(h,i),e.abrupt("return",{localId:h,rtpParameters:s,rtpSender:i});case 23:case"end":return e.stop()}}),e,this)}))),function(e){return L.apply(this,arguments)})},{key:"stopSending",value:(j=c(a().mark((function e(t){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(x.debug("stopSending() [localId:%s]",t),r=this._rtpSenders.get(t)){e.next=4;break}throw new Error("RTCRtpSender not found");case 4:this._rtpSenders.delete(t),e.prev=5,x.debug("stopSending() | calling rtpSender.stop()"),r.stop(),e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(5),x.warn("stopSending() | rtpSender.stop() failed:%o",e.t0),e.t0;case 14:case"end":return e.stop()}}),e,this,[[5,10]])}))),function(e){return j.apply(this,arguments)})},{key:"pauseSending",value:(C=c(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return C.apply(this,arguments)})},{key:"resumeSending",value:(T=c(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return T.apply(this,arguments)})},{key:"replaceTrack",value:(E=c(a().mark((function e(t,r){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r?x.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):x.debug("replaceTrack() [localId:%s, no track]",t),n=this._rtpSenders.get(t)){e.next=4;break}throw new Error("RTCRtpSender not found");case 4:n.setTrack(r);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return E.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(O=c(a().mark((function e(t,r){var n,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(x.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._rtpSenders.get(t)){e.next=4;break}throw new Error("RTCRtpSender not found");case 4:return(o=n.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=8,n.setParameters(o);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return O.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(P=c(a().mark((function e(t,r){var n,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(x.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._rtpSenders.get(t)){e.next=4;break}throw new Error("RTCRtpSender not found");case 4:return(o=n.getParameters()).encodings.forEach((function(e,t){o.encodings[t]=i(i({},e),r)})),e.next=8,n.setParameters(o);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return P.apply(this,arguments)})},{key:"getSenderStats",value:(R=c(a().mark((function e(t){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._rtpSenders.get(t)){e.next=3;break}throw new Error("RTCRtpSender not found");case 3:return e.abrupt("return",r.getStats());case 4:case"end":return e.stop()}}),e,this)}))),function(e){return R.apply(this,arguments)})},{key:"sendDataChannel",value:(k=c(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new b.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return k.apply(this,arguments)})},{key:"receive",value:(g=c(a().mark((function e(t){var r,n,o,i,s,c,l,p,f,d,h,v,m,y,g;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],n=u(t);try{for(n.s();!(o=n.n()).done;)i=o.value,s=i.trackId,c=i.kind,x.debug("receive() [trackId:%s, kind:%s]",s,c)}catch(e){n.e(e)}finally{n.f()}if(this._transportReady){e.next=6;break}return e.next=6,this.setupTransport({localDtlsRole:"server"});case 6:l=u(t),e.prev=7,l.s();case 9:if((p=l.n()).done){e.next=24;break}return f=p.value,d=f.trackId,h=f.kind,v=f.rtpParameters,x.debug("receive() | calling new RTCRtpReceiver()"),(m=new RTCRtpReceiver(this._dtlsTransport,h)).addEventListener("error",(function(e){x.error('rtpReceiver "error" event [event:%o]',e)})),y=S.mangleRtpParameters(v),x.debug("receive() | calling rtpReceiver.receive() [params:%o]",y),e.next=19,m.receive(y);case 19:g=d,this._rtpReceivers.set(g,m),r.push({localId:g,track:m.track,rtpReceiver:m});case 22:e.next=9;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(7),l.e(e.t0);case 29:return e.prev=29,l.f(),e.finish(29);case 32:return e.abrupt("return",r);case 33:case"end":return e.stop()}}),e,this,[[7,26,29,32]])}))),function(e){return g.apply(this,arguments)})},{key:"stopReceiving",value:(y=c(a().mark((function e(t){var r,n,o,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=u(t),e.prev=1,r.s();case 3:if((n=r.n()).done){e.next=13;break}if(o=n.value,x.debug("stopReceiving() [localId:%s]",o),i=this._rtpReceivers.get(o)){e.next=9;break}throw new Error("RTCRtpReceiver not found");case 9:this._rtpReceivers.delete(o);try{x.debug("stopReceiving() | calling rtpReceiver.stop()"),i.stop()}catch(e){x.warn("stopReceiving() | rtpReceiver.stop() failed:%o",e)}case 11:e.next=3;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(1),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[1,15,18,21]])}))),function(e){return y.apply(this,arguments)})},{key:"pauseReceiving",value:(m=c(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return m.apply(this,arguments)})},{key:"resumeReceiving",value:(v=c(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return v.apply(this,arguments)})},{key:"getReceiverStats",value:(f=c(a().mark((function e(t){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._rtpReceivers.get(t)){e.next=3;break}throw new Error("RTCRtpReceiver not found");case 3:return e.abrupt("return",r.getStats());case 4:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"receiveDataChannel",value:(l=c(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new b.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return l.apply(this,arguments)})},{key:"setIceGatherer",value:function(e){var t=e.iceServers,r=e.iceTransportPolicy,n=new RTCIceGatherer({iceServers:t||[],gatherPolicy:r||"all"});n.addEventListener("error",(function(e){x.error('iceGatherer "error" event [event:%o]',e)}));try{n.gather()}catch(e){x.debug("setIceGatherer() | iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=n}},{key:"setIceTransport",value:function(){var e=this,t=new RTCIceTransport(this._iceGatherer);t.addEventListener("statechange",(function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}})),t.addEventListener("icestatechange",(function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}})),t.addEventListener("candidatepairchange",(function(e){x.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)})),this._iceTransport=t}},{key:"setDtlsTransport",value:function(){var e=this,t=new RTCDtlsTransport(this._iceTransport);t.addEventListener("statechange",(function(){x.debug('dtlsTransport "statechange" event [state:%s]',t.state)})),t.addEventListener("dtlsstatechange",(function(){x.debug('dtlsTransport "dtlsstatechange" event [state:%s]',t.state),"closed"===t.state&&e.emit("@connectionstatechange","closed")})),t.addEventListener("error",(function(e){x.error('dtlsTransport "error" event [event:%o]',e)})),this._dtlsTransport=t}},{key:"setupTransport",value:(s=c(a().mark((function e(t){var r,n,o,i,s,c=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,x.debug("setupTransport()"),(n=this._dtlsTransport.getLocalParameters()).role=r,e.next=6,new Promise((function(e,t){c.safeEmit("@connect",{dtlsParameters:n},e,t)}));case 6:this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling"),o=u(this._remoteIceCandidates);try{for(o.s();!(i=o.n()).done;)s=i.value,this._iceTransport.addRemoteCandidate(s)}catch(e){o.e(e)}finally{o.f()}this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter((function(e){return"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm})),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0;case 13:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})}],o=[{key:"createFactory",value:function(){return function(){return new V}}}],r&&p(t.prototype,r),o&&p(t,o),Object.defineProperty(t,"prototype",{writable:!1}),V}(k.HandlerInterface);t.Edge11=R},246:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw a}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a.apply(this,arguments)}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){var n,o,i;n=e,o=t,i=r[t],(o=d(o))in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(){u=function(){return t};var e,t={},r=Object.prototype,o=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,a=Object.create(o.prototype),s=new L(n||[]);return i(a,"_invoke",{value:E(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var h="suspendedStart",v="suspendedYield",m="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};p(S,s,(function(){return this}));var k=Object.getPrototypeOf,x=k&&k(k(D([])));x&&x!==r&&o.call(x,s)&&(S=x);var R=_.prototype=b.prototype=Object.create(S);function P(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(i,a,s,c){var u=d(e[i],e,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==n(p)&&o.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,c)}))}c(u.arg)}var a;i(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function E(t,r,n){var o=h;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function r(){for(;++i<t.length;)if(o.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=_,i(R,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:w,configurable:!0}),w.displayName=p(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,p(e,l,"GeneratorFunction")),e.prototype=Object.create(R),e},t.awrap=function(e){return{__await:e}},P(O.prototype),p(O.prototype,c,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new O(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},P(R),p(R,l,"Generator"),p(R,s,(function(){return this})),p(R,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function l(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function p(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){l(i,n,o,a,s,"next",e)}function s(e){l(i,n,o,a,s,"throw",e)}a(void 0)}))}}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,d(n.key),n)}}function d(e){var t=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===n(t)?t:String(t)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}var m=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),y=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),g=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&m(t,e,r);return y(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Firefox60=void 0;var b=g(r(9652)),w=r(1916),_=r(6020),S=g(r(5234)),k=g(r(6059)),x=g(r(5388)),R=g(r(8538)),P=r(3018),O=r(9196),E=r(9975),T=new w.Logger("Firefox60"),C={OS:16,MIS:2048},j=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(Y,e);var t,r,i,s,l,d,m,y,g,w,P,j,L,D,I,M,A,N,F,B,G,V,U,q,z,W,K=(z=Y,W=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=v(z);if(W){var r=v(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function Y(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Y),(e=K.call(this))._closed=!1,e._mapMidTransceiver=new Map,e._sendStream=new MediaStream,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=Y,r=[{key:"name",get:function(){return"Firefox60"}},{key:"close",value:function(){if(T.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}}},{key:"getNativeRtpCapabilities",value:(q=p(u().mark((function e(){var t,r,n,o,i,a,s,c,l,p;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return T.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),(r=document.createElement("canvas")).getContext("2d"),n=r.captureStream(),o=n.getVideoTracks()[0],e.prev=6,t.addTransceiver("audio",{direction:"sendrecv"}),i=t.addTransceiver(o,{direction:"sendrecv"}),a=i.sender.getParameters(),s=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}],a.encodings=s,e.next=14,i.sender.setParameters(a);case 14:return e.next=16,t.createOffer();case 16:c=e.sent;try{r.remove()}catch(e){}try{o.stop()}catch(e){}try{t.close()}catch(e){}return l=b.parse(c.sdp),p=x.extractRtpCapabilities({sdpObject:l}),e.abrupt("return",p);case 25:e.prev=25,e.t0=e.catch(6);try{r.remove()}catch(e){}try{o.stop()}catch(e){}try{t.close()}catch(e){}throw e.t0;case 31:case"end":return e.stop()}}),e,null,[[6,25]])}))),function(){return q.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(U=p(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return T.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:C});case 2:case"end":return e.stop()}}),e)}))),function(){return U.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,o=e.iceCandidates,i=e.dtlsParameters,a=e.sctpParameters,s=e.iceServers,u=e.iceTransportPolicy,l=e.additionalSettings,p=e.proprietaryConstraints,f=e.extendedRtpCapabilities;this.assertNotClosed(),T.debug("run()"),this._direction=r,this._remoteSdp=new O.RemoteSdp({iceParameters:n,iceCandidates:o,dtlsParameters:i,sctpParameters:a}),this._sendingRtpParametersByKind={audio:k.getSendingRtpParameters("audio",f),video:k.getSendingRtpParameters("video",f)},this._sendingRemoteRtpParametersByKind={audio:k.getSendingRemoteRtpParameters("audio",f),video:k.getSendingRemoteRtpParameters("video",f)},this._pc=new RTCPeerConnection(c({iceServers:s||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},l),p),this._pc.addEventListener("icegatheringstatechange",(function(){t.emit("@icegatheringstatechange",t._pc.iceGatheringState)})),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(function(){t.emit("@connectionstatechange",t._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(function(){switch(T.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:(V=p(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw this.assertNotClosed(),new _.UnsupportedError("not supported");case 2:case"end":return e.stop()}}),e,this)}))),function(e){return V.apply(this,arguments)})},{key:"restartIce",value:(G=p(u().mark((function e(t){var r,n,o,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),T.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=5;break}return e.abrupt("return");case 5:if("send"!==this._direction){e.next=18;break}return e.next=8,this._pc.createOffer({iceRestart:!0});case 8:return r=e.sent,T.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=12,this._pc.setLocalDescription(r);case 12:return n={type:"answer",sdp:this._remoteSdp.getSdp()},T.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=16,this._pc.setRemoteDescription(n);case 16:e.next=28;break;case 18:return o={type:"offer",sdp:this._remoteSdp.getSdp()},T.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",o),e.next=22,this._pc.setRemoteDescription(o);case 22:return e.next=24,this._pc.createAnswer();case 24:return i=e.sent,T.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),e.next=28,this._pc.setLocalDescription(i);case 28:case"end":return e.stop()}}),e,this)}))),function(e){return G.apply(this,arguments)})},{key:"getTransportStats",value:(B=p(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.assertNotClosed(),e.abrupt("return",this._pc.getStats());case 2:case"end":return e.stop()}}),e,this)}))),function(){return B.apply(this,arguments)})},{key:"send",value:(F=p(u().mark((function e(t){var r,n,i,s,c,l,p,f,d,h,v,m,y,g,w,_,P,O;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.track,n=t.encodings,i=t.codecOptions,s=t.codec,this.assertNotClosed(),this.assertSendDirection(),T.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),n&&(n=S.clone(n)).length>1&&(n.forEach((function(e,t){e.rid="r".concat(t)})),n.reverse()),(c=S.clone(this._sendingRtpParametersByKind[r.kind])).codecs=k.reduceCodecs(c.codecs,s),(l=S.clone(this._sendingRemoteRtpParametersByKind[r.kind])).codecs=k.reduceCodecs(l.codecs,s),p=this._pc.addTransceiver(r,{direction:"sendonly",streams:[this._sendStream]}),!n){e.next=15;break}return(f=p.sender.getParameters()).encodings=n,e.next=15,p.sender.setParameters(f);case 15:return e.next=17,this._pc.createOffer();case 17:if(d=e.sent,h=b.parse(d.sdp),this._transportReady){e.next=22;break}return e.next=22,this.setupTransport({localDtlsRole:"client",localSdpObject:h});case 22:return v=(0,E.parse)((n||[{}])[0].scalabilityMode),T.debug("send() | calling pc.setLocalDescription() [offer:%o]",d),e.next=26,this._pc.setLocalDescription(d);case 26:if(m=p.mid,c.mid=m,h=b.parse(this._pc.localDescription.sdp),y=h.media[h.media.length-1],c.rtcp.cname=x.getCname({offerMediaObject:y}),n?1===n.length?(a((g=R.getRtpEncodings({offerMediaObject:y}))[0],n[0]),c.encodings=g):c.encodings=n.reverse():c.encodings=R.getRtpEncodings({offerMediaObject:y}),c.encodings.length>1&&("video/vp8"===c.codecs[0].mimeType.toLowerCase()||"video/h264"===c.codecs[0].mimeType.toLowerCase())){w=o(c.encodings);try{for(w.s();!(_=w.n()).done;)(P=_.value).scalabilityMode?P.scalabilityMode="L1T".concat(v.temporalLayers):P.scalabilityMode="L1T3"}catch(e){w.e(e)}finally{w.f()}}return this._remoteSdp.send({offerMediaObject:y,offerRtpParameters:c,answerRtpParameters:l,codecOptions:i,extmapAllowMixed:!0}),O={type:"answer",sdp:this._remoteSdp.getSdp()},T.debug("send() | calling pc.setRemoteDescription() [answer:%o]",O),e.next=38,this._pc.setRemoteDescription(O);case 38:return this._mapMidTransceiver.set(m,p),e.abrupt("return",{localId:m,rtpParameters:c,rtpSender:p.sender});case 40:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"stopSending",value:(N=p(u().mark((function e(t){var r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),T.debug("stopSending() [localId:%s]",t),!this._closed){e.next=4;break}return e.abrupt("return");case 4:if(r=this._mapMidTransceiver.get(t)){e.next=7;break}throw new Error("associated transceiver not found");case 7:return r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.disableMediaSection(r.mid),e.next=12,this._pc.createOffer();case 12:return n=e.sent,T.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=16,this._pc.setLocalDescription(n);case 16:return o={type:"answer",sdp:this._remoteSdp.getSdp()},T.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",o),e.next=20,this._pc.setRemoteDescription(o);case 20:this._mapMidTransceiver.delete(t);case 21:case"end":return e.stop()}}),e,this)}))),function(e){return N.apply(this,arguments)})},{key:"pauseSending",value:(A=p(u().mark((function e(t){var r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),T.debug("pauseSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return r.direction="inactive",this._remoteSdp.pauseMediaSection(t),e.next=10,this._pc.createOffer();case 10:return n=e.sent,T.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=14,this._pc.setLocalDescription(n);case 14:return o={type:"answer",sdp:this._remoteSdp.getSdp()},T.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",o),e.next=18,this._pc.setRemoteDescription(o);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"resumeSending",value:(M=p(u().mark((function e(t){var r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),T.debug("resumeSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return r.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(t),e.next=10,this._pc.createOffer();case 10:return n=e.sent,T.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=14,this._pc.setLocalDescription(n);case 14:return o={type:"answer",sdp:this._remoteSdp.getSdp()},T.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",o),e.next=18,this._pc.setRemoteDescription(o);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)})},{key:"replaceTrack",value:(I=p(u().mark((function e(t,r){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),r?T.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):T.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapMidTransceiver.get(t)){e.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return e.next=8,n.sender.replaceTrack(r);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return I.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(D=p(u().mark((function e(t,r){var n,o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),T.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapMidTransceiver.get(t)){e.next=6;break}throw new Error("associated transceiver not found");case 6:return o=n.sender.getParameters(),r=o.encodings.length-1-r,o.encodings.forEach((function(e,t){e.active=t>=r})),e.next=11,n.sender.setParameters(o);case 11:return this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings),e.next=14,this._pc.createOffer();case 14:return i=e.sent,T.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",i),e.next=18,this._pc.setLocalDescription(i);case 18:return a={type:"answer",sdp:this._remoteSdp.getSdp()},T.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),e.next=22,this._pc.setRemoteDescription(a);case 22:case"end":return e.stop()}}),e,this)}))),function(e,t){return D.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(L=p(u().mark((function e(t,r){var n,o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),T.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapMidTransceiver.get(t)){e.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return(o=n.sender.getParameters()).encodings.forEach((function(e,t){o.encodings[t]=c(c({},e),r)})),e.next=10,n.sender.setParameters(o);case 10:return this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings),e.next=13,this._pc.createOffer();case 13:return i=e.sent,T.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",i),e.next=17,this._pc.setLocalDescription(i);case 17:return a={type:"answer",sdp:this._remoteSdp.getSdp()},T.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),e.next=21,this._pc.setRemoteDescription(a);case 21:case"end":return e.stop()}}),e,this)}))),function(e,t){return L.apply(this,arguments)})},{key:"getSenderStats",value:(j=p(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return e.abrupt("return",r.sender.getStats());case 6:case"end":return e.stop()}}),e,this)}))),function(e){return j.apply(this,arguments)})},{key:"sendDataChannel",value:(P=p(u().mark((function e(t){var r,n,o,i,a,s,c,l,p,f,d,h;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,o=t.maxRetransmits,i=t.label,a=t.protocol,this.assertNotClosed(),this.assertSendDirection(),s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmits:o,protocol:a},T.debug("sendDataChannel() [options:%o]",s),c=this._pc.createDataChannel(i,s),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%C.MIS,this._hasDataChannelMediaSection){e.next=25;break}return e.next=10,this._pc.createOffer();case 10:if(l=e.sent,p=b.parse(l.sdp),f=p.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=16;break}return e.next=16,this.setupTransport({localDtlsRole:"client",localSdpObject:p});case 16:return T.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=19,this._pc.setLocalDescription(l);case 19:return this._remoteSdp.sendSctpAssociation({offerMediaObject:f}),d={type:"answer",sdp:this._remoteSdp.getSdp()},T.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),e.next=24,this._pc.setRemoteDescription(d);case 24:this._hasDataChannelMediaSection=!0;case 25:return h={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits},e.abrupt("return",{dataChannel:c,sctpStreamParameters:h});case 27:case"end":return e.stop()}}),e,this)}))),function(e){return P.apply(this,arguments)})},{key:"receive",value:(w=p(u().mark((function e(t){var r,n,i,a,s,c,l,p,f,d,h,v,m,y,g,w,_,S,k,R=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertNotClosed(),this.assertRecvDirection(),r=[],n=new Map,i=o(t);try{for(i.s();!(a=i.n()).done;)s=a.value,c=s.trackId,l=s.kind,p=s.rtpParameters,f=s.streamId,T.debug("receive() [trackId:%s, kind:%s]",c,l),d=p.mid||String(this._mapMidTransceiver.size),n.set(c,d),this._remoteSdp.receive({mid:d,kind:l,offerRtpParameters:p,streamId:f||p.rtcp.cname,trackId:c})}catch(e){i.e(e)}finally{i.f()}return h={type:"offer",sdp:this._remoteSdp.getSdp()},T.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",h),e.next=10,this._pc.setRemoteDescription(h);case 10:return e.next=12,this._pc.createAnswer();case 12:v=e.sent,m=b.parse(v.sdp),y=o(t),e.prev=15,w=u().mark((function e(){var t,r,o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=g.value,r=t.trackId,o=t.rtpParameters,i=n.get(r),a=m.media.find((function(e){return String(e.mid)===i})),x.applyCodecParameters({offerRtpParameters:o,answerMediaObject:a}),v={type:"answer",sdp:b.write(m)};case 6:case"end":return e.stop()}}),e)})),y.s();case 18:if((g=y.n()).done){e.next=22;break}return e.delegateYield(w(),"t0",20);case 20:e.next=18;break;case 22:e.next=27;break;case 24:e.prev=24,e.t1=e.catch(15),y.e(e.t1);case 27:return e.prev=27,y.f(),e.finish(27);case 30:if(this._transportReady){e.next=33;break}return e.next=33,this.setupTransport({localDtlsRole:"client",localSdpObject:m});case 33:return T.debug("receive() | calling pc.setLocalDescription() [answer:%o]",v),e.next=36,this._pc.setLocalDescription(v);case 36:_=o(t),e.prev=37,k=u().mark((function e(){var t,o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=S.value,o=t.trackId,i=n.get(o),a=R._pc.getTransceivers().find((function(e){return e.mid===i}))){e.next=6;break}throw new Error("new RTCRtpTransceiver not found");case 6:R._mapMidTransceiver.set(i,a),r.push({localId:i,track:a.receiver.track,rtpReceiver:a.receiver});case 8:case"end":return e.stop()}}),e)})),_.s();case 40:if((S=_.n()).done){e.next=44;break}return e.delegateYield(k(),"t2",42);case 42:e.next=40;break;case 44:e.next=49;break;case 46:e.prev=46,e.t3=e.catch(37),_.e(e.t3);case 49:return e.prev=49,_.f(),e.finish(49);case 52:return e.abrupt("return",r);case 53:case"end":return e.stop()}}),e,this,[[15,24,27,30],[37,46,49,52]])}))),function(e){return w.apply(this,arguments)})},{key:"stopReceiving",value:(g=p(u().mark((function e(t){var r,n,i,a,s,c,l,p,f;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertRecvDirection(),!this._closed){e.next=3;break}return e.abrupt("return");case 3:r=o(t),e.prev=4,r.s();case 6:if((n=r.n()).done){e.next=15;break}if(i=n.value,T.debug("stopReceiving() [localId:%s]",i),a=this._mapMidTransceiver.get(i)){e.next=12;break}throw new Error("associated RTCRtpTransceiver not found");case 12:this._remoteSdp.closeMediaSection(a.mid);case 13:e.next=6;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(4),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:return s={type:"offer",sdp:this._remoteSdp.getSdp()},T.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.next=27,this._pc.setRemoteDescription(s);case 27:return e.next=29,this._pc.createAnswer();case 29:return c=e.sent,T.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",c),e.next=33,this._pc.setLocalDescription(c);case 33:l=o(t);try{for(l.s();!(p=l.n()).done;)f=p.value,this._mapMidTransceiver.delete(f)}catch(e){l.e(e)}finally{l.f()}case 35:case"end":return e.stop()}}),e,this,[[4,17,20,23]])}))),function(e){return g.apply(this,arguments)})},{key:"pauseReceiving",value:(y=p(u().mark((function e(t){var r,n,i,a,s,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertNotClosed(),this.assertRecvDirection(),r=o(t),e.prev=3,r.s();case 5:if((n=r.n()).done){e.next=15;break}if(i=n.value,T.debug("pauseReceiving() [localId:%s]",i),a=this._mapMidTransceiver.get(i)){e.next=11;break}throw new Error("associated RTCRtpTransceiver not found");case 11:a.direction="inactive",this._remoteSdp.pauseMediaSection(i);case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:return s={type:"offer",sdp:this._remoteSdp.getSdp()},T.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.next=27,this._pc.setRemoteDescription(s);case 27:return e.next=29,this._pc.createAnswer();case 29:return c=e.sent,T.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",c),e.next=33,this._pc.setLocalDescription(c);case 33:case"end":return e.stop()}}),e,this,[[3,17,20,23]])}))),function(e){return y.apply(this,arguments)})},{key:"resumeReceiving",value:(m=p(u().mark((function e(t){var r,n,i,a,s,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertNotClosed(),this.assertRecvDirection(),r=o(t),e.prev=3,r.s();case 5:if((n=r.n()).done){e.next=15;break}if(i=n.value,T.debug("resumeReceiving() [localId:%s]",i),a=this._mapMidTransceiver.get(i)){e.next=11;break}throw new Error("associated RTCRtpTransceiver not found");case 11:a.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i);case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:return s={type:"offer",sdp:this._remoteSdp.getSdp()},T.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.next=27,this._pc.setRemoteDescription(s);case 27:return e.next=29,this._pc.createAnswer();case 29:return c=e.sent,T.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",c),e.next=33,this._pc.setLocalDescription(c);case 33:case"end":return e.stop()}}),e,this,[[3,17,20,23]])}))),function(e){return m.apply(this,arguments)})},{key:"getReceiverStats",value:(d=p(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertRecvDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.receiver.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"receiveDataChannel",value:(l=p(u().mark((function e(t){var r,n,o,i,a,s,c,l,p,f,d,h;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,o=t.protocol,this.assertNotClosed(),this.assertRecvDirection(),i=r.streamId,a=r.ordered,s=r.maxPacketLifeTime,c=r.maxRetransmits,l={negotiated:!0,id:i,ordered:a,maxPacketLifeTime:s,maxRetransmits:c,protocol:o},T.debug("receiveDataChannel() [options:%o]",l),p=this._pc.createDataChannel(n,l),this._hasDataChannelMediaSection){e.next=24;break}return this._remoteSdp.receiveSctpAssociation(),f={type:"offer",sdp:this._remoteSdp.getSdp()},T.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=13,this._pc.setRemoteDescription(f);case 13:return e.next=15,this._pc.createAnswer();case 15:if(d=e.sent,this._transportReady){e.next=20;break}return h=b.parse(d.sdp),e.next=20,this.setupTransport({localDtlsRole:"client",localSdpObject:h});case 20:return T.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),e.next=23,this._pc.setLocalDescription(d);case 23:this._hasDataChannelMediaSection=!0;case 24:return e.abrupt("return",{dataChannel:p});case 25:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"setupTransport",value:(s=p(u().mark((function e(t){var r,n,o,i=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=b.parse(this._pc.localDescription.sdp)),(o=x.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,new Promise((function(e,t){i.safeEmit("@connect",{dtlsParameters:o},e,t)}));case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"assertNotClosed",value:function(){if(this._closed)throw new _.InvalidStateError("method called in a closed handler")}},{key:"assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}],i=[{key:"createFactory",value:function(){return function(){return new Y}}}],r&&f(t.prototype,r),i&&f(t,i),Object.defineProperty(t,"prototype",{writable:!1}),Y}(P.HandlerInterface);t.Firefox60=j},3018:(e,t,r)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},o(e,t)}function i(e){return i=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},i(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.HandlerInterface=void 0;var a=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&o(e,t)}(c,e);var t,r,a,s=(r=c,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=i(r);if(a){var o=i(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function c(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),s.call(this)}return t=c,Object.defineProperty(t,"prototype",{writable:!1}),t}(r(5324).EnhancedEventEmitter);t.HandlerInterface=a},463:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw a}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a.apply(this,arguments)}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(){c=function(){return t};var e,t={},r=Object.prototype,o=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",u=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,a=Object.create(o.prototype),s=new L(n||[]);return i(a,"_invoke",{value:E(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var h="suspendedStart",v="suspendedYield",m="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};p(S,s,(function(){return this}));var k=Object.getPrototypeOf,x=k&&k(k(D([])));x&&x!==r&&o.call(x,s)&&(S=x);var R=_.prototype=b.prototype=Object.create(S);function P(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(i,a,s,c){var u=d(e[i],e,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==n(p)&&o.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,c)}))}c(u.arg)}var a;i(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function E(t,r,n){var o=h;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function r(){for(;++i<t.length;)if(o.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=_,i(R,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:w,configurable:!0}),w.displayName=p(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,p(e,l,"GeneratorFunction")),e.prototype=Object.create(R),e},t.awrap=function(e){return{__await:e}},P(O.prototype),p(O.prototype,u,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new O(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},P(R),p(R,l,"Generator"),p(R,s,(function(){return this})),p(R,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function u(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function l(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){u(i,n,o,a,s,"next",e)}function s(e){u(i,n,o,a,s,"throw",e)}a(void 0)}))}}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function f(e){var t=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===n(t)?t:String(t)}function d(e,t){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},d(e,t)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}var v=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),m=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),y=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&v(t,e,r);return m(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ReactNative=void 0;var g=y(r(9652)),b=r(1916),w=r(6020),_=y(r(5234)),S=y(r(6059)),k=y(r(5388)),x=y(r(5156)),R=r(3018),P=r(9196),O=new b.Logger("ReactNative"),E={OS:1024,MIS:1024},T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}(Y,e);var t,r,i,u,v,m,y,b,R,T,C,j,L,D,I,M,A,N,F,B,G,V,U,q,z,W,K=(z=Y,W=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=h(z);if(W){var r=h(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function Y(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Y),(e=K.call(this))._sendStream=new MediaStream,e._mapSendLocalIdTrack=new Map,e._nextSendLocalId=0,e._mapRecvLocalIdInfo=new Map,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=Y,r=[{key:"name",get:function(){return"ReactNative"}},{key:"close",value:function(){if(O.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}},{key:"getNativeRtpCapabilities",value:(q=l(c().mark((function e(){var t,r,n,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),e.prev=2,e.next=5,t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 5:r=e.sent;try{t.close()}catch(e){}return n=g.parse(r.sdp),o=k.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",o);case 12:e.prev=12,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[2,12]])}))),function(){return q.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(U=l(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:E});case 2:case"end":return e.stop()}}),e)}))),function(){return U.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,o=e.iceCandidates,i=e.dtlsParameters,a=e.sctpParameters,c=e.iceServers,u=e.iceTransportPolicy,l=e.additionalSettings,p=e.proprietaryConstraints,d=e.extendedRtpCapabilities;O.debug("run()"),this._direction=r,this._remoteSdp=new P.RemoteSdp({iceParameters:n,iceCandidates:o,dtlsParameters:i,sctpParameters:a,planB:!0}),this._sendingRtpParametersByKind={audio:S.getSendingRtpParameters("audio",d),video:S.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:S.getSendingRemoteRtpParameters("audio",d),video:S.getSendingRemoteRtpParameters("video",d)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){var n,o,i;n=e,o=t,i=r[t],(o=f(o))in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({iceServers:c||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},l),p),this._pc.addEventListener("icegatheringstatechange",(function(){t.emit("@icegatheringstatechange",t._pc.iceGatheringState)})),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(function(){t.emit("@connectionstatechange",t._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(function(){switch(O.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:(V=l(c().mark((function e(t){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:O.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return V.apply(this,arguments)})},{key:"restartIce",value:(G=l(c().mark((function e(t){var r,n,o,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,O.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return o={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",o),e.next=21,this._pc.setRemoteDescription(o);case 21:return e.next=23,this._pc.createAnswer();case 23:return i=e.sent,O.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),e.next=27,this._pc.setLocalDescription(i);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return G.apply(this,arguments)})},{key:"getTransportStats",value:(B=l(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return B.apply(this,arguments)})},{key:"send",value:(F=l(c().mark((function e(t){var r,n,i,s,u,l,p,f,d,h,v,m,y,b,w;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,n=t.encodings,i=t.codecOptions,s=t.codec,this.assertSendDirection(),O.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),s&&O.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(r),this._pc.addStream(this._sendStream),e.next=8,this._pc.createOffer();case 8:if(u=e.sent,l=g.parse(u.sdp),(f=_.clone(this._sendingRtpParametersByKind[r.kind])).codecs=S.reduceCodecs(f.codecs),(d=_.clone(this._sendingRemoteRtpParametersByKind[r.kind])).codecs=S.reduceCodecs(d.codecs),this._transportReady){e.next=17;break}return e.next=17,this.setupTransport({localDtlsRole:null!==(h=this._forcedLocalDtlsRole)&&void 0!==h?h:"client",localSdpObject:l});case 17:return"video"===r.kind&&n&&n.length>1&&(O.debug("send() | enabling simulcast"),l=g.parse(u.sdp),p=l.media.find((function(e){return"video"===e.type})),x.addLegacySimulcast({offerMediaObject:p,track:r,numStreams:n.length}),u={type:"offer",sdp:g.write(l)}),O.debug("send() | calling pc.setLocalDescription() [offer:%o]",u),e.next=21,this._pc.setLocalDescription(u);case 21:if(l=g.parse(this._pc.localDescription.sdp),p=l.media.find((function(e){return e.type===r.kind})),f.rtcp.cname=k.getCname({offerMediaObject:p}),f.encodings=x.getRtpEncodings({offerMediaObject:p,track:r}),n)for(v=0;v<f.encodings.length;++v)n[v]&&a(f.encodings[v],n[v]);if(f.encodings.length>1&&("video/vp8"===f.codecs[0].mimeType.toLowerCase()||"video/h264"===f.codecs[0].mimeType.toLowerCase())){m=o(f.encodings);try{for(m.s();!(y=m.n()).done;)y.value.scalabilityMode="L1T3"}catch(e){m.e(e)}finally{m.f()}}return this._remoteSdp.send({offerMediaObject:p,offerRtpParameters:f,answerRtpParameters:d,codecOptions:i}),b={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("send() | calling pc.setRemoteDescription() [answer:%o]",b),e.next=32,this._pc.setRemoteDescription(b);case 32:return w=String(this._nextSendLocalId),this._nextSendLocalId++,this._mapSendLocalIdTrack.set(w,r),e.abrupt("return",{localId:w,rtpParameters:f});case 36:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"stopSending",value:(N=l(c().mark((function e(t){var r,n,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),O.debug("stopSending() [localId:%s]",t),r=this._mapSendLocalIdTrack.get(t)){e.next=5;break}throw new Error("track not found");case 5:return this._mapSendLocalIdTrack.delete(t),this._sendStream.removeTrack(r),this._pc.addStream(this._sendStream),e.next=10,this._pc.createOffer();case 10:return n=e.sent,O.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.prev=12,e.next=15,this._pc.setLocalDescription(n);case 15:e.next=23;break;case 17:if(e.prev=17,e.t0=e.catch(12),0!==this._sendStream.getTracks().length){e.next=22;break}return O.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.t0.toString()),e.abrupt("return");case 22:throw e.t0;case 23:if("stable"!==this._pc.signalingState){e.next=25;break}return e.abrupt("return");case 25:return o={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",o),e.next=29,this._pc.setRemoteDescription(o);case 29:case"end":return e.stop()}}),e,this,[[12,17]])}))),function(e){return N.apply(this,arguments)})},{key:"pauseSending",value:(A=l(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return A.apply(this,arguments)})},{key:"resumeSending",value:(M=l(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return M.apply(this,arguments)})},{key:"replaceTrack",value:(I=l(c().mark((function e(t,r){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new w.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return I.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(D=l(c().mark((function e(t,r){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new w.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return D.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(L=l(c().mark((function e(t,r){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new w.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return L.apply(this,arguments)})},{key:"getSenderStats",value:(j=l(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new w.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return j.apply(this,arguments)})},{key:"sendDataChannel",value:(C=l(c().mark((function e(t){var r,n,o,i,a,s,u,l,p,f,d,h,v;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,o=t.maxRetransmits,i=t.label,a=t.protocol,this.assertSendDirection(),s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmitTime:n,maxRetransmits:o,protocol:a},O.debug("sendDataChannel() [options:%o]",s),u=this._pc.createDataChannel(i,s),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%E.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(l=e.sent,p=g.parse(l.sdp),f=p.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this.setupTransport({localDtlsRole:null!==(d=this._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:p});case 15:return O.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=18,this._pc.setLocalDescription(l);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:f}),h={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=23,this._pc.setRemoteDescription(h);case 23:this._hasDataChannelMediaSection=!0;case 24:return v={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits},e.abrupt("return",{dataChannel:u,sctpStreamParameters:v});case 26:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"receive",value:(T=l(c().mark((function e(t){var r,n,i,a,s,u,l,p,f,d,h,v,m,y,b,w,S,x,R,P,E=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=[],n=new Map,i=o(t);try{for(i.s();!(a=i.n()).done;)s=a.value,u=s.trackId,l=s.kind,p=s.rtpParameters,O.debug("receive() [trackId:%s, kind:%s]",u,l),f=l,d=s.streamId||p.rtcp.cname,O.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),d+="-hack-".concat(_.generateRandomNumber()),n.set(u,d),this._remoteSdp.receive({mid:f,kind:l,offerRtpParameters:p,streamId:d,trackId:u})}catch(e){i.e(e)}finally{i.f()}return h={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",h),e.next=9,this._pc.setRemoteDescription(h);case 9:return e.next=11,this._pc.createAnswer();case 11:v=e.sent,m=g.parse(v.sdp),y=o(t),e.prev=14,w=c().mark((function e(){var t,r,n,o,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=b.value,r=t.kind,n=t.rtpParameters,o=r,i=m.media.find((function(e){return String(e.mid)===o})),k.applyCodecParameters({offerRtpParameters:n,answerMediaObject:i});case 5:case"end":return e.stop()}}),e)})),y.s();case 17:if((b=y.n()).done){e.next=21;break}return e.delegateYield(w(),"t0",19);case 19:e.next=17;break;case 21:e.next=26;break;case 23:e.prev=23,e.t1=e.catch(14),y.e(e.t1);case 26:return e.prev=26,y.f(),e.finish(26);case 29:if(v={type:"answer",sdp:g.write(m)},this._transportReady){e.next=33;break}return e.next=33,this.setupTransport({localDtlsRole:null!==(S=this._forcedLocalDtlsRole)&&void 0!==S?S:"client",localSdpObject:m});case 33:return O.debug("receive() | calling pc.setLocalDescription() [answer:%o]",v),e.next=36,this._pc.setLocalDescription(v);case 36:x=o(t),e.prev=37,P=c().mark((function e(){var t,o,i,a,s,u,l,p,f;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=R.value,o=t.kind,i=t.trackId,a=t.rtpParameters,s=i,u=o,l=n.get(i),p=E._pc.getRemoteStreams().find((function(e){return e.id===l})),f=p.getTrackById(s)){e.next=9;break}throw new Error("remote track not found");case 9:E._mapRecvLocalIdInfo.set(s,{mid:u,rtpParameters:a}),r.push({localId:s,track:f});case 11:case"end":return e.stop()}}),e)})),x.s();case 40:if((R=x.n()).done){e.next=44;break}return e.delegateYield(P(),"t2",42);case 42:e.next=40;break;case 44:e.next=49;break;case 46:e.prev=46,e.t3=e.catch(37),x.e(e.t3);case 49:return e.prev=49,x.f(),e.finish(49);case 52:return e.abrupt("return",r);case 53:case"end":return e.stop()}}),e,this,[[14,23,26,29],[37,46,49,52]])}))),function(e){return T.apply(this,arguments)})},{key:"stopReceiving",value:(R=l(c().mark((function e(t){var r,n,i,a,s,u,l,p;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=o(t);try{for(r.s();!(n=r.n()).done;)i=n.value,O.debug("stopReceiving() [localId:%s]",i),a=this._mapRecvLocalIdInfo.get(i)||{},s=a.mid,u=a.rtpParameters,this._mapRecvLocalIdInfo.delete(i),this._remoteSdp.planBStopReceiving({mid:s,offerRtpParameters:u})}catch(e){r.e(e)}finally{r.f()}return l={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),e.next=7,this._pc.setRemoteDescription(l);case 7:return e.next=9,this._pc.createAnswer();case 9:return p=e.sent,O.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",p),e.next=13,this._pc.setLocalDescription(p);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return R.apply(this,arguments)})},{key:"pauseReceiving",value:(b=l(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return b.apply(this,arguments)})},{key:"resumeReceiving",value:(y=l(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return y.apply(this,arguments)})},{key:"getReceiverStats",value:(m=l(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new w.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return m.apply(this,arguments)})},{key:"receiveDataChannel",value:(v=l(c().mark((function e(t){var r,n,o,i,a,s,u,l,p,f,d,h,v;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,o=t.protocol,this.assertRecvDirection(),i=r.streamId,a=r.ordered,s=r.maxPacketLifeTime,u=r.maxRetransmits,l={negotiated:!0,id:i,ordered:a,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:u,protocol:o},O.debug("receiveDataChannel() [options:%o]",l),p=this._pc.createDataChannel(n,l),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),f={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=12,this._pc.setRemoteDescription(f);case 12:return e.next=14,this._pc.createAnswer();case 14:if(d=e.sent,this._transportReady){e.next=19;break}return v=g.parse(d.sdp),e.next=19,this.setupTransport({localDtlsRole:null!==(h=this._forcedLocalDtlsRole)&&void 0!==h?h:"client",localSdpObject:v});case 19:return O.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),e.next=22,this._pc.setLocalDescription(d);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:p});case 24:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"setupTransport",value:(u=l(c().mark((function e(t){var r,n,o,i=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=g.parse(this._pc.localDescription.sdp)),(o=k.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,new Promise((function(e,t){i.safeEmit("@connect",{dtlsParameters:o},e,t)}));case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}],i=[{key:"createFactory",value:function(){return function(){return new Y}}}],r&&p(t.prototype,r),i&&p(t,i),Object.defineProperty(t,"prototype",{writable:!1}),Y}(R.HandlerInterface);t.ReactNative=T},2295:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw a}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a.apply(this,arguments)}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){var n,o,i;n=e,o=t,i=r[t],(o=d(o))in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(){u=function(){return t};var e,t={},r=Object.prototype,o=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,a=Object.create(o.prototype),s=new L(n||[]);return i(a,"_invoke",{value:E(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var h="suspendedStart",v="suspendedYield",m="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};p(S,s,(function(){return this}));var k=Object.getPrototypeOf,x=k&&k(k(D([])));x&&x!==r&&o.call(x,s)&&(S=x);var R=_.prototype=b.prototype=Object.create(S);function P(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(i,a,s,c){var u=d(e[i],e,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==n(p)&&o.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,c)}))}c(u.arg)}var a;i(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function E(t,r,n){var o=h;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function r(){for(;++i<t.length;)if(o.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=_,i(R,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:w,configurable:!0}),w.displayName=p(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,p(e,l,"GeneratorFunction")),e.prototype=Object.create(R),e},t.awrap=function(e){return{__await:e}},P(O.prototype),p(O.prototype,c,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new O(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},P(R),p(R,l,"Generator"),p(R,s,(function(){return this})),p(R,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function l(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function p(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){l(i,n,o,a,s,"next",e)}function s(e){l(i,n,o,a,s,"throw",e)}a(void 0)}))}}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,d(n.key),n)}}function d(e){var t=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===n(t)?t:String(t)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}var m=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),y=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),g=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&m(t,e,r);return y(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ReactNativeUnifiedPlan=void 0;var b=g(r(9652)),w=r(1916),_=g(r(5234)),S=g(r(6059)),k=g(r(5388)),x=g(r(8538)),R=g(r(337)),P=r(6020),O=r(3018),E=r(9196),T=r(9975),C=new w.Logger("ReactNativeUnifiedPlan"),j={OS:1024,MIS:1024},L=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(H,e);var t,r,i,s,l,d,m,y,g,w,O,L,D,I,M,A,N,F,B,G,V,U,q,z,W,K,Y=(W=H,K=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=v(W);if(K){var r=v(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function H(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,H),(e=Y.call(this))._closed=!1,e._mapMidTransceiver=new Map,e._sendStream=new MediaStream,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=H,r=[{key:"name",get:function(){return"ReactNativeUnifiedPlan"}},{key:"close",value:function(){if(C.debug("close()"),!this._closed){if(this._closed=!0,this._sendStream.release(!1),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}}},{key:"getNativeRtpCapabilities",value:(z=p(u().mark((function e(){var t,r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"}),e.prev=2,t.addTransceiver("audio"),t.addTransceiver("video"),e.next=7,t.createOffer();case 7:r=e.sent;try{t.close()}catch(e){}return n=b.parse(r.sdp),o=k.extractRtpCapabilities({sdpObject:n}),R.addNackSuppportForOpus(o),e.abrupt("return",o);case 15:e.prev=15,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 19:case"end":return e.stop()}}),e,null,[[2,15]])}))),function(){return z.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(q=p(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:j});case 2:case"end":return e.stop()}}),e)}))),function(){return q.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,o=e.iceCandidates,i=e.dtlsParameters,a=e.sctpParameters,s=e.iceServers,u=e.iceTransportPolicy,l=e.additionalSettings,p=e.proprietaryConstraints,f=e.extendedRtpCapabilities;this.assertNotClosed(),C.debug("run()"),this._direction=r,this._remoteSdp=new E.RemoteSdp({iceParameters:n,iceCandidates:o,dtlsParameters:i,sctpParameters:a}),this._sendingRtpParametersByKind={audio:S.getSendingRtpParameters("audio",f),video:S.getSendingRtpParameters("video",f)},this._sendingRemoteRtpParametersByKind={audio:S.getSendingRemoteRtpParameters("audio",f),video:S.getSendingRemoteRtpParameters("video",f)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection(c({iceServers:s||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},l),p),this._pc.addEventListener("icegatheringstatechange",(function(){t.emit("@icegatheringstatechange",t._pc.iceGatheringState)})),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(function(){t.emit("@connectionstatechange",t._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(function(){switch(C.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:(U=p(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertNotClosed(),C.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return U.apply(this,arguments)})},{key:"restartIce",value:(V=p(u().mark((function e(t){var r,n,o,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),C.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=5;break}return e.abrupt("return");case 5:if("send"!==this._direction){e.next=18;break}return e.next=8,this._pc.createOffer({iceRestart:!0});case 8:return r=e.sent,C.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=12,this._pc.setLocalDescription(r);case 12:return n={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=16,this._pc.setRemoteDescription(n);case 16:e.next=28;break;case 18:return o={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",o),e.next=22,this._pc.setRemoteDescription(o);case 22:return e.next=24,this._pc.createAnswer();case 24:return i=e.sent,C.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),e.next=28,this._pc.setLocalDescription(i);case 28:case"end":return e.stop()}}),e,this)}))),function(e){return V.apply(this,arguments)})},{key:"getTransportStats",value:(G=p(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.assertNotClosed(),e.abrupt("return",this._pc.getStats());case 2:case"end":return e.stop()}}),e,this)}))),function(){return G.apply(this,arguments)})},{key:"send",value:(B=p(u().mark((function e(t){var r,n,i,s,c,l,p,f,d,h,v,m,y,g,w,R,P,O,E,j,L;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.track,i=t.encodings,s=t.codecOptions,c=t.codec,this.assertNotClosed(),this.assertSendDirection(),C.debug("send() [kind:%s, track.id:%s]",n.kind,n.id),i&&i.length>1&&i.forEach((function(e,t){e.rid="r".concat(t)})),(l=_.clone(this._sendingRtpParametersByKind[n.kind])).codecs=S.reduceCodecs(l.codecs,c),(p=_.clone(this._sendingRemoteRtpParametersByKind[n.kind])).codecs=S.reduceCodecs(p.codecs,c),f=this._remoteSdp.getNextMediaSectionIdx(),d=this._pc.addTransceiver(n,{direction:"sendonly",streams:[this._sendStream],sendEncodings:i}),e.next=13,this._pc.createOffer();case 13:if(h=e.sent,v=b.parse(h.sdp),this._transportReady){e.next=18;break}return e.next=18,this.setupTransport({localDtlsRole:null!==(y=this._forcedLocalDtlsRole)&&void 0!==y?y:"client",localSdpObject:v});case 18:return g=!1,w=(0,T.parse)((i||[{}])[0].scalabilityMode),i&&1===i.length&&w.spatialLayers>1&&"video/vp9"===l.codecs[0].mimeType.toLowerCase()&&(C.debug("send() | enabling legacy simulcast for VP9 SVC"),g=!0,v=b.parse(h.sdp),m=v.media[f.idx],x.addLegacySimulcast({offerMediaObject:m,numStreams:w.spatialLayers}),h={type:"offer",sdp:b.write(v)}),C.debug("send() | calling pc.setLocalDescription() [offer:%o]",h),e.next=24,this._pc.setLocalDescription(h);case 24:if((R=null!==(r=d.mid)&&void 0!==r?r:void 0)||C.warn("send() | missing transceiver.mid (bug in react-native-webrtc, using a workaround"),l.mid=R,v=b.parse(this._pc.localDescription.sdp),m=v.media[f.idx],l.rtcp.cname=k.getCname({offerMediaObject:m}),i?1===i.length?(a((P=x.getRtpEncodings({offerMediaObject:m}))[0],i[0]),g&&(P=[P[0]]),l.encodings=P):l.encodings=i:l.encodings=x.getRtpEncodings({offerMediaObject:m}),l.encodings.length>1&&("video/vp8"===l.codecs[0].mimeType.toLowerCase()||"video/h264"===l.codecs[0].mimeType.toLowerCase())){O=o(l.encodings);try{for(O.s();!(E=O.n()).done;)(j=E.value).scalabilityMode?j.scalabilityMode="L1T".concat(w.temporalLayers):j.scalabilityMode="L1T3"}catch(e){O.e(e)}finally{O.f()}}return this._remoteSdp.send({offerMediaObject:m,reuseMid:f.reuseMid,offerRtpParameters:l,answerRtpParameters:p,codecOptions:s,extmapAllowMixed:!0}),L={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("send() | calling pc.setRemoteDescription() [answer:%o]",L),e.next=37,this._pc.setRemoteDescription(L);case 37:return R||(R=d.mid,l.mid=R),this._mapMidTransceiver.set(R,d),e.abrupt("return",{localId:R,rtpParameters:l,rtpSender:d.sender});case 40:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"stopSending",value:(F=p(u().mark((function e(t){var r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),!this._closed){e.next=3;break}return e.abrupt("return");case 3:if(C.debug("stopSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=7;break}throw new Error("associated RTCRtpTransceiver not found");case 7:if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch(e){}return e.next=13,this._pc.createOffer();case 13:return n=e.sent,C.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=17,this._pc.setLocalDescription(n);case 17:return o={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",o),e.next=21,this._pc.setRemoteDescription(o);case 21:this._mapMidTransceiver.delete(t);case 22:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"pauseSending",value:(N=p(u().mark((function e(t){var r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),C.debug("pauseSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return r.direction="inactive",this._remoteSdp.pauseMediaSection(t),e.next=10,this._pc.createOffer();case 10:return n=e.sent,C.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=14,this._pc.setLocalDescription(n);case 14:return o={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",o),e.next=18,this._pc.setRemoteDescription(o);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return N.apply(this,arguments)})},{key:"resumeSending",value:(A=p(u().mark((function e(t){var r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),C.debug("resumeSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t),this._remoteSdp.resumeSendingMediaSection(t),r){e.next=7;break}throw new Error("associated RTCRtpTransceiver not found");case 7:return r.direction="sendonly",e.next=10,this._pc.createOffer();case 10:return n=e.sent,C.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=14,this._pc.setLocalDescription(n);case 14:return o={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",o),e.next=18,this._pc.setRemoteDescription(o);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"replaceTrack",value:(M=p(u().mark((function e(t,r){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),r?C.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):C.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapMidTransceiver.get(t)){e.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return e.next=8,n.sender.replaceTrack(r);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return M.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(I=p(u().mark((function e(t,r){var n,o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),C.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapMidTransceiver.get(t)){e.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return(o=n.sender.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=10,n.sender.setParameters(o);case 10:return this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings),e.next=13,this._pc.createOffer();case 13:return i=e.sent,C.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",i),e.next=17,this._pc.setLocalDescription(i);case 17:return a={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),e.next=21,this._pc.setRemoteDescription(a);case 21:case"end":return e.stop()}}),e,this)}))),function(e,t){return I.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(D=p(u().mark((function e(t,r){var n,o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),C.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapMidTransceiver.get(t)){e.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return(o=n.sender.getParameters()).encodings.forEach((function(e,t){o.encodings[t]=c(c({},e),r)})),e.next=10,n.sender.setParameters(o);case 10:return this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings),e.next=13,this._pc.createOffer();case 13:return i=e.sent,C.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",i),e.next=17,this._pc.setLocalDescription(i);case 17:return a={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),e.next=21,this._pc.setRemoteDescription(a);case 21:case"end":return e.stop()}}),e,this)}))),function(e,t){return D.apply(this,arguments)})},{key:"getSenderStats",value:(L=p(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return e.abrupt("return",r.sender.getStats());case 6:case"end":return e.stop()}}),e,this)}))),function(e){return L.apply(this,arguments)})},{key:"sendDataChannel",value:(O=p(u().mark((function e(t){var r,n,o,i,a,s,c,l,p,f,d,h,v;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,o=t.maxRetransmits,i=t.label,a=t.protocol,this.assertNotClosed(),this.assertSendDirection(),s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmits:o,protocol:a},C.debug("sendDataChannel() [options:%o]",s),c=this._pc.createDataChannel(i,s),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%j.MIS,this._hasDataChannelMediaSection){e.next=25;break}return e.next=10,this._pc.createOffer();case 10:if(l=e.sent,p=b.parse(l.sdp),f=p.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=16;break}return e.next=16,this.setupTransport({localDtlsRole:null!==(d=this._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:p});case 16:return C.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=19,this._pc.setLocalDescription(l);case 19:return this._remoteSdp.sendSctpAssociation({offerMediaObject:f}),h={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=24,this._pc.setRemoteDescription(h);case 24:this._hasDataChannelMediaSection=!0;case 25:return v={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits},e.abrupt("return",{dataChannel:c,sctpStreamParameters:v});case 27:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"receive",value:(w=p(u().mark((function e(t){var r,n,i,a,s,c,l,p,f,d,h,v,m,y,g,w,_,S,x,R,P=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertNotClosed(),this.assertRecvDirection(),r=[],n=new Map,i=o(t);try{for(i.s();!(a=i.n()).done;)s=a.value,c=s.trackId,l=s.kind,p=s.rtpParameters,f=s.streamId,C.debug("receive() [trackId:%s, kind:%s]",c,l),d=p.mid||String(this._mapMidTransceiver.size),n.set(c,d),this._remoteSdp.receive({mid:d,kind:l,offerRtpParameters:p,streamId:f||p.rtcp.cname,trackId:c})}catch(e){i.e(e)}finally{i.f()}return h={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",h),e.next=10,this._pc.setRemoteDescription(h);case 10:return e.next=12,this._pc.createAnswer();case 12:v=e.sent,m=b.parse(v.sdp),y=o(t),e.prev=15,w=u().mark((function e(){var t,r,o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=g.value,r=t.trackId,o=t.rtpParameters,i=n.get(r),a=m.media.find((function(e){return String(e.mid)===i})),k.applyCodecParameters({offerRtpParameters:o,answerMediaObject:a});case 5:case"end":return e.stop()}}),e)})),y.s();case 18:if((g=y.n()).done){e.next=22;break}return e.delegateYield(w(),"t0",20);case 20:e.next=18;break;case 22:e.next=27;break;case 24:e.prev=24,e.t1=e.catch(15),y.e(e.t1);case 27:return e.prev=27,y.f(),e.finish(27);case 30:if(v={type:"answer",sdp:b.write(m)},this._transportReady){e.next=34;break}return e.next=34,this.setupTransport({localDtlsRole:null!==(_=this._forcedLocalDtlsRole)&&void 0!==_?_:"client",localSdpObject:m});case 34:return C.debug("receive() | calling pc.setLocalDescription() [answer:%o]",v),e.next=37,this._pc.setLocalDescription(v);case 37:S=o(t),e.prev=38,R=u().mark((function e(){var t,o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=x.value,o=t.trackId,i=n.get(o),a=P._pc.getTransceivers().find((function(e){return e.mid===i}))){e.next=8;break}throw new Error("new RTCRtpTransceiver not found");case 8:P._mapMidTransceiver.set(i,a),r.push({localId:i,track:a.receiver.track,rtpReceiver:a.receiver});case 10:case"end":return e.stop()}}),e)})),S.s();case 41:if((x=S.n()).done){e.next=45;break}return e.delegateYield(R(),"t2",43);case 43:e.next=41;break;case 45:e.next=50;break;case 47:e.prev=47,e.t3=e.catch(38),S.e(e.t3);case 50:return e.prev=50,S.f(),e.finish(50);case 53:return e.abrupt("return",r);case 54:case"end":return e.stop()}}),e,this,[[15,24,27,30],[38,47,50,53]])}))),function(e){return w.apply(this,arguments)})},{key:"stopReceiving",value:(g=p(u().mark((function e(t){var r,n,i,a,s,c,l,p,f;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertRecvDirection(),!this._closed){e.next=3;break}return e.abrupt("return");case 3:r=o(t),e.prev=4,r.s();case 6:if((n=r.n()).done){e.next=15;break}if(i=n.value,C.debug("stopReceiving() [localId:%s]",i),a=this._mapMidTransceiver.get(i)){e.next=12;break}throw new Error("associated RTCRtpTransceiver not found");case 12:this._remoteSdp.closeMediaSection(a.mid);case 13:e.next=6;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(4),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:return s={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.next=27,this._pc.setRemoteDescription(s);case 27:return e.next=29,this._pc.createAnswer();case 29:return c=e.sent,C.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",c),e.next=33,this._pc.setLocalDescription(c);case 33:l=o(t);try{for(l.s();!(p=l.n()).done;)f=p.value,this._mapMidTransceiver.delete(f)}catch(e){l.e(e)}finally{l.f()}case 35:case"end":return e.stop()}}),e,this,[[4,17,20,23]])}))),function(e){return g.apply(this,arguments)})},{key:"pauseReceiving",value:(y=p(u().mark((function e(t){var r,n,i,a,s,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertNotClosed(),this.assertRecvDirection(),r=o(t),e.prev=3,r.s();case 5:if((n=r.n()).done){e.next=15;break}if(i=n.value,C.debug("pauseReceiving() [localId:%s]",i),a=this._mapMidTransceiver.get(i)){e.next=11;break}throw new Error("associated RTCRtpTransceiver not found");case 11:a.direction="inactive",this._remoteSdp.pauseMediaSection(i);case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:return s={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.next=27,this._pc.setRemoteDescription(s);case 27:return e.next=29,this._pc.createAnswer();case 29:return c=e.sent,C.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",c),e.next=33,this._pc.setLocalDescription(c);case 33:case"end":return e.stop()}}),e,this,[[3,17,20,23]])}))),function(e){return y.apply(this,arguments)})},{key:"resumeReceiving",value:(m=p(u().mark((function e(t){var r,n,i,a,s,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertNotClosed(),this.assertRecvDirection(),r=o(t),e.prev=3,r.s();case 5:if((n=r.n()).done){e.next=15;break}if(i=n.value,C.debug("resumeReceiving() [localId:%s]",i),a=this._mapMidTransceiver.get(i)){e.next=11;break}throw new Error("associated RTCRtpTransceiver not found");case 11:a.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i);case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:return s={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.next=27,this._pc.setRemoteDescription(s);case 27:return e.next=29,this._pc.createAnswer();case 29:return c=e.sent,C.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",c),e.next=33,this._pc.setLocalDescription(c);case 33:case"end":return e.stop()}}),e,this,[[3,17,20,23]])}))),function(e){return m.apply(this,arguments)})},{key:"getReceiverStats",value:(d=p(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertRecvDirection(),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return e.abrupt("return",r.receiver.getStats());case 6:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"receiveDataChannel",value:(l=p(u().mark((function e(t){var r,n,o,i,a,s,c,l,p,f,d,h,v;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,o=t.protocol,this.assertNotClosed(),this.assertRecvDirection(),i=r.streamId,a=r.ordered,s=r.maxPacketLifeTime,c=r.maxRetransmits,l={negotiated:!0,id:i,ordered:a,maxPacketLifeTime:s,maxRetransmits:c,protocol:o},C.debug("receiveDataChannel() [options:%o]",l),p=this._pc.createDataChannel(n,l),this._hasDataChannelMediaSection){e.next=24;break}return this._remoteSdp.receiveSctpAssociation(),f={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=13,this._pc.setRemoteDescription(f);case 13:return e.next=15,this._pc.createAnswer();case 15:if(d=e.sent,this._transportReady){e.next=20;break}return v=b.parse(d.sdp),e.next=20,this.setupTransport({localDtlsRole:null!==(h=this._forcedLocalDtlsRole)&&void 0!==h?h:"client",localSdpObject:v});case 20:return C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),e.next=23,this._pc.setLocalDescription(d);case 23:this._hasDataChannelMediaSection=!0;case 24:return e.abrupt("return",{dataChannel:p});case 25:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"setupTransport",value:(s=p(u().mark((function e(t){var r,n,o,i=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=b.parse(this._pc.localDescription.sdp)),(o=k.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,new Promise((function(e,t){i.safeEmit("@connect",{dtlsParameters:o},e,t)}));case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"assertNotClosed",value:function(){if(this._closed)throw new P.InvalidStateError("method called in a closed handler")}},{key:"assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}],i=[{key:"createFactory",value:function(){return function(){return new H}}}],r&&f(t.prototype,r),i&&f(t,i),Object.defineProperty(t,"prototype",{writable:!1}),H}(O.HandlerInterface);t.ReactNativeUnifiedPlan=L},6893:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw a}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a.apply(this,arguments)}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){var n,o,i;n=e,o=t,i=r[t],(o=d(o))in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(){u=function(){return t};var e,t={},r=Object.prototype,o=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,a=Object.create(o.prototype),s=new L(n||[]);return i(a,"_invoke",{value:E(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var h="suspendedStart",v="suspendedYield",m="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};p(S,s,(function(){return this}));var k=Object.getPrototypeOf,x=k&&k(k(D([])));x&&x!==r&&o.call(x,s)&&(S=x);var R=_.prototype=b.prototype=Object.create(S);function P(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(i,a,s,c){var u=d(e[i],e,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==n(p)&&o.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,c)}))}c(u.arg)}var a;i(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function E(t,r,n){var o=h;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function r(){for(;++i<t.length;)if(o.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=_,i(R,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:w,configurable:!0}),w.displayName=p(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,p(e,l,"GeneratorFunction")),e.prototype=Object.create(R),e},t.awrap=function(e){return{__await:e}},P(O.prototype),p(O.prototype,c,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new O(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},P(R),p(R,l,"Generator"),p(R,s,(function(){return this})),p(R,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function l(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function p(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){l(i,n,o,a,s,"next",e)}function s(e){l(i,n,o,a,s,"throw",e)}a(void 0)}))}}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,d(n.key),n)}}function d(e){var t=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===n(t)?t:String(t)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}var m=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),y=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),g=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&m(t,e,r);return y(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Safari11=void 0;var b=g(r(9652)),w=r(1916),_=g(r(5234)),S=g(r(6059)),k=g(r(5388)),x=g(r(5156)),R=r(3018),P=r(9196),O=new w.Logger("Safari11"),E={OS:1024,MIS:1024},T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(W,e);var t,r,i,s,l,d,m,y,g,w,R,T,C,j,L,D,I,M,A,N,F,B,G,V,U,q,z=(U=W,q=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=v(U);if(q){var r=v(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function W(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,W),(e=z.call(this))._sendStream=new MediaStream,e._mapSendLocalIdRtpSender=new Map,e._nextSendLocalId=0,e._mapRecvLocalIdInfo=new Map,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=W,r=[{key:"name",get:function(){return"Safari11"}},{key:"close",value:function(){if(O.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}},{key:"getNativeRtpCapabilities",value:(V=p(u().mark((function e(){var t,r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),e.prev=2,e.next=5,t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 5:r=e.sent;try{t.close()}catch(e){}return n=b.parse(r.sdp),o=k.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",o);case 12:e.prev=12,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[2,12]])}))),function(){return V.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(G=p(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:E});case 2:case"end":return e.stop()}}),e)}))),function(){return G.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,o=e.iceCandidates,i=e.dtlsParameters,a=e.sctpParameters,s=e.iceServers,u=e.iceTransportPolicy,l=e.additionalSettings,p=e.proprietaryConstraints,f=e.extendedRtpCapabilities;O.debug("run()"),this._direction=r,this._remoteSdp=new P.RemoteSdp({iceParameters:n,iceCandidates:o,dtlsParameters:i,sctpParameters:a,planB:!0}),this._sendingRtpParametersByKind={audio:S.getSendingRtpParameters("audio",f),video:S.getSendingRtpParameters("video",f)},this._sendingRemoteRtpParametersByKind={audio:S.getSendingRemoteRtpParameters("audio",f),video:S.getSendingRemoteRtpParameters("video",f)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection(c({iceServers:s||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},l),p),this._pc.addEventListener("icegatheringstatechange",(function(){t.emit("@icegatheringstatechange",t._pc.iceGatheringState)})),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(function(){t.emit("@connectionstatechange",t._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(function(){switch(O.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:(B=p(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:O.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"restartIce",value:(F=p(u().mark((function e(t){var r,n,o,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,O.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return o={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",o),e.next=21,this._pc.setRemoteDescription(o);case 21:return e.next=23,this._pc.createAnswer();case 23:return i=e.sent,O.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),e.next=27,this._pc.setLocalDescription(i);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"getTransportStats",value:(N=p(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return N.apply(this,arguments)})},{key:"send",value:(A=p(u().mark((function e(t){var r,n,i,s,c,l,p,f,d,h,v,m,y,g,w,R;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,n=t.encodings,i=t.codecOptions,s=t.codec,this.assertSendDirection(),O.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),s&&O.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(r),this._pc.addTrack(r,this._sendStream),e.next=8,this._pc.createOffer();case 8:if(c=e.sent,l=b.parse(c.sdp),(f=_.clone(this._sendingRtpParametersByKind[r.kind])).codecs=S.reduceCodecs(f.codecs),(d=_.clone(this._sendingRemoteRtpParametersByKind[r.kind])).codecs=S.reduceCodecs(d.codecs),this._transportReady){e.next=17;break}return e.next=17,this.setupTransport({localDtlsRole:null!==(h=this._forcedLocalDtlsRole)&&void 0!==h?h:"client",localSdpObject:l});case 17:return"video"===r.kind&&n&&n.length>1&&(O.debug("send() | enabling simulcast"),l=b.parse(c.sdp),p=l.media.find((function(e){return"video"===e.type})),x.addLegacySimulcast({offerMediaObject:p,track:r,numStreams:n.length}),c={type:"offer",sdp:b.write(l)}),O.debug("send() | calling pc.setLocalDescription() [offer:%o]",c),e.next=21,this._pc.setLocalDescription(c);case 21:if(l=b.parse(this._pc.localDescription.sdp),p=l.media.find((function(e){return e.type===r.kind})),f.rtcp.cname=k.getCname({offerMediaObject:p}),f.encodings=x.getRtpEncodings({offerMediaObject:p,track:r}),n)for(v=0;v<f.encodings.length;++v)n[v]&&a(f.encodings[v],n[v]);if(f.encodings.length>1&&"video/vp8"===f.codecs[0].mimeType.toLowerCase()){m=o(f.encodings);try{for(m.s();!(y=m.n()).done;)y.value.scalabilityMode="L1T3"}catch(e){m.e(e)}finally{m.f()}}return this._remoteSdp.send({offerMediaObject:p,offerRtpParameters:f,answerRtpParameters:d,codecOptions:i}),g={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("send() | calling pc.setRemoteDescription() [answer:%o]",g),e.next=32,this._pc.setRemoteDescription(g);case 32:return w=String(this._nextSendLocalId),this._nextSendLocalId++,R=this._pc.getSenders().find((function(e){return e.track===r})),this._mapSendLocalIdRtpSender.set(w,R),e.abrupt("return",{localId:w,rtpParameters:f,rtpSender:R});case 37:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"stopSending",value:(M=p(u().mark((function e(t){var r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),r=this._mapSendLocalIdRtpSender.get(t)){e.next=4;break}throw new Error("associated RTCRtpSender not found");case 4:return r.track&&this._sendStream.removeTrack(r.track),this._mapSendLocalIdRtpSender.delete(t),e.next=8,this._pc.createOffer();case 8:return n=e.sent,O.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.prev=10,e.next=13,this._pc.setLocalDescription(n);case 13:e.next=21;break;case 15:if(e.prev=15,e.t0=e.catch(10),0!==this._sendStream.getTracks().length){e.next=20;break}return O.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.t0.toString()),e.abrupt("return");case 20:throw e.t0;case 21:if("stable"!==this._pc.signalingState){e.next=23;break}return e.abrupt("return");case 23:return o={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",o),e.next=27,this._pc.setRemoteDescription(o);case 27:case"end":return e.stop()}}),e,this,[[10,15]])}))),function(e){return M.apply(this,arguments)})},{key:"pauseSending",value:(I=p(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return I.apply(this,arguments)})},{key:"resumeSending",value:(D=p(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return D.apply(this,arguments)})},{key:"replaceTrack",value:(L=p(u().mark((function e(t,r){var n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),r?O.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):O.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return o=n.track,e.next=8,n.replaceTrack(r);case 8:o&&this._sendStream.removeTrack(o),r&&this._sendStream.addTrack(r);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return L.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(j=p(u().mark((function e(t,r){var n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),O.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return(o=n.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=9,n.setParameters(o);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return j.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(C=p(u().mark((function e(t,r){var n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),O.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return(o=n.getParameters()).encodings.forEach((function(e,t){o.encodings[t]=c(c({},e),r)})),e.next=9,n.setParameters(o);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return C.apply(this,arguments)})},{key:"getSenderStats",value:(T=p(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),r=this._mapSendLocalIdRtpSender.get(t)){e.next=4;break}throw new Error("associated RTCRtpSender not found");case 4:return e.abrupt("return",r.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"sendDataChannel",value:(R=p(u().mark((function e(t){var r,n,o,i,a,s,c,l,p,f,d,h,v;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,o=t.maxRetransmits,i=t.label,a=t.protocol,this.assertSendDirection(),s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmits:o,protocol:a},O.debug("sendDataChannel() [options:%o]",s),c=this._pc.createDataChannel(i,s),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%E.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(l=e.sent,p=b.parse(l.sdp),f=p.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this.setupTransport({localDtlsRole:null!==(d=this._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:p});case 15:return O.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=18,this._pc.setLocalDescription(l);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:f}),h={type:"answer",sdp:this._remoteSdp.getSdp()},O.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=23,this._pc.setRemoteDescription(h);case 23:this._hasDataChannelMediaSection=!0;case 24:return v={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits},e.abrupt("return",{dataChannel:c,sctpStreamParameters:v});case 26:case"end":return e.stop()}}),e,this)}))),function(e){return R.apply(this,arguments)})},{key:"receive",value:(w=p(u().mark((function e(t){var r,n,i,a,s,c,l,p,f,d,h,v,m,y,g,w,_,S,x,R=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=[],n=o(t);try{for(n.s();!(i=n.n()).done;)a=i.value,s=a.trackId,c=a.kind,l=a.rtpParameters,p=a.streamId,O.debug("receive() [trackId:%s, kind:%s]",s,c),f=c,this._remoteSdp.receive({mid:f,kind:c,offerRtpParameters:l,streamId:p||l.rtcp.cname,trackId:s})}catch(e){n.e(e)}finally{n.f()}return d={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",d),e.next=8,this._pc.setRemoteDescription(d);case 8:return e.next=10,this._pc.createAnswer();case 10:h=e.sent,v=b.parse(h.sdp),m=o(t),e.prev=13,g=u().mark((function e(){var t,r,n,o,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=y.value,r=t.kind,n=t.rtpParameters,o=r,i=v.media.find((function(e){return String(e.mid)===o})),k.applyCodecParameters({offerRtpParameters:n,answerMediaObject:i});case 5:case"end":return e.stop()}}),e)})),m.s();case 16:if((y=m.n()).done){e.next=20;break}return e.delegateYield(g(),"t0",18);case 18:e.next=16;break;case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(13),m.e(e.t1);case 25:return e.prev=25,m.f(),e.finish(25);case 28:if(h={type:"answer",sdp:b.write(v)},this._transportReady){e.next=32;break}return e.next=32,this.setupTransport({localDtlsRole:null!==(w=this._forcedLocalDtlsRole)&&void 0!==w?w:"client",localSdpObject:v});case 32:return O.debug("receive() | calling pc.setLocalDescription() [answer:%o]",h),e.next=35,this._pc.setLocalDescription(h);case 35:_=o(t),e.prev=36,x=u().mark((function e(){var t,n,o,i,a,s,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=S.value,n=t.kind,o=t.trackId,i=t.rtpParameters,a=n,s=o,c=R._pc.getReceivers().find((function(e){return e.track&&e.track.id===s}))){e.next=7;break}throw new Error("new RTCRtpReceiver not");case 7:R._mapRecvLocalIdInfo.set(s,{mid:a,rtpParameters:i,rtpReceiver:c}),r.push({localId:s,track:c.track,rtpReceiver:c});case 9:case"end":return e.stop()}}),e)})),_.s();case 39:if((S=_.n()).done){e.next=43;break}return e.delegateYield(x(),"t2",41);case 41:e.next=39;break;case 43:e.next=48;break;case 45:e.prev=45,e.t3=e.catch(36),_.e(e.t3);case 48:return e.prev=48,_.f(),e.finish(48);case 51:return e.abrupt("return",r);case 52:case"end":return e.stop()}}),e,this,[[13,22,25,28],[36,45,48,51]])}))),function(e){return w.apply(this,arguments)})},{key:"stopReceiving",value:(g=p(u().mark((function e(t){var r,n,i,a,s,c,l,p;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertRecvDirection(),r=o(t);try{for(r.s();!(n=r.n()).done;)i=n.value,O.debug("stopReceiving() [localId:%s]",i),a=this._mapRecvLocalIdInfo.get(i)||{},s=a.mid,c=a.rtpParameters,this._mapRecvLocalIdInfo.delete(i),this._remoteSdp.planBStopReceiving({mid:s,offerRtpParameters:c})}catch(e){r.e(e)}finally{r.f()}return l={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",l),e.next=7,this._pc.setRemoteDescription(l);case 7:return e.next=9,this._pc.createAnswer();case 9:return p=e.sent,O.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",p),e.next=13,this._pc.setLocalDescription(p);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"getReceiverStats",value:(y=p(u().mark((function e(t){var r,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertRecvDirection(),r=this._mapRecvLocalIdInfo.get(t)||{},n=r.rtpReceiver){e.next=4;break}throw new Error("associated RTCRtpReceiver not found");case 4:return e.abrupt("return",n.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"pauseReceiving",value:(m=p(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return m.apply(this,arguments)})},{key:"resumeReceiving",value:(d=p(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return d.apply(this,arguments)})},{key:"receiveDataChannel",value:(l=p(u().mark((function e(t){var r,n,o,i,a,s,c,l,p,f,d,h,v;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,o=t.protocol,this.assertRecvDirection(),i=r.streamId,a=r.ordered,s=r.maxPacketLifeTime,c=r.maxRetransmits,l={negotiated:!0,id:i,ordered:a,maxPacketLifeTime:s,maxRetransmits:c,protocol:o},O.debug("receiveDataChannel() [options:%o]",l),p=this._pc.createDataChannel(n,l),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),f={type:"offer",sdp:this._remoteSdp.getSdp()},O.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=12,this._pc.setRemoteDescription(f);case 12:return e.next=14,this._pc.createAnswer();case 14:if(d=e.sent,this._transportReady){e.next=19;break}return v=b.parse(d.sdp),e.next=19,this.setupTransport({localDtlsRole:null!==(h=this._forcedLocalDtlsRole)&&void 0!==h?h:"client",localSdpObject:v});case 19:return O.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),e.next=22,this._pc.setLocalDescription(d);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:p});case 24:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"setupTransport",value:(s=p(u().mark((function e(t){var r,n,o,i=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=b.parse(this._pc.localDescription.sdp)),(o=k.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,new Promise((function(e,t){i.safeEmit("@connect",{dtlsParameters:o},e,t)}));case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}],i=[{key:"createFactory",value:function(){return function(){return new W}}}],r&&f(t.prototype,r),i&&f(t,i),Object.defineProperty(t,"prototype",{writable:!1}),W}(R.HandlerInterface);t.Safari11=T},3614:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw a}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a.apply(this,arguments)}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){var n,o,i;n=e,o=t,i=r[t],(o=d(o))in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(){u=function(){return t};var e,t={},r=Object.prototype,o=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,a=Object.create(o.prototype),s=new L(n||[]);return i(a,"_invoke",{value:E(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var h="suspendedStart",v="suspendedYield",m="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};p(S,s,(function(){return this}));var k=Object.getPrototypeOf,x=k&&k(k(D([])));x&&x!==r&&o.call(x,s)&&(S=x);var R=_.prototype=b.prototype=Object.create(S);function P(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(i,a,s,c){var u=d(e[i],e,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==n(p)&&o.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,c)}))}c(u.arg)}var a;i(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function E(t,r,n){var o=h;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function r(){for(;++i<t.length;)if(o.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=_,i(R,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:w,configurable:!0}),w.displayName=p(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,p(e,l,"GeneratorFunction")),e.prototype=Object.create(R),e},t.awrap=function(e){return{__await:e}},P(O.prototype),p(O.prototype,c,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new O(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},P(R),p(R,l,"Generator"),p(R,s,(function(){return this})),p(R,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function l(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function p(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){l(i,n,o,a,s,"next",e)}function s(e){l(i,n,o,a,s,"throw",e)}a(void 0)}))}}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,d(n.key),n)}}function d(e){var t=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===n(t)?t:String(t)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}var m=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),y=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),g=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&m(t,e,r);return y(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Safari12=void 0;var b=g(r(9652)),w=r(1916),_=g(r(5234)),S=g(r(6059)),k=g(r(5388)),x=g(r(8538)),R=g(r(337)),P=r(6020),O=r(3018),E=r(9196),T=r(9975),C=new w.Logger("Safari12"),j={OS:1024,MIS:1024},L=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(H,e);var t,r,i,s,l,d,m,y,g,w,O,L,D,I,M,A,N,F,B,G,V,U,q,z,W,K,Y=(W=H,K=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=v(W);if(K){var r=v(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function H(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,H),(e=Y.call(this))._closed=!1,e._mapMidTransceiver=new Map,e._sendStream=new MediaStream,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=H,r=[{key:"name",get:function(){return"Safari12"}},{key:"close",value:function(){if(C.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}}},{key:"getNativeRtpCapabilities",value:(z=p(u().mark((function e(){var t,r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),e.prev=2,t.addTransceiver("audio"),t.addTransceiver("video"),e.next=7,t.createOffer();case 7:r=e.sent;try{t.close()}catch(e){}return n=b.parse(r.sdp),o=k.extractRtpCapabilities({sdpObject:n}),R.addNackSuppportForOpus(o),e.abrupt("return",o);case 15:e.prev=15,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 19:case"end":return e.stop()}}),e,null,[[2,15]])}))),function(){return z.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(q=p(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:j});case 2:case"end":return e.stop()}}),e)}))),function(){return q.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,o=e.iceCandidates,i=e.dtlsParameters,a=e.sctpParameters,s=e.iceServers,u=e.iceTransportPolicy,l=e.additionalSettings,p=e.proprietaryConstraints,f=e.extendedRtpCapabilities;this.assertNotClosed(),C.debug("run()"),this._direction=r,this._remoteSdp=new E.RemoteSdp({iceParameters:n,iceCandidates:o,dtlsParameters:i,sctpParameters:a}),this._sendingRtpParametersByKind={audio:S.getSendingRtpParameters("audio",f),video:S.getSendingRtpParameters("video",f)},this._sendingRemoteRtpParametersByKind={audio:S.getSendingRemoteRtpParameters("audio",f),video:S.getSendingRemoteRtpParameters("video",f)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection(c({iceServers:s||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},l),p),this._pc.addEventListener("icegatheringstatechange",(function(){t.emit("@icegatheringstatechange",t._pc.iceGatheringState)})),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(function(){t.emit("@connectionstatechange",t._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(function(){switch(C.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:(U=p(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertNotClosed(),C.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return U.apply(this,arguments)})},{key:"restartIce",value:(V=p(u().mark((function e(t){var r,n,o,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),C.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=5;break}return e.abrupt("return");case 5:if("send"!==this._direction){e.next=18;break}return e.next=8,this._pc.createOffer({iceRestart:!0});case 8:return r=e.sent,C.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=12,this._pc.setLocalDescription(r);case 12:return n={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=16,this._pc.setRemoteDescription(n);case 16:e.next=28;break;case 18:return o={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",o),e.next=22,this._pc.setRemoteDescription(o);case 22:return e.next=24,this._pc.createAnswer();case 24:return i=e.sent,C.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),e.next=28,this._pc.setLocalDescription(i);case 28:case"end":return e.stop()}}),e,this)}))),function(e){return V.apply(this,arguments)})},{key:"getTransportStats",value:(G=p(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.assertNotClosed(),e.abrupt("return",this._pc.getStats());case 2:case"end":return e.stop()}}),e,this)}))),function(){return G.apply(this,arguments)})},{key:"send",value:(B=p(u().mark((function e(t){var r,n,i,s,c,l,p,f,d,h,v,m,y,g,w,R,P,O,E;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,n=t.encodings,i=t.codecOptions,s=t.codec,this.assertNotClosed(),this.assertSendDirection(),C.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),(c=_.clone(this._sendingRtpParametersByKind[r.kind])).codecs=S.reduceCodecs(c.codecs,s),(l=_.clone(this._sendingRemoteRtpParametersByKind[r.kind])).codecs=S.reduceCodecs(l.codecs,s),p=this._remoteSdp.getNextMediaSectionIdx(),f=this._pc.addTransceiver(r,{direction:"sendonly",streams:[this._sendStream]}),e.next=12,this._pc.createOffer();case 12:if(d=e.sent,h=b.parse(d.sdp),this._transportReady){e.next=17;break}return e.next=17,this.setupTransport({localDtlsRole:null!==(m=this._forcedLocalDtlsRole)&&void 0!==m?m:"client",localSdpObject:h});case 17:return y=(0,T.parse)((n||[{}])[0].scalabilityMode),n&&n.length>1&&(C.debug("send() | enabling legacy simulcast"),h=b.parse(d.sdp),v=h.media[p.idx],x.addLegacySimulcast({offerMediaObject:v,numStreams:n.length}),d={type:"offer",sdp:b.write(h)}),C.debug("send() | calling pc.setLocalDescription() [offer:%o]",d),e.next=22,this._pc.setLocalDescription(d);case 22:if(g=f.mid,c.mid=g,h=b.parse(this._pc.localDescription.sdp),v=h.media[p.idx],c.rtcp.cname=k.getCname({offerMediaObject:v}),c.encodings=x.getRtpEncodings({offerMediaObject:v}),n)for(w=0;w<c.encodings.length;++w)n[w]&&a(c.encodings[w],n[w]);if(c.encodings.length>1&&("video/vp8"===c.codecs[0].mimeType.toLowerCase()||"video/h264"===c.codecs[0].mimeType.toLowerCase())){R=o(c.encodings);try{for(R.s();!(P=R.n()).done;)(O=P.value).scalabilityMode?O.scalabilityMode="L1T".concat(y.temporalLayers):O.scalabilityMode="L1T3"}catch(e){R.e(e)}finally{R.f()}}return this._remoteSdp.send({offerMediaObject:v,reuseMid:p.reuseMid,offerRtpParameters:c,answerRtpParameters:l,codecOptions:i}),E={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("send() | calling pc.setRemoteDescription() [answer:%o]",E),e.next=35,this._pc.setRemoteDescription(E);case 35:return this._mapMidTransceiver.set(g,f),e.abrupt("return",{localId:g,rtpParameters:c,rtpSender:f.sender});case 37:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"stopSending",value:(F=p(u().mark((function e(t){var r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertSendDirection(),!this._closed){e.next=3;break}return e.abrupt("return");case 3:if(C.debug("stopSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=7;break}throw new Error("associated RTCRtpTransceiver not found");case 7:if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch(e){}return e.next=13,this._pc.createOffer();case 13:return n=e.sent,C.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=17,this._pc.setLocalDescription(n);case 17:return o={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",o),e.next=21,this._pc.setRemoteDescription(o);case 21:this._mapMidTransceiver.delete(t);case 22:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"pauseSending",value:(N=p(u().mark((function e(t){var r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),C.debug("pauseSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return r.direction="inactive",this._remoteSdp.pauseMediaSection(t),e.next=10,this._pc.createOffer();case 10:return n=e.sent,C.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=14,this._pc.setLocalDescription(n);case 14:return o={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",o),e.next=18,this._pc.setRemoteDescription(o);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return N.apply(this,arguments)})},{key:"resumeSending",value:(A=p(u().mark((function e(t){var r,n,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),C.debug("resumeSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return r.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(t),e.next=10,this._pc.createOffer();case 10:return n=e.sent,C.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=14,this._pc.setLocalDescription(n);case 14:return o={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",o),e.next=18,this._pc.setRemoteDescription(o);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"replaceTrack",value:(M=p(u().mark((function e(t,r){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),r?C.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):C.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapMidTransceiver.get(t)){e.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return e.next=8,n.sender.replaceTrack(r);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return M.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(I=p(u().mark((function e(t,r){var n,o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),C.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapMidTransceiver.get(t)){e.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return(o=n.sender.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=10,n.sender.setParameters(o);case 10:return this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings),e.next=13,this._pc.createOffer();case 13:return i=e.sent,C.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",i),e.next=17,this._pc.setLocalDescription(i);case 17:return a={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),e.next=21,this._pc.setRemoteDescription(a);case 21:case"end":return e.stop()}}),e,this)}))),function(e,t){return I.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(D=p(u().mark((function e(t,r){var n,o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),C.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapMidTransceiver.get(t)){e.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return(o=n.sender.getParameters()).encodings.forEach((function(e,t){o.encodings[t]=c(c({},e),r)})),e.next=10,n.sender.setParameters(o);case 10:return this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings),e.next=13,this._pc.createOffer();case 13:return i=e.sent,C.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",i),e.next=17,this._pc.setLocalDescription(i);case 17:return a={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),e.next=21,this._pc.setRemoteDescription(a);case 21:case"end":return e.stop()}}),e,this)}))),function(e,t){return D.apply(this,arguments)})},{key:"getSenderStats",value:(L=p(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertSendDirection(),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return e.abrupt("return",r.sender.getStats());case 6:case"end":return e.stop()}}),e,this)}))),function(e){return L.apply(this,arguments)})},{key:"sendDataChannel",value:(O=p(u().mark((function e(t){var r,n,o,i,a,s,c,l,p,f,d,h,v;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,o=t.maxRetransmits,i=t.label,a=t.protocol,this.assertNotClosed(),this.assertSendDirection(),s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmits:o,protocol:a},C.debug("sendDataChannel() [options:%o]",s),c=this._pc.createDataChannel(i,s),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%j.MIS,this._hasDataChannelMediaSection){e.next=25;break}return e.next=10,this._pc.createOffer();case 10:if(l=e.sent,p=b.parse(l.sdp),f=p.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=16;break}return e.next=16,this.setupTransport({localDtlsRole:null!==(d=this._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:p});case 16:return C.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=19,this._pc.setLocalDescription(l);case 19:return this._remoteSdp.sendSctpAssociation({offerMediaObject:f}),h={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=24,this._pc.setRemoteDescription(h);case 24:this._hasDataChannelMediaSection=!0;case 25:return v={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits},e.abrupt("return",{dataChannel:c,sctpStreamParameters:v});case 27:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"receive",value:(w=p(u().mark((function e(t){var r,n,i,a,s,c,l,p,f,d,h,v,m,y,g,w,_,S,x,R,P=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertNotClosed(),this.assertRecvDirection(),r=[],n=new Map,i=o(t);try{for(i.s();!(a=i.n()).done;)s=a.value,c=s.trackId,l=s.kind,p=s.rtpParameters,f=s.streamId,C.debug("receive() [trackId:%s, kind:%s]",c,l),d=p.mid||String(this._mapMidTransceiver.size),n.set(c,d),this._remoteSdp.receive({mid:d,kind:l,offerRtpParameters:p,streamId:f||p.rtcp.cname,trackId:c})}catch(e){i.e(e)}finally{i.f()}return h={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",h),e.next=10,this._pc.setRemoteDescription(h);case 10:return e.next=12,this._pc.createAnswer();case 12:v=e.sent,m=b.parse(v.sdp),y=o(t),e.prev=15,w=u().mark((function e(){var t,r,o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=g.value,r=t.trackId,o=t.rtpParameters,i=n.get(r),a=m.media.find((function(e){return String(e.mid)===i})),k.applyCodecParameters({offerRtpParameters:o,answerMediaObject:a});case 5:case"end":return e.stop()}}),e)})),y.s();case 18:if((g=y.n()).done){e.next=22;break}return e.delegateYield(w(),"t0",20);case 20:e.next=18;break;case 22:e.next=27;break;case 24:e.prev=24,e.t1=e.catch(15),y.e(e.t1);case 27:return e.prev=27,y.f(),e.finish(27);case 30:if(v={type:"answer",sdp:b.write(m)},this._transportReady){e.next=34;break}return e.next=34,this.setupTransport({localDtlsRole:null!==(_=this._forcedLocalDtlsRole)&&void 0!==_?_:"client",localSdpObject:m});case 34:return C.debug("receive() | calling pc.setLocalDescription() [answer:%o]",v),e.next=37,this._pc.setLocalDescription(v);case 37:S=o(t),e.prev=38,R=u().mark((function e(){var t,o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=x.value,o=t.trackId,i=n.get(o),a=P._pc.getTransceivers().find((function(e){return e.mid===i}))){e.next=6;break}throw new Error("new RTCRtpTransceiver not found");case 6:P._mapMidTransceiver.set(i,a),r.push({localId:i,track:a.receiver.track,rtpReceiver:a.receiver});case 8:case"end":return e.stop()}}),e)})),S.s();case 41:if((x=S.n()).done){e.next=45;break}return e.delegateYield(R(),"t2",43);case 43:e.next=41;break;case 45:e.next=50;break;case 47:e.prev=47,e.t3=e.catch(38),S.e(e.t3);case 50:return e.prev=50,S.f(),e.finish(50);case 53:return e.abrupt("return",r);case 54:case"end":return e.stop()}}),e,this,[[15,24,27,30],[38,47,50,53]])}))),function(e){return w.apply(this,arguments)})},{key:"stopReceiving",value:(g=p(u().mark((function e(t){var r,n,i,a,s,c,l,p,f;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertRecvDirection(),!this._closed){e.next=3;break}return e.abrupt("return");case 3:r=o(t),e.prev=4,r.s();case 6:if((n=r.n()).done){e.next=15;break}if(i=n.value,C.debug("stopReceiving() [localId:%s]",i),a=this._mapMidTransceiver.get(i)){e.next=12;break}throw new Error("associated RTCRtpTransceiver not found");case 12:this._remoteSdp.closeMediaSection(a.mid);case 13:e.next=6;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(4),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:return s={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.next=27,this._pc.setRemoteDescription(s);case 27:return e.next=29,this._pc.createAnswer();case 29:return c=e.sent,C.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",c),e.next=33,this._pc.setLocalDescription(c);case 33:l=o(t);try{for(l.s();!(p=l.n()).done;)f=p.value,this._mapMidTransceiver.delete(f)}catch(e){l.e(e)}finally{l.f()}case 35:case"end":return e.stop()}}),e,this,[[4,17,20,23]])}))),function(e){return g.apply(this,arguments)})},{key:"pauseReceiving",value:(y=p(u().mark((function e(t){var r,n,i,a,s,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertNotClosed(),this.assertRecvDirection(),r=o(t),e.prev=3,r.s();case 5:if((n=r.n()).done){e.next=15;break}if(i=n.value,C.debug("pauseReceiving() [localId:%s]",i),a=this._mapMidTransceiver.get(i)){e.next=11;break}throw new Error("associated RTCRtpTransceiver not found");case 11:a.direction="inactive",this._remoteSdp.pauseMediaSection(i);case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:return s={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.next=27,this._pc.setRemoteDescription(s);case 27:return e.next=29,this._pc.createAnswer();case 29:return c=e.sent,C.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",c),e.next=33,this._pc.setLocalDescription(c);case 33:case"end":return e.stop()}}),e,this,[[3,17,20,23]])}))),function(e){return y.apply(this,arguments)})},{key:"resumeReceiving",value:(m=p(u().mark((function e(t){var r,n,i,a,s,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assertNotClosed(),this.assertRecvDirection(),r=o(t),e.prev=3,r.s();case 5:if((n=r.n()).done){e.next=15;break}if(i=n.value,C.debug("resumeReceiving() [localId:%s]",i),a=this._mapMidTransceiver.get(i)){e.next=11;break}throw new Error("associated RTCRtpTransceiver not found");case 11:a.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i);case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:return s={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.next=27,this._pc.setRemoteDescription(s);case 27:return e.next=29,this._pc.createAnswer();case 29:return c=e.sent,C.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",c),e.next=33,this._pc.setLocalDescription(c);case 33:case"end":return e.stop()}}),e,this,[[3,17,20,23]])}))),function(e){return m.apply(this,arguments)})},{key:"getReceiverStats",value:(d=p(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.assertNotClosed(),this.assertRecvDirection(),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return e.abrupt("return",r.receiver.getStats());case 6:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"receiveDataChannel",value:(l=p(u().mark((function e(t){var r,n,o,i,a,s,c,l,p,f,d,h,v;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,o=t.protocol,this.assertNotClosed(),this.assertRecvDirection(),i=r.streamId,a=r.ordered,s=r.maxPacketLifeTime,c=r.maxRetransmits,l={negotiated:!0,id:i,ordered:a,maxPacketLifeTime:s,maxRetransmits:c,protocol:o},C.debug("receiveDataChannel() [options:%o]",l),p=this._pc.createDataChannel(n,l),this._hasDataChannelMediaSection){e.next=24;break}return this._remoteSdp.receiveSctpAssociation(),f={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=13,this._pc.setRemoteDescription(f);case 13:return e.next=15,this._pc.createAnswer();case 15:if(d=e.sent,this._transportReady){e.next=20;break}return v=b.parse(d.sdp),e.next=20,this.setupTransport({localDtlsRole:null!==(h=this._forcedLocalDtlsRole)&&void 0!==h?h:"client",localSdpObject:v});case 20:return C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),e.next=23,this._pc.setLocalDescription(d);case 23:this._hasDataChannelMediaSection=!0;case 24:return e.abrupt("return",{dataChannel:p});case 25:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"setupTransport",value:(s=p(u().mark((function e(t){var r,n,o,i=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=b.parse(this._pc.localDescription.sdp)),(o=k.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,new Promise((function(e,t){i.safeEmit("@connect",{dtlsParameters:o},e,t)}));case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"assertNotClosed",value:function(){if(this._closed)throw new P.InvalidStateError("method called in a closed handler")}},{key:"assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}],i=[{key:"createFactory",value:function(){return function(){return new H}}}],r&&f(t.prototype,r),i&&f(t,i),Object.defineProperty(t,"prototype",{writable:!1}),H}(O.HandlerInterface);t.Safari12=L},6819:function(e,t,r){"use strict";function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.mangleRtpParameters=t.getCapabilities=void 0;var c=s(r(5234));t.getCapabilities=function(){var e,t,r=RTCRtpReceiver.getCapabilities(),o=c.clone(r),i=n(null!==(e=o.codecs)&&void 0!==e?e:[]);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.channels=a.numChannels,delete a.numChannels,a.mimeType=a.mimeType||"".concat(a.kind,"/").concat(a.name),a.parameters){var s=a.parameters;s.apt&&(s.apt=Number(s.apt)),s["packetization-mode"]&&(s["packetization-mode"]=Number(s["packetization-mode"]))}var u,l=n(a.rtcpFeedback||[]);try{for(l.s();!(u=l.n()).done;){var p=u.value;p.parameter||(p.parameter="")}}catch(e){l.e(e)}finally{l.f()}}}catch(e){i.e(e)}finally{i.f()}return o},t.mangleRtpParameters=function(e){var t=c.clone(e);t.mid&&(t.muxId=t.mid,delete t.mid);var r,o=n(t.codecs);try{for(o.s();!(r=o.n()).done;){var i=r.value;i.channels&&(i.numChannels=i.channels,delete i.channels),i.mimeType&&!i.name&&(i.name=i.mimeType.split("/")[1]),delete i.mimeType}}catch(e){o.e(e)}finally{o.f()}return t}},337:(e,t)=>{"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Object.defineProperty(t,"__esModule",{value:!0}),t.addNackSuppportForOpus=void 0,t.addNackSuppportForOpus=function(e){var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw a}}}}(e.codecs||[]);try{for(n.s();!(t=n.n()).done;){var o,i=t.value;"audio/opus"!==i.mimeType.toLowerCase()&&"audio/multiopus"!==i.mimeType.toLowerCase()||null!==(o=i.rtcpFeedback)&&void 0!==o&&o.some((function(e){return"nack"===e.type&&!e.parameter}))||(i.rtcpFeedback||(i.rtcpFeedback=[]),i.rtcpFeedback.push({type:"nack"}))}}catch(e){n.e(e)}finally{n.f()}}},560:function(e,t,r){"use strict";function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&o(e,t)}function o(e,t){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},o(e,t)}function i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=a(e);if(t){var o=a(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===s(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function c(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==s(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===s(o)?o:String(o)),n)}var o}function f(e,t,r){return t&&p(e.prototype,t),r&&p(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var d=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),h=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),v=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&d(t,e,r);return h(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.OfferMediaSection=t.AnswerMediaSection=t.MediaSection=void 0;var m=v(r(9652)),y=v(r(5234)),g=function(){function e(t){var r=t.iceParameters,n=t.iceCandidates,o=t.dtlsParameters,i=t.planB,a=void 0!==i&&i;if(l(this,e),this._mediaObject={},this._planB=a,r&&this.setIceParameters(r),n){this._mediaObject.candidates=[];var s,u=c(n);try{for(u.s();!(s=u.n()).done;){var p=s.value,f={component:1};f.foundation=p.foundation,f.ip=p.ip,f.port=p.port,f.priority=p.priority,f.transport=p.protocol,f.type=p.type,p.tcpType&&(f.tcptype=p.tcpType),this._mediaObject.candidates.push(f)}}catch(e){u.e(e)}finally{u.f()}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}o&&this.setDtlsRole(o.role)}return f(e,[{key:"mid",get:function(){return String(this._mediaObject.mid)}},{key:"closed",get:function(){return 0===this._mediaObject.port}},{key:"getObject",value:function(){return this._mediaObject}},{key:"setIceParameters",value:function(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}},{key:"pause",value:function(){this._mediaObject.direction="inactive"}},{key:"disable",value:function(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}},{key:"close",value:function(){this.disable(),this._mediaObject.port=0}}]),e}();t.MediaSection=g;var b=function(e){n(r,e);var t=i(r);function r(e){var n,o=e.iceParameters,i=e.iceCandidates,a=e.dtlsParameters,s=e.sctpParameters,u=e.plainRtpParameters,p=e.planB,f=void 0!==p&&p,d=e.offerMediaObject,h=e.offerRtpParameters,v=e.answerRtpParameters,m=e.codecOptions,g=e.extmapAllowMixed,b=void 0!==g&&g;switch(l(this,r),(n=t.call(this,{iceParameters:o,iceCandidates:i,dtlsParameters:a,planB:f}))._mediaObject.mid=String(d.mid),n._mediaObject.type=d.type,n._mediaObject.protocol=d.protocol,u?(n._mediaObject.connection={ip:u.ip,version:u.ipVersion},n._mediaObject.port=u.port):(n._mediaObject.connection={ip:"127.0.0.1",version:4},n._mediaObject.port=7),d.type){case"audio":case"video":n._mediaObject.direction="recvonly",n._mediaObject.rtp=[],n._mediaObject.rtcpFb=[],n._mediaObject.fmtp=[];var w,S=c(v.codecs);try{var k=function(){var e,t,r=w.value,o={payload:r.payloadType,codec:_(r),rate:r.clockRate};r.channels>1&&(o.encoding=r.channels),n._mediaObject.rtp.push(o);var i=null!==(e=y.clone(r.parameters))&&void 0!==e?e:{},a=null!==(t=y.clone(r.rtcpFeedback))&&void 0!==t?t:[];if(m){var s=m.opusStereo,u=m.opusFec,l=m.opusDtx,p=m.opusMaxPlaybackRate,f=m.opusMaxAverageBitrate,d=m.opusPtime,v=m.opusNack,g=m.videoGoogleStartBitrate,b=m.videoGoogleMaxBitrate,S=m.videoGoogleMinBitrate,k=h.codecs.find((function(e){return e.payloadType===r.payloadType}));switch(r.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":void 0!==s&&(k.parameters["sprop-stereo"]=s?1:0,i.stereo=s?1:0),void 0!==u&&(k.parameters.useinbandfec=u?1:0,i.useinbandfec=u?1:0),void 0!==l&&(k.parameters.usedtx=l?1:0,i.usedtx=l?1:0),void 0!==p&&(i.maxplaybackrate=p),void 0!==f&&(i.maxaveragebitrate=f),void 0!==d&&(k.parameters.ptime=d,i.ptime=d),v||(k.rtcpFeedback=k.rtcpFeedback.filter((function(e){return"nack"!==e.type||e.parameter})),a=a.filter((function(e){return"nack"!==e.type||e.parameter})));break;case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":void 0!==g&&(i["x-google-start-bitrate"]=g),void 0!==b&&(i["x-google-max-bitrate"]=b),void 0!==S&&(i["x-google-min-bitrate"]=S)}}for(var x={payload:r.payloadType,config:""},R=0,P=Object.keys(i);R<P.length;R++){var O=P[R];x.config&&(x.config+=";"),x.config+="".concat(O,"=").concat(i[O])}x.config&&n._mediaObject.fmtp.push(x);var E,T=c(a);try{for(T.s();!(E=T.n()).done;){var C=E.value;n._mediaObject.rtcpFb.push({payload:r.payloadType,type:C.type,subtype:C.parameter})}}catch(e){T.e(e)}finally{T.f()}};for(S.s();!(w=S.n()).done;)k()}catch(e){S.e(e)}finally{S.f()}n._mediaObject.payloads=v.codecs.map((function(e){return e.payloadType})).join(" "),n._mediaObject.ext=[];var x,R=c(v.headerExtensions);try{var P=function(){var e=x.value;if(!(d.ext||[]).some((function(t){return t.uri===e.uri})))return 1;n._mediaObject.ext.push({uri:e.uri,value:e.id})};for(R.s();!(x=R.n()).done;)P()}catch(e){R.e(e)}finally{R.f()}if(b&&"extmap-allow-mixed"===d.extmapAllowMixed&&(n._mediaObject.extmapAllowMixed="extmap-allow-mixed"),d.simulcast){n._mediaObject.simulcast={dir1:"recv",list1:d.simulcast.list1},n._mediaObject.rids=[];var O,E=c(d.rids||[]);try{for(E.s();!(O=E.n()).done;){var T=O.value;"send"===T.direction&&n._mediaObject.rids.push({id:T.id,direction:"recv"})}}catch(e){E.e(e)}finally{E.f()}}else if(d.simulcast_03){n._mediaObject.simulcast_03={value:d.simulcast_03.value.replace(/send/g,"recv")},n._mediaObject.rids=[];var C,j=c(d.rids||[]);try{for(j.s();!(C=j.n()).done;){var L=C.value;"send"===L.direction&&n._mediaObject.rids.push({id:L.id,direction:"recv"})}}catch(e){j.e(e)}finally{j.f()}}n._mediaObject.rtcpMux="rtcp-mux",n._mediaObject.rtcpRsize="rtcp-rsize",n._planB&&"video"===n._mediaObject.type&&(n._mediaObject.xGoogleFlag="conference");break;case"application":"number"==typeof d.sctpPort?(n._mediaObject.payloads="webrtc-datachannel",n._mediaObject.sctpPort=s.port,n._mediaObject.maxMessageSize=s.maxMessageSize):d.sctpmap&&(n._mediaObject.payloads=s.port,n._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:s.port,maxMessageSize:s.maxMessageSize})}return n}return f(r,[{key:"setDtlsRole",value:function(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}},{key:"resume",value:function(){this._mediaObject.direction="recvonly"}},{key:"muxSimulcastStreams",value:function(e){if(this._mediaObject.simulcast&&this._mediaObject.simulcast.list1){var t,r={},n=c(e);try{for(n.s();!(t=n.n()).done;){var o=t.value;o.rid&&(r[o.rid]=o)}}catch(e){n.e(e)}finally{n.f()}var i,a=this._mediaObject.simulcast.list1,s=m.parseSimulcastStreamList(a),u=c(s);try{for(u.s();!(i=u.n()).done;){var l,p=c(i.value);try{for(p.s();!(l=p.n()).done;){var f,d=l.value;d.paused=!(null!==(f=r[d.scid])&&void 0!==f&&f.active)}}catch(e){p.e(e)}finally{p.f()}}}catch(e){u.e(e)}finally{u.f()}this._mediaObject.simulcast.list1=s.map((function(e){return e.map((function(e){return"".concat(e.paused?"~":"").concat(e.scid)})).join(",")})).join(";")}}}]),r}(g);t.AnswerMediaSection=b;var w=function(e){n(r,e);var t=i(r);function r(e){var n,o=e.iceParameters,i=e.iceCandidates,a=e.dtlsParameters,s=e.sctpParameters,u=e.plainRtpParameters,p=e.planB,f=void 0!==p&&p,d=e.mid,h=e.kind,v=e.offerRtpParameters,m=e.streamId,y=e.trackId,g=e.oldDataChannelSpec,b=void 0!==g&&g;switch(l(this,r),(n=t.call(this,{iceParameters:o,iceCandidates:i,dtlsParameters:a,planB:f}))._mediaObject.mid=String(d),n._mediaObject.type=h,u?(n._mediaObject.connection={ip:u.ip,version:u.ipVersion},n._mediaObject.protocol="RTP/AVP",n._mediaObject.port=u.port):(n._mediaObject.connection={ip:"127.0.0.1",version:4},n._mediaObject.protocol=s?"UDP/DTLS/SCTP":"UDP/TLS/RTP/SAVPF",n._mediaObject.port=7),h){case"audio":case"video":n._mediaObject.direction="sendonly",n._mediaObject.rtp=[],n._mediaObject.rtcpFb=[],n._mediaObject.fmtp=[],n._planB||(n._mediaObject.msid="".concat(m||"-"," ").concat(y));var w,S=c(v.codecs);try{for(S.s();!(w=S.n()).done;){var k=w.value,x={payload:k.payloadType,codec:_(k),rate:k.clockRate};k.channels>1&&(x.encoding=k.channels),n._mediaObject.rtp.push(x);for(var R={payload:k.payloadType,config:""},P=0,O=Object.keys(k.parameters);P<O.length;P++){var E=O[P];R.config&&(R.config+=";"),R.config+="".concat(E,"=").concat(k.parameters[E])}R.config&&n._mediaObject.fmtp.push(R);var T,C=c(k.rtcpFeedback);try{for(C.s();!(T=C.n()).done;){var j=T.value;n._mediaObject.rtcpFb.push({payload:k.payloadType,type:j.type,subtype:j.parameter})}}catch(e){C.e(e)}finally{C.f()}}}catch(e){S.e(e)}finally{S.f()}n._mediaObject.payloads=v.codecs.map((function(e){return e.payloadType})).join(" "),n._mediaObject.ext=[];var L,D=c(v.headerExtensions);try{for(D.s();!(L=D.n()).done;){var I=L.value;n._mediaObject.ext.push({uri:I.uri,value:I.id})}}catch(e){D.e(e)}finally{D.f()}n._mediaObject.rtcpMux="rtcp-mux",n._mediaObject.rtcpRsize="rtcp-rsize";var M=v.encodings[0],A=M.ssrc,N=M.rtx&&M.rtx.ssrc?M.rtx.ssrc:void 0;n._mediaObject.ssrcs=[],n._mediaObject.ssrcGroups=[],v.rtcp.cname&&n._mediaObject.ssrcs.push({id:A,attribute:"cname",value:v.rtcp.cname}),n._planB&&n._mediaObject.ssrcs.push({id:A,attribute:"msid",value:"".concat(m||"-"," ").concat(y)}),N&&(v.rtcp.cname&&n._mediaObject.ssrcs.push({id:N,attribute:"cname",value:v.rtcp.cname}),n._planB&&n._mediaObject.ssrcs.push({id:N,attribute:"msid",value:"".concat(m||"-"," ").concat(y)}),n._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(A," ").concat(N)}));break;case"application":b?(n._mediaObject.payloads=s.port,n._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:s.port,maxMessageSize:s.maxMessageSize}):(n._mediaObject.payloads="webrtc-datachannel",n._mediaObject.sctpPort=s.port,n._mediaObject.maxMessageSize=s.maxMessageSize)}return n}return f(r,[{key:"setDtlsRole",value:function(e){this._mediaObject.setup="actpass"}},{key:"resume",value:function(){this._mediaObject.direction="sendonly"}},{key:"planBReceive",value:function(e){var t,r=this,n=e.offerRtpParameters,o=e.streamId,i=e.trackId,a=n.encodings[0],s=a.ssrc,u=a.rtx&&a.rtx.ssrc?a.rtx.ssrc:void 0,l=this._mediaObject.payloads.split(" "),p=c(n.codecs);try{for(p.s();!(t=p.n()).done;){var f=t.value;if(!l.includes(String(f.payloadType))){var d={payload:f.payloadType,codec:_(f),rate:f.clockRate};f.channels>1&&(d.encoding=f.channels),this._mediaObject.rtp.push(d);for(var h={payload:f.payloadType,config:""},v=0,m=Object.keys(f.parameters);v<m.length;v++){var y=m[v];h.config&&(h.config+=";"),h.config+="".concat(y,"=").concat(f.parameters[y])}h.config&&this._mediaObject.fmtp.push(h);var g,b=c(f.rtcpFeedback);try{for(b.s();!(g=b.n()).done;){var w=g.value;this._mediaObject.rtcpFb.push({payload:f.payloadType,type:w.type,subtype:w.parameter})}}catch(e){b.e(e)}finally{b.f()}}}}catch(e){p.e(e)}finally{p.f()}this._mediaObject.payloads+=" ".concat(n.codecs.filter((function(e){return!r._mediaObject.payloads.includes(e.payloadType)})).map((function(e){return e.payloadType})).join(" ")),this._mediaObject.payloads=this._mediaObject.payloads.trim(),n.rtcp.cname&&this._mediaObject.ssrcs.push({id:s,attribute:"cname",value:n.rtcp.cname}),this._mediaObject.ssrcs.push({id:s,attribute:"msid",value:"".concat(o||"-"," ").concat(i)}),u&&(n.rtcp.cname&&this._mediaObject.ssrcs.push({id:u,attribute:"cname",value:n.rtcp.cname}),this._mediaObject.ssrcs.push({id:u,attribute:"msid",value:"".concat(o||"-"," ").concat(i)}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(s," ").concat(u)}))}},{key:"planBStopReceiving",value:function(e){var t=e.offerRtpParameters.encodings[0],r=t.ssrc,n=t.rtx&&t.rtx.ssrc?t.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter((function(e){return e.id!==r&&e.id!==n})),n&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter((function(e){return e.ssrcs!=="".concat(r," ").concat(n)})))}}]),r}(g);function _(e){var t=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");return t[2]}t.OfferMediaSection=w},9196:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw a}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,i=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===n(i)?i:String(i)),o)}var i}var s=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),c=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),u=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return c(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteSdp=void 0;var l=u(r(9652)),p=r(1916),f=r(560),d=new p.Logger("RemoteSdp"),h=function(){function e(t){var r=t.iceParameters,n=t.iceCandidates,o=t.dtlsParameters,i=t.sctpParameters,a=t.plainRtpParameters,s=t.planB,c=void 0!==s&&s;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=r,this._iceCandidates=n,this._dtlsParameters=o,this._sctpParameters=i,this._plainRtpParameters=a,this._planB=c,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},r&&r.iceLite&&(this._sdpObject.icelite="ice-lite"),o){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};var u=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:o.fingerprints[u-1].algorithm,hash:o.fingerprints[u-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}a&&(this._sdpObject.origin.address=a.ip,this._sdpObject.origin.ipVer=a.ipVersion)}var t,r;return t=e,r=[{key:"updateIceParameters",value:function(e){d.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;var t,r=o(this._mediaSections);try{for(r.s();!(t=r.n()).done;)t.value.setIceParameters(e)}catch(e){r.e(e)}finally{r.f()}}},{key:"updateDtlsRole",value:function(e){d.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;var t,r=o(this._mediaSections);try{for(r.s();!(t=r.n()).done;)t.value.setDtlsRole(e)}catch(e){r.e(e)}finally{r.f()}}},{key:"getNextMediaSectionIdx",value:function(){for(var e=0;e<this._mediaSections.length;++e){var t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}},{key:"send",value:function(e){var t=e.offerMediaObject,r=e.reuseMid,n=e.offerRtpParameters,o=e.answerRtpParameters,i=e.codecOptions,a=e.extmapAllowMixed,s=void 0!==a&&a,c=new f.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:t,offerRtpParameters:n,answerRtpParameters:o,codecOptions:i,extmapAllowMixed:s});r?this._replaceMediaSection(c,r):this._midToIndex.has(c.mid)?this._replaceMediaSection(c):this._addMediaSection(c)}},{key:"receive",value:function(e){var t,r=e.mid,n=e.kind,o=e.offerRtpParameters,i=e.streamId,a=e.trackId,s=this._midToIndex.get(r);if(void 0!==s&&(t=this._mediaSections[s]),t)t.planBReceive({offerRtpParameters:o,streamId:i,trackId:a}),this._replaceMediaSection(t);else{t=new f.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:r,kind:n,offerRtpParameters:o,streamId:i,trackId:a});var c=this._mediaSections.find((function(e){return e.closed}));c?this._replaceMediaSection(t,c.mid):this._addMediaSection(t)}}},{key:"pauseMediaSection",value:function(e){this._findMediaSection(e).pause()}},{key:"resumeSendingMediaSection",value:function(e){this._findMediaSection(e).resume()}},{key:"resumeReceivingMediaSection",value:function(e){this._findMediaSection(e).resume()}},{key:"disableMediaSection",value:function(e){this._findMediaSection(e).disable()}},{key:"closeMediaSection",value:function(e){var t=this._findMediaSection(e);return e===this._firstMid?(d.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),this.disableMediaSection(e),!1):(t.close(),this._regenerateBundleMids(),!0)}},{key:"muxMediaSectionSimulcast",value:function(e,t){var r=this._findMediaSection(e);r.muxSimulcastStreams(t),this._replaceMediaSection(r)}},{key:"planBStopReceiving",value:function(e){var t=e.mid,r=e.offerRtpParameters,n=this._findMediaSection(t);n.planBStopReceiving({offerRtpParameters:r}),this._replaceMediaSection(n)}},{key:"sendSctpAssociation",value:function(e){var t=e.offerMediaObject,r=new f.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:t});this._addMediaSection(r)}},{key:"receiveSctpAssociation",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).oldDataChannelSpec,t=void 0!==e&&e,r=new f.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:t});this._addMediaSection(r)}},{key:"getSdp",value:function(){return this._sdpObject.origin.sessionVersion++,l.write(this._sdpObject)}},{key:"_addMediaSection",value:function(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}},{key:"_replaceMediaSection",value:function(e,t){if("string"==typeof t){var r=this._midToIndex.get(t);if(void 0===r)throw new Error("no media section found for reuseMid '".concat(t,"'"));var n=this._mediaSections[r];this._mediaSections[r]=e,this._midToIndex.delete(n.mid),this._midToIndex.set(e.mid,r),this._sdpObject.media[r]=e.getObject(),this._regenerateBundleMids()}else{var o=this._midToIndex.get(e.mid);if(void 0===o)throw new Error("no media section found with mid '".concat(e.mid,"'"));this._mediaSections[o]=e,this._sdpObject.media[o]=e.getObject()}}},{key:"_findMediaSection",value:function(e){var t=this._midToIndex.get(e);if(void 0===t)throw new Error("no media section found with mid '".concat(e,"'"));return this._mediaSections[t]}},{key:"_regenerateBundleMids",value:function(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter((function(e){return!e.closed})).map((function(e){return e.mid})).join(" "))}}],r&&a(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.RemoteSdp=h},5388:function(e,t,r){"use strict";function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.applyCodecParameters=t.getCname=t.extractDtlsParameters=t.extractRtpCapabilities=void 0;var c=s(r(9652));t.extractRtpCapabilities=function(e){var t,r=e.sdpObject,o=new Map,i=[],a=!1,s=!1,u=n(r.media);try{for(u.s();!(t=u.n()).done;){var l=t.value,p=l.type;switch(p){case"audio":if(a)continue;a=!0;break;case"video":if(s)continue;s=!0;break;default:continue}var f,d=n(l.rtp);try{for(d.s();!(f=d.n()).done;){var h=f.value,v={kind:p,mimeType:"".concat(p,"/").concat(h.codec),preferredPayloadType:h.payload,clockRate:h.rate,channels:h.encoding,parameters:{},rtcpFeedback:[]};o.set(v.preferredPayloadType,v)}}catch(e){d.e(e)}finally{d.f()}var m,y=n(l.fmtp||[]);try{for(y.s();!(m=y.n()).done;){var g=m.value,b=c.parseParams(g.config),w=o.get(g.payload);w&&(b&&b.hasOwnProperty("profile-level-id")&&(b["profile-level-id"]=String(b["profile-level-id"])),w.parameters=b)}}catch(e){y.e(e)}finally{y.f()}var _,S=n(l.rtcpFb||[]);try{for(S.s();!(_=S.n()).done;){var k=_.value,x={type:k.type,parameter:k.subtype};if(x.parameter||delete x.parameter,"*"!==k.payload){var R=o.get(k.payload);if(!R)continue;R.rtcpFeedback.push(x)}else{var P,O=n(o.values());try{for(O.s();!(P=O.n()).done;){var E=P.value;E.kind!==p||/.+\/rtx$/i.test(E.mimeType)||E.rtcpFeedback.push(x)}}catch(e){O.e(e)}finally{O.f()}}}}catch(e){S.e(e)}finally{S.f()}var T,C=n(l.ext||[]);try{for(C.s();!(T=C.n()).done;){var j=T.value;if(!j["encrypt-uri"]){var L={kind:p,uri:j.uri,preferredId:j.value};i.push(L)}}}catch(e){C.e(e)}finally{C.f()}}}catch(e){u.e(e)}finally{u.f()}return{codecs:Array.from(o.values()),headerExtensions:i}},t.extractDtlsParameters=function(e){var t,r=e.sdpObject,n=r.setup,o=r.fingerprint;if(!n||!o){var i,a,s=(r.media||[]).find((function(e){return 0!==e.port}));s&&(null!==(i=n)&&void 0!==i||(n=s.setup),null!==(a=o)&&void 0!==a||(o=s.fingerprint))}if(!n)throw new Error("no a=setup found at SDP session or media level");if(!o)throw new Error("no a=fingerprint found at SDP session or media level");switch(n){case"active":t="client";break;case"passive":t="server";break;case"actpass":t="auto"}return{role:t,fingerprints:[{algorithm:o.type,value:o.hash}]}},t.getCname=function(e){var t=(e.offerMediaObject.ssrcs||[]).find((function(e){return"cname"===e.attribute}));return t?t.value:""},t.applyCodecParameters=function(e){var t,r=e.offerRtpParameters,o=e.answerMediaObject,i=n(r.codecs);try{var a=function(){var e=t.value,r=e.mimeType.toLowerCase();if("audio/opus"!==r)return 0;if(!(o.rtp||[]).find((function(t){return t.payload===e.payloadType})))return 0;o.fmtp=o.fmtp||[];var n=o.fmtp.find((function(t){return t.payload===e.payloadType}));n||(n={payload:e.payloadType,config:""},o.fmtp.push(n));var i=c.parseParams(n.config);if("audio/opus"===r){var a=e.parameters["sprop-stereo"];void 0!==a&&(i.stereo=a?1:0)}n.config="";for(var s=0,u=Object.keys(i);s<u.length;s++){var l=u[s];n.config&&(n.config+=";"),n.config+="".concat(l,"=").concat(i[l])}};for(i.s();!(t=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}}},5156:(e,t)=>{"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||o(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=o(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw a}}}}function o(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Object.defineProperty(t,"__esModule",{value:!0}),t.addLegacySimulcast=t.getRtpEncodings=void 0,t.getRtpEncodings=function(e){var t,o,i=e.offerMediaObject,a=e.track,s=new Set,c=n(i.ssrcs||[]);try{for(c.s();!(o=c.n()).done;){var u=o.value;if("msid"===u.attribute&&u.value.split(" ")[1]===a.id){var l=u.id;s.add(l),t||(t=l)}}}catch(e){c.e(e)}finally{c.f()}if(0===s.size)throw new Error("a=ssrc line with msid information not found [track.id:".concat(a.id,"]"));var p,f=new Map,d=n(i.ssrcGroups||[]);try{for(d.s();!(p=d.n()).done;){var h=p.value;if("FID"===h.semantics){var v=r(h.ssrcs.split(/\s+/),2),m=v[0],y=v[1];m=Number(m),y=Number(y),s.has(m)&&(s.delete(m),s.delete(y),f.set(m,y))}}}catch(e){d.e(e)}finally{d.f()}var g,b=n(s);try{for(b.s();!(g=b.n()).done;){var w=g.value;f.set(w,null)}}catch(e){b.e(e)}finally{b.f()}var _,S=[],k=n(f);try{for(k.s();!(_=k.n()).done;){var x=r(_.value,2),R=x[0],P=x[1],O={ssrc:R};P&&(O.rtx={ssrc:P}),S.push(O)}}catch(e){k.e(e)}finally{k.f()}return S},t.addLegacySimulcast=function(e){var t,r,n,o=e.offerMediaObject,i=e.track,a=e.numStreams;if(a<=1)throw new TypeError("numStreams must be greater than 1");if(!(o.ssrcs||[]).find((function(e){return"msid"===e.attribute&&e.value.split(" ")[1]===i.id&&(t=e.id,n=e.value.split(" ")[0],!0)})))throw new Error("a=ssrc line with msid information not found [track.id:".concat(i.id,"]"));(o.ssrcGroups||[]).some((function(e){if("FID"!==e.semantics)return!1;var n=e.ssrcs.split(/\s+/);return Number(n[0])===t&&(r=Number(n[1]),!0)}));var s=o.ssrcs.find((function(e){return"cname"===e.attribute&&e.id===t}));if(!s)throw new Error("a=ssrc line with cname information not found [track.id:".concat(i.id,"]"));for(var c=s.value,u=[],l=[],p=0;p<a;++p)u.push(t+p),r&&l.push(r+p);o.ssrcGroups=o.ssrcGroups||[],o.ssrcs=o.ssrcs||[],o.ssrcGroups.push({semantics:"SIM",ssrcs:u.join(" ")});for(var f=0;f<u.length;++f){var d=u[f];o.ssrcs.push({id:d,attribute:"cname",value:c}),o.ssrcs.push({id:d,attribute:"msid",value:"".concat(n," ").concat(i.id)})}for(var h=0;h<l.length;++h){var v=u[h],m=l[h];o.ssrcs.push({id:m,attribute:"cname",value:c}),o.ssrcs.push({id:m,attribute:"msid",value:"".concat(n," ").concat(i.id)}),o.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(v," ").concat(m)})}}},8538:(e,t)=>{"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||o(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=o(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw a}}}}function o(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Object.defineProperty(t,"__esModule",{value:!0}),t.addLegacySimulcast=t.getRtpEncodings=void 0,t.getRtpEncodings=function(e){var t,o=e.offerMediaObject,i=new Set,a=n(o.ssrcs||[]);try{for(a.s();!(t=a.n()).done;){var s=t.value.id;i.add(s)}}catch(e){a.e(e)}finally{a.f()}if(0===i.size)throw new Error("no a=ssrc lines found");var c,u=new Map,l=n(o.ssrcGroups||[]);try{for(l.s();!(c=l.n()).done;){var p=c.value;if("FID"===p.semantics){var f=r(p.ssrcs.split(/\s+/),2),d=f[0],h=f[1];d=Number(d),h=Number(h),i.has(d)&&(i.delete(d),i.delete(h),u.set(d,h))}}}catch(e){l.e(e)}finally{l.f()}var v,m=n(i);try{for(m.s();!(v=m.n()).done;){var y=v.value;u.set(y,null)}}catch(e){m.e(e)}finally{m.f()}var g,b=[],w=n(u);try{for(w.s();!(g=w.n()).done;){var _=r(g.value,2),S=_[0],k=_[1],x={ssrc:S};k&&(x.rtx={ssrc:k}),b.push(x)}}catch(e){w.e(e)}finally{w.f()}return b},t.addLegacySimulcast=function(e){var t=e.offerMediaObject,n=e.numStreams;if(n<=1)throw new TypeError("numStreams must be greater than 1");var o=(t.ssrcs||[]).find((function(e){return"msid"===e.attribute}));if(!o)throw new Error("a=ssrc line with msid information not found");var i,a=r(o.value.split(" "),2),s=a[0],c=a[1],u=o.id;(t.ssrcGroups||[]).some((function(e){if("FID"!==e.semantics)return!1;var t=e.ssrcs.split(/\s+/);return Number(t[0])===u&&(i=Number(t[1]),!0)}));var l=t.ssrcs.find((function(e){return"cname"===e.attribute}));if(!l)throw new Error("a=ssrc line with cname information not found");for(var p=l.value,f=[],d=[],h=0;h<n;++h)f.push(u+h),i&&d.push(i+h);t.ssrcGroups=[],t.ssrcs=[],t.ssrcGroups.push({semantics:"SIM",ssrcs:f.join(" ")});for(var v=0;v<f.length;++v){var m=f[v];t.ssrcs.push({id:m,attribute:"cname",value:p}),t.ssrcs.push({id:m,attribute:"msid",value:"".concat(s," ").concat(c)})}for(var y=0;y<d.length;++y){var g=f[y],b=d[y];t.ssrcs.push({id:b,attribute:"cname",value:p}),t.ssrcs.push({id:b,attribute:"msid",value:"".concat(s," ").concat(c)}),t.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(g," ").concat(b)})}}},1733:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.debug=t.parseScalabilityMode=t.detectDevice=t.Device=t.version=t.types=void 0;var s=a(r(1373));t.debug=s.default;var c=r(8630);Object.defineProperty(t,"Device",{enumerable:!0,get:function(){return c.Device}}),Object.defineProperty(t,"detectDevice",{enumerable:!0,get:function(){return c.detectDevice}});var u=i(r(6087));t.types=u,t.version="3.7.0";var l=r(9975);Object.defineProperty(t,"parseScalabilityMode",{enumerable:!0,get:function(){return l.parse}})},6059:function(e,t,r){"use strict";function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}var a=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.canReceive=t.canSend=t.generateProbatorRtpParameters=t.reduceCodecs=t.getSendingRemoteRtpParameters=t.getSendingRtpParameters=t.getRecvRtpCapabilities=t.getExtendedRtpCapabilities=t.validateSctpStreamParameters=t.validateSctpParameters=t.validateNumSctpStreams=t.validateSctpCapabilities=t.validateRtcpParameters=t.validateRtpEncodingParameters=t.validateRtpHeaderExtensionParameters=t.validateRtpCodecParameters=t.validateRtpParameters=t.validateRtpHeaderExtension=t.validateRtcpFeedback=t.validateRtpCodecCapability=t.validateRtpCapabilities=void 0;var u=c(r(8205)),l=c(r(5234));function p(e){var t=new RegExp("^(audio|video)/(.+)","i");if("object"!==i(e))throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");var r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if(e.kind=r[1].toLowerCase(),e.preferredPayloadType&&"number"!=typeof e.preferredPayloadType)throw new TypeError("invalid codec.preferredPayloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===e.kind?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"===i(e.parameters)||(e.parameters={});for(var o=0,a=Object.keys(e.parameters);o<a.length;o++){var s=a[o],c=e.parameters[s];if(void 0===c&&(e.parameters[s]="",c=""),"string"!=typeof c&&"number"!=typeof c)throw new TypeError("invalid codec parameter [key:".concat(s,"s, value:").concat(c,"]"));if("apt"===s&&"number"!=typeof c)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);var u,l=n(e.rtcpFeedback);try{for(l.s();!(u=l.n()).done;)f(u.value)}catch(e){l.e(e)}finally{l.f()}}function f(e){if("object"!==i(e))throw new TypeError("fb is not an object");if(!e.type||"string"!=typeof e.type)throw new TypeError("missing fb.type");e.parameter&&"string"==typeof e.parameter||(e.parameter="")}function d(e){if("object"!==i(e))throw new TypeError("ext is not an object");if("audio"!==e.kind&&"video"!==e.kind)throw new TypeError("invalid ext.kind");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.preferredId)throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&"boolean"!=typeof e.preferredEncrypt)throw new TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&"string"!=typeof e.direction)throw new TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}function h(e){if("object"!==i(e))throw new TypeError("params is not an object");if(e.mid&&"string"!=typeof e.mid)throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");var t,r=n(e.codecs);try{for(r.s();!(t=r.n()).done;)v(t.value)}catch(e){r.e(e)}finally{r.f()}if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);var o,a=n(e.headerExtensions);try{for(a.s();!(o=a.n()).done;)m(o.value)}catch(e){a.e(e)}finally{a.f()}if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");e.encodings||(e.encodings=[]);var s,c=n(e.encodings);try{for(c.s();!(s=c.n()).done;)y(s.value)}catch(e){c.e(e)}finally{c.f()}if(e.rtcp&&"object"!==i(e.rtcp))throw new TypeError("params.rtcp is not an object");e.rtcp||(e.rtcp={}),g(e.rtcp)}function v(e){var t=new RegExp("^(audio|video)/(.+)","i");if("object"!==i(e))throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");var r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if("number"!=typeof e.payloadType)throw new TypeError("missing codec.payloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===r[1].toLowerCase()?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"===i(e.parameters)||(e.parameters={});for(var o=0,a=Object.keys(e.parameters);o<a.length;o++){var s=a[o],c=e.parameters[s];if(void 0===c&&(e.parameters[s]="",c=""),"string"!=typeof c&&"number"!=typeof c)throw new TypeError("invalid codec parameter [key:".concat(s,"s, value:").concat(c,"]"));if("apt"===s&&"number"!=typeof c)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);var u,l=n(e.rtcpFeedback);try{for(l.s();!(u=l.n()).done;)f(u.value)}catch(e){l.e(e)}finally{l.f()}}function m(e){if("object"!==i(e))throw new TypeError("ext is not an object");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.id)throw new TypeError("missing ext.id");if(e.encrypt&&"boolean"!=typeof e.encrypt)throw new TypeError("invalid ext.encrypt");e.encrypt||(e.encrypt=!1),e.parameters&&"object"===i(e.parameters)||(e.parameters={});for(var t=0,r=Object.keys(e.parameters);t<r.length;t++){var n=r[t],o=e.parameters[n];if(void 0===o&&(e.parameters[n]="",o=""),"string"!=typeof o&&"number"!=typeof o)throw new TypeError("invalid header extension parameter")}}function y(e){if("object"!==i(e))throw new TypeError("encoding is not an object");if(e.ssrc&&"number"!=typeof e.ssrc)throw new TypeError("invalid encoding.ssrc");if(e.rid&&"string"!=typeof e.rid)throw new TypeError("invalid encoding.rid");if(e.rtx&&"object"!==i(e.rtx))throw new TypeError("invalid encoding.rtx");if(e.rtx&&"number"!=typeof e.rtx.ssrc)throw new TypeError("missing encoding.rtx.ssrc");if(e.dtx&&"boolean"==typeof e.dtx||(e.dtx=!1),e.scalabilityMode&&"string"!=typeof e.scalabilityMode)throw new TypeError("invalid encoding.scalabilityMode")}function g(e){if("object"!==i(e))throw new TypeError("rtcp is not an object");if(e.cname&&"string"!=typeof e.cname)throw new TypeError("invalid rtcp.cname");e.reducedSize&&"boolean"==typeof e.reducedSize||(e.reducedSize=!0)}function b(e){if("object"!==i(e))throw new TypeError("numStreams is not an object");if("number"!=typeof e.OS)throw new TypeError("missing numStreams.OS");if("number"!=typeof e.MIS)throw new TypeError("missing numStreams.MIS")}function w(e){return!!e&&/.+\/rtx$/i.test(e.mimeType)}function _(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.strict,o=void 0!==n&&n,i=r.modify,a=void 0!==i&&i,s=e.mimeType.toLowerCase();if(s!==t.mimeType.toLowerCase())return!1;if(e.clockRate!==t.clockRate)return!1;if(e.channels!==t.channels)return!1;switch(s){case"video/h264":if(o){var c;if((e.parameters["packetization-mode"]||0)!==(t.parameters["packetization-mode"]||0))return!1;if(!u.isSameProfile(e.parameters,t.parameters))return!1;try{c=u.generateProfileLevelIdForAnswer(e.parameters,t.parameters)}catch(e){return!1}a&&(c?(e.parameters["profile-level-id"]=c,t.parameters["profile-level-id"]=c):(delete e.parameters["profile-level-id"],delete t.parameters["profile-level-id"]))}break;case"video/vp9":if(o&&(e.parameters["profile-id"]||0)!==(t.parameters["profile-id"]||0))return!1}return!0}function S(e,t){var r,o=[],i=n(e.rtcpFeedback||[]);try{var a=function(){var e=r.value,n=(t.rtcpFeedback||[]).find((function(t){return t.type===e.type&&(t.parameter===e.parameter||!t.parameter&&!e.parameter)}));n&&o.push(n)};for(i.s();!(r=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}return o}t.validateRtpCapabilities=function(e){if("object"!==i(e))throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");e.codecs||(e.codecs=[]);var t,r=n(e.codecs);try{for(r.s();!(t=r.n()).done;)p(t.value)}catch(e){r.e(e)}finally{r.f()}if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);var o,a=n(e.headerExtensions);try{for(a.s();!(o=a.n()).done;)d(o.value)}catch(e){a.e(e)}finally{a.f()}},t.validateRtpCodecCapability=p,t.validateRtcpFeedback=f,t.validateRtpHeaderExtension=d,t.validateRtpParameters=h,t.validateRtpCodecParameters=v,t.validateRtpHeaderExtensionParameters=m,t.validateRtpEncodingParameters=y,t.validateRtcpParameters=g,t.validateSctpCapabilities=function(e){if("object"!==i(e))throw new TypeError("caps is not an object");if(!e.numStreams||"object"!==i(e.numStreams))throw new TypeError("missing caps.numStreams");b(e.numStreams)},t.validateNumSctpStreams=b,t.validateSctpParameters=function(e){if("object"!==i(e))throw new TypeError("params is not an object");if("number"!=typeof e.port)throw new TypeError("missing params.port");if("number"!=typeof e.OS)throw new TypeError("missing params.OS");if("number"!=typeof e.MIS)throw new TypeError("missing params.MIS");if("number"!=typeof e.maxMessageSize)throw new TypeError("missing params.maxMessageSize")},t.validateSctpStreamParameters=function(e){if("object"!==i(e))throw new TypeError("params is not an object");if("number"!=typeof e.streamId)throw new TypeError("missing params.streamId");var t=!1;if("boolean"==typeof e.ordered?t=!0:e.ordered=!0,e.maxPacketLifeTime&&"number"!=typeof e.maxPacketLifeTime)throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&"number"!=typeof e.maxRetransmits)throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(t&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(t||!e.maxPacketLifeTime&&!e.maxRetransmits||(e.ordered=!1),e.label&&"string"!=typeof e.label)throw new TypeError("invalid params.label");if(e.protocol&&"string"!=typeof e.protocol)throw new TypeError("invalid params.protocol")},t.getExtendedRtpCapabilities=function(e,t){var r,o={codecs:[],headerExtensions:[]},i=n(t.codecs||[]);try{var a=function(){var t=r.value;if(w(t))return 0;var n=(e.codecs||[]).find((function(e){return _(e,t,{strict:!0,modify:!0})}));if(!n)return 0;var i={mimeType:n.mimeType,kind:n.kind,clockRate:n.clockRate,channels:n.channels,localPayloadType:n.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:t.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:n.parameters,remoteParameters:t.parameters,rtcpFeedback:S(n,t)};o.codecs.push(i)};for(i.s();!(r=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}var s,c=n(o.codecs);try{var u=function(){var r=s.value,n=e.codecs.find((function(e){return w(e)&&e.parameters.apt===r.localPayloadType})),o=t.codecs.find((function(e){return w(e)&&e.parameters.apt===r.remotePayloadType}));n&&o&&(r.localRtxPayloadType=n.preferredPayloadType,r.remoteRtxPayloadType=o.preferredPayloadType)};for(c.s();!(s=c.n()).done;)u()}catch(e){c.e(e)}finally{c.f()}var l,p=n(t.headerExtensions);try{var f=function(){var t=l.value,r=e.headerExtensions.find((function(e){return n=t,!((r=e).kind&&n.kind&&r.kind!==n.kind||r.uri!==n.uri);var r,n}));if(!r)return 1;var n={kind:t.kind,uri:t.uri,sendId:r.preferredId,recvId:t.preferredId,encrypt:r.preferredEncrypt,direction:"sendrecv"};switch(t.direction){case"sendrecv":n.direction="sendrecv";break;case"recvonly":n.direction="sendonly";break;case"sendonly":n.direction="recvonly";break;case"inactive":n.direction="inactive"}o.headerExtensions.push(n)};for(p.s();!(l=p.n()).done;)f()}catch(e){p.e(e)}finally{p.f()}return o},t.getRecvRtpCapabilities=function(e){var t,r={codecs:[],headerExtensions:[]},o=n(e.codecs);try{for(o.s();!(t=o.n()).done;){var i=t.value,a={mimeType:i.mimeType,kind:i.kind,preferredPayloadType:i.remotePayloadType,clockRate:i.clockRate,channels:i.channels,parameters:i.localParameters,rtcpFeedback:i.rtcpFeedback};if(r.codecs.push(a),i.remoteRtxPayloadType){var s={mimeType:"".concat(i.kind,"/rtx"),kind:i.kind,preferredPayloadType:i.remoteRtxPayloadType,clockRate:i.clockRate,parameters:{apt:i.remotePayloadType},rtcpFeedback:[]};r.codecs.push(s)}}}catch(e){o.e(e)}finally{o.f()}var c,u=n(e.headerExtensions);try{for(u.s();!(c=u.n()).done;){var l=c.value;if("sendrecv"===l.direction||"recvonly"===l.direction){var p={kind:l.kind,uri:l.uri,preferredId:l.recvId,preferredEncrypt:l.encrypt,direction:l.direction};r.headerExtensions.push(p)}}}catch(e){u.e(e)}finally{u.f()}return r},t.getSendingRtpParameters=function(e,t){var r,o={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},i=n(t.codecs);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.kind===e){var s={mimeType:a.mimeType,payloadType:a.localPayloadType,clockRate:a.clockRate,channels:a.channels,parameters:a.localParameters,rtcpFeedback:a.rtcpFeedback};if(o.codecs.push(s),a.localRtxPayloadType){var c={mimeType:"".concat(a.kind,"/rtx"),payloadType:a.localRtxPayloadType,clockRate:a.clockRate,parameters:{apt:a.localPayloadType},rtcpFeedback:[]};o.codecs.push(c)}}}}catch(e){i.e(e)}finally{i.f()}var u,l=n(t.headerExtensions);try{for(l.s();!(u=l.n()).done;){var p=u.value;if(!(p.kind&&p.kind!==e||"sendrecv"!==p.direction&&"sendonly"!==p.direction)){var f={uri:p.uri,id:p.sendId,encrypt:p.encrypt,parameters:{}};o.headerExtensions.push(f)}}}catch(e){l.e(e)}finally{l.f()}return o},t.getSendingRemoteRtpParameters=function(e,t){var r,o={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},i=n(t.codecs);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.kind===e){var s={mimeType:a.mimeType,payloadType:a.localPayloadType,clockRate:a.clockRate,channels:a.channels,parameters:a.remoteParameters,rtcpFeedback:a.rtcpFeedback};if(o.codecs.push(s),a.localRtxPayloadType){var c={mimeType:"".concat(a.kind,"/rtx"),payloadType:a.localRtxPayloadType,clockRate:a.clockRate,parameters:{apt:a.localPayloadType},rtcpFeedback:[]};o.codecs.push(c)}}}}catch(e){i.e(e)}finally{i.f()}var u,l=n(t.headerExtensions);try{for(l.s();!(u=l.n()).done;){var p=u.value;if(!(p.kind&&p.kind!==e||"sendrecv"!==p.direction&&"sendonly"!==p.direction)){var f={uri:p.uri,id:p.sendId,encrypt:p.encrypt,parameters:{}};o.headerExtensions.push(f)}}}catch(e){l.e(e)}finally{l.f()}if(o.headerExtensions.some((function(e){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.uri}))){var d,h=n(o.codecs);try{for(h.s();!(d=h.n()).done;){var v=d.value;v.rtcpFeedback=(v.rtcpFeedback||[]).filter((function(e){return"goog-remb"!==e.type}))}}catch(e){h.e(e)}finally{h.f()}}else if(o.headerExtensions.some((function(e){return"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.uri}))){var m,y=n(o.codecs);try{for(y.s();!(m=y.n()).done;){var g=m.value;g.rtcpFeedback=(g.rtcpFeedback||[]).filter((function(e){return"transport-cc"!==e.type}))}}catch(e){y.e(e)}finally{y.f()}}else{var b,w=n(o.codecs);try{for(w.s();!(b=w.n()).done;){var _=b.value;_.rtcpFeedback=(_.rtcpFeedback||[]).filter((function(e){return"transport-cc"!==e.type&&"goog-remb"!==e.type}))}}catch(e){w.e(e)}finally{w.f()}}return o},t.reduceCodecs=function(e,t){var r=[];if(t){for(var n=0;n<e.length;++n)if(_(e[n],t)){r.push(e[n]),w(e[n+1])&&r.push(e[n+1]);break}if(0===r.length)throw new TypeError("no matching codec found")}else r.push(e[0]),w(e[1])&&r.push(e[1]);return r},t.generateProbatorRtpParameters=function(e){h(e=l.clone(e));var t={mid:"probator",codecs:[],headerExtensions:[],encodings:[{ssrc:1234}],rtcp:{cname:"probator"}};return t.codecs.push(e.codecs[0]),t.codecs[0].payloadType=127,t.headerExtensions=e.headerExtensions,t},t.canSend=function(e,t){return t.codecs.some((function(t){return t.kind===e}))},t.canReceive=function(e,t){if(h(e),0===e.codecs.length)return!1;var r=e.codecs[0];return t.codecs.some((function(e){return e.remotePayloadType===r.payloadType}))}},9975:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=void 0;var r=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");t.parse=function(e){var t=r.exec(e||"");return t?{spatialLayers:Number(t[1]),temporalLayers:Number(t[2])}:{spatialLayers:1,temporalLayers:1}}},6087:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(8630),t),o(r(2683),t),o(r(4791),t),o(r(9113),t),o(r(6487),t),o(r(6503),t),o(r(7562),t),o(r(5987),t),o(r(3018),t),o(r(6020),t)},5234:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateRandomNumber=t.clone=void 0,t.clone=function(e){return void 0===e?void 0:Number.isNaN(e)?NaN:"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))},t.generateRandomNumber=function(){return Math.round(1e7*Math.random())}},9622:e=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}var r=1e3,n=60*r,o=60*n,i=24*o;function a(e,t,r,n){var o=t>=1.5*r;return Math.round(e/r)+" "+n+(o?"s":"")}e.exports=function(e,s){s=s||{};var c,u,l=t(e);if("string"===l&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var a=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"weeks":case"week":case"w":return 6048e5*a;case"days":case"day":case"d":return a*i;case"hours":case"hour":case"hrs":case"hr":case"h":return a*o;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(e);if("number"===l&&isFinite(e))return s.long?(c=e,(u=Math.abs(c))>=i?a(c,u,i,"day"):u>=o?a(c,u,o,"hour"):u>=n?a(c,u,n,"minute"):u>=r?a(c,u,r,"second"):c+" ms"):function(e){var t=Math.abs(e);return t>=i?Math.round(e/i)+"d":t>=o?Math.round(e/o)+"h":t>=n?Math.round(e/n)+"m":t>=r?Math.round(e/r)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},5110:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(){"use strict";o=function(){return t};var e,t={},r=Object.prototype,i=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,i=Object.create(o.prototype),s=new L(n||[]);return a(i,"_invoke",{value:E(e,r,s)}),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var h="suspendedStart",v="suspendedYield",m="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};p(S,c,(function(){return this}));var k=Object.getPrototypeOf,x=k&&k(k(D([])));x&&x!==r&&i.call(x,c)&&(S=x);var R=_.prototype=b.prototype=Object.create(S);function P(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(o,a,s,c){var u=d(e[o],e,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==n(p)&&i.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,c)}))}c(u.arg)}var o;a(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(i,i):i()}})}function E(t,r,n){var o=h;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(i.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=_,a(R,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:w,configurable:!0}),w.displayName=p(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,p(e,l,"GeneratorFunction")),e.prototype=Object.create(R),e},t.awrap=function(e){return{__await:e}},P(O.prototype),p(O.prototype,u,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new O(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},P(R),p(R,l,"Generator"),p(R,c,(function(){return this})),p(R,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function i(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function a(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,i=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===n(i)?i:String(i)),o)}var i}function s(e,t){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},s(e,t)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}var u=r(5090).EventEmitter,l=r(862),p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&s(e,t)}(v,e);var t,r,u,p,f,d,h=(f=v,d=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=c(f);if(d){var r=c(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function v(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,v),(t=h.call(this)).setMaxListeners(1/0),t._logger=e||new l("EnhancedEventEmitter"),t}return t=v,r=[{key:"safeEmit",value:function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.emit.apply(this,[e].concat(r))}catch(t){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",e,t)}}},{key:"safeEmitAsPromise",value:(u=o().mark((function e(t){var r,n,i,a=this,s=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=s.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=s[i];return e.abrupt("return",new Promise((function(e,r){a.safeEmit.apply(a,[t].concat(n,[e,r]))})));case 2:case"end":return e.stop()}}),e)})),p=function(){var e=this,t=arguments;return new Promise((function(r,n){var o=u.apply(e,t);function a(e){i(o,r,n,a,s,"next",e)}function s(e){i(o,r,n,a,s,"throw",e)}a(void 0)}))},function(e){return p.apply(this,arguments)})}],r&&a(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),v}(u);e.exports=p},862:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,i=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===n(i)?i:String(i)),o)}var i}var i=r(1373),a="protoo-client",s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t?(this._debug=i("".concat(a,":").concat(t)),this._warn=i("".concat(a,":WARN:").concat(t)),this._error=i("".concat(a,":ERROR:").concat(t))):(this._debug=i(a),this._warn=i("".concat(a,":WARN")),this._error=i("".concat(a,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}var t,r;return t=e,(r=[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}])&&o(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();e.exports=s},4715:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,i=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===n(i)?i:String(i)),o)}var i}var i=r(862),a=r(477).generateRandomNumber,s=new i("Message"),c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"parse",value:function(e){var t,r={};try{t=JSON.parse(e)}catch(e){return void s.error("parse() | invalid JSON: %s",e)}if("object"===n(t)&&!Array.isArray(t)){if(t.request){if(r.request=!0,"string"!=typeof t.method)return void s.error("parse() | missing/invalid method field");if("number"!=typeof t.id)return void s.error("parse() | missing/invalid id field");r.id=t.id,r.method=t.method,r.data=t.data||{}}else if(t.response){if(r.response=!0,"number"!=typeof t.id)return void s.error("parse() | missing/invalid id field");r.id=t.id,t.ok?(r.ok=!0,r.data=t.data||{}):(r.ok=!1,r.errorCode=t.errorCode,r.errorReason=t.errorReason)}else{if(!t.notification)return void s.error("parse() | missing request/response field");if(r.notification=!0,"string"!=typeof t.method)return void s.error("parse() | missing/invalid method field");r.method=t.method,r.data=t.data||{}}return r}s.error("parse() | not an object")}},{key:"createRequest",value:function(e,t){return{request:!0,id:a(),method:e,data:t||{}}}},{key:"createSuccessResponse",value:function(e,t){return{response:!0,id:e.id,ok:!0,data:t||{}}}},{key:"createErrorResponse",value:function(e,t,r){return{response:!0,id:e.id,ok:!1,errorCode:t,errorReason:r}}},{key:"createNotification",value:function(e,t){return{notification:!0,method:e,data:t||{}}}}],null&&o(t.prototype,null),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();e.exports=c},1123:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(){"use strict";o=function(){return t};var e,t={},r=Object.prototype,i=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,i=Object.create(o.prototype),s=new L(n||[]);return a(i,"_invoke",{value:E(e,r,s)}),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var h="suspendedStart",v="suspendedYield",m="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};p(S,c,(function(){return this}));var k=Object.getPrototypeOf,x=k&&k(k(D([])));x&&x!==r&&i.call(x,c)&&(S=x);var R=_.prototype=b.prototype=Object.create(S);function P(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(o,a,s,c){var u=d(e[o],e,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==n(p)&&i.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,c)}))}c(u.arg)}var o;a(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(i,i):i()}})}function E(t,r,n){var o=h;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(i.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=_,a(R,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:w,configurable:!0}),w.displayName=p(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,p(e,l,"GeneratorFunction")),e.prototype=Object.create(R),e},t.awrap=function(e){return{__await:e}},P(O.prototype),p(O.prototype,u,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new O(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},P(R),p(R,l,"Generator"),p(R,c,(function(){return this})),p(R,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function i(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function a(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function s(e){i(a,n,o,s,c,"next",e)}function c(e){i(a,n,o,s,c,"throw",e)}s(void 0)}))}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,i=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===n(i)?i:String(i)),o)}var i}function u(e,t){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},u(e,t)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}var p=r(862),f=r(5110),d=r(4715),h=new p("Peer"),v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(y,e);var t,r,i,p,f,v,m=(f=y,v=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=l(f);if(v){var r=l(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function y(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y),t=m.call(this,h),h.debug("constructor()"),t._closed=!1,t._transport=e,t._connected=!1,t._data={},t._sents=new Map,t._handleTransport(),t}return t=y,r=[{key:"closed",get:function(){return this._closed}},{key:"connected",get:function(){return this._connected}},{key:"data",get:function(){return this._data},set:function(e){throw new Error("cannot override data object")}},{key:"close",value:function(){if(!this._closed){h.debug("close()"),this._closed=!0,this._connected=!1,this._transport.close();var e,t=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}(this._sents.values());try{for(t.s();!(e=t.n()).done;)e.value.close()}catch(e){t.e(e)}finally{t.f()}this.safeEmit("close")}}},{key:"request",value:(p=a(o().mark((function e(t){var r,n,i=this,a=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:void 0,n=d.createRequest(t,r),this._logger.debug("request() [method:%s, id:%s]",t,n.id),e.next=5,this._transport.send(n);case 5:return e.abrupt("return",new Promise((function(e,t){var r=1500*(15+.1*i._sents.size),o={id:n.id,method:n.method,resolve:function(t){i._sents.delete(n.id)&&(clearTimeout(o.timer),e(t))},reject:function(e){i._sents.delete(n.id)&&(clearTimeout(o.timer),t(e))},timer:setTimeout((function(){i._sents.delete(n.id)&&t(new Error("request timeout"))}),r),close:function(){clearTimeout(o.timer),t(new Error("peer closed"))}};i._sents.set(n.id,o)})));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"notify",value:(i=a(o().mark((function e(t){var r,n,i=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:void 0,n=d.createNotification(t,r),this._logger.debug("notify() [method:%s]",t),e.next=5,this._transport.send(n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"_handleTransport",value:function(){var e=this;if(this._transport.closed)return this._closed=!0,void setTimeout((function(){e._closed||(e._connected=!1,e.safeEmit("close"))}));this._transport.on("open",(function(){e._closed||(h.debug('emit "open"'),e._connected=!0,e.safeEmit("open"))})),this._transport.on("disconnected",(function(){e._closed||(h.debug('emit "disconnected"'),e._connected=!1,e.safeEmit("disconnected"))})),this._transport.on("failed",(function(t){e._closed||(h.debug('emit "failed" [currentAttempt:%s]',t),e._connected=!1,e.safeEmit("failed",t))})),this._transport.on("close",(function(){e._closed||(e._closed=!0,h.debug('emit "close"'),e._connected=!1,e.safeEmit("close"))})),this._transport.on("message",(function(t){t.request?e._handleRequest(t):t.response?e._handleResponse(t):t.notification&&e._handleNotification(t)}))}},{key:"_handleRequest",value:function(e){var t=this;try{this.emit("request",e,(function(r){var n=d.createSuccessResponse(e,r);t._transport.send(n).catch((function(){}))}),(function(r,n){r instanceof Error?(n=r.message,r=500):"number"==typeof r&&n instanceof Error&&(n=n.message);var o=d.createErrorResponse(e,r,n);t._transport.send(o).catch((function(){}))}))}catch(t){var r=d.createErrorResponse(e,500,String(t));this._transport.send(r).catch((function(){}))}}},{key:"_handleResponse",value:function(e){var t=this._sents.get(e.id);if(t)if(e.ok)t.resolve(e.data);else{var r=new Error(e.errorReason);r.code=e.errorCode,t.reject(r)}else h.error("received response does not match any sent request [id:%s]",e.id)}},{key:"_handleNotification",value:function(e){this.safeEmit("notification",e)}}],r&&c(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),y}(f);e.exports=v},5522:(e,t,r)=>{r(7002).version,r(1123),r(4801)},4801:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(){"use strict";o=function(){return t};var e,t={},r=Object.prototype,i=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,i=Object.create(o.prototype),s=new L(n||[]);return a(i,"_invoke",{value:E(e,r,s)}),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var h="suspendedStart",v="suspendedYield",m="executing",y="completed",g={};function b(){}function w(){}function _(){}var S={};p(S,c,(function(){return this}));var k=Object.getPrototypeOf,x=k&&k(k(D([])));x&&x!==r&&i.call(x,c)&&(S=x);var R=_.prototype=b.prototype=Object.create(S);function P(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(o,a,s,c){var u=d(e[o],e,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==n(p)&&i.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,c)}))}c(u.arg)}var o;a(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(i,i):i()}})}function E(t,r,n){var o=h;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(i.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=_,a(R,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:w,configurable:!0}),w.displayName=p(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,p(e,l,"GeneratorFunction")),e.prototype=Object.create(R),e},t.awrap=function(e){return{__await:e}},P(O.prototype),p(O.prototype,u,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new O(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},P(R),p(R,l,"Generator"),p(R,c,(function(){return this})),p(R,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function i(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function a(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,i=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===n(i)?i:String(i)),o)}var i}function s(e,t){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},s(e,t)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}var u=r(7444).w3cwebsocket,l=r(2643),p=r(862),f=r(5110),d=r(4715),h={retries:10,factor:2,minTimeout:1e3,maxTimeout:8e3},v=new p("WebSocketTransport"),m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&s(e,t)}(b,e);var t,r,p,f,m,y,g=(m=b,y=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=c(m);if(y){var r=c(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function b(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,b),r=g.call(this,v),v.debug("constructor() [url:%s, options:%o]",e,t),r._closed=!1,r._url=e,r._options=t||{},r._ws=null,r._runWebSocket(),r}return t=b,r=[{key:"closed",get:function(){return this._closed}},{key:"close",value:function(){if(!this._closed){v.debug("close()"),this._closed=!0,this.safeEmit("close");try{this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close()}catch(e){v.error("close() | error closing the WebSocket: %o",e)}}}},{key:"send",value:(p=o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=2;break}throw new Error("transport closed");case 2:e.prev=2,this._ws.send(JSON.stringify(t)),e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(2),v.warn("send() failed:%o",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[2,6]])})),f=function(){var e=this,t=arguments;return new Promise((function(r,n){var o=p.apply(e,t);function a(e){i(o,r,n,a,s,"next",e)}function s(e){i(o,r,n,a,s,"throw",e)}a(void 0)}))},function(e){return f.apply(this,arguments)})},{key:"_runWebSocket",value:function(){var e=this,t=l.operation(this._options.retry||h),r=!1;t.attempt((function(n){e._closed?t.stop():(v.debug("_runWebSocket() [currentAttempt:%s]",n),e._ws=new u(e._url,"protoo",e._options.origin,e._options.headers,e._options.requestOptions,e._options.clientConfig),e._ws.onopen=function(){e._closed||(r=!0,e.safeEmit("open"))},e._ws.onclose=function(o){if(!e._closed){if(v.warn('WebSocket "close" event [wasClean:%s, code:%s, reason:"%s"]',o.wasClean,o.code,o.reason),4e3!==o.code){if(r){if(t.stop(),e.safeEmit("disconnected"),e._closed)return;return void e._runWebSocket()}if(e.safeEmit("failed",n),e._closed)return;if(t.retry(!0))return}e._closed=!0,e.safeEmit("close")}},e._ws.onerror=function(){e._closed||v.error('WebSocket "error" event')},e._ws.onmessage=function(t){if(!e._closed){var r=d.parse(t.data);r&&(0!==e.listenerCount("message")?e.safeEmit("message",r):v.error('no listeners for WebSocket "message" event, ignoring received message'))}})}))}}],r&&a(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),b}(f);e.exports=m},477:(e,t)=>{t.generateRandomNumber=function(){return Math.round(1e7*Math.random())}},2643:(e,t,r)=>{e.exports=r(6828)},6828:(e,t,r)=>{var n=r(7389);t.operation=function(e){var r=t.timeouts(e);return new n(r,{forever:e&&e.forever,unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],o=0;o<t.retries;o++)n.push(this.createTimeout(o,t));return e&&e.forever&&!n.length&&n.push(this.createTimeout(o,t)),n.sort((function(e,t){return e-t})),n},t.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,n=Math.round(r*t.minTimeout*Math.pow(t.factor,e));return Math.min(n,t.maxTimeout)},t.wrap=function(e,r,n){if(r instanceof Array&&(n=r,r=null),!n)for(var o in n=[],e)"function"==typeof e[o]&&n.push(o);for(var i=0;i<n.length;i++){var a=n[i],s=e[a];e[a]=function(n){var o=t.operation(r),i=Array.prototype.slice.call(arguments,1),a=i.pop();i.push((function(e){o.retry(e)||(e&&(arguments[0]=o.mainError()),a.apply(this,arguments))})),o.attempt((function(){n.apply(e,i)}))}.bind(e,s),e[a].options=r}}},7389:e=>{function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),r=this._timeouts.shift()}var n=this,o=setTimeout((function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)}),r);return this._options.unref&&o.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var o=this._errors[n],i=o.message,a=(e[i]||0)+1;e[i]=a,a>=r&&(t=o,r=a)}return t}},6497:(e,t,r)=>{var n;e.exports="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"!=typeof window?window:r.g):function(e){return(n||(n=Promise.resolve())).then(e).catch((function(e){return setTimeout((function(){throw e}),0)}))}},7513:(e,t,r)=>{"use strict";function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},n.apply(this,arguments)}var o=r(3074);function i(e,t,r,n,i){var a=o.writeRtpDescription(e.kind,t);if(a+=o.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=o.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":i||"active"),a+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var c="msid:"+(n?n.id:"-")+" "+s+"\r\n";a+="a="+c,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+o.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+o.localCName+"\r\n"),a}function a(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},o=function(e,t,r,o){var i=n(e.parameters.apt,r),a=n(t.parameters.apt,o);return i&&a&&i.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach((function(n){for(var i=0;i<t.codecs.length;i++){var a=t.codecs[i];if(n.name.toLowerCase()===a.name.toLowerCase()&&n.clockRate===a.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&a.parameters.apt&&!o(n,a,e.codecs,t.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(n.numChannels,a.numChannels),r.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter((function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var n=0;n<t.headerExtensions.length;n++){var o=t.headerExtensions[n];if(e.uri===o.uri){r.headerExtensions.push(o);break}}})),r}function s(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function c(e,t){var r=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return r||e.addRemoteCandidate(t),!r}function u(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}e.exports=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function l(t,r,n,o){var i=new Event("track");i.track=r,i.receiver=n,i.transceiver={receiver:n},i.streams=o,e.setTimeout((function(){t._dispatchEvent("track",i)}))}var p=function(r){var n=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){n[e]=i[e].bind(i)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw u("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var o="string"==typeof n;return o&&(n=[n]),n=n.filter((function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||r?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(r=!0,!0)})),delete e.url,e.urls=o?n[0]:n,!!n.length}}))}(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var a=r.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=o.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(p.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(p.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),p.prototype.onicecandidate=null,p.prototype.onaddstream=null,p.prototype.ontrack=null,p.prototype.onremovestream=null,p.prototype.onsignalingstatechange=null,p.prototype.oniceconnectionstatechange=null,p.prototype.onconnectionstatechange=null,p.prototype.onicegatheringstatechange=null,p.prototype.onnegotiationneeded=null,p.prototype.ondatachannel=null,p.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},p.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},p.prototype.getConfiguration=function(){return this._config},p.prototype.getLocalStreams=function(){return this.localStreams},p.prototype.getRemoteStreams=function(){return this.remoteStreams},p.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var o=this._createIceAndDtlsTransports();n.iceTransport=o.iceTransport,n.dtlsTransport=o.dtlsTransport}return t||this.transceivers.push(n),n},p.prototype.addTrack=function(t,r){if(this._isClosed)throw u("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n;if(this.transceivers.find((function(e){return e.track===t})))throw u("InvalidAccessError","Track already exists.");for(var o=0;o<this.transceivers.length;o++)this.transceivers[o].track||this.transceivers[o].kind!==t.kind||(n=this.transceivers[o]);return n||(n=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),n.track=t,n.stream=r,n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},p.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach((function(t){r.addTrack(t,e)}));else{var n=e.clone();e.getTracks().forEach((function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",(function(e){r.enabled=e.enabled}))})),n.getTracks().forEach((function(e){r.addTrack(e,n)}))}},p.prototype.removeTrack=function(t){if(this._isClosed)throw u("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find((function(e){return e.rtpSender===t}));if(!r)throw u("InvalidAccessError","Sender was not created by this connection.");var n=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(n)&&this.localStreams.indexOf(n)>-1&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},p.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var r=t.getSenders().find((function(t){return t.track===e}));r&&t.removeTrack(r)}))},p.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},p.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},p.prototype._createIceGatherer=function(t,r){var n=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var o=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(o,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;o.state=r?"completed":"gathering",null!==n.transceivers[t].bufferedCandidateEvents&&n.transceivers[t].bufferedCandidateEvents.push(e)},o.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),o},p.prototype._gather=function(t,r){var i=this,a=this.transceivers[r].iceGatherer;if(!a.onlocalcandidate){var s=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,a.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),a.onlocalcandidate=function(e){if(!(i.usingBundle&&r>0)){var s=new Event("icecandidate");s.candidate={sdpMid:t,sdpMLineIndex:r};var c=e.candidate,u=!c||0===Object.keys(c).length;if(u)"new"!==a.state&&"gathering"!==a.state||(a.state="completed");else{"new"===a.state&&(a.state="gathering"),c.component=1,c.ufrag=a.getLocalParameters().usernameFragment;var l=o.writeCandidate(c);s.candidate=n(s.candidate,o.parseCandidate(l)),s.candidate.candidate=l,s.candidate.toJSON=function(){return{candidate:s.candidate.candidate,sdpMid:s.candidate.sdpMid,sdpMLineIndex:s.candidate.sdpMLineIndex,usernameFragment:s.candidate.usernameFragment}}}var p=o.getMediaSections(i._localDescription.sdp);p[s.candidate.sdpMLineIndex]+=u?"a=end-of-candidates\r\n":"a="+s.candidate.candidate+"\r\n",i._localDescription.sdp=o.getDescription(i._localDescription.sdp)+p.join("");var f=i.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),u||i._dispatchEvent("icecandidate",s),f&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout((function(){s.forEach((function(e){a.onlocalcandidate(e)}))}),0)}},p.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var n=new e.RTCDtlsTransport(r);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:n}},p.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},p.prototype._transceive=function(e,r,n){var i=a(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:o.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),n&&e.rtpReceiver&&i.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?i.encodings=e.recvEncodingParameters:i.encodings=[{}],i.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(i.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},p.prototype.setLocalDescription=function(e){var t,r,n=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(u("TypeError",'Unsupported type "'+e.type+'"'));if(!s("setLocalDescription",e.type,n.signalingState)||n._isClosed)return Promise.reject(u("InvalidStateError","Can not set local "+e.type+" in state "+n.signalingState));if("offer"===e.type)t=o.splitSections(e.sdp),r=t.shift(),t.forEach((function(e,t){var r=o.parseRtpParameters(e);n.transceivers[t].localCapabilities=r})),n.transceivers.forEach((function(e,t){n._gather(e.mid,t)}));else if("answer"===e.type){t=o.splitSections(n._remoteDescription.sdp),r=t.shift();var i=o.matchPrefix(r,"a=ice-lite").length>0;t.forEach((function(e,t){var s=n.transceivers[t],c=s.iceGatherer,u=s.iceTransport,l=s.dtlsTransport,p=s.localCapabilities,f=s.remoteCapabilities;if(!(o.isRejected(e)&&0===o.matchPrefix(e,"a=bundle-only").length||s.rejected)){var d=o.getIceParameters(e,r),h=o.getDtlsParameters(e,r);i&&(h.role="server"),n.usingBundle&&0!==t||(n._gather(s.mid,t),"new"===u.state&&u.start(c,d,i?"controlling":"controlled"),"new"===l.state&&l.start(h));var v=a(p,f);n._transceive(s,v.codecs.length>0,!1)}}))}return n._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?n._updateSignalingState("have-local-offer"):n._updateSignalingState("stable"),Promise.resolve()},p.prototype.setRemoteDescription=function(n){var i=this;if(-1===["offer","answer"].indexOf(n.type))return Promise.reject(u("TypeError",'Unsupported type "'+n.type+'"'));if(!s("setRemoteDescription",n.type,i.signalingState)||i._isClosed)return Promise.reject(u("InvalidStateError","Can not set remote "+n.type+" in state "+i.signalingState));var p={};i.remoteStreams.forEach((function(e){p[e.id]=e}));var f=[],d=o.splitSections(n.sdp),h=d.shift(),v=o.matchPrefix(h,"a=ice-lite").length>0,m=o.matchPrefix(h,"a=group:BUNDLE ").length>0;i.usingBundle=m;var y=o.matchPrefix(h,"a=ice-options:")[0];return i.canTrickleIceCandidates=!!y&&y.substr(14).split(" ").indexOf("trickle")>=0,d.forEach((function(s,u){var l=o.splitLines(s),d=o.getKind(s),y=o.isRejected(s)&&0===o.matchPrefix(s,"a=bundle-only").length,g=l[0].substr(2).split(" ")[2],b=o.getDirection(s,h),w=o.parseMsid(s),_=o.getMid(s)||o.generateIdentifier();if(y||"application"===d&&("DTLS/SCTP"===g||"UDP/DTLS/SCTP"===g))i.transceivers[u]={mid:_,kind:d,protocol:g,rejected:!0};else{var S,k,x,R,P,O,E,T,C;!y&&i.transceivers[u]&&i.transceivers[u].rejected&&(i.transceivers[u]=i._createTransceiver(d,!0));var j,L,D=o.parseRtpParameters(s);y||(j=o.getIceParameters(s,h),(L=o.getDtlsParameters(s,h)).role="client"),E=o.parseRtpEncodingParameters(s);var I=o.parseRtcpParameters(s),M=o.matchPrefix(s,"a=end-of-candidates",h).length>0,A=o.matchPrefix(s,"a=candidate:").map((function(e){return o.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===n.type||"answer"===n.type)&&!y&&m&&u>0&&i.transceivers[u]&&(i._disposeIceAndDtlsTransports(u),i.transceivers[u].iceGatherer=i.transceivers[0].iceGatherer,i.transceivers[u].iceTransport=i.transceivers[0].iceTransport,i.transceivers[u].dtlsTransport=i.transceivers[0].dtlsTransport,i.transceivers[u].rtpSender&&i.transceivers[u].rtpSender.setTransport(i.transceivers[0].dtlsTransport),i.transceivers[u].rtpReceiver&&i.transceivers[u].rtpReceiver.setTransport(i.transceivers[0].dtlsTransport)),"offer"!==n.type||y)"answer"!==n.type||y||(k=(S=i.transceivers[u]).iceGatherer,x=S.iceTransport,R=S.dtlsTransport,P=S.rtpReceiver,O=S.sendEncodingParameters,T=S.localCapabilities,i.transceivers[u].recvEncodingParameters=E,i.transceivers[u].remoteCapabilities=D,i.transceivers[u].rtcpParameters=I,A.length&&"new"===x.state&&(!v&&!M||m&&0!==u?A.forEach((function(e){c(S.iceTransport,e)})):x.setRemoteCandidates(A)),m&&0!==u||("new"===x.state&&x.start(k,j,"controlling"),"new"===R.state&&R.start(L)),!a(S.localCapabilities,S.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&S.sendEncodingParameters[0].rtx&&delete S.sendEncodingParameters[0].rtx,i._transceive(S,"sendrecv"===b||"recvonly"===b,"sendrecv"===b||"sendonly"===b),!P||"sendrecv"!==b&&"sendonly"!==b?delete S.rtpReceiver:(C=P.track,w?(p[w.stream]||(p[w.stream]=new e.MediaStream),r(C,p[w.stream]),f.push([C,P,p[w.stream]])):(p.default||(p.default=new e.MediaStream),r(C,p.default),f.push([C,P,p.default]))));else{(S=i.transceivers[u]||i._createTransceiver(d)).mid=_,S.iceGatherer||(S.iceGatherer=i._createIceGatherer(u,m)),A.length&&"new"===S.iceTransport.state&&(!M||m&&0!==u?A.forEach((function(e){c(S.iceTransport,e)})):S.iceTransport.setRemoteCandidates(A)),T=e.RTCRtpReceiver.getCapabilities(d),t<15019&&(T.codecs=T.codecs.filter((function(e){return"rtx"!==e.name}))),O=S.sendEncodingParameters||[{ssrc:1001*(2*u+2)}];var N,F=!1;"sendrecv"===b||"sendonly"===b?(F=!S.rtpReceiver,P=S.rtpReceiver||new e.RTCRtpReceiver(S.dtlsTransport,d),F&&(C=P.track,w&&"-"===w.stream||(w?(p[w.stream]||(p[w.stream]=new e.MediaStream,Object.defineProperty(p[w.stream],"id",{get:function(){return w.stream}})),Object.defineProperty(C,"id",{get:function(){return w.track}}),N=p[w.stream]):(p.default||(p.default=new e.MediaStream),N=p.default)),N&&(r(C,N),S.associatedRemoteMediaStreams.push(N)),f.push([C,P,N]))):S.rtpReceiver&&S.rtpReceiver.track&&(S.associatedRemoteMediaStreams.forEach((function(t){var r=t.getTracks().find((function(e){return e.id===S.rtpReceiver.track.id}));r&&function(t,r){r.removeTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(r,t)})),S.associatedRemoteMediaStreams=[]),S.localCapabilities=T,S.remoteCapabilities=D,S.rtpReceiver=P,S.rtcpParameters=I,S.sendEncodingParameters=O,S.recvEncodingParameters=E,i._transceive(i.transceivers[u],!1,F)}}})),void 0===i._dtlsRole&&(i._dtlsRole="offer"===n.type?"active":"passive"),i._remoteDescription={type:n.type,sdp:n.sdp},"offer"===n.type?i._updateSignalingState("have-remote-offer"):i._updateSignalingState("stable"),Object.keys(p).forEach((function(t){var r=p[t];if(r.getTracks().length){if(-1===i.remoteStreams.indexOf(r)){i.remoteStreams.push(r);var n=new Event("addstream");n.stream=r,e.setTimeout((function(){i._dispatchEvent("addstream",n)}))}f.forEach((function(e){var t=e[0],n=e[1];r.id===e[2].id&&l(i,t,n,[r])}))}})),f.forEach((function(e){e[2]||l(i,e[0],e[1],[])})),e.setTimeout((function(){i&&i.transceivers&&i.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},p.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},p.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},p.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},p.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},p.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},p.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(u("InvalidStateError","Can not call createOffer after close"));var n=r.transceivers.filter((function(e){return"audio"===e.kind})).length,a=r.transceivers.filter((function(e){return"video"===e.kind})).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(n=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(a=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(r.transceivers.forEach((function(e){"audio"===e.kind?--n<0&&(e.wantReceive=!1):"video"===e.kind&&--a<0&&(e.wantReceive=!1)}));n>0||a>0;)n>0&&(r._createTransceiver("audio"),n--),a>0&&(r._createTransceiver("video"),a--);var c=o.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach((function(n,i){var a=n.track,s=n.kind,c=n.mid||o.generateIdentifier();n.mid=c,n.iceGatherer||(n.iceGatherer=r._createIceGatherer(i,r.usingBundle));var u=e.RTCRtpSender.getCapabilities(s);t<15019&&(u.codecs=u.codecs.filter((function(e){return"rtx"!==e.name}))),u.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),n.remoteCapabilities&&n.remoteCapabilities.codecs&&n.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),u.headerExtensions.forEach((function(e){(n.remoteCapabilities&&n.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var l=n.sendEncodingParameters||[{ssrc:1001*(2*i+1)}];a&&t>=15019&&"video"===s&&!l[0].rtx&&(l[0].rtx={ssrc:l[0].ssrc+1}),n.wantReceive&&(n.rtpReceiver=new e.RTCRtpReceiver(n.dtlsTransport,s)),n.localCapabilities=u,n.sendEncodingParameters=l})),"max-compat"!==r._config.bundlePolicy&&(c+="a=group:BUNDLE "+r.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),c+="a=ice-options:trickle\r\n",r.transceivers.forEach((function(e,t){c+=i(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),c+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,c+="a="+o.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(c+="a=end-of-candidates\r\n"))}));var l=new e.RTCSessionDescription({type:"offer",sdp:c});return Promise.resolve(l)},p.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(u("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(u("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var n=o.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(n+="a=group:BUNDLE "+r.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),n+="a=ice-options:trickle\r\n";var s=o.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach((function(e,o){if(!(o+1>s)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?n+="m=application 0 DTLS/SCTP 5000\r\n":n+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?n+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(n+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(n+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;e.stream&&("audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var u=a(e.localCapabilities,e.remoteCapabilities);!u.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,n+=i(e,u,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(n+="a=rtcp-rsize\r\n")}}));var c=new e.RTCSessionDescription({type:"answer",sdp:n});return Promise.resolve(c)},p.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(n,i){if(!r._remoteDescription)return i(u("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var a=e.sdpMLineIndex;if(e.sdpMid)for(var s=0;s<r.transceivers.length;s++)if(r.transceivers[s].mid===e.sdpMid){a=s;break}var l=r.transceivers[a];if(!l)return i(u("OperationError","Can not add ICE candidate"));if(l.rejected)return n();var p=Object.keys(e.candidate).length>0?o.parseCandidate(e.candidate):{};if("tcp"===p.protocol&&(0===p.port||9===p.port))return n();if(p.component&&1!==p.component)return n();if((0===a||a>0&&l.iceTransport!==r.transceivers[0].iceTransport)&&!c(l.iceTransport,p))return i(u("OperationError","Can not add ICE candidate"));var f=e.candidate.trim();0===f.indexOf("a=")&&(f=f.substr(2)),(t=o.getMediaSections(r._remoteDescription.sdp))[a]+="a="+(p.type?f:"end-of-candidates")+"\r\n",r._remoteDescription.sdp=o.getDescription(r._remoteDescription.sdp)+t.join("")}else for(var d=0;d<r.transceivers.length&&(r.transceivers[d].rejected||(r.transceivers[d].iceTransport.addRemoteCandidate({}),(t=o.getMediaSections(r._remoteDescription.sdp))[d]+="a=end-of-candidates\r\n",r._remoteDescription.sdp=o.getDescription(r._remoteDescription.sdp)+t.join(""),!r.usingBundle));d++);n()}))},p.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)})),!r)throw u("InvalidAccessError","Invalid selector.");return r.getStats()}var n=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&n.push(e[t].getStats())}))})),Promise.all(n).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var n=r.prototype.getStats;r.prototype.getStats=function(){return n.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(r){var n;e[r].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(n=e[r]).type]||n.type,t.set(r,e[r])})),t}))}}}));var f=["createOffer","createAnswer"];return f.forEach((function(e){var t=p.prototype[e];p.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(f=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=p.prototype[e];p.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=p.prototype[e];p.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),p}},1723:e=>{var t=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",(t+=null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(t).forEach((function(e){t[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},9652:(e,t,r)=>{var n=r(2973),o=r(9721);t.write=o,t.parse=n.parse,t.parseParams=n.parseParams,t.parseFmtpConfig=n.parseFmtpConfig,t.parsePayloads=n.parsePayloads,t.parseRemoteCandidates=n.parseRemoteCandidates,t.parseImageAttributes=n.parseImageAttributes,t.parseSimulcastStreamList=n.parseSimulcastStreamList},2973:(e,t,r)=>{var n=function(e){return String(Number(e))===e?Number(e):e},o=function(e,t,r){var o=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:o&&!t[e.name]&&(t[e.name]={});var i=e.push?{}:o?t[e.name]:t;!function(e,t,r,o){if(o&&!r)t[o]=n(e[1]);else for(var i=0;i<r.length;i+=1)null!=e[i+1]&&(t[r[i]]=n(e[i+1]))}(r.match(e.reg),i,e.names,e.name),e.push&&t[e.push].push(i)},i=r(1723),a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(a).forEach((function(e){var t=e[0],a=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var s=0;s<(i[t]||[]).length;s+=1){var c=i[t][s];if(c.reg.test(a))return o(c,n,a)}})),t.media=r,t};var s=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=n(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(n),o=0;o<r.length;o+=3)t.push({component:r[o],ip:r[o+1],port:r[o+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,r=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}}))}))}},9721:(e,t,r)=>{var n=r(1723),o=/%[sdv%]/g,i=function(e){var t=1,r=arguments,n=r.length;return e.replace(o,(function(e){if(t>=n)return e;var o=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(o);case"%d":return Number(o);case"%v":return""}}))},a=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var a=t.names[o];t.name?n.push(r[t.name][a]):n.push(r[t.names[o]])}else n.push(r[t.name]);return i.apply(null,n)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||s,o=t.innerOrder||c,i=[];return r.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(a(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(a(t,r,e))}))}))})),e.media.forEach((function(e){i.push(a("m",n.m[0],e)),o.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(a(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(a(t,r,e))}))}))}))})),i.join("\r\n")+"\r\n"}},3074:(e,t,r)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}e=r.nmd(e);var o={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};o.localCName=o.generateIdentifier(),o.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},o.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},o.getDescription=function(e){var t=o.splitSections(e);return t&&t[0]},o.getMediaSections=function(e){var t=o.splitSections(e);return t.shift(),t},o.matchPrefix=function(e,t){return o.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},o.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1]}return r},o.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},o.parseIceOptions=function(e){return e.substr(14).split(" ")},o.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},o.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},o.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},o.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},o.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),o=0;o<n.length;o++)r[(t=n[o].trim().split("="))[0].trim()]=t[1];return r},o.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)})),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},o.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},o.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},o.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},o.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},o.getMid=function(e){var t=o.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},o.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},o.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:o.matchPrefix(e+t,"a=fingerprint:").map(o.parseFingerprint)}},o.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),r},o.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},o.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===n(e.keyParams)?o.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},o.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},o.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},o.getCryptoParameters=function(e,t){return o.matchPrefix(e+t,"a=crypto:").map(o.parseCryptoLine)},o.getIceParameters=function(e,t){var r=o.matchPrefix(e+t,"a=ice-ufrag:")[0],n=o.matchPrefix(e+t,"a=ice-pwd:")[0];return r&&n?{usernameFragment:r.substr(12),password:n.substr(10)}:null},o.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},o.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=o.splitLines(e)[0].split(" "),n=3;n<r.length;n++){var i=r[n],a=o.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(a){var s=o.parseRtpMap(a),c=o.matchPrefix(e,"a=fmtp:"+i+" ");switch(s.parameters=c.length?o.parseFmtp(c[0]):{},s.rtcpFeedback=o.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(o.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return o.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(o.parseExtmap(e))})),t},o.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){r+=o.writeRtpMap(e),r+=o.writeFmtp(e),r+=o.writeRtcpFb(e)}));var n=0;return t.codecs.forEach((function(e){e.maxptime>n&&(n=e.maxptime)})),n>0&&(r+="a=maxptime:"+n+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach((function(e){r+=o.writeExtmap(e)})),r},o.parseRtpEncodingParameters=function(e){var t,r=[],n=o.parseRtpParameters(e),i=-1!==n.fecMechanisms.indexOf("RED"),a=-1!==n.fecMechanisms.indexOf("ULPFEC"),s=o.matchPrefix(e,"a=ssrc:").map((function(e){return o.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=s.length>0&&s[0].ssrc,u=o.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),n.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(n.rtx={ssrc:t}),r.push(n),i&&((n=JSON.parse(JSON.stringify(n))).fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},r.push(n))}})),0===r.length&&c&&r.push({ssrc:c});var l=o.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,r.forEach((function(e){e.maxBitrate=l}))),r},o.parseRtcpParameters=function(e){var t={},r=o.matchPrefix(e,"a=ssrc:").map((function(e){return o.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var n=o.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=n.length>0,t.compound=0===n.length;var i=o.matchPrefix(e,"a=rtcp-mux");return t.mux=i.length>0,t},o.parseMsid=function(e){var t,r=o.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};var n=o.matchPrefix(e,"a=ssrc:").map((function(e){return o.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return n.length>0?{stream:(t=n[0].value.split(" "))[0],track:t[1]}:void 0},o.parseSctpDescription=function(e){var t,r=o.parseMLine(e),n=o.matchPrefix(e,"a=max-message-size:");n.length>0&&(t=parseInt(n[0].substr(19),10)),isNaN(t)&&(t=65536);var i=o.matchPrefix(e,"a=sctp-port:");if(i.length>0)return{port:parseInt(i[0].substr(12),10),protocol:r.fmt,maxMessageSize:t};if(o.matchPrefix(e,"a=sctpmap:").length>0){var a=o.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:t}}},o.writeSctpDescription=function(e,t){var r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},o.generateSessionId=function(){return Math.random().toString().substr(2,21)},o.writeSessionBoilerplate=function(e,t,r){var n=void 0!==t?t:2;return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||o.generateSessionId())+" "+n+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},o.writeMediaSection=function(e,t,r,n){var i=o.writeRtpDescription(e.kind,t);if(i+=o.writeIceParameters(e.iceGatherer.getLocalParameters()),i+=o.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),i+="a=mid:"+e.mid+"\r\n",e.direction?i+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?i+="a=sendrecv\r\n":e.rtpSender?i+="a=sendonly\r\n":e.rtpReceiver?i+="a=recvonly\r\n":i+="a=inactive\r\n",e.rtpSender){var a="msid:"+n.id+" "+e.rtpSender.track.id+"\r\n";i+="a="+a,i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,i+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+o.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+o.localCName+"\r\n"),i},o.getDirection=function(e,t){for(var r=o.splitLines(e),n=0;n<r.length;n++)switch(r[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[n].substr(2)}return t?o.getDirection(t):"sendrecv"},o.getKind=function(e){return o.splitLines(e)[0].split(" ")[0].substr(2)},o.isRejected=function(e){return"0"===e.split(" ",2)[1]},o.parseMLine=function(e){var t=o.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},o.parseOLine=function(e){var t=o.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},o.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=o.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},"object"===n(e)&&(e.exports=o)},7492:function(e,t,r){var n;function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}e=r.nmd(e),function(i,a){"use strict";var s="function",c="undefined",u="object",l="string",p="major",f="model",d="name",h="type",v="vendor",m="version",y="architecture",g="console",b="mobile",w="tablet",_="smarttv",S="wearable",k="embedded",x="Amazon",R="Apple",P="ASUS",O="BlackBerry",E="Browser",T="Chrome",C="Firefox",j="Google",L="Huawei",D="LG",I="Microsoft",M="Motorola",A="Opera",N="Samsung",F="Sharp",B="Sony",G="Xiaomi",V="Zebra",U="Facebook",q="Chromium OS",z="Mac OS",W=function(e){for(var t={},r=0;r<e.length;r++)t[e[r].toUpperCase()]=e[r];return t},K=function(e,t){return o(e)===l&&-1!==Y(t).indexOf(Y(e))},Y=function(e){return e.toLowerCase()},H=function(e,t){if(o(e)===l)return e=e.replace(/^\s\s*/,""),o(t)===c?e:e.substring(0,500)},J=function(e,t){for(var r,n,i,c,l,p,f=0;f<t.length&&!l;){var d=t[f],h=t[f+1];for(r=n=0;r<d.length&&!l&&d[r];)if(l=d[r++].exec(e))for(i=0;i<h.length;i++)p=l[++n],o(c=h[i])===u&&c.length>0?2===c.length?o(c[1])==s?this[c[0]]=c[1].call(this,p):this[c[0]]=c[1]:3===c.length?o(c[1])!==s||c[1].exec&&c[1].test?this[c[0]]=p?p.replace(c[1],c[2]):a:this[c[0]]=p?c[1].call(this,p,c[2]):a:4===c.length&&(this[c[0]]=p?c[3].call(this,p.replace(c[1],c[2])):a):this[c]=p||a;f+=2}},$=function(e,t){for(var r in t)if(o(t[r])===u&&t[r].length>0){for(var n=0;n<t[r].length;n++)if(K(t[r][n],e))return"?"===r?a:r}else if(K(t[r],e))return"?"===r?a:r;return e},Q={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},X={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[m,[d,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[m,[d,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[d,m],[/opios[\/ ]+([\w\.]+)/i],[m,[d,A+" Mini"]],[/\bopr\/([\w\.]+)/i],[m,[d,A]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[m,[d,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[d,m],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[m,[d,"UC"+E]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[m,[d,"WeChat"]],[/konqueror\/([\w\.]+)/i],[m,[d,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[m,[d,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[m,[d,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[m,[d,"Smart Lenovo "+E]],[/(avast|avg)\/([\w\.]+)/i],[[d,/(.+)/,"$1 Secure "+E],m],[/\bfocus\/([\w\.]+)/i],[m,[d,C+" Focus"]],[/\bopt\/([\w\.]+)/i],[m,[d,A+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[m,[d,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[m,[d,"Dolphin"]],[/coast\/([\w\.]+)/i],[m,[d,A+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[m,[d,"MIUI "+E]],[/fxios\/([-\w\.]+)/i],[m,[d,C]],[/\bqihu|(qi?ho?o?|360)browser/i],[[d,"360 "+E]],[/(oculus|sailfish|huawei|vivo)browser\/([\w\.]+)/i],[[d,/(.+)/,"$1 "+E],m],[/samsungbrowser\/([\w\.]+)/i],[m,[d,N+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[d,/_/g," "],m],[/metasr[\/ ]?([\d\.]+)/i],[m,[d,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[d,"Sogou Mobile"],m],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[d,m],[/(lbbrowser)/i,/\[(linkedin)app\]/i],[d],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[d,U],m],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[d,m],[/\bgsa\/([\w\.]+) .*safari\//i],[m,[d,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[m,[d,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[m,[d,T+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[d,T+" WebView"],m],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[m,[d,"Android "+E]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[d,m],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[m,[d,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[m,d],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[d,[m,$,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[d,m],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[d,"Netscape"],m],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[m,[d,C+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[d,m],[/(cobalt)\/([\w\.]+)/i],[d,[m,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[y,"amd64"]],[/(ia32(?=;))/i],[[y,Y]],[/((?:i[346]|x)86)[;\)]/i],[[y,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[y,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[y,"armhf"]],[/windows (ce|mobile); ppc;/i],[[y,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[y,/ower/,"",Y]],[/(sun4\w)[;\)]/i],[[y,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[y,Y]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[f,[v,N],[h,w]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[f,[v,N],[h,b]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[f,[v,R],[h,b]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[f,[v,R],[h,w]],[/(macintosh);/i],[f,[v,R]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[f,[v,F],[h,b]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[f,[v,L],[h,w]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[f,[v,L],[h,b]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[f,/_/g," "],[v,G],[h,b]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[f,/_/g," "],[v,G],[h,w]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[f,[v,"OPPO"],[h,b]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[f,[v,"Vivo"],[h,b]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[f,[v,"Realme"],[h,b]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[f,[v,M],[h,b]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[f,[v,M],[h,w]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[f,[v,D],[h,w]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[f,[v,D],[h,b]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[f,[v,"Lenovo"],[h,w]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[f,/_/g," "],[v,"Nokia"],[h,b]],[/(pixel c)\b/i],[f,[v,j],[h,w]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[f,[v,j],[h,b]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[f,[v,B],[h,b]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[f,"Xperia Tablet"],[v,B],[h,w]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[f,[v,"OnePlus"],[h,b]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[f,[v,x],[h,w]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[f,/(.+)/g,"Fire Phone $1"],[v,x],[h,b]],[/(playbook);[-\w\),; ]+(rim)/i],[f,v,[h,w]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[f,[v,O],[h,b]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[f,[v,P],[h,w]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[f,[v,P],[h,b]],[/(nexus 9)/i],[f,[v,"HTC"],[h,w]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[v,[f,/_/g," "],[h,b]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[f,[v,"Acer"],[h,w]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[f,[v,"Meizu"],[h,b]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[f,[v,"Ulefone"],[h,b]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[v,f,[h,b]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[v,f,[h,w]],[/(surface duo)/i],[f,[v,I],[h,w]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[f,[v,"Fairphone"],[h,b]],[/(u304aa)/i],[f,[v,"AT&T"],[h,b]],[/\bsie-(\w*)/i],[f,[v,"Siemens"],[h,b]],[/\b(rct\w+) b/i],[f,[v,"RCA"],[h,w]],[/\b(venue[\d ]{2,7}) b/i],[f,[v,"Dell"],[h,w]],[/\b(q(?:mv|ta)\w+) b/i],[f,[v,"Verizon"],[h,w]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[f,[v,"Barnes & Noble"],[h,w]],[/\b(tm\d{3}\w+) b/i],[f,[v,"NuVision"],[h,w]],[/\b(k88) b/i],[f,[v,"ZTE"],[h,w]],[/\b(nx\d{3}j) b/i],[f,[v,"ZTE"],[h,b]],[/\b(gen\d{3}) b.+49h/i],[f,[v,"Swiss"],[h,b]],[/\b(zur\d{3}) b/i],[f,[v,"Swiss"],[h,w]],[/\b((zeki)?tb.*\b) b/i],[f,[v,"Zeki"],[h,w]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[v,"Dragon Touch"],f,[h,w]],[/\b(ns-?\w{0,9}) b/i],[f,[v,"Insignia"],[h,w]],[/\b((nxa|next)-?\w{0,9}) b/i],[f,[v,"NextBook"],[h,w]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[v,"Voice"],f,[h,b]],[/\b(lvtel\-)?(v1[12]) b/i],[[v,"LvTel"],f,[h,b]],[/\b(ph-1) /i],[f,[v,"Essential"],[h,b]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[f,[v,"Envizen"],[h,w]],[/\b(trio[-\w\. ]+) b/i],[f,[v,"MachSpeed"],[h,w]],[/\btu_(1491) b/i],[f,[v,"Rotor"],[h,w]],[/(shield[\w ]+) b/i],[f,[v,"Nvidia"],[h,w]],[/(sprint) (\w+)/i],[v,f,[h,b]],[/(kin\.[onetw]{3})/i],[[f,/\./g," "],[v,I],[h,b]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[f,[v,V],[h,w]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[f,[v,V],[h,b]],[/smart-tv.+(samsung)/i],[v,[h,_]],[/hbbtv.+maple;(\d+)/i],[[f,/^/,"SmartTV"],[v,N],[h,_]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[v,D],[h,_]],[/(apple) ?tv/i],[v,[f,R+" TV"],[h,_]],[/crkey/i],[[f,T+"cast"],[v,j],[h,_]],[/droid.+aft(\w+)( bui|\))/i],[f,[v,x],[h,_]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[f,[v,F],[h,_]],[/(bravia[\w ]+)( bui|\))/i],[f,[v,B],[h,_]],[/(mitv-\w{5}) bui/i],[f,[v,G],[h,_]],[/Hbbtv.*(technisat) (.*);/i],[v,f,[h,_]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[v,H],[f,H],[h,_]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[h,_]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[v,f,[h,g]],[/droid.+; (shield) bui/i],[f,[v,"Nvidia"],[h,g]],[/(playstation [345portablevi]+)/i],[f,[v,B],[h,g]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[f,[v,I],[h,g]],[/((pebble))app/i],[v,f,[h,S]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[f,[v,R],[h,S]],[/droid.+; (glass) \d/i],[f,[v,j],[h,S]],[/droid.+; (wt63?0{2,3})\)/i],[f,[v,V],[h,S]],[/(quest( 2| pro)?)/i],[f,[v,U],[h,S]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[v,[h,k]],[/(aeobc)\b/i],[f,[v,x],[h,k]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[f,[h,b]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[f,[h,w]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[h,w]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[h,b]],[/(android[-\w\. ]{0,9});.+buil/i],[f,[v,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[m,[d,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[m,[d,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[d,m],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[m,d]],os:[[/microsoft (windows) (vista|xp)/i],[d,m],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[d,[m,$,Q]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[m,$,Q],[d,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[m,/_/g,"."],[d,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[d,z],[m,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[m,d],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[d,m],[/\(bb(10);/i],[m,[d,O]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[m,[d,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[m,[d,C+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[m,[d,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[m,[d,"watchOS"]],[/crkey\/([\d\.]+)/i],[m,[d,T+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[d,q],m],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[d,m],[/(sunos) ?([\w\.\d]*)/i],[[d,"Solaris"],m],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[d,m]]},Z=function e(t,r){if(o(t)===u&&(r=t,t=a),!(this instanceof e))return new e(t,r).getResult();var n=o(i)!==c&&i.navigator?i.navigator:a,g=t||(n&&n.userAgent?n.userAgent:""),_=n&&n.userAgentData?n.userAgentData:a,S=r?function(e,t){var r={};for(var n in e)t[n]&&t[n].length%2==0?r[n]=t[n].concat(e[n]):r[n]=e[n];return r}(X,r):X,k=n&&n.userAgent==g;return this.getBrowser=function(){var e,t={};return t[d]=a,t[m]=a,J.call(t,g,S.browser),t[p]=o(e=t[m])===l?e.replace(/[^\d\.]/g,"").split(".")[0]:a,k&&n&&n.brave&&o(n.brave.isBrave)==s&&(t[d]="Brave"),t},this.getCPU=function(){var e={};return e[y]=a,J.call(e,g,S.cpu),e},this.getDevice=function(){var e={};return e[v]=a,e[f]=a,e[h]=a,J.call(e,g,S.device),k&&!e[h]&&_&&_.mobile&&(e[h]=b),k&&"Macintosh"==e[f]&&n&&o(n.standalone)!==c&&n.maxTouchPoints&&n.maxTouchPoints>2&&(e[f]="iPad",e[h]=w),e},this.getEngine=function(){var e={};return e[d]=a,e[m]=a,J.call(e,g,S.engine),e},this.getOS=function(){var e={};return e[d]=a,e[m]=a,J.call(e,g,S.os),k&&!e[d]&&_&&"Unknown"!=_.platform&&(e[d]=_.platform.replace(/chrome os/i,q).replace(/macos/i,z)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return g},this.setUA=function(e){return g=o(e)===l&&e.length>500?H(e,500):e,this},this.setUA(g),this};Z.VERSION="1.0.37",Z.BROWSER=W([d,m,p]),Z.CPU=W([y]),Z.DEVICE=W([f,v,h,g,b,_,w,S,k]),Z.ENGINE=Z.OS=W([d,m]),o(t)!==c?(o(e)!==c&&e.exports&&(t=e.exports=Z),t.UAParser=Z):o(r.amdD)===s&&r.amdO?(n=function(){return Z}.call(t,r,t,e))===a||(e.exports=n):o(i)!==c&&(i.UAParser=Z);var ee=o(i)!==c&&(i.jQuery||i.Zepto);if(ee&&!ee.ua){var te=new Z;ee.ua=te.getResult(),ee.ua.get=function(){return te.getUA()},ee.ua.set=function(e){te.setUA(e);var t=te.getResult();for(var r in t)ee.ua[r]=t[r]}}}("object"===("undefined"==typeof window?"undefined":o(window))?window:this)},7444:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}var o;if("object"===("undefined"==typeof globalThis?"undefined":n(globalThis)))o=globalThis;else try{o=r(9257)}catch(e){}finally{if(o||"undefined"==typeof window||(o=window),!o)throw new Error("Could not determine global this")}var i=o.WebSocket||o.MozWebSocket,a=r(1433);function s(e,t){return t?new i(e,t):new i(e)}i&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach((function(e){Object.defineProperty(s,e,{get:function(){return i[e]}})})),e.exports={w3cwebsocket:i?s:null,version:a}},1433:(e,t,r)=>{e.exports=r(9794).version},7002:e=>{"use strict";e.exports=JSON.parse('{"name":"protoo-client","version":"4.0.6","description":"protoo JavaScript client module","author":"Iaki Baz Castillo <ibc@aliax.net>","homepage":"https://protoo.versatica.com","license":"MIT","repository":{"type":"git","url":"https://github.com/ibc/protoo.git"},"main":"lib/index.js","keywords":["nodejs","browser","websocket"],"engines":{"node":">=8.0.0"},"scripts":{"lint":"eslint -c .eslintrc.js lib"},"dependencies":{"debug":"^4.3.1","events":"^3.2.0","retry":"^0.12.0"},"devDependencies":{"eslint":"^5.16.0"},"optionalDependencies":{"websocket":"^1.0.33"}}')},9794:e=>{"use strict";e.exports={version:"1.0.34"}}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}r.amdD=function(){throw new Error("define cannot be used indirect")},r.amdO={},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var n={};return(()=>{"use strict";r.r(n),r.d(n,{EventManager:()=>Dn,default:()=>Ki,logger:()=>Un});var e={};r.r(e),r.d(e,{Decoder:()=>yt,Encoder:()=>vt,PacketType:()=>ft,protocol:()=>ht});var t={};r.r(t),r.d(t,{fixNegotiationNeeded:()=>mr,shimAddTrackRemoveTrack:()=>hr,shimAddTrackRemoveTrackWithNative:()=>dr,shimGetDisplayMedia:()=>ir,shimGetSendersWithDtmf:()=>lr,shimGetStats:()=>pr,shimGetUserMedia:()=>or,shimMediaStream:()=>cr,shimOnTrack:()=>ur,shimPeerConnection:()=>vr,shimSenderReceiverGetStats:()=>fr});var o={};r.r(o),r.d(o,{shimGetDisplayMedia:()=>wr,shimGetUserMedia:()=>br,shimPeerConnection:()=>_r,shimReplaceTrack:()=>Sr});var i={};r.r(i),r.d(i,{shimAddTransceiver:()=>Ir,shimCreateAnswer:()=>Ar,shimCreateOffer:()=>Mr,shimGetDisplayMedia:()=>Rr,shimGetUserMedia:()=>xr,shimOnTrack:()=>Er,shimPeerConnection:()=>Tr,shimRTCDataChannel:()=>Dr,shimReceiverGetStats:()=>jr,shimRemoveStream:()=>Lr,shimSenderGetStats:()=>Cr});var a={};r.r(a),r.d(a,{shimCallbacksAPI:()=>Vr,shimConstraints:()=>qr,shimCreateOfferLegacy:()=>Kr,shimGetUserMedia:()=>Ur,shimLocalStreamsAPI:()=>Br,shimRTCIceServerUrls:()=>zr,shimRemoteStreamsAPI:()=>Gr,shimTrackEventTransceiver:()=>Wr});var s={};r.r(s),r.d(s,{removeAllowExtmapMixed:()=>tn,shimConnectionState:()=>en,shimMaxMessageSize:()=>Xr,shimRTCIceCandidate:()=>Qr,shimSendThrowTypeError:()=>Zr});var c={};r.r(c),r.d(c,{CHANNEL_CLOSE:()=>dn,CHANNEL_ERROR:()=>vn,CHANNEL_MESSAGE:()=>hn,CHANNEL_OPEN:()=>pn,CHANNEL_REOPEN:()=>fn,CHANNEL_RETRY:()=>mn,LOGGED_ON_CONSOLE:()=>ln,ON_INCOMING_SCREEN_STREAM:()=>sn,ON_INCOMING_STREAM:()=>an,STREAM_ENDED:()=>cn,STREAM_MUTED:()=>un});var u=Object.create(null);u.open="0",u.close="1",u.ping="2",u.pong="3",u.message="4",u.upgrade="5",u.noop="6";var l=Object.create(null);Object.keys(u).forEach((function(e){l[u[e]]=e}));var p,f={type:"error",data:"parser error"},d="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),h="function"==typeof ArrayBuffer,v=function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer},m=function(e,t,r){var n=e.type,o=e.data;return d&&o instanceof Blob?t?r(o):y(o,r):h&&(o instanceof ArrayBuffer||v(o))?t?r(o):y(new Blob([o]),r):r(u[n]+(o||""))},y=function(e,t){var r=new FileReader;return r.onload=function(){var e=r.result.split(",")[1];t("b"+(e||""))},r.readAsDataURL(e)};function g(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}for(var b="undefined"==typeof Uint8Array?[]:new Uint8Array(256),w=0;w<64;w++)b["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(w)]=w;var _,S="function"==typeof ArrayBuffer,k=function(e,t){if("string"!=typeof e)return{type:"message",data:R(e,t)};var r=e.charAt(0);return"b"===r?{type:"message",data:x(e.substring(1),t)}:l[r]?e.length>1?{type:l[r],data:e.substring(1)}:{type:l[r]}:f},x=function(e,t){if(S){var r=function(e){var t,r,n,o,i,a=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var u=new ArrayBuffer(a),l=new Uint8Array(u);for(t=0;t<s;t+=4)r=b[e.charCodeAt(t)],n=b[e.charCodeAt(t+1)],o=b[e.charCodeAt(t+2)],i=b[e.charCodeAt(t+3)],l[c++]=r<<2|n>>4,l[c++]=(15&n)<<4|o>>2,l[c++]=(3&o)<<6|63&i;return u}(e);return R(r,t)}return{base64:!0,data:e}},R=function(e,t){return"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer},P=String.fromCharCode(30);function O(e){return e.reduce((function(e,t){return e+t.length}),0)}function E(e,t){if(e[0].length===t)return e.shift();for(var r=new Uint8Array(t),n=0,o=0;o<t;o++)r[o]=e[0][n++],n===e[0].length&&(e.shift(),n=0);return e.length&&n<e[0].length&&(e[0]=e[0].slice(n)),r}function T(e){if(e)return function(e){for(var t in T.prototype)e[t]=T.prototype[t];return e}(e)}T.prototype.on=T.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},T.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},T.prototype.off=T.prototype.removeListener=T.prototype.removeAllListeners=T.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var o=0;o<n.length;o++)if((r=n[o])===t||r.fn===t){n.splice(o,1);break}return 0===n.length&&delete this._callbacks["$"+e],this},T.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(r){n=0;for(var o=(r=r.slice(0)).length;n<o;++n)r[n].apply(this,t)}return this},T.prototype.emitReserved=T.prototype.emit,T.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},T.prototype.hasListeners=function(e){return!!this.listeners(e).length};var C="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function j(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return r.reduce((function(t,r){return e.hasOwnProperty(r)&&(t[r]=e[r]),t}),{})}var L=C.setTimeout,D=C.clearTimeout;function I(e,t){t.useNativeTimers?(e.setTimeoutFn=L.bind(C),e.clearTimeoutFn=D.bind(C)):(e.setTimeoutFn=C.setTimeout.bind(C),e.clearTimeoutFn=C.clearTimeout.bind(C))}function M(e){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M(e)}function A(){return A="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Y(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(arguments.length<3?e:r):o.value}},A.apply(this,arguments)}function N(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==M(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==M(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===M(o)?o:String(o)),n)}var o}function F(e,t,r){return t&&N(e.prototype,t),r&&N(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function B(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function G(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&K(e,t)}function V(e){var t=W();return function(){var r,n=Y(e);if(t){var o=Y(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===M(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return U(e)}(this,r)}}function U(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function q(e){var t="function"==typeof Map?new Map:void 0;return q=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return z(e,arguments,Y(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),K(r,e)},q(e)}function z(e,t,r){return z=W()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&K(o,r.prototype),o},z.apply(null,arguments)}function W(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function K(e,t){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},K(e,t)}function Y(e){return Y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Y(e)}var H,J=function(e){G(r,e);var t=V(r);function r(e,n,o){var i;return B(this,r),(i=t.call(this,e)).description=n,i.context=o,i.type="TransportError",i}return F(r)}(q(Error)),$=function(e){G(r,e);var t=V(r);function r(e){var n;return B(this,r),(n=t.call(this)).writable=!1,I(U(n),e),n.opts=e,n.query=e.query,n.socket=e.socket,n}return F(r,[{key:"onError",value:function(e,t,n){return A(Y(r.prototype),"emitReserved",this).call(this,"error",new J(e,t,n)),this}},{key:"open",value:function(){return this.readyState="opening",this.doOpen(),this}},{key:"close",value:function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}},{key:"send",value:function(e){"open"===this.readyState&&this.write(e)}},{key:"onOpen",value:function(){this.readyState="open",this.writable=!0,A(Y(r.prototype),"emitReserved",this).call(this,"open")}},{key:"onData",value:function(e){var t=k(e,this.socket.binaryType);this.onPacket(t)}},{key:"onPacket",value:function(e){A(Y(r.prototype),"emitReserved",this).call(this,"packet",e)}},{key:"onClose",value:function(e){this.readyState="closed",A(Y(r.prototype),"emitReserved",this).call(this,"close",e)}},{key:"pause",value:function(e){}},{key:"createUri",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}},{key:"_hostname",value:function(){var e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}},{key:"_port",value:function(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}},{key:"_query",value:function(e){var t=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t}(e);return t.length?"?"+t:""}}]),r}(T),Q="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),X=64,Z={},ee=0,te=0;function re(e){var t="";do{t=Q[e%X]+t,e=Math.floor(e/X)}while(e>0);return t}function ne(){var e=re(+new Date);return e!==H?(ee=0,H=e):e+"."+re(ee++)}for(;te<X;te++)Z[Q[te]]=te;var oe=!1;try{oe="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}var ie=oe;function ae(e){var t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||ie))return new XMLHttpRequest}catch(e){}if(!t)try{return new(C[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function se(e){return se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},se(e)}function ce(){return ce=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ce.apply(this,arguments)}function ue(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function le(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==se(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==se(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===se(o)?o:String(o)),n)}var o}function pe(e,t,r){return t&&le(e.prototype,t),r&&le(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function fe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&de(e,t)}function de(e,t){return de=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},de(e,t)}function he(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=me(e);if(t){var o=me(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===se(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ve(e)}(this,r)}}function ve(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function me(e){return me=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},me(e)}function ye(){}var ge=null!=new ae({xdomain:!1}).responseType,be=function(e){fe(r,e);var t=he(r);function r(e){var n;if(ue(this,r),(n=t.call(this,e)).polling=!1,"undefined"!=typeof location){var o="https:"===location.protocol,i=location.port;i||(i=o?"443":"80"),n.xd="undefined"!=typeof location&&e.hostname!==location.hostname||i!==e.port}var a=e&&e.forceBase64;return n.supportsBinary=ge&&!a,n.opts.withCredentials&&(n.cookieJar=void 0),n}return pe(r,[{key:"name",get:function(){return"polling"}},{key:"doOpen",value:function(){this.poll()}},{key:"pause",value:function(e){var t=this;this.readyState="pausing";var r=function(){t.readyState="paused",e()};if(this.polling||!this.writable){var n=0;this.polling&&(n++,this.once("pollComplete",(function(){--n||r()}))),this.writable||(n++,this.once("drain",(function(){--n||r()})))}else r()}},{key:"poll",value:function(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}},{key:"onData",value:function(e){var t=this;(function(e,t){for(var r=e.split(P),n=[],o=0;o<r.length;o++){var i=k(r[o],t);if(n.push(i),"error"===i.type)break}return n})(e,this.socket.binaryType).forEach((function(e){if("opening"===t.readyState&&"open"===e.type&&t.onOpen(),"close"===e.type)return t.onClose({description:"transport closed by the server"}),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}},{key:"doClose",value:function(){var e=this,t=function(){e.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}},{key:"write",value:function(e){var t=this;this.writable=!1,function(e,r){var n=e.length,o=new Array(n),i=0;e.forEach((function(e,r){m(e,!1,(function(e){var a;o[r]=e,++i===n&&(a=o.join(P),t.doWrite(a,(function(){t.writable=!0,t.emitReserved("drain")})))}))}))}(e)}},{key:"uri",value:function(){var e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=ne()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}},{key:"request",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return ce(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new we(this.uri(),e)}},{key:"doWrite",value:function(e,t){var r=this,n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(function(e,t){r.onError("xhr post error",e,t)}))}},{key:"doPoll",value:function(){var e=this,t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(function(t,r){e.onError("xhr poll error",t,r)})),this.pollXhr=t}}]),r}($),we=function(e){fe(r,e);var t=he(r);function r(e,n){var o;return ue(this,r),I(ve(o=t.call(this)),n),o.opts=n,o.method=n.method||"GET",o.uri=e,o.data=void 0!==n.data?n.data:null,o.create(),o}return pe(r,[{key:"create",value:function(){var e,t=this,n=j(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this.opts.xd;var o=this.xhr=new ae(n);try{o.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders)for(var i in o.setDisableHeaderCheck&&o.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(i)&&o.setRequestHeader(i,this.opts.extraHeaders[i])}catch(e){}if("POST"===this.method)try{o.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{o.setRequestHeader("Accept","*/*")}catch(e){}null===(e=this.opts.cookieJar)||void 0===e||e.addCookies(o),"withCredentials"in o&&(o.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(o.timeout=this.opts.requestTimeout),o.onreadystatechange=function(){var e;3===o.readyState&&(null===(e=t.opts.cookieJar)||void 0===e||e.parseCookies(o)),4===o.readyState&&(200===o.status||1223===o.status?t.onLoad():t.setTimeoutFn((function(){t.onError("number"==typeof o.status?o.status:0)}),0))},o.send(this.data)}catch(e){return void this.setTimeoutFn((function(){t.onError(e)}),0)}"undefined"!=typeof document&&(this.index=r.requestsCount++,r.requests[this.index]=this)}},{key:"onError",value:function(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}},{key:"cleanup",value:function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=ye,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete r.requests[this.index],this.xhr=null}}},{key:"onLoad",value:function(){var e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}},{key:"abort",value:function(){this.cleanup()}}]),r}(T);function _e(){for(var e in we.requests)we.requests.hasOwnProperty(e)&&we.requests[e].abort()}we.requestsCount=0,we.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",_e):"function"==typeof addEventListener&&addEventListener("onpagehide"in C?"pagehide":"unload",_e,!1));var Se="function"==typeof Promise&&"function"==typeof Promise.resolve?function(e){return Promise.resolve().then(e)}:function(e,t){return t(e,0)},ke=C.WebSocket||C.MozWebSocket;function xe(e){return xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xe(e)}function Re(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==xe(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==xe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===xe(o)?o:String(o)),n)}var o}function Pe(e,t){return Pe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Pe(e,t)}function Oe(e){return Oe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Oe(e)}var Ee="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),Te=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Pe(e,t)}(a,e);var t,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Oe(n);if(o){var r=Oe(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===xe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e)).supportsBinary=!e.forceBase64,t}return t=a,r=[{key:"name",get:function(){return"websocket"}},{key:"doOpen",value:function(){if(this.check()){var e=this.uri(),t=this.opts.protocols,r=Ee?{}:j(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=Ee?new ke(e,t,r):t?new ke(e,t):new ke(e)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}}},{key:"addEventListeners",value:function(){var e=this;this.ws.onopen=function(){e.opts.autoUnref&&e.ws._socket.unref(),e.onOpen()},this.ws.onclose=function(t){return e.onClose({description:"websocket connection closed",context:t})},this.ws.onmessage=function(t){return e.onData(t.data)},this.ws.onerror=function(t){return e.onError("websocket error",t)}}},{key:"write",value:function(e){var t=this;this.writable=!1;for(var r=function(){var r=e[n],o=n===e.length-1;m(r,t.supportsBinary,(function(e){try{t.ws.send(e)}catch(e){}o&&Se((function(){t.writable=!0,t.emitReserved("drain")}),t.setTimeoutFn)}))},n=0;n<e.length;n++)r()}},{key:"doClose",value:function(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}},{key:"uri",value:function(){var e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=ne()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}},{key:"check",value:function(){return!!ke}}],r&&Re(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),a}($);function Ce(e){return Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ce(e)}function je(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Ce(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Ce(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Ce(o)?o:String(o)),n)}var o}function Le(e,t){return Le=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Le(e,t)}function De(e){return De=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},De(e)}var Ie=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Le(e,t)}(a,e);var t,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=De(n);if(o){var r=De(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Ce(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),i.apply(this,arguments)}return t=a,r=[{key:"name",get:function(){return"webtransport"}},{key:"doOpen",value:function(){var e=this;"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then((function(){e.onClose()})).catch((function(t){e.onError("webtransport error",t)})),this.transport.ready.then((function(){e.transport.createBidirectionalStream().then((function(t){var r=function(e,t){_||(_=new TextDecoder);var r=[],n=0,o=-1,i=!1;return new TransformStream({transform:function(a,s){for(r.push(a);;){if(0===n){if(O(r)<1)break;var c=E(r,1);i=128==(128&c[0]),o=127&c[0],n=o<126?3:126===o?1:2}else if(1===n){if(O(r)<2)break;var u=E(r,2);o=new DataView(u.buffer,u.byteOffset,u.length).getUint16(0),n=3}else if(2===n){if(O(r)<8)break;var l=E(r,8),p=new DataView(l.buffer,l.byteOffset,l.length),d=p.getUint32(0);if(d>Math.pow(2,21)-1){s.enqueue(f);break}o=d*Math.pow(2,32)+p.getUint32(4),n=3}else{if(O(r)<o)break;var h=E(r,o);s.enqueue(k(i?h:_.decode(h),t)),n=0}if(0===o||o>e){s.enqueue(f);break}}}})}(Number.MAX_SAFE_INTEGER,e.socket.binaryType),n=t.readable.pipeThrough(r).getReader(),o=new TransformStream({transform:function(e,t){!function(e,t){d&&e.data instanceof Blob?e.data.arrayBuffer().then(g).then(t):h&&(e.data instanceof ArrayBuffer||v(e.data))?t(g(e.data)):m(e,!1,(function(e){p||(p=new TextEncoder),t(p.encode(e))}))}(e,(function(r){var n,o=r.length;if(o<126)n=new Uint8Array(1),new DataView(n.buffer).setUint8(0,o);else if(o<65536){n=new Uint8Array(3);var i=new DataView(n.buffer);i.setUint8(0,126),i.setUint16(1,o)}else{n=new Uint8Array(9);var a=new DataView(n.buffer);a.setUint8(0,127),a.setBigUint64(1,BigInt(o))}e.data&&"string"!=typeof e.data&&(n[0]|=128),t.enqueue(n),t.enqueue(r)}))}});o.readable.pipeTo(t.writable),e.writer=o.writable.getWriter(),function t(){n.read().then((function(r){var n=r.done,o=r.value;n||(e.onPacket(o),t())})).catch((function(e){}))}();var i={type:"open"};e.query.sid&&(i.data='{"sid":"'.concat(e.query.sid,'"}')),e.writer.write(i).then((function(){return e.onOpen()}))}))})))}},{key:"write",value:function(e){var t=this;this.writable=!1;for(var r=function(){var r=e[n],o=n===e.length-1;t.writer.write(r).then((function(){o&&Se((function(){t.writable=!0,t.emitReserved("drain")}),t.setTimeoutFn)}))},n=0;n<e.length;n++)r()}},{key:"doClose",value:function(){var e;null===(e=this.transport)||void 0===e||e.close()}}],r&&je(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),a}($),Me={websocket:Te,webtransport:Ie,polling:be},Ae=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Ne=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Fe(e){if(e.length>2e3)throw"URI too long";var t,r,n=e,o=e.indexOf("["),i=e.indexOf("]");-1!=o&&-1!=i&&(e=e.substring(0,o)+e.substring(o,i).replace(/:/g,";")+e.substring(i,e.length));for(var a,s,c=Ae.exec(e||""),u={},l=14;l--;)u[Ne[l]]=c[l]||"";return-1!=o&&-1!=i&&(u.source=n,u.host=u.host.substring(1,u.host.length-1).replace(/;/g,":"),u.authority=u.authority.replace("[","").replace("]","").replace(/;/g,":"),u.ipv6uri=!0),u.pathNames=(t=u.path,r=t.replace(/\/{2,9}/g,"/").split("/"),"/"!=t.slice(0,1)&&0!==t.length||r.splice(0,1),"/"==t.slice(-1)&&r.splice(r.length-1,1),r),u.queryKey=(a=u.query,s={},a.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,r){t&&(s[t]=r)})),s),u}function Be(){return Be=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Be.apply(this,arguments)}function Ge(e){return Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ge(e)}function Ve(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Ge(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Ge(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Ge(o)?o:String(o)),n)}var o}function Ue(e,t){return Ue=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ue(e,t)}function qe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ze(e){return ze=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ze(e)}var We=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ue(e,t)}(a,e);var t,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ze(n);if(o){var r=ze(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Ge(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return qe(e)}(this,e)});function a(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this)).binaryType="arraybuffer",t.writeBuffer=[],e&&"object"===Ge(e)&&(r=e,e=null),e?(e=Fe(e),r.hostname=e.host,r.secure="https"===e.protocol||"wss"===e.protocol,r.port=e.port,e.query&&(r.query=e.query)):r.host&&(r.hostname=Fe(r.host).host),I(qe(t),r),t.secure=null!=r.secure?r.secure:"undefined"!=typeof location&&"https:"===location.protocol,r.hostname&&!r.port&&(r.port=t.secure?"443":"80"),t.hostname=r.hostname||("undefined"!=typeof location?location.hostname:"localhost"),t.port=r.port||("undefined"!=typeof location&&location.port?location.port:t.secure?"443":"80"),t.transports=r.transports||["polling","websocket","webtransport"],t.writeBuffer=[],t.prevBufferLen=0,t.opts=Be({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},r),t.opts.path=t.opts.path.replace(/\/$/,"")+(t.opts.addTrailingSlash?"/":""),"string"==typeof t.opts.query&&(t.opts.query=function(e){for(var t={},r=e.split("&"),n=0,o=r.length;n<o;n++){var i=r[n].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}(t.opts.query)),t.id=null,t.upgrades=null,t.pingInterval=null,t.pingTimeout=null,t.pingTimeoutTimer=null,"function"==typeof addEventListener&&(t.opts.closeOnBeforeunload&&(t.beforeunloadEventListener=function(){t.transport&&(t.transport.removeAllListeners(),t.transport.close())},addEventListener("beforeunload",t.beforeunloadEventListener,!1)),"localhost"!==t.hostname&&(t.offlineEventListener=function(){t.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",t.offlineEventListener,!1))),t.open(),t}return t=a,r=[{key:"createTransport",value:function(e){var t=Be({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);var r=Be({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new Me[e](r)}},{key:"open",value:function(){var e,t=this;if(this.opts.rememberUpgrade&&a.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((function(){t.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}},{key:"setTransport",value:function(e){var t=this;this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(function(e){return t.onClose("transport close",e)}))}},{key:"probe",value:function(e){var t=this,r=this.createTransport(e),n=!1;a.priorWebsocketSuccess=!1;var o=function(){n||(r.send([{type:"ping",data:"probe"}]),r.once("packet",(function(e){if(!n)if("pong"===e.type&&"probe"===e.data){if(t.upgrading=!0,t.emitReserved("upgrading",r),!r)return;a.priorWebsocketSuccess="websocket"===r.name,t.transport.pause((function(){n||"closed"!==t.readyState&&(p(),t.setTransport(r),r.send([{type:"upgrade"}]),t.emitReserved("upgrade",r),r=null,t.upgrading=!1,t.flush())}))}else{var o=new Error("probe error");o.transport=r.name,t.emitReserved("upgradeError",o)}})))};function i(){n||(n=!0,p(),r.close(),r=null)}var s=function(e){var n=new Error("probe error: "+e);n.transport=r.name,i(),t.emitReserved("upgradeError",n)};function c(){s("transport closed")}function u(){s("socket closed")}function l(e){r&&e.name!==r.name&&i()}var p=function(){r.removeListener("open",o),r.removeListener("error",s),r.removeListener("close",c),t.off("close",u),t.off("upgrading",l)};r.once("open",o),r.once("error",s),r.once("close",c),this.once("close",u),this.once("upgrading",l),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn((function(){n||r.open()}),200):r.open()}},{key:"onOpen",value:function(){if(this.readyState="open",a.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade)for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},{key:"onPacket",value:function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}},{key:"onHandshake",value:function(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}},{key:"resetPingTimeout",value:function(){var e=this;this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((function(){e.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}},{key:"onDrain",value:function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}},{key:"flush",value:function(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){var e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}},{key:"getWritablePackets",value:function(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;for(var e,t=1,r=0;r<this.writeBuffer.length;r++){var n=this.writeBuffer[r].data;if(n&&(t+="string"==typeof(e=n)?function(e){for(var t=0,r=0,n=0,o=e.length;n<o;n++)(t=e.charCodeAt(n))<128?r+=1:t<2048?r+=2:t<55296||t>=57344?r+=3:(n++,r+=4);return r}(e):Math.ceil(1.33*(e.byteLength||e.size))),r>0&&t>this.maxPayload)return this.writeBuffer.slice(0,r);t+=2}return this.writeBuffer}},{key:"write",value:function(e,t,r){return this.sendPacket("message",e,t,r),this}},{key:"send",value:function(e,t,r){return this.sendPacket("message",e,t,r),this}},{key:"sendPacket",value:function(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"!==this.readyState&&"closed"!==this.readyState){(r=r||{}).compress=!1!==r.compress;var o={type:e,data:t,options:r};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),n&&this.once("flush",n),this.flush()}}},{key:"close",value:function(){var e=this,t=function(){e.onClose("forced close"),e.transport.close()},r=function r(){e.off("upgrade",r),e.off("upgradeError",r),t()},n=function(){e.once("upgrade",r),e.once("upgradeError",r)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(function(){e.upgrading?n():t()})):this.upgrading?n():t()),this}},{key:"onError",value:function(e){a.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}},{key:"onClose",value:function(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}},{key:"filterUpgrades",value:function(e){for(var t=[],r=0,n=e.length;r<n;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}],r&&Ve(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),a}(T);function Ke(e){return Ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ke(e)}We.protocol=4,We.protocol;var Ye="function"==typeof ArrayBuffer,He=function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer},Je=Object.prototype.toString,$e="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Je.call(Blob),Qe="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===Je.call(File);function Xe(e){return Ye&&(e instanceof ArrayBuffer||He(e))||$e&&e instanceof Blob||Qe&&e instanceof File}function Ze(e,t){if(!e||"object"!==Ke(e))return!1;if(Array.isArray(e)){for(var r=0,n=e.length;r<n;r++)if(Ze(e[r]))return!0;return!1}if(Xe(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return Ze(e.toJSON(),!0);for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)&&Ze(e[o]))return!0;return!1}function et(e){return et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},et(e)}function tt(e){var t=[],r=e.data,n=e;return n.data=rt(r,t),n.attachments=t.length,{packet:n,buffers:t}}function rt(e,t){if(!e)return e;if(Xe(e)){var r={_placeholder:!0,num:t.length};return t.push(e),r}if(Array.isArray(e)){for(var n=new Array(e.length),o=0;o<e.length;o++)n[o]=rt(e[o],t);return n}if("object"===et(e)&&!(e instanceof Date)){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(i[a]=rt(e[a],t));return i}return e}function nt(e,t){return e.data=ot(e.data,t),delete e.attachments,e}function ot(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(var r=0;r<e.length;r++)e[r]=ot(e[r],t);else if("object"===et(e))for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=ot(e[n],t));return e}function it(e){return it="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},it(e)}function at(){return at="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ct(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(arguments.length<3?e:r):o.value}},at.apply(this,arguments)}function st(e,t){return st=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},st(e,t)}function ct(e){return ct=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ct(e)}function ut(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function lt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==it(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==it(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===it(o)?o:String(o)),n)}var o}function pt(e,t,r){return t&&lt(e.prototype,t),r&&lt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var ft,dt=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],ht=5;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(ft||(ft={}));var vt=function(){function e(t){ut(this,e),this.replacer=t}return pt(e,[{key:"encode",value:function(e){return e.type!==ft.EVENT&&e.type!==ft.ACK||!Ze(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===ft.EVENT?ft.BINARY_EVENT:ft.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}},{key:"encodeAsString",value:function(e){var t=""+e.type;return e.type!==ft.BINARY_EVENT&&e.type!==ft.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}},{key:"encodeAsBinary",value:function(e){var t=tt(e),r=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(r),n}}]),e}();function mt(e){return"[object Object]"===Object.prototype.toString.call(e)}var yt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&st(e,t)}(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=ct(t);if(r){var o=ct(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return function(e,t){if(t&&("object"===it(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function o(e){var t;return ut(this,o),(t=n.call(this)).reviver=e,t}return pt(o,[{key:"add",value:function(e){var t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");var r=(t=this.decodeString(e)).type===ft.BINARY_EVENT;r||t.type===ft.BINARY_ACK?(t.type=r?ft.EVENT:ft.ACK,this.reconstructor=new gt(t),0===t.attachments&&at(ct(o.prototype),"emitReserved",this).call(this,"decoded",t)):at(ct(o.prototype),"emitReserved",this).call(this,"decoded",t)}else{if(!Xe(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,at(ct(o.prototype),"emitReserved",this).call(this,"decoded",t))}}},{key:"decodeString",value:function(e){var t=0,r={type:Number(e.charAt(0))};if(void 0===ft[r.type])throw new Error("unknown packet type "+r.type);if(r.type===ft.BINARY_EVENT||r.type===ft.BINARY_ACK){for(var n=t+1;"-"!==e.charAt(++t)&&t!=e.length;);var i=e.substring(n,t);if(i!=Number(i)||"-"!==e.charAt(t))throw new Error("Illegal attachments");r.attachments=Number(i)}if("/"===e.charAt(t+1)){for(var a=t+1;++t&&","!==e.charAt(t)&&t!==e.length;);r.nsp=e.substring(a,t)}else r.nsp="/";var s=e.charAt(t+1);if(""!==s&&Number(s)==s){for(var c=t+1;++t;){var u=e.charAt(t);if(null==u||Number(u)!=u){--t;break}if(t===e.length)break}r.id=Number(e.substring(c,t+1))}if(e.charAt(++t)){var l=this.tryParse(e.substr(t));if(!o.isPayloadValid(r.type,l))throw new Error("invalid payload");r.data=l}return r}},{key:"tryParse",value:function(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}},{key:"destroy",value:function(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}],[{key:"isPayloadValid",value:function(e,t){switch(e){case ft.CONNECT:return mt(t);case ft.DISCONNECT:return void 0===t;case ft.CONNECT_ERROR:return"string"==typeof t||mt(t);case ft.EVENT:case ft.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===dt.indexOf(t[0]));case ft.ACK:case ft.BINARY_ACK:return Array.isArray(t)}}}]),o}(T),gt=function(){function e(t){ut(this,e),this.packet=t,this.buffers=[],this.reconPack=t}return pt(e,[{key:"takeBinaryData",value:function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=nt(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}},{key:"finishedReconstruction",value:function(){this.reconPack=null,this.buffers=[]}}]),e}();function bt(e,t,r){return e.on(t,r),function(){e.off(t,r)}}function wt(e){return wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wt(e)}function _t(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return St(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?St(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function St(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function kt(){return kt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},kt.apply(this,arguments)}function xt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==wt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==wt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===wt(o)?o:String(o)),n)}var o}function Rt(){return Rt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ot(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(arguments.length<3?e:r):o.value}},Rt.apply(this,arguments)}function Pt(e,t){return Pt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Pt(e,t)}function Ot(e){return Ot=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ot(e)}var Et=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Tt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Pt(e,t)}(a,e);var t,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ot(n);if(o){var r=Ot(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===wt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function a(e,t,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this)).connected=!1,n.recovered=!1,n.receiveBuffer=[],n.sendBuffer=[],n._queue=[],n._queueSeq=0,n.ids=0,n.acks={},n.flags={},n.io=e,n.nsp=t,r&&r.auth&&(n.auth=r.auth),n._opts=kt({},r),n.io._autoConnect&&n.open(),n}return t=a,r=[{key:"disconnected",get:function(){return!this.connected}},{key:"subEvents",value:function(){if(!this.subs){var e=this.io;this.subs=[bt(e,"open",this.onopen.bind(this)),bt(e,"packet",this.onpacket.bind(this)),bt(e,"error",this.onerror.bind(this)),bt(e,"close",this.onclose.bind(this))]}}},{key:"active",get:function(){return!!this.subs}},{key:"connect",value:function(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}},{key:"open",value:function(){return this.connect()}},{key:"send",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.unshift("message"),this.emit.apply(this,t),this}},{key:"emit",value:function(e){if(Et.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if(r.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(r),this;var o={type:ft.EVENT,data:r,options:{}};if(o.options.compress=!1!==this.flags.compress,"function"==typeof r[r.length-1]){var i=this.ids++,a=r.pop();this._registerAckCallback(i,a),o.id=i}var s=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!s||!this.connected)||(this.connected?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}},{key:"_registerAckCallback",value:function(e,t){var r,n=this,o=null!==(r=this.flags.timeout)&&void 0!==r?r:this._opts.ackTimeout;if(void 0!==o){var i=this.io.setTimeoutFn((function(){delete n.acks[e];for(var r=0;r<n.sendBuffer.length;r++)n.sendBuffer[r].id===e&&n.sendBuffer.splice(r,1);t.call(n,new Error("operation has timed out"))}),o);this.acks[e]=function(){n.io.clearTimeoutFn(i);for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];t.apply(n,[null].concat(r))}}else this.acks[e]=t}},{key:"emitWithAck",value:function(e){for(var t=this,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];var i=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise((function(r,o){n.push((function(e,t){return i?e?o(e):r(t):r(e)})),t.emit.apply(t,[e].concat(n))}))}},{key:"_addToQueue",value:function(e){var t,r=this;"function"==typeof e[e.length-1]&&(t=e.pop());var n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:kt({fromQueue:!0},this.flags)};e.push((function(e){if(n===r._queue[0]){if(null!==e)n.tryCount>r._opts.retries&&(r._queue.shift(),t&&t(e));else if(r._queue.shift(),t){for(var o=arguments.length,i=new Array(o>1?o-1:0),a=1;a<o;a++)i[a-1]=arguments[a];t.apply(void 0,[null].concat(i))}return n.pending=!1,r._drainQueue()}})),this._queue.push(n),this._drainQueue()}},{key:"_drainQueue",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.connected&&0!==this._queue.length){var t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}}},{key:"packet",value:function(e){e.nsp=this.nsp,this.io._packet(e)}},{key:"onopen",value:function(){var e=this;"function"==typeof this.auth?this.auth((function(t){e._sendConnectPacket(t)})):this._sendConnectPacket(this.auth)}},{key:"_sendConnectPacket",value:function(e){this.packet({type:ft.CONNECT,data:this._pid?kt({pid:this._pid,offset:this._lastOffset},e):e})}},{key:"onerror",value:function(e){this.connected||this.emitReserved("connect_error",e)}},{key:"onclose",value:function(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}},{key:"onpacket",value:function(e){if(e.nsp===this.nsp)switch(e.type){case ft.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ft.EVENT:case ft.BINARY_EVENT:this.onevent(e);break;case ft.ACK:case ft.BINARY_ACK:this.onack(e);break;case ft.DISCONNECT:this.ondisconnect();break;case ft.CONNECT_ERROR:this.destroy();var t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}},{key:"onevent",value:function(e){var t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}},{key:"emitEvent",value:function(e){if(this._anyListeners&&this._anyListeners.length){var t,r=_t(this._anyListeners.slice());try{for(r.s();!(t=r.n()).done;)t.value.apply(this,e)}catch(e){r.e(e)}finally{r.f()}}Rt(Ot(a.prototype),"emit",this).apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}},{key:"ack",value:function(e){var t=this,r=!1;return function(){if(!r){r=!0;for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];t.packet({type:ft.ACK,id:e,data:o})}}}},{key:"onack",value:function(e){var t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}},{key:"onconnect",value:function(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}},{key:"emitBuffered",value:function(){var e=this;this.receiveBuffer.forEach((function(t){return e.emitEvent(t)})),this.receiveBuffer=[],this.sendBuffer.forEach((function(t){e.notifyOutgoingListeners(t),e.packet(t)})),this.sendBuffer=[]}},{key:"ondisconnect",value:function(){this.destroy(),this.onclose("io server disconnect")}},{key:"destroy",value:function(){this.subs&&(this.subs.forEach((function(e){return e()})),this.subs=void 0),this.io._destroy(this)}},{key:"disconnect",value:function(){return this.connected&&this.packet({type:ft.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{key:"close",value:function(){return this.disconnect()}},{key:"compress",value:function(e){return this.flags.compress=e,this}},{key:"volatile",get:function(){return this.flags.volatile=!0,this}},{key:"timeout",value:function(e){return this.flags.timeout=e,this}},{key:"onAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}},{key:"prependAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}},{key:"offAny",value:function(e){if(!this._anyListeners)return this;if(e){for(var t=this._anyListeners,r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}},{key:"listenersAny",value:function(){return this._anyListeners||[]}},{key:"onAnyOutgoing",value:function(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}},{key:"prependAnyOutgoing",value:function(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}},{key:"offAnyOutgoing",value:function(e){if(!this._anyOutgoingListeners)return this;if(e){for(var t=this._anyOutgoingListeners,r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}},{key:"listenersAnyOutgoing",value:function(){return this._anyOutgoingListeners||[]}},{key:"notifyOutgoingListeners",value:function(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){var t,r=_t(this._anyOutgoingListeners.slice());try{for(r.s();!(t=r.n()).done;)t.value.apply(this,e.data)}catch(e){r.e(e)}finally{r.f()}}}}],r&&xt(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),a}(T);function Ct(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}function jt(e){return jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jt(e)}function Lt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==jt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==jt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===jt(o)?o:String(o)),n)}var o}function Dt(e,t){return Dt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Dt(e,t)}function It(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Mt(e){return Mt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Mt(e)}Ct.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},Ct.prototype.reset=function(){this.attempts=0},Ct.prototype.setMin=function(e){this.ms=e},Ct.prototype.setMax=function(e){this.max=e},Ct.prototype.setJitter=function(e){this.jitter=e};var At=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Dt(e,t)}(s,t);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Mt(o);if(i){var r=Mt(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===jt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return It(e)}(this,e)});function s(t,r){var n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=a.call(this)).nsps={},n.subs=[],t&&"object"===jt(t)&&(r=t,t=void 0),(r=r||{}).path=r.path||"/socket.io",n.opts=r,I(It(n),r),n.reconnection(!1!==r.reconnection),n.reconnectionAttempts(r.reconnectionAttempts||1/0),n.reconnectionDelay(r.reconnectionDelay||1e3),n.reconnectionDelayMax(r.reconnectionDelayMax||5e3),n.randomizationFactor(null!==(o=r.randomizationFactor)&&void 0!==o?o:.5),n.backoff=new Ct({min:n.reconnectionDelay(),max:n.reconnectionDelayMax(),jitter:n.randomizationFactor()}),n.timeout(null==r.timeout?2e4:r.timeout),n._readyState="closed",n.uri=t;var i=r.parser||e;return n.encoder=new i.Encoder,n.decoder=new i.Decoder,n._autoConnect=!1!==r.autoConnect,n._autoConnect&&n.open(),n}return r=s,n=[{key:"reconnection",value:function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}},{key:"reconnectionAttempts",value:function(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}},{key:"reconnectionDelay",value:function(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}},{key:"randomizationFactor",value:function(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}},{key:"reconnectionDelayMax",value:function(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}},{key:"timeout",value:function(e){return arguments.length?(this._timeout=e,this):this._timeout}},{key:"maybeReconnectOnOpen",value:function(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}},{key:"open",value:function(e){var t=this;if(~this._readyState.indexOf("open"))return this;this.engine=new We(this.uri,this.opts);var r=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;var o=bt(r,"open",(function(){n.onopen(),e&&e()})),i=function(r){t.cleanup(),t._readyState="closed",t.emitReserved("error",r),e?e(r):t.maybeReconnectOnOpen()},a=bt(r,"error",i);if(!1!==this._timeout){var s=this._timeout,c=this.setTimeoutFn((function(){o(),i(new Error("timeout")),r.close()}),s);this.opts.autoUnref&&c.unref(),this.subs.push((function(){t.clearTimeoutFn(c)}))}return this.subs.push(o),this.subs.push(a),this}},{key:"connect",value:function(e){return this.open(e)}},{key:"onopen",value:function(){this.cleanup(),this._readyState="open",this.emitReserved("open");var e=this.engine;this.subs.push(bt(e,"ping",this.onping.bind(this)),bt(e,"data",this.ondata.bind(this)),bt(e,"error",this.onerror.bind(this)),bt(e,"close",this.onclose.bind(this)),bt(this.decoder,"decoded",this.ondecoded.bind(this)))}},{key:"onping",value:function(){this.emitReserved("ping")}},{key:"ondata",value:function(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}},{key:"ondecoded",value:function(e){var t=this;Se((function(){t.emitReserved("packet",e)}),this.setTimeoutFn)}},{key:"onerror",value:function(e){this.emitReserved("error",e)}},{key:"socket",value:function(e,t){var r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Tt(this,e,t),this.nsps[e]=r),r}},{key:"_destroy",value:function(e){for(var t=0,r=Object.keys(this.nsps);t<r.length;t++){var n=r[t];if(this.nsps[n].active)return}this._close()}},{key:"_packet",value:function(e){for(var t=this.encoder.encode(e),r=0;r<t.length;r++)this.engine.write(t[r],e.options)}},{key:"cleanup",value:function(){this.subs.forEach((function(e){return e()})),this.subs.length=0,this.decoder.destroy()}},{key:"_close",value:function(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}},{key:"disconnect",value:function(){return this._close()}},{key:"onclose",value:function(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}},{key:"reconnect",value:function(){var e=this;if(this._reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{var r=this.backoff.duration();this._reconnecting=!0;var n=this.setTimeoutFn((function(){t.skipReconnect||(e.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((function(r){r?(t._reconnecting=!1,t.reconnect(),e.emitReserved("reconnect_error",r)):t.onreconnect()})))}),r);this.opts.autoUnref&&n.unref(),this.subs.push((function(){e.clearTimeoutFn(n)}))}}},{key:"onreconnect",value:function(){var e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}],n&&Lt(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),s}(T);function Nt(){return Nt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Nt.apply(this,arguments)}function Ft(e){return Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ft(e)}var Bt={};function Gt(e,t){"object"===Ft(e)&&(t=e,e=void 0);var r,n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0,n=e;r=r||"undefined"!=typeof location&&location,null==e&&(e=r.protocol+"//"+r.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?r.protocol+e:r.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==r?r.protocol+"//"+e:"https://"+e),n=Fe(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";var o=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+o+":"+n.port+t,n.href=n.protocol+"://"+o+(r&&r.port===n.port?"":":"+n.port),n}(e,(t=t||{}).path||"/socket.io"),o=n.source,i=n.id,a=n.path,s=Bt[i]&&a in Bt[i].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||s?r=new At(o,t):(Bt[i]||(Bt[i]=new At(o,t)),r=Bt[i]),n.query&&!t.query&&(t.query=n.queryKey),r.socket(n.path,t)}function Vt(){return Vt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Vt.apply(this,arguments)}function Ut(e){return Ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ut(e)}Nt(Gt,{Manager:At,Socket:Tt,io:Gt,connect:Gt});var qt=!0,zt=!0;function Wt(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function Kt(e,t,r){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,o=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return o.apply(this,arguments);var i=function(e){var t=r(e);t&&n(t)};return this._eventMap=this._eventMap||{},this._eventMap[n]=i,o.apply(this,[e,i])};var i=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r])return i.apply(this,arguments);var n=this._eventMap[r];return delete this._eventMap[r],i.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function Yt(e){return"boolean"!=typeof e?new Error("Argument type: "+Ut(e)+". Please use a boolean."):(qt=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Ht(e){return"boolean"!=typeof e?new Error("Argument type: "+Ut(e)+". Please use a boolean."):(zt=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Jt(){if("object"===("undefined"==typeof window?"undefined":Ut(window))){if(qt)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function $t(e,t){zt&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Qt(e){var t=e.navigator,r={browser:null,version:null};if(void 0===e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=Wt(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)r.browser="chrome",r.version=Wt(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=Wt(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=Wt(t.userAgent,/AppleWebKit\/(\d+)\./,1),r.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return r}function Xt(e){return"[object Object]"===Object.prototype.toString.call(e)}function Zt(e){return Xt(e)?Object.keys(e).reduce((function(t,r){var n=Xt(e[r]),o=n?Zt(e[r]):e[r],i=n&&!Object.keys(o).length;return void 0===o||i?t:Vt(t,function(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==Ut(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Ut(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Ut(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},r,o))}),{}):e}function er(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach((function(n){n.endsWith("Id")?er(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach((function(t){er(e,e.get(t),r)}))})))}function tr(e,t,r){var n=r?"outbound-rtp":"inbound-rtp",o=new Map;if(null===t)return o;var i=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&i.push(e)})),i.forEach((function(t){e.forEach((function(r){r.type===n&&r.trackId===t.id&&er(e,r,o)}))})),o}function rr(e){return rr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rr(e)}var nr=Jt;function or(e){var t=e&&e.navigator;if(t.mediaDevices){var r=Qt(e),n=function(e){if("object"!==rr(e)||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var n="object"===rr(e[r])?e[r]:{ideal:e[r]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];var i={};"number"==typeof n.ideal?(i[o("min",r)]=n.ideal,t.optional.push(i),(i={})[o("max",r)]=n.ideal,t.optional.push(i)):(i[o("",r)]=n.ideal,t.optional.push(i))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",r)]=n.exact):["min","max"].forEach((function(e){void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,r)]=n[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},o=function(e,o){if(r.version>=61)return o(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===rr(e.audio)){var i=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};i((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),i(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"===rr(e.video)){var a=e.video.facingMode;a=a&&("object"===rr(a)?a:{ideal:a});var s,c=r.version<66;if(a&&("user"===a.exact||"environment"===a.exact||"user"===a.ideal||"environment"===a.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||c)&&(delete e.video.facingMode,"environment"===a.exact||"environment"===a.ideal?s=["back","rear"]:"user"!==a.exact&&"user"!==a.ideal||(s=["front"]),s))return t.mediaDevices.enumerateDevices().then((function(t){var r=(t=t.filter((function(e){return"videoinput"===e.kind}))).find((function(e){return s.some((function(t){return e.label.toLowerCase().includes(t)}))}));return!r&&t.length&&s.includes("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=a.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=n(e.video),nr("chrome: "+JSON.stringify(e)),o(e)}));e.video=n(e.video)}return nr("chrome: "+JSON.stringify(e)),o(e)},i=function(e){return r.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=function(e,r,n){o(e,(function(e){t.webkitGetUserMedia(e,r,(function(e){n&&n(i(e))}))}))}.bind(t),t.mediaDevices.getUserMedia){var a=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return o(e,(function(e){return a(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Promise.reject(i(e))}))}))}}}}function ir(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then((function(t){var n=r.video&&r.video.width,o=r.video&&r.video.height,i=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:i||3}},n&&(r.video.mandatory.maxWidth=n),o&&(r.video.mandatory.maxHeight=o),e.navigator.mediaDevices.getUserMedia(r)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function ar(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==sr(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==sr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===sr(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function sr(e){return sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sr(e)}function cr(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function ur(e){if("object"===sr(e)&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(n){var o;o=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find((function(e){return e.track&&e.track.id===n.track.id})):{track:n.track};var i=new Event("track");i.track=n.track,i.receiver=o,i.transceiver={receiver:o},i.streams=[t.stream],r.dispatchEvent(i)})),t.stream.getTracks().forEach((function(n){var o;o=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find((function(e){return e.track&&e.track.id===n.id})):{track:n};var i=new Event("track");i.track=n,i.receiver=o,i.transceiver={receiver:o},i.streams=[t.stream],r.dispatchEvent(i)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Kt(e,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}))}function lr(e){if("object"===sr(e)&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var o=r.apply(this,arguments);return o||(o=t(this,e),this._senders.push(o)),o};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach((function(e){r._senders.push(t(r,e))}))};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((function(e){var r=t._senders.find((function(t){return t.track===e}));r&&t._senders.splice(t._senders.indexOf(r),1)}))}}else if("object"===sr(e)&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function pr(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,r=Array.prototype.slice.call(arguments),n=r[0],o=r[1],i=r[2];if(arguments.length>0&&"function"==typeof n)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof n))return t.apply(this,[]);var a=function(e){var t={};return e.result().forEach((function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){r[t]=e.stat(t)})),t[r.id]=r})),t},s=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};return arguments.length>=2?t.apply(this,[function(e){o(s(a(e)))},n]):new Promise((function(r,n){t.apply(e,[function(e){r(s(a(e)))},n])})).then(o,i)}}}function fr(e){if("object"===sr(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return tr(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=n.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),Kt(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return tr(t,e.track,!1)}))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,r,n,i=arguments[0];return this.getSenders().forEach((function(e){e.track===i&&(t?n=!0:t=e)})),this.getReceivers().forEach((function(e){return e.track===i&&(r?n=!0:r=e),e.track===i})),n||t&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return o.apply(this,arguments)}}}}function dr(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(t){return e._shimmedLocalStreams[t][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){if(t.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var n=this.getSenders();r.apply(this,arguments);var o=this.getSenders().filter((function(e){return-1===n.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(o)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((function(r){var n=t._shimmedLocalStreams[r].indexOf(e);-1!==n&&t._shimmedLocalStreams[r].splice(n,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]})),o.apply(this,arguments)}}function hr(e){if(e.RTCPeerConnection){var t=Qt(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return dr(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((function(t){return e._reverseStreams[t.id]}))};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){if(r.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var o=new e.MediaStream(t.getTracks());this._streams[t.id]=o,this._reverseStreams[o.id]=t,t=o}n.apply(this,[t])};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var o=[].slice.call(arguments,1);if(1!==o.length||!o[0].getTracks().find((function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((function(e){return e.track===t})))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var i=this._streams[r.id];if(i)i.addTrack(t),Promise.resolve().then((function(){n.dispatchEvent(new Event("negotiationneeded"))}));else{var a=new e.MediaStream([t]);this._streams[r.id]=a,this._reverseStreams[a.id]=r,this.addStream(a)}return this.getSenders().find((function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t],n=ar({},t,(function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(this,[function(r){var n=s(e,r);t[0].apply(null,[n])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(this,arguments).then((function(t){return s(e,t)}))}));e.RTCPeerConnection.prototype[t]=n[t]}));var i=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var n=e._reverseStreams[t],o=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),o.id)})),new RTCSessionDescription({type:t.type,sdp:r})}(this,arguments[0]),i.apply(this,arguments)):i.apply(this,arguments)};var a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=a.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach((function(n){r._streams[n].getTracks().find((function(t){return e.track===t}))&&(t=r._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function s(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var n=e._reverseStreams[t],o=e._streams[n.id];r=r.replace(new RegExp(o.id,"g"),n.id)})),new RTCSessionDescription({type:t.type,sdp:r})}}function vr(e){var t=Qt(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection){var r=0===e.RTCPeerConnection.prototype.addIceCandidate.length;t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t],n=ar({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=n[t]}));var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return r||arguments[0]?t.version<78&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}}function mr(e){Kt(e,"negotiationneeded",(function(e){if("stable"===e.target.signalingState)return e}))}var yr=r(7513),gr=r.n(yr);function br(e){var t=e&&e.navigator,r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch((function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))}))}}function wr(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}function _r(e){var t=Qt(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var n=gr()(e,t.version);e.RTCPeerConnection=function(e){var r,o;return e&&e.iceServers&&(e.iceServers=(r=e.iceServers,t.version,o=!1,(r=JSON.parse(JSON.stringify(r))).filter((function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&$t("RTCIceServer.url","RTCIceServer.urls");var r="string"==typeof t;return r&&(t=[t]),t=t.filter((function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!o?(o=!0,!0):t&&!o})),delete e.url,e.urls=r?t[0]:t,!!t.length}}))),Jt("ICE servers after filtering:",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype}function Sr(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}function kr(e){return kr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kr(e)}function xr(e){var t=Qt(e),r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){$t("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var o=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},i=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===kr(e)&&"object"===kr(e.audio)&&(e=JSON.parse(JSON.stringify(e)),o(e.audio,"autoGainControl","mozAutoGainControl"),o(e.audio,"noiseSuppression","mozNoiseSuppression")),i(e)},n&&n.prototype.getSettings){var a=n.prototype.getSettings;n.prototype.getSettings=function(){var e=a.apply(this,arguments);return o(e,"mozAutoGainControl","autoGainControl"),o(e,"mozNoiseSuppression","noiseSuppression"),e}}if(n&&n.prototype.applyConstraints){var s=n.prototype.applyConstraints;n.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===kr(e)&&(e=JSON.parse(JSON.stringify(e)),o(e,"autoGainControl","mozAutoGainControl"),o(e,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[e])}}}}function Rr(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){var n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}function Pr(){return Pr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Pr.apply(this,arguments)}function Or(e){return Or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Or(e)}function Er(e){"object"===Or(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function Tr(e){var t=Qt(e);if("object"===Or(e)&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){if(!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t],n=function(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==Or(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Or(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Or(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=n[t]})),t.version<68){var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}var n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),r=e[0],i=e[1],a=e[2];return o.apply(this,[r||null]).then((function(e){if(t.version<53&&!i)try{e.forEach((function(e){e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach((function(t,r){e.set(r,Pr({},t,{type:n[t.type]||t.type}))}))}return e})).then(i,a)}}}function Cr(e){if("object"===Or(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function jr(e){if("object"===Or(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r}),Kt(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function Lr(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;$t("removeStream","removeTrack"),this.getSenders().forEach((function(r){r.track&&e.getTracks().includes(r.track)&&t.removeTrack(r)}))})}function Dr(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Ir(e){if("object"===Or(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1],r=e&&"sendEncodings"in e;r&&e.sendEncodings.forEach((function(e){if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var n=t.apply(this,arguments);if(r){var o=n.sender,i=o.getParameters();"encodings"in i||(i.encodings=e.sendEncodings,this.setParametersPromises.push(o.setParameters(i).catch((function(){}))))}return n})}}function Mr(e){if("object"===Or(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=arguments,r=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(r,e)})).finally((function(){r.setParametersPromises=[]})):t.apply(this,arguments)}}}function Ar(e){if("object"===Or(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=arguments,r=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(r,e)})).finally((function(){r.setParametersPromises=[]})):t.apply(this,arguments)}}}function Nr(){return Nr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Nr.apply(this,arguments)}function Fr(e){return Fr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fr(e)}function Br(e){if("object"===Fr(e)&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((function(n){return t.call(r,n,e)})),e.getVideoTracks().forEach((function(n){return t.call(r,n,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var r=this,n=arguments.length,o=new Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];return o&&o.forEach((function(e){r._localStreams?r._localStreams.includes(e)||r._localStreams.push(e):r._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var r=this._localStreams.indexOf(e);if(-1!==r){this._localStreams.splice(r,1);var n=e.getTracks();this.getSenders().forEach((function(e){n.includes(e.track)&&t.removeTrack(e)}))}})}}function Gr(e){if("object"===Fr(e)&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.dispatchEvent(r)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}}))}),t.apply(e,arguments)}}}function Vr(e){if("object"===Fr(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,o=t.setLocalDescription,i=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],o=r.apply(this,[n]);return t?(o.then(e,t),Promise.resolve()):o},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],o=n.apply(this,[r]);return t?(o.then(e,t),Promise.resolve()):o};var s=function(e,t,r){var n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=s,s=function(e,t,r){var n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=s,s=function(e,t,r){var n=a.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=s}}function Ur(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var r=t.mediaDevices,n=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=function(e){return n(qr(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t))}function qr(e){return e&&void 0!==e.video?Nr({},e,{video:Zt(e.video)}):e}function zr(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var n=[],o=0;o<e.iceServers.length;o++){var i=e.iceServers[o];!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")?($t("RTCIceServer.url","RTCIceServer.urls"),(i=JSON.parse(JSON.stringify(i))).urls=i.url,delete i.url,n.push(i)):n.push(e.iceServers[o])}e.iceServers=n}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}function Wr(e){"object"===Fr(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function Kr(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r=this.getTransceivers().find((function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var n=this.getTransceivers().find((function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return t.apply(this,arguments)}}var Yr=r(3074),Hr=r.n(Yr);function Jr(){return Jr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Jr.apply(this,arguments)}function $r(e){return $r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$r(e)}function Qr(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===$r(e)&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=Jr(new t(e),Hr().parseCandidate(e.candidate));return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,Kt(e,"icecandidate",(function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))}}function Xr(e){if(e.RTCPeerConnection){var t=Qt(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e,n;if(this._sctp=null,"chrome"===t.browser&&t.version>=76&&"plan-b"===this.getConfiguration().sdpSemantics&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0}),function(e){if(!e||!e.sdp)return!1;var t=Hr().splitSections(e.sdp);return t.shift(),t.some((function(e){var t=Hr().parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){var o,i=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r}(arguments[0]),a=(e=i,n=65536,"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n),s=function(e,r){var n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);var o=Hr().matchPrefix(e.sdp,"a=max-message-size:");return o.length>0?n=parseInt(o[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(n=2147483637),n}(arguments[0],i);o=0===a&&0===s?Number.POSITIVE_INFINITY:0===a||0===s?Math.max(a,s):Math.min(a,s);var c={};Object.defineProperty(c,"maxMessageSize",{get:function(){return o}}),this._sctp=c}return r.apply(this,arguments)}}}function Zr(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e,this),e},Kt(e,"datachannel",(function(e){return r(e.channel,e.target),e}))}function r(e,t){var r=e.send;e.send=function(){var n=arguments[0],o=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&o>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}}function en(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}}function tn(e){if(e.RTCPeerConnection){var t=Qt(e);if(!("chrome"===t.browser&&t.version>=71)){var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter((function(e){return"a=extmap-allow-mixed"!==e.trim()})).join("\n")),r.apply(this,arguments)}}}}var rn=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).window,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},n=Jt,c=Qt(e),u={browserDetails:c,commonShim:s,extractVersion:Wt,disableLog:Yt,disableWarnings:Ht};switch(c.browser){case"chrome":if(!t||!vr||!r.shimChrome)return n("Chrome shim is not included in this adapter release."),u;n("adapter.js shimming chrome."),u.browserShim=t,or(e),cr(e),vr(e),ur(e),hr(e),lr(e),pr(e),fr(e),mr(e),Qr(e),en(e),Xr(e),Zr(e),tn(e);break;case"firefox":if(!i||!Tr||!r.shimFirefox)return n("Firefox shim is not included in this adapter release."),u;n("adapter.js shimming firefox."),u.browserShim=i,xr(e),Tr(e),Er(e),Lr(e),Cr(e),jr(e),Dr(e),Ir(e),Mr(e),Ar(e),Qr(e),en(e),Xr(e),Zr(e);break;case"edge":if(!o||!_r||!r.shimEdge)return n("MS edge shim is not included in this adapter release."),u;n("adapter.js shimming edge."),u.browserShim=o,br(e),wr(e),_r(e),Sr(e),Xr(e),Zr(e);break;case"safari":if(!a||!r.shimSafari)return n("Safari shim is not included in this adapter release."),u;n("adapter.js shimming safari."),u.browserShim=a,zr(e),Kr(e),Vr(e),Br(e),Gr(e),Wr(e),Ur(e),Qr(e),Xr(e),Zr(e),tn(e);break;default:n("Unsupported browser!")}return u}({window});const nn=rn;nn.options=nn.options||{},nn.onwebrtcreadyDone=!1,nn.WebRTCPlugin={plugin:null},nn._onwebrtcreadies=[],nn.webRTCReady=function(e){if("function"!=typeof e)throw new Error("Callback provided is not a function");var t=function(){"function"==typeof window.require&&"function"==typeof nn._defineMediaSourcePolyfill&&nn._defineMediaSourcePolyfill(),e(null!==nn.WebRTCPlugin.plugin)};!0===nn.onwebrtcreadyDone?t():nn._onwebrtcreadies.push(t)},nn.maybeThroughWebRTCReady=function(){nn.onwebrtcreadyDone||(nn.onwebrtcreadyDone=!0,nn._onwebrtcreadies.length?nn._onwebrtcreadies.forEach((function(e){"function"==typeof e&&e(null!==nn.WebRTCPlugin.plugin)})):"function"==typeof nn.onwebrtcready&&nn.onwebrtcready(null!==nn.WebRTCPlugin.plugin))},window.webrtcDetectedBrowser=null,window.webrtcDetectedVersion=null,window.webrtcMinimumVersion=null,window.webrtcDetectedDCSupport=null,nn.parseWebrtcDetectedBrowser=function(){var e=null;if(window.navigator.userAgent.match(/React-Native/gi)||navigator.userAgent.match(/React-Native/gi))window.webrtcDetectedBrowser="react-native",window.webrtcDetectedVersion="",window.webrtcMinimumVersion=0,window.webrtcDetectedType="react-native",window.webrtcDetectedDCSupport=null;else if(window.opr&&window.opr.addons||window.opera||navigator.userAgent.indexOf(" OPR/")>=0)e=navigator.userAgent.match(/OPR\/(\d+)/i)||[],window.webrtcDetectedBrowser="opera",window.webrtcDetectedVersion=parseInt(e[1]||"0",10),window.webrtcMinimumVersion=26,window.webrtcDetectedType="webkit",window.webrtcDetectedDCSupport="SCTP";else if(navigator.userAgent.match(/Bowser\/[0-9.]*/g)){e=navigator.userAgent.match(/Bowser\/[0-9.]*/g)||[];var t=parseInt((navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./i)||[])[2]||"0",10);window.webrtcDetectedBrowser="bowser",window.webrtcDetectedVersion=parseFloat((e[0]||"0/0").split("/")[1],10),window.webrtcMinimumVersion=0,window.webrtcDetectedType="webkit",window.webrtcDetectedDCSupport=t>30?"SCTP":"RTP"}else if(navigator.userAgent.indexOf("OPiOS")>0)e=navigator.userAgent.match(/OPiOS\/([0-9]+)\./),window.webrtcDetectedBrowser="opera",window.webrtcDetectedVersion=parseInt(e[1]||"0",10),window.webrtcMinimumVersion=0,window.webrtcDetectedType=null,window.webrtcDetectedDCSupport=null;else if(navigator.userAgent.indexOf("CriOS")>0)e=navigator.userAgent.match(/CriOS\/([0-9]+)\./)||[],navigator.userAgent.match(/CPU OS ([0-9]+)_([0-9]+)/g)[0].split(" ")[2].split("_")[0]>13?(window.webrtcDetectedVersion=parseInt(e[1]||"0",10),window.webrtcMinimumVersion=53,window.webrtcDetectedType="AppleWebKit",window.webrtcDetectedBrowser="chrome",window.webrtcDetectedDCSupport=null):(window.webrtcDetectedVersion=parseInt(e[1]||"0",10),window.webrtcMinimumVersion=0,window.webrtcDetectedType=null,window.webrtcDetectedBrowser="chrome",window.webrtcDetectedDCSupport=null);else if(navigator.userAgent.indexOf("FxiOS")>0)e=navigator.userAgent.match(/FxiOS\/([0-9]+)\./)||[],window.webrtcDetectedBrowser="firefox",window.webrtcDetectedVersion=parseInt(e[1]||"0",10),window.webrtcMinimumVersion=0,window.webrtcDetectedType=null,window.webrtcDetectedDCSupport=null;else if(document.documentMode)e=/\brv[ :]+(\d+)/g.exec(navigator.userAgent)||[],window.webrtcDetectedBrowser="IE",window.webrtcDetectedVersion=parseInt(e[1],10),window.webrtcMinimumVersion=9,window.webrtcDetectedType="plugin",window.webrtcDetectedDCSupport="SCTP",window.webrtcDetectedVersion||(e=/\bMSIE[ :]+(\d+)/g.exec(navigator.userAgent)||[],window.webrtcDetectedVersion=parseInt(e[1]||"0",10));else if(window.StyleMedia||navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))e=navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)||[],window.webrtcDetectedBrowser="edge",window.webrtcDetectedVersion=parseFloat((e[0]||"0/0").split("/")[1],10),window.webrtcMinimumVersion=13.10547,window.webrtcDetectedType="ms",window.webrtcDetectedDCSupport=null;else if("undefined"!=typeof InstallTrigger||navigator.userAgent.indexOf("irefox")>0)e=navigator.userAgent.match(/Firefox\/([0-9]+)\./)||[],window.webrtcDetectedBrowser="firefox",window.webrtcDetectedVersion=parseInt(e[1]||"0",10),window.webrtcMinimumVersion=33,window.webrtcDetectedType="moz",window.webrtcDetectedDCSupport="SCTP";else if(window.chrome&&window.chrome.webstore||navigator.userAgent.indexOf("Chrom")>0)e=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./i)||[],window.webrtcDetectedBrowser="chrome",window.webrtcDetectedVersion=parseInt(e[2]||"0",10),window.webrtcMinimumVersion=38,window.webrtcDetectedType="webkit",window.webrtcDetectedDCSupport=window.webrtcDetectedVersion>30?"SCTP":"RTP";else if(/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString()||navigator.userAgent.match(/AppleWebKit\/(\d+)\./)||navigator.userAgent.match(/Version\/(\d+).(\d+)/)){e=navigator.userAgent.match(/version\/(\d+)\.(\d+)/i)||[];var r=navigator.userAgent.match(/AppleWebKit\/(\d+)/i)||[],n=navigator.userAgent.match(/(iPhone|iPad)/gi),o=r.length>=1&&r[1]>=604;if(window.webrtcDetectedBrowser="safari",window.webrtcDetectedVersion=parseInt(e[1]||"0",10),window.webrtcMinimumVersion=7,n)window.webrtcDetectedType=o?"AppleWebKit":null;else{var i=window.webrtcDetectedVersion,a=parseInt(e[2]||"0",10),s=11==i&&a<2;window.webrtcDetectedType=!o||nn.options.forceSafariPlugin&&s?"plugin":"AppleWebKit"}window.webrtcDetectedDCSupport="SCTP"}nn.webrtcDetectedBrowser=window.webrtcDetectedBrowser,nn.webrtcDetectedVersion=window.webrtcDetectedVersion,nn.webrtcMinimumVersion=window.webrtcMinimumVersion,nn.webrtcDetectedType=window.webrtcDetectedType,nn.webrtcDetectedDCSupport=window.webrtcDetectedDCSupport},nn.addExtensions=function(){var e=null,t=null;navigator.mozGetUserMedia?(e=function(e,t){return e.srcObject=t,e},t=function(e,t){return e.srcObject=t.srcObject,e}):navigator.webkitGetUserMedia?(e=function(e,t){return nn.webrtcDetectedVersion>=43?e.srcObject=t:void 0!==e.src?e.src=URL.createObjectURL(t):console.error("Error attaching stream to element."),e},t=function(e,t){return nn.webrtcDetectedVersion>=43?e.srcObject=t.srcObject:e.src=t.src,e}):"AppleWebKit"===nn.webrtcDetectedType&&("chrome"===nn.webrtcDetectedBrowser?e=function(e,t){return nn.webrtcDetectedVersion>=43?e.srcObject=t:console.error("Error attaching stream to element."),e}:(e=function(e,t){return e.srcObject=t,e},t=function(e,t){return e.srcObject=t.srcObject,e})),window.attachMediaStream=e,window.reattachMediaStream=t,nn.attachMediaStream=e,nn.reattachMediaStream=t},nn.parseWebrtcDetectedBrowser(),nn.addExtensions(),nn.maybeThroughWebRTCReady();const on=nn;var an="onIncomingStream",sn="onIncomingScreenStream",cn="streamEnded",un="streamMuted",ln="loggedOnConsole",pn="channelOpen",fn="channelReopen",dn="channelClose",hn="channelMessage",vn="channelError",mn="channelRetry";function yn(e){return yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yn(e)}function gn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==yn(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==yn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===yn(o)?o:String(o)),n)}var o}function bn(e,t,r){return t&&gn(e.prototype,t),r&&gn(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}const wn=bn((function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=t,this.detail=r}));var _n=c,Sn={qvga:{width:{ideal:320},height:{ideal:240}},vga:{width:{ideal:640},height:{ideal:480}},hd:{width:{ideal:1280},height:{ideal:720}}},kn="SDK EVENT";const xn={ERRORS:{NO_ADAPTER:"AdapterJS dependency is not loaded or incorrect AdapterJS dependency is used",NO_SOCKET_IO:"Socket.io not loaded - Please load socket.io",NO_SOCKET_HOST_PARAM:"Error host param"},INCOMPATIBLE_BROWSER:"Incompatible browser agent detected",INFO:{API_SUCCESS:"Promise resolved: APP Authenticated Successfully!"}},Rn={ABORT_RECONNECT:"Aborting socket reconnect",FALIED_LINK:"socket link failed",SEND_TIMEOUT:"socket IO send timeout"},Pn={EVENT_DISPATCHED:"Event dispatched",EVENT_REGISTERED:"Event successfully registered",EVENT_UNREGISTERED:"Event successfully unregistered",EVENT_DISPATCH_ERROR:"Error dispatching event",EVENT_REGISTER_ERROR:"Error registering event",EVENT_UNREGISTER_ERROR:"Error unregistering event",LOGS_NOT_STORED:"Store logs feature is not enabled.",LOGS_CLEARED:"Stored logs cleared",INVALID_CB:"Dropping listener as it is not a function"},On={ERROR_CODES:{INVALID_KEY:"INVALID_KEY",INVALID_OPERATION:"INVALID_OPERATION",INVALID_LOCAL_STREAM:"INVALID_LOCAL_STREAM",INVALID_REMOTE_STREAM:"INVALID_REMOTE_STREAM",SOCKET_ERROR:"SOCKET_ERROR",SOCKET_DISCONNECTED:"SOCKET_DISCONNECTED",PEERCONNECTION_FAILED:"PEERCONNECTION_FAILED",CONNECT_GATEWAY_ERROR:"CONNECT_GATEWAY_ERROR",SERVICE_NOT_AVAILABLE:"SERVICE_NOT_AVAILABLE",JOIN_CHANNEL_FAILED:"JOIN_CHANNEL_FAILED",PUBLISH_STREAM_FAILED:"PUBLISH_STREAM_FAILED",UNPUBLISH_STREAM_FAILED:"UNPUBLISH_STREAM_FAILED",SUBSCRIBE_STREAM_FAILED:"SUBSCRIBE_STREAM_FAILED",UNSUBSCRIBE_STREAM_FAILED:"UNSUBSCRIBE_STREAM_FAILED"}};function En(e){return En="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},En(e)}function Tn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==En(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==En(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===En(o)?o:String(o)),n)}var o}var Cn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.events={},this.privateEvents={},this.on=this.addEventListener.bind(this)}var t,r;return t=e,r=[{key:"addPrivateEventListener",value:function(e,t){this.addListener(e,t,!0)}},{key:"addEventListener",value:function(e,t){this.addListener(e,t,!1)}},{key:"addListener",value:function(e,t,r){try{var n=r?"privateEvents":"events";if(!Wn(t))return void Un.log.DEBUG([null,kn,e,Pn.INVALID_CB]);this[n][e]||(this[n][e]={}),this[n][e].callbacks||(this[n][e].callbacks=[]),this[n][e].callbacks.push(t),r||Un.log.DEBUG([null,kn,e,Pn.EVENT_REGISTERED])}catch(t){Un.log.ERROR([null,kn,e,Pn.EVENT_REGISTER_ERROR],t)}}},{key:"dispatchEvent",value:function(e){var t=e.type;if(t!==_n.LOGGED_ON_CONSOLE){var r=[];if(this.events[t]){var n=this.events[t].callbacks;r=r.concat(n)}else Un.log.DEBUG([null,kn,t,Pn.EVENT_DISPATCHED]);if(this.privateEvents[t]){var o=this.privateEvents[t]?this.privateEvents[t].callbacks:[];r=r.concat(o)}r.forEach((function(r){try{r(e.detail)}catch(e){Un.log.ERROR([null,kn,t,Pn.EVENT_DISPATCH_ERROR],e)}}))}}},{key:"removeEventListener",value:function(e,t){this.removeListener(e,t,!1)}},{key:"removePrivateEventListener",value:function(e,t){this.removeListener(e,t,!0)}},{key:"removeListener",value:function(e,t,r){var n=this,o=r?"privateEvents":"events";if(r||this.events[e]&&this.events[e].callbacks)try{this[o][e].callbacks.forEach((function(i,a){i===t&&(delete n[o][e].callbacks[a],r||Un.log.DEBUG([null,kn,e,Pn.EVENT_UNREGISTERED]))}))}catch(t){Un.log.ERROR([null,kn,e,Pn.EVENT_DISPATCH_ERROR],t)}else Un.log.WARN([null,kn,e,Pn.EVENT_UNREGISTERED])}}],r&&Tn(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),jn=new Cn,Ln=(jn.addPrivateEventListener.bind(jn),jn.removePrivateEventListener.bind(jn),jn.dispatchEvent.bind(jn));const Dn=Cn;function In(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Mn=["trace","debug","info","warn","error"],An="loglevel:GmRTC",Nn=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o="[".concat((new Date).toISOString(),"]"),i=e.level,a=e.logLevels;if(i<=t&&i!==a.SILENT){var s=Mn[t],c=function(e){var t=!0;return("undefined"==typeof console||void 0===console[e])&&(t=!1),t}(s);if(!c)return;var u=function(e){var t="".concat(e);if(Array.isArray(e)){var r=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return In(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?In(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,4),n=r[0],o=r[1],i=r[2],a=r[3];if(t=n?"[".concat(n,"]"):"",t+=o?" <<".concat(o,">>"):n?"":" <<Method>>",i)if(Array.isArray(i))for(var s=0;s<i.length;s+=1)t+=" (".concat(i[s],")");else t+=" (".concat(i,")");a&&(t+=" ".concat(a))}return t}(r),l=Array.prototype.slice.call(arguments,4);0===l.length&&(l=""),console[s](o,s,"GmRTC -",u,n||"",l);var p=function(){return new wn(ln,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}({level:s,message:u,debugObject:n});if(Ln(p),Un.storeLogs){var f=[o,s.toUpperCase(),u];n&&f.push(n),Un.storedLogs.push(f)}}};function Fn(e){return Fn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fn(e)}function Bn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Fn(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Fn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Fn(o)?o:String(o)),n)}var o}var Gn=function(){function e(){var t,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.logLevels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},this.level=(t=this.logLevels,null===(r=window.localStorage.getItem(An))||Number.isNaN(+r)?t.TRACE:+r),this.storeLogs=!0,this.storedLogs=[]}var t,r;return t=e,r=[{key:"setLevel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.levels.ERROR,t=arguments.length>1?arguments[1]:void 0;zn(e)?(this.level=e,function(e){window.localStorage.setItem(An,e)}(this.level)):this.level=this.levels.ERROR,t&&(this.storeLogs=t)}},{key:"enableAll",value:function(){this.setLevel(this.logLevels.TRACE)}},{key:"disableAll",value:function(){this.setLevel(this.logLevels.SILENT)}},{key:"getLogs",value:function(){return this.storeLogs?this.storedLogs:(this.log.WARN(Pn.LOGS_NOT_STORED),null)}},{key:"clearLogs",value:function(){this.log.INFO(Pn.LOGS_CLEARED),this.storedLogs=[]}}],r&&Bn(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),Vn=new Gn;Gn.prototype.log={TRACE:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];Nn.apply(void 0,[Vn,Vn.logLevels.TRACE].concat(t))},DEBUG:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];Nn.apply(void 0,[Vn,Vn.logLevels.DEBUG].concat(t))},INFO:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];Nn.apply(void 0,[Vn,Vn.logLevels.INFO].concat(t))},WARN:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];Nn.apply(void 0,[Vn,Vn.logLevels.WARN].concat(t))},ERROR:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];Nn.apply(void 0,[Vn,Vn.logLevels.ERROR].concat(t))}};const Un=Vn;var qn=function(){var e=arguments[0];if("function"==typeof e){var t=Array.prototype.slice.call(arguments,1);e.apply(null,t)}},zn=function(e){return"number"==typeof e},Wn=function(e){return"function"==typeof e},Kn=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};function Yn(e){return Yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yn(e)}var Hn=function(e){var t={video:e.video,audio:e.audio,fake:e.fake};if(e.screen)t={video:e.video,audio:e.audio,screen:!0,attributes:e.screenAttributes,fake:e.fake};else{var r=15,n=15;void 0!==e.attributes.minFrameRate&&(n=e.attributes.minFrameRate),void 0!==e.attributes.maxFrameRate&&(r=e.attributes.maxFrameRate),null!==window.navigator.userAgent.match("Firefox")?!0===t.video?(t.video={width:{exact:e.videoSize[0]},height:{exact:e.videoSize[1]},framerate:{ideal:n,max:r}},e.setVideoBitRate([500,500])):"object"===Yn(t.video)&&(t.video.framerate={ideal:n,max:r}):!0===t.video?(t.video={mandatory:{minWidth:e.videoSize[0],minHeight:e.videoSize[1],maxWidth:e.videoSize[2],maxHeight:e.videoSize[3],minFrameRate:n,maxFrameRate:r}},e.setVideoBitRate([500,500])):"object"===Yn(t.video)&&void 0!==t.video.mandatory&&(t.video.mandatory.maxFrameRate=r,t.video.mandatory.minFrameRate=n),void 0!==e.options.cameraId&&""!==e.options.cameraId&&(t.video.optional=[{sourceId:e.options.cameraId}]),void 0!==e.options.microphoneId&&""!==e.options.microphoneId&&(t.audio=[{sourceId:e.options.microphoneId}])}return t};function Jn(e){return Jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jn(e)}function $n(){$n=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof y?t:y,a=Object.create(i.prototype),s=new C(n||[]);return o(a,"_invoke",{value:P(e,r,s)}),a}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",d="suspendedYield",h="executing",v="completed",m={};function y(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var _=Object.getPrototypeOf,S=_&&_(_(j([])));S&&S!==r&&n.call(S,a)&&(w=S);var k=b.prototype=y.prototype=Object.create(w);function x(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function r(o,i,a,s){var c=p(e[o],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==Jn(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function P(t,r,n){var o=f;return function(i,a){if(o===h)throw new Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=O(s,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?v:d,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=v,n.method="throw",n.arg=u.arg)}}}function O(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,O(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=p(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function j(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(Jn(t)+" is not iterable")}return g.prototype=b,o(k,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(R.prototype),u(R.prototype,s,(function(){return this})),t.AsyncIterator=R,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new R(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(k),u(k,c,"Generator"),u(k,a,(function(){return this})),u(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=j,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:j(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function Qn(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Xn(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){Qn(i,n,o,a,s,"next",e)}function s(e){Qn(i,n,o,a,s,"throw",e)}a(void 0)}))}}function Zn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Jn(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Jn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Jn(o)?o:String(o)),n)}var o}function eo(e,t){return eo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},eo(e,t)}function to(e){return to=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},to(e)}var ro=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&eo(e,t)}(c,e);var t,r,n,o,i,a,s=(i=c,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=to(i);if(a){var r=to(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Jn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=s.call(this)).options=e||{},t.stream=e.stream,t.audioStream=void 0,t.url=e.url,t.onClose=void 0,t.local=!1,t.video=Boolean(e.video),t.audio=Boolean(e.audio),t.screen=Boolean(e.screen),t.screenAttributes={width:1920,height:1080,maxFr:5,minFr:1},t.videoSize=e.videoSize,t.attributes=e.attributes||{},t.videoEnabled=!0,t.audioEnabled=!0,t.videoConsumer=null,t.audioConsumer=null,t.playerShowing=!1,void 0!==e.local&&!0!==e.local||(t.local=!0),void 0!==t.videoSize||t.videoSize instanceof Array&&4===t.videoSize.length||(t.videoSize=[640,480,640,480]),t.initialized=!t.local,t.unmuteAudio=void 0,t.muteAudio=void 0,t.unmuteVideo=void 0,t.muteVideo=void 0,t}return t=c,r=[{key:"initFailed",value:function(e,t,r){var n=this;switch((r={type:"error",msg:r.name||r}).msg){case"Starting video failed":case"TrackStartError":if(this.setVideo("unspecified"),this.videoSize=void 0,this.loopNum>0)return void setTimeout((function(){n.init(e,t)}),1);r.msg="MEDIA_OPTION_INVALID";break;case"DevicesNotFoundError":r.msg="DEVICES_NOT_FOUND";break;case"NotSupportedError":r.msg="NOT_SUPPORTED";break;case"PermissionDeniedError":r.msg="PERMISSION_DENIED";break;case"PERMISSION_DENIED":break;case"ConstraintNotSatisfiedError":r.msg="CONSTRAINT_NOT_SATISFIED";break;default:r.msg||(r.msg="UNDEFINED")}qn(t,r)}},{key:"init",value:function(e,t){var r=this;if(!0===this.initialized)return qn(t,{type:"warning",msg:"STREAM_ALREADY_INITIALIZED"});if(!0!==this.local)return qn(t,{type:"warning",msg:"STREAM_NOT_LOCAL"});if(!(this.audio||this.video||this.screen)||void 0!==this.url)return qn(t,{type:"warning",msg:"STREAM_HAS_NO_MEDIA_ATTRIBUTES"});try{var n=Hn(this);Ki.getUserMedia(n,(function(t,n){r.stream=t,r.audioStream=n,r.initialized=!0,qn(e),Un.log.INFO("getUserMedia sucess",r.allMediaTrack())}),(function(n){r.initFailed(e,t,n)}))}catch(e){return qn(t,{type:"error",msg:e.message||e})}}},{key:"setLocalStreamTrack",value:(o=Xn($n().mark((function e(){var t,r,n,o=this;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.stream){e.next=2;break}return e.abrupt("return",!1);case 2:if(t=!1,this.video&&(r=this.getVideoTracks()[0],t=r&&"ended"===r.readyState),!t&&this.audio&&(n=this.getAudioTracks()[0],t=n&&"ended"===n.readyState),t){e.next=8;break}return Un.log.INFO(["setLocalStreamTrack",t],this.allMediaTrack()),e.abrupt("return",!1);case 8:return e.abrupt("return",new Promise((function(e,r){var n=Hn(o);Ki.getUserMedia(n,(function(r,n){o.stream=r,o.audioStream=n,Un.log.INFO(["setLocalStreamTrack sucess",t],o.allMediaTrack()),e()}),(function(e){Un.log.INFO(["setLocalStreamTrack failed",t],e),r({error:e,type:"getUserMedia"})}))})));case 9:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"allMediaTrack",value:function(){return{audioTrack:this.getAudioTracks(),videoTrack:this.getVideoTracks()}}},{key:"stopTrack",value:function(e){if(!e)return!1}},{key:"close",value:function(){this.stopTrack(this.stream),this.stopTrack(this.audioStream),this.stream=void 0,this.audioStream=void 0,this.initialized=!1,this.unmuteAudio=void 0,this.muteAudio=void 0,this.unmuteVideo=void 0,this.muteVideo=void 0,this.closeConsumer(this.videoConsumer),this.closeConsumer(this.audioConsumer),void 0!==this.pc&&this.pc.close&&this.pc.close(),this.pc=void 0}},{key:"closeConsumer",value:function(e){if(!e)return!1;"video"===e.kind?(this.videoConsumer=null,this.videoRemoteData=null,this.video=!1,this.screen=!1):"audio"===e.kind&&(this.audioConsumer=null,this.audioRemoteData=null,this.audio=!1)}},{key:"setRemoteStream",value:function(e,t,r){var n=t.type,o=t.producerPaused,i=r.parseScalabilityMode(e.rtpParameters.encodings[0].scalabilityMode),a=i.spatialLayers,s=i.temporalLayers,c={id:e.id,type:n,locallyPaused:!1,remotelyPaused:o,rtpParameters:e.rtpParameters,spatialLayers:a,temporalLayers:s,preferredSpatialLayer:a-1,preferredTemporalLayer:s-1,priority:1,codec:e.rtpParameters.codecs[0].mimeType.split("/")[1],track:e.track};"video"===e.kind?(this.videoConsumer=e,this.videoRemoteData=c,this.screen||(this.video=!0)):"audio"===e.kind&&(this.audioConsumer=e,this.audioRemoteData=c,this.audio=!0)}},{key:"getAudioStream",value:function(){if(!this.local){var e=this.audioConsumer&&this.audioConsumer.track||null,t=new MediaStream;return e||Un.log.ERROR("getVideoStream no track",{track:e}),e&&t.addTrack(e),t}return this.local&&this.screen?this.audioStream:this.stream}},{key:"getVideoStream",value:function(){if(!this.local){var e=this.videoConsumer&&this.videoConsumer.track||null;e||Un.log.ERROR("getVideoStream no track",{track:e});var t=new MediaStream;return e&&t.addTrack(e),t}return this.stream}},{key:"getVideoTracks",value:function(){return this.getVideoStream().getVideoTracks()}},{key:"getAudioTracks",value:function(){return this.getAudioStream().getAudioTracks()}},{key:"hasVideoeEabled",value:function(){return(this.hasVideo()||this.hasScreen())&&this.getVideoTracks()[0].enabled||!1}},{key:"hasAudioEabled",value:function(){return this.hasAudio()&&this.getVideoTracks()[0].enabled||!1}},{key:"enableAudio",value:function(){return this.hasAudioEabled()||(void 0!==this.unmuteAudio&&this.unmuteAudio(),this.audioEnabled=!0,this.getAudioTracks()[0].enabled=!0),!1}},{key:"disableAudio",value:function(){return this.hasAudioEabled()&&(void 0!==this.muteAudio&&this.muteAudio(),this.audioEnabled=!1,this.getAudioTracks()[0].enabled=!1),!1}},{key:"enableVideo",value:function(){return this.hasVideoeEabled()||(void 0!==this.unmuteVideo&&this.unmuteVideo(),this.videoEnabled=!0,this.getVideoTracks()[0].enabled=!0),!1}},{key:"disableVideo",value:function(){return this.hasVideoeEabled()&&(void 0!==this.muteVideo&&this.muteVideo(),this.videoEnabled=!1,this.getVideoTracks()[0].enabled=!1),!1}},{key:"play",value:(n=Xn($n().mark((function e(t){var r,n,o=this;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.elementID=t,this.playerShowing=!0,r=[],n=new Promise((function(e){e(null)})),Un.log.INFO(["play---player",this.getId()],{elementID:t,playerShowing:this.playerShowing}),this.playerVideo||!this.video&&!this.screen?r.push(n):(Un.log.INFO(["play---playerVideo- start",this.getId()],{media:this.playerVideo}),this.playerVideo=Ki.videoPlayer({id:this.getId(),stream:this,elementID:t,options:void 0}),r.push(this.playerVideo.mediaPlay()),Un.log.INFO(["play---playerVideo- end",this.getId()],{media:this.playerVideo})),!this.playerAudio&&this.hasAudio()?(Un.log.INFO(["play---playerAudio- start",this.getId()],{media:this.playerAudio}),this.playerAudio=Ki.audioPlayer({id:this.getId(),stream:this,elementID:t,options:void 0}),r.push(this.playerAudio.mediaPlay()),Un.log.INFO(["play---playerAudio- end",this.getId()],{media:this.playerAudio})):r.push(n),e.abrupt("return",new Promise((function(e,t){var n={video:null,audio:null};Un.log.INFO(["play---return allPromise success",o.getId()],r),Promise.all(r).then((function(t){n.video=t[0],n.audio=t[1],Un.log.INFO(["play---return statu success",o.getId()],n),e(n)})).catch((function(e){Un.log.ERROR(["play---return statu failed",o.getId()],{error:e}),t(e)}))})));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"stop",value:function(){this.playerVideo&&this.playerVideo.destroy(),this.playerAudio&&this.playerAudio.destroy(),this.playerVideo=void 0,this.playerAudio=void 0,this.playerShowing=null}},{key:"setVideoResolution",value:function(e){return void 0!==this[e]&&(this.options.attributes=this.options.attributes||{},this.options.attributes.resolution=e,!0)}},{key:"setVideoFrameRate",value:function(e){return"object"===Jn(e)&&e instanceof Array&&1<e.length&&(this.options.attributes=this.options.attributes||{},this.options.attributes.minFrameRate=e[0],this.options.attributes.maxFrameRate=e[1],!0)}},{key:"setVideoBitRate",value:function(e){return"object"===Jn(e)&&e instanceof Array&&1<e.length&&(this.options.attributes=this.options.attributes||{},this.options.attributes.minVideoBW=e[0],this.options.attributes.maxVideoBW=e[1],!0)}},{key:"setScreenProfile",value:function(e){if("string"==typeof e){switch(e){case"480p_1":this.screenAttributes.width=640,this.screenAttributes.height=480,this.screenAttributes.maxFr=5,this.screenAttributes.minFr=1;break;case"480p_2":this.screenAttributes.width=640,this.screenAttributes.height=480,this.screenAttributes.maxFr=30,this.screenAttributes.minFr=25;break;case"720p_1":this.screenAttributes.width=1280,this.screenAttributes.height=720,this.screenAttributes.maxFr=5,this.screenAttributes.minFr=1;break;case"720p_2":this.screenAttributes.width=1280,this.screenAttributes.height=720,this.screenAttributes.maxFr=30,this.screenAttributes.minFr=25;break;case"1080p_1":this.screenAttributes.width=1920,this.screenAttributes.height=1080,this.screenAttributes.maxFr=5,this.screenAttributes.minFr=1;break;case"1080p_2":this.screenAttributes.width=1920,this.screenAttributes.height=1080,this.screenAttributes.maxFr=30,this.screenAttributes.minFr=25}return!0}return!1}},{key:"setVideoProfile",value:function(e){if("string"==typeof e){switch(e){case"120p_1":this.setVideoResolution("120p"),this.setVideoFrameRate([15,15]),this.setVideoBitRate([10,80]);break;case"240p_1":this.setVideoResolution("240p"),this.setVideoFrameRate([15,15]),this.setVideoBitRate([10,200]);break;case"480p_1":default:this.setVideoResolution("480p"),this.setVideoFrameRate([15,15]),this.setVideoBitRate([20,500]);break;case"480p_2":this.setVideoResolution("480p"),this.setVideoFrameRate([30,30]),this.setVideoBitRate([20,1e3]);break;case"480p_3":this.setVideoResolution("480p"),this.setVideoFrameRate([25,25]),this.setVideoBitRate([20,750]);break;case"720p_1":this.setVideoResolution("720p"),this.setVideoFrameRate([15,15]),this.setVideoBitRate([30,1e3]);break;case"720p_2":this.setVideoResolution("720p"),this.setVideoFrameRate([30,30]),this.setVideoBitRate([30,2e3]);break;case"720p_3":this.setVideoResolution("720p"),this.setVideoFrameRate([25,25]),this.setVideoBitRate([30,1500]);break;case"1080p_1":this.setVideoResolution("1080p"),this.setVideoFrameRate([15,15]),this.setVideoBitRate([50,1500]);break;case"1080p_2":this.setVideoResolution("1080p"),this.setVideoFrameRate([30,30]),this.setVideoBitRate([50,3e3])}return!0}return!1}},{key:"getId",value:function(){return this.options.streamID}},{key:"getAttributes",value:function(){return this.attributes}},{key:"hasAudio",value:function(){return this.audio}},{key:"hasVideo",value:function(){return this.video}},{key:"hasScreen",value:function(){return this.screen}},{key:"isVideoOn",value:function(){return(this.hasVideo()||this.hasScreen())&&this.videoEnabled}},{key:"isAudioOn",value:function(){return this.hasAudio()&&this.audioEnabled}},{key:"isPlaying",value:function(){return this.playerShowing}},{key:"unmutePlayerAudio",value:function(){try{this.playerAudio&&this.playerAudio.mediaPause(),this.audioConsumer&&this.audioConsumer.pause()}catch(e){Un.log.ERROR("unmutePlayerAudio() | failed",e)}}},{key:"mutePlayerAudio",value:function(){try{this.playerAudio&&this.playerAudio.mediaResume(),this.audioConsumer&&this.audioConsumer.resume()}catch(e){Un.log.ERROR("mutePlayerAudio() | failed",e)}}},{key:"unmutePlayerVideo",value:function(){try{this.playerVideo&&this.playerVideo.mediaPause(),this.videoConsumer&&this.videoConsumer.pause()}catch(e){Un.log.ERROR("unmutePlayerVideo() | failed",e)}}},{key:"mutePlayerVideo",value:function(){try{this.playerVideo&&this.playerVideo.mediaResume(),this.videoConsumer&&this.videoConsumer.resume()}catch(e){Un.log.ERROR("mutePlayerVideo() | failed",e)}}}],r&&Zn(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(Dn);const no=ro;var oo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new wn(e.type,e);return t.stream=e.stream,t.msg=e.msg,t},io=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new wn(e.type,e);return t.uid=e.uid,t.attr=e.attr,t.stream=e.stream,t},ao=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new wn(e.type,e);return t.msg=e.msg,t};function so(e){return so="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},so(e)}function co(){co=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof y?t:y,a=Object.create(i.prototype),s=new C(n||[]);return o(a,"_invoke",{value:P(e,r,s)}),a}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",d="suspendedYield",h="executing",v="completed",m={};function y(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var _=Object.getPrototypeOf,S=_&&_(_(j([])));S&&S!==r&&n.call(S,a)&&(w=S);var k=b.prototype=y.prototype=Object.create(w);function x(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function r(o,i,a,s){var c=p(e[o],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==so(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function P(t,r,n){var o=f;return function(i,a){if(o===h)throw new Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=O(s,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?v:d,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=v,n.method="throw",n.arg=u.arg)}}}function O(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,O(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=p(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function j(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(so(t)+" is not iterable")}return g.prototype=b,o(k,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(R.prototype),u(R.prototype,s,(function(){return this})),t.AsyncIterator=R,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new R(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(k),u(k,c,"Generator"),u(k,a,(function(){return this})),u(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=j,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:j(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function uo(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function lo(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==so(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==so(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===so(o)?o:String(o)),n)}var o}function po(e,t){return po=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},po(e,t)}function fo(e){return fo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},fo(e)}var ho=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&po(e,t)}(c,e);var t,r,n,o,i,a,s=(i=c,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=fo(i);if(a){var r=fo(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===so(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function c(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(e=s.call(this)).setMaxListeners(1/0),e}return t=c,r=[{key:"safeEmit",value:function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.emit.apply(this,[e].concat(r))}catch(e){}}},{key:"safeEmitAsPromise",value:(n=co().mark((function e(t){var r,n,o,i=this,a=arguments;return co().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=a.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=a[o];return e.abrupt("return",new Promise((function(e,r){i.safeEmit.apply(i,[t].concat(n,[e,r]))})));case 2:case"end":return e.stop()}}),e)})),o=function(){var e=this,t=arguments;return new Promise((function(r,o){var i=n.apply(e,t);function a(e){uo(i,r,o,a,s,"next",e)}function s(e){uo(i,r,o,a,s,"throw",e)}a(void 0)}))},function(e){return o.apply(this,arguments)})}],r&&lo(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(r(5090).EventEmitter);const vo=ho;var mo=r(7444),yo=r.n(mo),go={retries:10,factor:2,minTimeout:1e3,maxTimeout:8e3};function bo(e){return bo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bo(e)}function wo(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==bo(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==bo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===bo(o)?o:String(o)),n)}var o}const _o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"parse",value:function(e){var t,r={};try{t=JSON.parse(e)}catch(e){return}if("object"===bo(t)&&!Array.isArray(t)){if(t.request){if(r.request=!0,"string"!=typeof t.method)return;if("number"!=typeof t.id)return;r.id=t.id,r.method=t.method,r.data=t.data||{}}else if(t.response){if(r.response=!0,"number"!=typeof t.id)return;r.id=t.id,t.ok?(r.ok=!0,r.data=t.data||{}):(r.ok=!1,r.errorCode=t.errorCode,r.errorReason=t.errorReason)}else{if(!t.notification)return;if(r.notification=!0,"string"!=typeof t.method)return;r.method=t.method,r.data=t.data||{}}return r}}},{key:"createRequest",value:function(e,t){return{request:!0,id:Math.round(1e7*Math.random()),method:e,data:t||{}}}},{key:"createSuccessResponse",value:function(e,t){return{response:!0,id:e.id,ok:!0,data:t||{}}}},{key:"createErrorResponse",value:function(e,t,r){return{response:!0,id:e.id,ok:!1,errorCode:t,errorReason:r}}},{key:"createNotification",value:function(e,t){return{notification:!0,method:e,data:t||{}}}}],null&&wo(t.prototype,null),r&&wo(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function So(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}const ko=So;So.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},So.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},So.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),r=this._timeouts.shift()}var n=this,o=setTimeout((function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)}),r);return this._options.unref&&o.unref(),!0},So.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},So.prototype.try=function(e){this.attempt(e)},So.prototype.start=function(e){this.attempt(e)},So.prototype.start=So.prototype.try,So.prototype.errors=function(){return this._errors},So.prototype.attempts=function(){return this._attempts},So.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var o=this._errors[n],i=o.message,a=(e[i]||0)+1;e[i]=a,a>=r&&(t=o,r=a)}return t};var xo=function(e,t){var r=t.randomize?Math.random()+1:1,n=Math.round(r*t.minTimeout*Math.pow(t.factor,e));return Math.min(n,t.maxTimeout)};function Ro(e){return Ro="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ro(e)}function Po(){Po=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof y?t:y,a=Object.create(i.prototype),s=new C(n||[]);return o(a,"_invoke",{value:P(e,r,s)}),a}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",d="suspendedYield",h="executing",v="completed",m={};function y(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var _=Object.getPrototypeOf,S=_&&_(_(j([])));S&&S!==r&&n.call(S,a)&&(w=S);var k=b.prototype=y.prototype=Object.create(w);function x(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function r(o,i,a,s){var c=p(e[o],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==Ro(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function P(t,r,n){var o=f;return function(i,a){if(o===h)throw new Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=O(s,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?v:d,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=v,n.method="throw",n.arg=u.arg)}}}function O(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,O(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=p(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function j(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(Ro(t)+" is not iterable")}return g.prototype=b,o(k,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(R.prototype),u(R.prototype,s,(function(){return this})),t.AsyncIterator=R,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new R(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(k),u(k,c,"Generator"),u(k,a,(function(){return this})),u(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=j,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:j(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function Oo(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Eo(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Ro(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Ro(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Ro(o)?o:String(o)),n)}var o}function To(e,t){return To=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},To(e,t)}function Co(e){return Co=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Co(e)}var jo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&To(e,t)}(c,e);var t,r,n,o,i,a,s=(i=c,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Co(i);if(a){var r=Co(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Ro(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function c(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(r=s.call(this)).websocket=yo(),r._closed=!1,r._url=e,r._options=t||{},r._ws=null,r._runWebSocket(),r}return t=c,r=[{key:"closed",get:function(){return this._closed}},{key:"close",value:function(){if(!this._closed){this._closed=!0,this.safeEmit("close");try{this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close()}catch(e){}}}},{key:"send",value:(n=Po().mark((function e(t){return Po().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=2;break}throw new Error("transport closed");case 2:try{this._ws.send(JSON.stringify(t))}catch(e){}case 3:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(r,o){var i=n.apply(e,t);function a(e){Oo(i,r,o,a,s,"next",e)}function s(e){Oo(i,r,o,a,s,"throw",e)}a(void 0)}))},function(e){return o.apply(this,arguments)})},{key:"_runWebSocket",value:function(){var e,t,r=this,n=(t=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],o=0;o<t.retries;o++)n.push(xo(o,t));return e&&e.forever&&!n.length&&n.push(xo(0,t)),n.sort((function(e,t){return e-t})),n}(e=this._options.retry||go),new ko(t,{forever:e&&e.forever,unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})),o=!1;n.attempt((function(e){r._closed?n.stop():(r._ws=new r.websocket.w3cwebsocket(r._url,"protoo",r._options.origin,r._options.headers,r._options.requestOptions,r._options.clientConfig),r._ws.onopen=function(){r._closed||(o=!0,r.safeEmit("open"))},r._ws.onclose=function(t){if(!r._closed){if(4e3!==t.code){if(o){if(n.stop(),r.safeEmit("disconnected"),r._closed)return;return void r._runWebSocket()}if(r.safeEmit("failed",e),r._closed)return;if(n.retry(!0))return}r._closed=!0,r.safeEmit("close")}},r._ws.onerror=function(){r._closed},r._ws.onmessage=function(e){if(!r._closed){var t=_o.parse(e.data);t&&0!==r.listenerCount("message")&&r.safeEmit("message",t)}})}))}}],r&&Eo(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(vo);const Lo=jo;function Do(e){return Do="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Do(e)}function Io(){Io=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof y?t:y,a=Object.create(i.prototype),s=new C(n||[]);return o(a,"_invoke",{value:P(e,r,s)}),a}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",d="suspendedYield",h="executing",v="completed",m={};function y(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var _=Object.getPrototypeOf,S=_&&_(_(j([])));S&&S!==r&&n.call(S,a)&&(w=S);var k=b.prototype=y.prototype=Object.create(w);function x(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function r(o,i,a,s){var c=p(e[o],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==Do(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function P(t,r,n){var o=f;return function(i,a){if(o===h)throw new Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=O(s,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?v:d,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=v,n.method="throw",n.arg=u.arg)}}}function O(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,O(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=p(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function j(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(Do(t)+" is not iterable")}return g.prototype=b,o(k,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(R.prototype),u(R.prototype,s,(function(){return this})),t.AsyncIterator=R,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new R(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(k),u(k,c,"Generator"),u(k,a,(function(){return this})),u(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=j,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:j(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function Mo(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Ao(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){Mo(i,n,o,a,s,"next",e)}function s(e){Mo(i,n,o,a,s,"throw",e)}a(void 0)}))}}function No(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Fo(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Do(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Do(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Do(o)?o:String(o)),n)}var o}function Bo(e,t){return Bo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Bo(e,t)}function Go(e){return Go=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Go(e)}var Vo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Bo(e,t)}(c,e);var t,r,n,o,i,a,s=(i=c,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Go(i);if(a){var r=Go(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Do(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function c(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(r=s.call(this))._closed=!1,r._transport=new Lo(e,t),r._connected=!1,r._data={},r._sents=new Map,r._handleTransport(),r}return t=c,r=[{key:"closed",get:function(){return this._closed}},{key:"connected",get:function(){return this._connected}},{key:"data",get:function(){return this._data},set:function(e){throw new Error("cannot override data object")}},{key:"close",value:function(){if(!this._closed){this._closed=!0,this._connected=!1,this._transport.close();var e,t=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return No(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?No(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}(this._sents.values());try{for(t.s();!(e=t.n()).done;)e.value.close()}catch(e){t.e(e)}finally{t.f()}this.safeEmit("close")}}},{key:"request",value:(o=Ao(Io().mark((function e(t){var r,n,o=this,i=arguments;return Io().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:void 0,n=_o.createRequest(t,r),e.next=4,this._transport.send(n);case 4:return e.abrupt("return",new Promise((function(e,t){var r=1500*(15+.1*o._sents.size),i={id:n.id,method:n.method,resolve:function(t){o._sents.delete(n.id)&&(clearTimeout(i.timer),e(t))},reject:function(e){o._sents.delete(n.id)&&(clearTimeout(i.timer),t(e))},timer:setTimeout((function(){o._sents.delete(n.id)&&t(new Error("request timeout"))}),r),close:function(){clearTimeout(i.timer),t(new Error("peer closed"))}};o._sents.set(n.id,i)})));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"notify",value:(n=Ao(Io().mark((function e(t){var r,n,o=arguments;return Io().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:void 0,n=_o.createNotification(t,r),e.next=4,this._transport.send(n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_handleTransport",value:function(){var e=this;if(this._transport.closed)return this._closed=!0,void setTimeout((function(){e._closed||(e._connected=!1,e.safeEmit("close"))}));this._transport.on("open",(function(){e._closed||(e._connected=!0,e.safeEmit("open"))})),this._transport.on("disconnected",(function(){e._closed||(e._connected=!1,e.safeEmit("disconnected"))})),this._transport.on("failed",(function(t){e._closed||(e._connected=!1,e.safeEmit("failed",t))})),this._transport.on("close",(function(){e._closed||(e._closed=!0,e._connected=!1,e.safeEmit("close"))})),this._transport.on("message",(function(t){t.request?e._handleRequest(t):t.response?e._handleResponse(t):t.notification&&e._handleNotification(t)}))}},{key:"_handleRequest",value:function(e){var t=this;try{this.emit("request",e,(function(r){var n=_o.createSuccessResponse(e,r);t._transport.send(n).catch((function(){}))}),(function(r,n){r instanceof Error?(n=r.message,r=500):"number"==typeof r&&n instanceof Error&&(n=n.message);var o=_o.createErrorResponse(e,r,n);t._transport.send(o).catch((function(){}))}))}catch(t){var r=_o.createErrorResponse(e,500,String(t));this._transport.send(r).catch((function(){}))}}},{key:"_handleResponse",value:function(e){var t=this._sents.get(e.id);if(t)if(e.ok)t.resolve(e.data);else{var r=new Error(e.errorReason);r.code=e.errorCode,t.reject(r)}}},{key:"_handleNotification",value:function(e){this.safeEmit("notification",e)}}],r&&Fo(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(vo);const Uo=Vo;var qo=r(1733);function zo(e){return zo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zo(e)}function Wo(){Wo=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof y?t:y,a=Object.create(i.prototype),s=new C(n||[]);return o(a,"_invoke",{value:P(e,r,s)}),a}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",d="suspendedYield",h="executing",v="completed",m={};function y(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var _=Object.getPrototypeOf,S=_&&_(_(j([])));S&&S!==r&&n.call(S,a)&&(w=S);var k=b.prototype=y.prototype=Object.create(w);function x(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function r(o,i,a,s){var c=p(e[o],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==zo(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function P(t,r,n){var o=f;return function(i,a){if(o===h)throw new Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=O(s,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?v:d,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=v,n.method="throw",n.arg=u.arg)}}}function O(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,O(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=p(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function j(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(zo(t)+" is not iterable")}return g.prototype=b,o(k,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(R.prototype),u(R.prototype,s,(function(){return this})),t.AsyncIterator=R,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new R(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(k),u(k,c,"Generator"),u(k,a,(function(){return this})),u(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=j,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:j(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function Ko(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}var Yo=function(){var e,t=(e=Wo().mark((function e(t,r){var n,o,i,a,s,c,u,l,p,f,d,h,v,m,y,g,b,w,_,S,k;return Wo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Un.log.INFO("IO notificationEvent()",this,t),e.t0=t.method,e.next="producerScore"===e.t0?4:"newPeer"===e.t0?6:"peerClosed"===e.t0?8:"peerDisplayNameChanged"===e.t0?17:"downlinkBwe"===e.t0?19:"consumerClosed"===e.t0?21:"consumerPaused"===e.t0?30:"consumerResumed"===e.t0?38:"consumerLayersChanged"===e.t0?46:"consumerScore"===e.t0?51:"dataConsumerClosed"===e.t0?53:"activeSpeaker"===e.t0?61:63;break;case 4:return(n=t.data).producerId,n.score,e.abrupt("break",64);case 6:return t.data,e.abrupt("break",64);case 8:if(o=t.data.peerId,i=r.remoteStreams[o]){e.next=12;break}return e.abrupt("break",64);case 12:return a=io({type:"peer-leave",uid:o,stream:i}),r.dispatchEvent(a),i.close(),delete r.remoteStreams[o],e.abrupt("break",64);case 17:return(s=t.data).peerId,s.displayName,s.oldDisplayName,e.abrupt("break",64);case 19:return Un.log.INFO("'downlinkBwe' event:%o",t.data),e.abrupt("break",64);case 21:if(c=t.data.consumerId,u=this._consumers.get(c),l=u.appData.peerId,p=r.remoteStreams[l]){e.next=27;break}return e.abrupt("break",64);case 27:return p.closeConsumer(u),p.hasVideo()||p.hasAudio()||p.hasScreen()||(delete r.remoteStreams[l],f=oo({type:"stream-removed",stream:p}),r.dispatchEvent(f),p.close()),e.abrupt("break",64);case 30:if(d=t.data.consumerId,h=this._consumers.get(d),v=h.appData.peerId,r.remoteStreams[v]){e.next=36;break}return e.abrupt("break",64);case 36:return h.pause(),e.abrupt("break",64);case 38:if(m=t.data.consumerId,y=this._consumers.get(m),g=y.appData.peerId,r.remoteStreams[g]){e.next=44;break}return e.abrupt("break",64);case 44:return y.resume(),e.abrupt("break",64);case 46:if(b=t.data,w=b.consumerId,b.spatialLayer,b.temporalLayer,this._consumers.get(w)){e.next=50;break}return e.abrupt("break",64);case 50:return e.abrupt("break",64);case 51:return(_=t.data).consumerId,_.score,e.abrupt("break",64);case 53:if(S=t.data.dataConsumerId,k=this._dataConsumers.get(S)){e.next=57;break}return e.abrupt("break",64);case 57:return k.close(),this._dataConsumers.delete(S),k.appData.peerId,e.abrupt("break",64);case 61:return t.data.peerId,e.abrupt("break",64);case 63:Un.log.ERROR('unknown protoo response.method "%s"',t.method);case 64:case"end":return e.stop()}}),e,this)})),function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){Ko(i,n,o,a,s,"next",e)}function s(e){Ko(i,n,o,a,s,"throw",e)}a(void 0)}))});return function(e,r){return t.apply(this,arguments)}}();function Ho(e){return Ho="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ho(e)}function Jo(){Jo=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof y?t:y,a=Object.create(i.prototype),s=new C(n||[]);return o(a,"_invoke",{value:P(e,r,s)}),a}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",d="suspendedYield",h="executing",v="completed",m={};function y(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var _=Object.getPrototypeOf,S=_&&_(_(j([])));S&&S!==r&&n.call(S,a)&&(w=S);var k=b.prototype=y.prototype=Object.create(w);function x(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function r(o,i,a,s){var c=p(e[o],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==Ho(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function P(t,r,n){var o=f;return function(i,a){if(o===h)throw new Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=O(s,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?v:d,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=v,n.method="throw",n.arg=u.arg)}}}function O(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,O(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=p(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function j(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(Ho(t)+" is not iterable")}return g.prototype=b,o(k,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(R.prototype),u(R.prototype,s,(function(){return this})),t.AsyncIterator=R,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new R(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(k),u(k,c,"Generator"),u(k,a,(function(){return this})),u(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=j,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:j(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function $o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Qo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$o(Object(r),!0).forEach((function(t){Xo(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Xo(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==Ho(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Ho(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Ho(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Zo(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function ei(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){Zo(i,n,o,a,s,"next",e)}function s(e){Zo(i,n,o,a,s,"throw",e)}a(void 0)}))}}var ti=function(){var e=ei(Jo().mark((function e(t,r,n){var o,i,a,s,c,u,l,p,f,d,h,v=this;return Jo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.peerId,i=t.producerId,a=t.id,s=t.kind,c=t.rtpParameters,t.type,u=t.appData,l=t.producerPaused,e.prev=1,e.next=4,this._recvTransport.consume({id:a,producerId:i,kind:s,rtpParameters:c,appData:Qo(Qo({},u),{},{peerId:o})});case 4:p=e.sent,this._consumers.set(p.id,p),p.on("transportclose",(function(){v._consumers.delete(p.id)})),f=function(e){window.clearTimeout(v.throttleTime),e.initAddEvent=!0,Un.log.INFO(["play---remoteStream create start",o],e);var t=oo({type:"stream-added",stream:e});r.dispatchEvent(t),Un.log.INFO(["play---remoteStream create end",o],e)},void 0===r.remoteStreams[o]?((d=Ki.createStream({streamID:o,local:!1,screen:u.screen,attributes:u.attributes})).setRemoteStream(p,t,n),r.remoteStreams[o]=d,f(d)):((h=r.remoteStreams[o]).setRemoteStream(p,t,n),h.playerShowing?(Un.log.INFO(["play---remoteStream YES playerShowing start",o],h),h.stop(),h.play(h.elementID),Un.log.INFO(["play---remoteStream YES playerShowing end",o],h)):Un.log.INFO(["play---remoteStream NO playerShowing",o],h)),"paused"===l&&this._pauseConsumer(p),e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(1),Un.log.ERROR('"newConsumer" request failed:%o',e.t0),e.t0;case 16:case"end":return e.stop()}}),e,this,[[1,12]])})));return function(t,r,n){return e.apply(this,arguments)}}(),ri=function(){var e=ei(Jo().mark((function e(t,r,n){var o,i,a,s,c,u,l,p,f=this;return Jo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.peerId,i=t.dataProducerId,a=t.id,s=t.sctpStreamParameters,c=t.label,u=t.protocol,l=t.appData,e.prev=1,e.next=4,this._recvTransport.consumeData({id:a,dataProducerId:i,sctpStreamParameters:s,label:c,protocol:u,appData:Qo(Qo({},l),{},{peerId:o})});case 4:p=e.sent,this._dataConsumers.set(p.id,p),p.on("transportclose",(function(){f._dataConsumers.delete(p.id)})),p.on("open",(function(){Un.log.INFO('DataConsumer "open" event')})),p.on("close",(function(){Un.log.WARN('DataConsumer "close" event'),f._dataConsumers.delete(p.id)})),p.on("error",(function(e){Un.log.ERROR('DataConsumer "error" event:%o',e)})),p.on("message",(function(e){if(Un.log.INFO('DataConsumer "message" event [streamId:%d]',p.sctpStreamParameters.streamId),window.DC_MESSAGE=e,e instanceof ArrayBuffer){var t=new DataView(e).getUint32();return t==Math.pow(2,32)-1?(Un.log.WARN("dataChannelTest finished!"),void(f._nextDataChannelTestNumber=0)):(t>f._nextDataChannelTestNumber&&Un.log.WARN("dataChannelTest: %s packets missing",t-f._nextDataChannelTestNumber),void(f._nextDataChannelTestNumber=t+1))}"string"==typeof e?p.label:Un.log.WARN('ignoring DataConsumer "message" (not a string)')})),window.DC=p,e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(1),Un.log.ERROR('"newDataConsumer" request failed:%o',e.t0),e.t0;case 18:case"end":return e.stop()}}),e,this,[[1,14]])})));return function(t,r,n){return e.apply(this,arguments)}}(),ni=function(){var e=ei(Jo().mark((function e(t,r,n,o,i){var a;return Jo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Un.log.INFO("IO requestEvent()",this,t),a=t.data,e.t0=t.method,e.next="newConsumer"===e.t0?5:"newDataConsumer"===e.t0?8:17;break;case 5:return ti.call(this,a,o,i),r(),e.abrupt("break",17);case 8:if(this._consume){e.next=11;break}return n(403,"I do not want to data consume"),e.abrupt("break",17);case 11:if(this._useDataChannel){e.next=14;break}return n(403,"I do not want DataChannels"),e.abrupt("break",17);case 14:return ri.call(this,a,r,n),r(),e.abrupt("break",17);case 17:case"end":return e.stop()}}),e,this)})));return function(t,r,n,o,i){return e.apply(this,arguments)}}();const oi={Disconnected:function(e,t){var r=this;if(0!==e.state){for(var n in e.timers)Kn(e.timers,n)&&clearInterval(e.timers[n]);for(var o in e.remoteStreams)if(Kn(e.remoteStreams,o)){var i=e.remoteStreams[o],a=io({type:"stream-removed",uid:i.getId(),stream:i});e.dispatchEvent(a),delete e.remoteStreams[o],void 0!==i.pc&&(i.pc.close(),i.pc=void 0)}this._sendTransport&&(this._sendTransport.close(),this._sendTransport=null),this._recvTransport&&(this._recvTransport.close(),this._recvTransport=null),e.state=0,this.socket.destroy(),this.socket=void 0,qn(t,On.ERROR_CODES.SOCKET_DISCONNECTED),this.timeRelink=window.setTimeout((function(){e.attemps++,r.reConnect()}),1e3)}},Failed:function(e,t){},ConnectError:function(e,t){}};function ii(e){return ii="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ii(e)}function ai(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return si(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?si(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function si(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ci(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ui(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ci(Object(r),!0).forEach((function(t){li(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ci(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function li(e,t,r){return(t=vi(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pi(){pi=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof y?t:y,a=Object.create(i.prototype),s=new C(n||[]);return o(a,"_invoke",{value:P(e,r,s)}),a}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",d="suspendedYield",h="executing",v="completed",m={};function y(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var _=Object.getPrototypeOf,S=_&&_(_(j([])));S&&S!==r&&n.call(S,a)&&(w=S);var k=b.prototype=y.prototype=Object.create(w);function x(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function r(o,i,a,s){var c=p(e[o],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==ii(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function P(t,r,n){var o=f;return function(i,a){if(o===h)throw new Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=O(s,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?v:d,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=v,n.method="throw",n.arg=u.arg)}}}function O(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,O(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=p(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function j(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(ii(t)+" is not iterable")}return g.prototype=b,o(k,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(R.prototype),u(R.prototype,s,(function(){return this})),t.AsyncIterator=R,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new R(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(k),u(k,c,"Generator"),u(k,a,(function(){return this})),u(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=j,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:j(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function fi(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function di(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){fi(i,n,o,a,s,"next",e)}function s(e){fi(i,n,o,a,s,"throw",e)}a(void 0)}))}}function hi(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,vi(n.key),n)}}function vi(e){var t=function(e,t){if("object"!==ii(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==ii(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===ii(t)?t:String(t)}r(5522);var mi=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.socket=void 0,this.client=null,this.timeRelink=null,this.ioSuccessFN=null,this.ioFailedFN=null,this._mediasoupDevice=null,this.ioTimeMap={},this._consumers=new Map}var t,r,n,o,i,a,s,c,u,l,p,f,d,h,v,m,y,g,b,w,_,S,k,x,R,P,O,E,T,C,j,L,D,I,M,A,N,F,B,G,V,U,q,z,W,K,Y,H;return t=e,r=[{key:"link",value:function(e){var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.host,r=void 0===t?"":t,n=e.roomId,o=e.peerId,i=e.consumerReplicas;"https:"==document.location.protocol&&(r=r&&r.replace("http","https"));var a=window.location.hostname,s=r||"".concat(a,":").concat(4443),c=[];return c.push("token=".concat(e.token)),c.push("roomId=".concat(n)),c.push("peerId=".concat(o)),c.push("consumerReplicas=".concat(i)),c.push("time=".concat((new Date).getTime())),"wss://".concat(s,"/?").concat(c.join("&"))}({token:e.token,host:e.host,roomId:e.channel,peerId:e.uid,consumerReplicas:""});Boolean(!e.service)?this.socket=new Uo(t):this.socket=Gt(t,{transportOptions:{websocket:{protocols:"protoo"}},extraHeaders:{},query:{token:e.token||"",peerId:e.uid||"",roomId:e.channel||"",consumerReplicas:e.consumerReplicas||"",time:(new Date).getTime()}}),Un.log.INFO(["io link evebt"],this.socket)}},{key:"callbackSuccess",value:function(e,t){this.ioSuccessFN&&(this.ioSuccessFN=null,qn(e,t))}},{key:"callbackFailed",value:function(e,t){this.ioFailedFN&&(this.ioFailedFN=null,qn(e,t||Rn.FALIED_LINK))}},{key:"reConnect",value:function(){var e=this;if(Un.log.INFO(["io reConnect"],this),!this.client)return this.disconnect(),!1;var t=this.client.token,r=this.client.channel,n=this.client.uid;this.client.join(t,r,n,this.ioSuccessFN||function(t){if(void 0!==e.client.localStreams[t]){var r=e.client.localStreams[t];delete e.client.localStreams[t],void 0!==r.pc&&(r.pc.close(),r.pc=void 0),e.client.publish(r,(function(){}),(function(){}))}},this.ioFailedFN||function(){})}},{key:"connect",value:(H=di(pi().mark((function e(t,r,n){var o=this;return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.socket){e.next=2;break}return e.abrupt("return",this.socket.connect());case 2:this.client=t,this.ioSuccessFN=r,this.ioFailedFN=n,this.link(t),t.service?(this.socket.on("connect",(function(e){Un.log.INFO(["socket.io connect",e],o),t.attemps=1,t.state=2,o._joinRoom(r,n)})),this.socket.on("connect_error",(function(e){Un.log.INFO(["socket.io connect_error",t.attemps,e],o)})),this.socket.on("failed",(function(e){Un.log.INFO(["socket.io failed",t.attemps,e],o);var r=ao({type:"error",msg:e});t.dispatchEvent(r)})),this.socket.on("disconnect",(function(e){Un.log.INFO(["socket.io disconnect",t.attemps,e],o),oi.Disconnected.call(o,t,n)}))):(this.socket.on("open",(function(e){Un.log.INFO(["io open",e],o),t.attemps=1,t.state=2,o._joinRoom(r,n)})),this.socket.on("failed",(function(e){Un.log.INFO(["io failed",t.attemps,e],o)})),this.socket.on("disconnected",(function(e){Un.log.INFO(["io disconnect",t.attemps,e],o),oi.Disconnected.call(o,t,n)}))),this.socket.on("close",(function(){o._closed||o.disconnect()})),this.socket.on("request",function(){var e=di(pi().mark((function e(r,n,i){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Un.log.INFO('IO "request" event',r.method,r.data),e.next=3,ni.call(o,r,n,i,t,qo);case 3:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()),this.socket.on("notification",(function(e){Un.log.INFO('IO "notification" event ',e.method,e.data),Yo.call(o,e,t)}));case 11:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return H.apply(this,arguments)})},{key:"sendRoom",value:(Y=di(pi().mark((function e(){var t;return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._mediasoupDevice=new qo.Device,e.next=3,this.request("getRouterRtpCapabilities");case 3:t=e.sent,Un.log.INFO("IO sendRoom ",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return Y.apply(this,arguments)})},{key:"_joinRoom",value:(K=di(pi().mark((function e(t,r){var n,o,i;return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Un.log.INFO(["io _joinRoom"],this),e.prev=1,this._mediasoupDevice=new qo.Device,e.next=5,this.request("getRouterRtpCapabilities");case 5:return n=e.sent,e.next=8,this._mediasoupDevice.load({routerRtpCapabilities:n});case 8:return e.next=10,this._consumeRoom();case 10:return e.next=12,this.request("join",{displayName:this.client.uid,rtpCapabilities:this._mediasoupDevice.rtpCapabilities,sctpCapabilities:this._mediasoupDevice.sctpCapabilities});case 12:o=e.sent,i=o.peers,this.client.peers=i,this.callbackSuccess(t,this.client.uid),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(1),this.callbackFailed(r,e.t0);case 21:case"end":return e.stop()}}),e,this,[[1,18]])}))),function(e,t){return K.apply(this,arguments)})},{key:"_produceRoom",value:(W=di(pi().mark((function e(t,r){var n,o,i,a,s,c,u=this;return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Un.log.INFO(["io _produceRoom"],t),e.prev=1,e.next=4,this.request("createWebRtcTransport",{forceTcp:this._forceTcp,producing:!0,consuming:!1,sctpCapabilities:this._mediasoupDevice.sctpCapabilities});case 4:return n=e.sent,o=n.id,i=n.iceParameters,a=n.iceCandidates,s=n.dtlsParameters,c=n.sctpParameters,this._sendTransport=this._mediasoupDevice.createSendTransport({id:o,iceParameters:i,iceCandidates:a,dtlsParameters:s,sctpParameters:c,iceServers:[]}),this._sendTransport.on("connect",(function(e,t,r){var n=e.dtlsParameters;u.request("connectWebRtcTransport",{transportId:u._sendTransport.id,dtlsParameters:n}).then(t).catch(r)})),this._sendTransport.on("produce",function(){var e=di(pi().mark((function e(t,r,n){var o,i,a,s,c;return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.kind,i=t.rtpParameters,a=t.appData,e.prev=1,e.next=4,u.request("produce",{transportId:u._sendTransport.id,kind:o,rtpParameters:i,appData:a});case 4:s=e.sent,c=s.id,r({id:c}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),n(e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,r,n){return e.apply(this,arguments)}}()),this._sendTransport.on("producedata",function(){var e=di(pi().mark((function e(t,r,n){var o,i,a,s,c,l;return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.sctpStreamParameters,i=t.label,a=t.protocol,s=t.appData,e.prev=1,e.next=4,u.request("produceData",{transportId:u._sendTransport.id,sctpStreamParameters:o,label:i,protocol:a,appData:s});case 4:c=e.sent,l=c.id,r({id:l}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),n(e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,r,n){return e.apply(this,arguments)}}()),e.next=12,t.setLocalStreamTrack();case 12:if(!t.video){e.next=17;break}return e.next=15,this.enableWebcam(t);case 15:e.next=20;break;case 17:if(!t.screen){e.next=20;break}return e.next=20,this.enableShare(t);case 20:if(!t.audio){e.next=23;break}return e.next=23,this.enableMic(t);case 23:this._sendTransport.on("connectionstatechange",(function(e){"connected"===e&&(u.enableChatDataProducer(),u.enableBotDataProducer())})),t.pc.onsignalingmessage(t),e.next=30;break;case 27:e.prev=27,e.t0=e.catch(1),qn(r,e.t0);case 30:case"end":return e.stop()}}),e,this,[[1,27]])}))),function(e,t){return W.apply(this,arguments)})},{key:"_unProduceRoom",value:(z=di(pi().mark((function e(t,r,n){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.video){e.next=5;break}return e.next=3,this.disableWebcam(t);case 3:e.next=8;break;case 5:if(!t.screen){e.next=8;break}return e.next=8,this.disableShare(t);case 8:if(!t.audio){e.next=11;break}return e.next=11,this.disableMic(t);case 11:this._sendTransport&&this._sendTransport.close(),qn(r);case 13:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return z.apply(this,arguments)})},{key:"_consumeRoom",value:(q=di(pi().mark((function e(t){var r,n,o,i,a,s,c=this;return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.request("createWebRtcTransport",{forceTcp:this._forceTcp,producing:!1,consuming:!0,sctpCapabilities:this._mediasoupDevice.sctpCapabilities});case 3:r=e.sent,n=r.id,o=r.iceParameters,i=r.iceCandidates,a=r.dtlsParameters,s=r.sctpParameters,this._recvTransport=this._mediasoupDevice.createRecvTransport({id:n,iceParameters:o,iceCandidates:i,dtlsParameters:a,sctpParameters:s,iceServers:[]}),this._recvTransport.on("connect",(function(e,t,r){var n=e.dtlsParameters;c.request("connectWebRtcTransport",{transportId:c._recvTransport.id,dtlsParameters:n}).then(t).catch(r)})),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),qn(t,e.t0),Un.log.INFO("_consumeRoom()",e.t0);case 13:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e){return q.apply(this,arguments)})},{key:"enableShare",value:(U=di(pi().mark((function e(t){var r,n,o=this;return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Un.log.INFO("enableShare()"),!this._shareProducer){e.next=5;break}return e.abrupt("return");case 5:if(!this._webcamProducer){e.next=8;break}return e.next=8,this.disableWebcam();case 8:return e.prev=8,Un.log.INFO("enableShare() | calling getUserMedia()"),r=t.getVideoTracks()[0],n={videoGoogleStartBitrate:1e3},e.next=14,this._sendTransport.produce({track:r,encodings:void 0,codecOptions:n,codec:void 0,appData:{share:!0}});case 14:this._shareProducer=e.sent,this._shareProducer.on("transportclose",(function(){o._shareProducer=null})),this._shareProducer.on("trackended",(function(){Un.log.ERROR("enableShare() Share disconnected!"),o.disableShare().catch((function(){}))})),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(8),Un.log.ERROR("enableShare() | failed:%o",e.t0),r&&r.stop();case 23:case"end":return e.stop()}}),e,this,[[8,19]])}))),function(e){return U.apply(this,arguments)})},{key:"disableShare",value:(V=di(pi().mark((function e(){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Un.log.INFO("disableShare()"),this._shareProducer){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,this._shareProducer.close(),e.next=7,this.request("closeProducer",{producerId:this._shareProducer.id});case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),Un.log.ERROR("disableShare() | failed:%o",e.t0);case 12:this._shareProducer=null;case 13:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(){return V.apply(this,arguments)})},{key:"enableWebcam",value:(G=di(pi().mark((function e(t){var r,n,o=this;return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._webcamProducer){e.next=2;break}return e.abrupt("return");case 2:return r=t.getVideoTracks()[0],e.prev=3,n={videoGoogleStartBitrate:1e3},e.next=7,this._sendTransport.produce({track:r,encodings:void 0,codecOptions:n,codec:void 0});case 7:this._webcamProducer=e.sent,this._webcamProducer.on("transportclose",(function(){o._webcamProducer=null})),this._webcamProducer.on("trackended",(function(){o.disableWebcam().catch((function(){}))})),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(3),r&&r.stop();case 15:case"end":return e.stop()}}),e,this,[[3,12]])}))),function(e){return G.apply(this,arguments)})},{key:"enableMic",value:(B=di(pi().mark((function e(t){var r,n=this;return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._micProducer){e.next=2;break}return e.abrupt("return");case 2:return r=t.getAudioTracks()[0],e.prev=3,e.next=6,this._sendTransport.produce({track:r,codecOptions:{opusStereo:1,opusDtx:1}});case 6:this._micProducer=e.sent,this._micProducer.on("transportclose",(function(){n._micProducer=null})),this._micProducer.on("trackended",(function(){n.disableMic().catch((function(){}))})),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),r&&r.stop();case 14:case"end":return e.stop()}}),e,this,[[3,11]])}))),function(e){return B.apply(this,arguments)})},{key:"enableChatDataProducer",value:(F=di(pi().mark((function e(){var t=this;return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Un.log.INFO("enableChatDataProducer()"),this._useDataChannel){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,this._sendTransport.produceData({ordered:!1,maxRetransmits:1,label:"chat",priority:"medium",appData:{info:"my-chat-DataProducer"}});case 6:this._chatDataProducer=e.sent,this._chatDataProducer.on("transportclose",(function(){t._chatDataProducer=null})),this._chatDataProducer.on("open",(function(){Un.log.INFO('chat DataProducer "open" event')})),this._chatDataProducer.on("close",(function(){t._chatDataProducer=null})),this._chatDataProducer.on("error",(function(e){Un.log.ERROR('chat DataProducer "error" event:%o',e)})),this._chatDataProducer.on("bufferedamountlow",(function(){Un.log.INFO('chat DataProducer "bufferedamountlow" event')})),e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(3),Un.log.ERROR("enableChatDataProducer() | failed:%o",e.t0),e.t0;case 18:case"end":return e.stop()}}),e,this,[[3,14]])}))),function(){return F.apply(this,arguments)})},{key:"enableBotDataProducer",value:(N=di(pi().mark((function e(){var t=this;return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Un.log.INFO("enableBotDataProducer()"),this._useDataChannel){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,this._sendTransport.produceData({ordered:!1,maxPacketLifeTime:2e3,label:"bot",priority:"medium",appData:{info:"my-bot-DataProducer"}});case 6:this._botDataProducer=e.sent,this._botDataProducer.on("transportclose",(function(){t._botDataProducer=null})),this._botDataProducer.on("open",(function(){Un.log.INFO('bot DataProducer "open" event')})),this._botDataProducer.on("close",(function(){t._botDataProducer=null})),this._botDataProducer.on("error",(function(e){Un.log.ERROR('bot DataProducer "error" event:%o',e)})),this._botDataProducer.on("bufferedamountlow",(function(){Un.log.INFO('bot DataProducer "bufferedamountlow" event')})),e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(3),Un.log.ERROR("enableBotDataProducer() | failed:%o",e.t0),e.t0;case 18:case"end":return e.stop()}}),e,this,[[3,14]])}))),function(){return N.apply(this,arguments)})},{key:"disableWebcam",value:(A=di(pi().mark((function e(){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._webcamProducer){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,this._webcamProducer.close(),e.next=6,this.request("closeProducer",{producerId:this._webcamProducer.id});case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),Un.log.INFO("Error closing server-side webcam Producer: ".concat(e.t0));case 11:this._webcamProducer=null;case 12:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(){return A.apply(this,arguments)})},{key:"disableMic",value:(M=di(pi().mark((function e(){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._micProducer){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,this._micProducer.close(),e.next=6,this.request("closeProducer",{producerId:this._micProducer.id});case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),Un.log.INFO("Error closing server-side mic Producer: ".concat(e.t0));case 11:this._micProducer=null;case 12:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(){return M.apply(this,arguments)})},{key:"muteVideo",value:(I=di(pi().mark((function e(){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this._webcamProducer.pause(),e.next=4,this.request("pauseProducer",{producerId:this._webcamProducer.id});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),Un.log.ERROR("muteMic() | failed: %o",e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return I.apply(this,arguments)})},{key:"unmuteVideo",value:(D=di(pi().mark((function e(){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this._webcamProducer.resume(),e.next=4,this.request("resumeProducer",{producerId:this._webcamProducer.id});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),Un.log.ERROR("unmuteMic() | failed: %o",e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return D.apply(this,arguments)})},{key:"muteMic",value:(L=di(pi().mark((function e(){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this._micProducer.pause(),e.next=4,this.request("pauseProducer",{producerId:this._micProducer.id});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),Un.log.ERROR("muteMic() | failed: %o",e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return L.apply(this,arguments)})},{key:"unmuteMic",value:(j=di(pi().mark((function e(){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this._micProducer.resume(),e.next=4,this.request("resumeProducer",{producerId:this._micProducer.id});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),Un.log.ERROR("unmuteMic() | failed: %o",e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return j.apply(this,arguments)})},{key:"_pauseConsumer",value:(C=di(pi().mark((function e(t){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&!t.paused){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.request("pauseConsumer",{consumerId:t.id});case 5:t.pause(),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),Un.log.ERROR("_pauseConsumer() | failed:%o",e.t0);case 11:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(e){return C.apply(this,arguments)})},{key:"_resumeConsumer",value:(T=di(pi().mark((function e(t){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.paused){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.request("resumeConsumer",{consumerId:t.id});case 5:t.resume(),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),Un.log.ERROR("_resumeConsumer() | failed:%o",e.t0);case 11:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(e){return T.apply(this,arguments)})},{key:"request",value:function(e,t){return 0==!this.client.service?this.send(e,t):this.socket.request(e,t)}},{key:"send",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{a:1,b:2};return new Promise((function(n,o){if(void 0===t.socket)return qn(o,On.ERROR_CODES.INVALID_OPERATION);try{Un.log.INFO("socket IO send()",{type:e,param:r}),t.socket.emit("request",e,r,(function(r,i){Un.log.INFO("socket IO sucess response()",r,i),window.clearTimeout(t.ioTimeMap[e]),qn(r?n:o,i)}))}catch(e){Un.log.INFO("socket IO error",e),qn(o,On.ERROR_CODES.SOCKET_ERROR)}}))}},{key:"changeWebcam",value:(E=di(pi().mark((function e(){var t,r,n,o,i,a;return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Un.log.INFO("changeWebcam()"),e.prev=1,e.next=4,this._updateWebcams();case 4:if(t=Array.from(this._webcams.keys()),r=t.length,n=this._webcam.device?this._webcam.device.deviceId:void 0,(o=t.indexOf(n))<r-1?o++:o=0,this._webcam.device=this._webcams.get(t[o]),this._webcam.resolution="hd",this._webcam.device){e.next=13;break}throw new Error("no webcam devices");case 13:return this._webcamProducer.track.stop(),e.next=16,navigator.mediaDevices.getUserMedia({video:ui({deviceId:{exact:this._webcam.device.deviceId}},Sn[this._webcam.resolution])});case 16:return i=e.sent,a=i.getVideoTracks()[0],e.next=20,this._webcamProducer.replaceTrack({track:a});case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(1),Un.log.ERROR("changeWebcam() | failed: %o",e.t0);case 25:case"end":return e.stop()}}),e,this,[[1,22]])}))),function(){return E.apply(this,arguments)})},{key:"_updateWebcams",value:(O=di(pi().mark((function e(){var t,r,n,o,i,a,s;return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Un.log.INFO("_updateWebcams()"),this._webcams=new Map,e.next=4,navigator.mediaDevices.enumerateDevices();case 4:t=e.sent,r=ai(t),e.prev=6,r.s();case 8:if((n=r.n()).done){e.next=15;break}if("videoinput"===(o=n.value).kind){e.next=12;break}return e.abrupt("continue",13);case 12:this._webcams.set(o.deviceId,o);case 13:e.next=8;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(6),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:i=Array.from(this._webcams.values()),a=i.length,s=this._webcam.device?this._webcam.device.deviceId:void 0,Un.log.INFO("_updateWebcams() [webcams:%o]",i),0===a?this._webcam.device=null:this._webcams.has(s)||(this._webcam.device=i[0]);case 28:case"end":return e.stop()}}),e,this,[[6,17,20,23]])}))),function(){return O.apply(this,arguments)})},{key:"changeWebcamResolution",value:(P=di(pi().mark((function e(){var t,r;return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Un.log.INFO("changeWebcamResolution()"),e.prev=1,e.t0=this._webcam.resolution,e.next="qvga"===e.t0?5:"vga"===e.t0?7:"hd"===e.t0?9:11;break;case 5:return this._webcam.resolution="vga",e.abrupt("break",12);case 7:return this._webcam.resolution="hd",e.abrupt("break",12);case 9:return this._webcam.resolution="qvga",e.abrupt("break",12);case 11:this._webcam.resolution="hd";case 12:return e.next=14,navigator.mediaDevices.getUserMedia({video:ui({deviceId:{exact:this._webcam.device.deviceId}},Sn[this._webcam.resolution])});case 14:return t=e.sent,r=t.getVideoTracks()[0],e.next=18,this._webcamProducer.replaceTrack({track:r});case 18:e.next=23;break;case 20:e.prev=20,e.t1=e.catch(1),Un.log.ERROR("changeWebcamResolution() | failed: %o",e.t1);case 23:case"end":return e.stop()}}),e,this,[[1,20]])}))),function(){return P.apply(this,arguments)})},{key:"restartIce",value:(R=di(pi().mark((function e(){var t,r;return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!this._sendTransport){e.next=7;break}return e.next=4,this.request("restartIce",{transportId:this._sendTransport.id});case 4:return t=e.sent,e.next=7,this._sendTransport.restartIce({iceParameters:t});case 7:if(!this._recvTransport){e.next=13;break}return e.next=10,this.request("restartIce",{transportId:this._recvTransport.id});case 10:return r=e.sent,e.next=13,this._recvTransport.restartIce({iceParameters:r});case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),Un.log.ERROR("restartIce() | failed:%o",e.t0);case 18:case"end":return e.stop()}}),e,this,[[0,15]])}))),function(){return R.apply(this,arguments)})},{key:"setMaxSendingSpatialLayer",value:(x=di(pi().mark((function e(t){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Un.log.INFO("setMaxSendingSpatialLayer() [spatialLayer:%s]",t),e.prev=1,!this._webcamProducer){e.next=7;break}return e.next=5,this._webcamProducer.setMaxSpatialLayer(t);case 5:e.next=10;break;case 7:if(!this._shareProducer){e.next=10;break}return e.next=10,this._shareProducer.setMaxSpatialLayer(t);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),Un.log.ERROR("setMaxSendingSpatialLayer() | failed:%o",e.t0);case 15:case"end":return e.stop()}}),e,this,[[1,12]])}))),function(e){return x.apply(this,arguments)})},{key:"setConsumerPreferredLayers",value:(k=di(pi().mark((function e(t,r,n){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.request("setConsumerPreferredLayers",{consumerId:t,spatialLayer:r,temporalLayer:n});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),Un.log.ERROR("setConsumerPreferredLayers() | failed:%o",e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(e,t,r){return k.apply(this,arguments)})},{key:"setConsumerPriority",value:(S=di(pi().mark((function e(t,r){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.request("setConsumerPriority",{consumerId:t,priority:r});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),Un.log.ERROR("setConsumerPriority() | failed:%o",e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(e,t){return S.apply(this,arguments)})},{key:"requestConsumerKeyFrame",value:(_=di(pi().mark((function e(t){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.request("requestConsumerKeyFrame",{consumerId:t});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),Un.log.ERROR("requestConsumerKeyFrame() | failed:%o",e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(e){return _.apply(this,arguments)})},{key:"sendChatMessage",value:(w=di(pi().mark((function e(t){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._chatDataProducer){e.next=2;break}return e.abrupt("return");case 2:try{this._chatDataProducer.send(t)}catch(e){Un.log.ERROR("chat DataProducer.send() failed:%o",e)}case 3:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{key:"sendBotMessage",value:(b=di(pi().mark((function e(t){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._botDataProducer){e.next=2;break}return e.abrupt("return");case 2:try{this._botDataProducer.send(t)}catch(e){Un.log.ERROR("bot DataProducer.send() failed:%o",e)}case 3:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"changeDisplayName",value:(g=di(pi().mark((function e(t){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.request("changeDisplayName",{displayName:t});case 3:this._displayName=t,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),Un.log.ERROR("changeDisplayName() | failed: %o",e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e){return g.apply(this,arguments)})},{key:"getSendTransportRemoteStats",value:(y=di(pi().mark((function e(){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Un.log.INFO("getSendTransportRemoteStats()"),this._sendTransport){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this.request("getTransportStats",{transportId:this._sendTransport.id}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"getRecvTransportRemoteStats",value:(m=di(pi().mark((function e(){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._recvTransport){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",this.request("getTransportStats",{transportId:this._recvTransport.id}));case 3:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"getAudioRemoteStats",value:(v=di(pi().mark((function e(){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._micProducer){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",this.request("getProducerStats",{producerId:this._micProducer.id}));case 3:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"getVideoRemoteStats",value:(h=di(pi().mark((function e(){var t;return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._webcamProducer||this._shareProducer){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this.request("getProducerStats",{producerId:t.id}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"getConsumerRemoteStats",value:(d=di(pi().mark((function e(t){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._consumers.get(t)){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this.request("getConsumerStats",{consumerId:t}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"getChatDataProducerRemoteStats",value:(f=di(pi().mark((function e(){var t;return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._chatDataProducer){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this.request("getDataProducerStats",{dataProducerId:t.id}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"getBotDataProducerRemoteStats",value:(p=di(pi().mark((function e(){var t;return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._botDataProducer){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this.request("getDataProducerStats",{dataProducerId:t.id}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"getDataConsumerRemoteStats",value:(l=di(pi().mark((function e(t){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._dataConsumers.get(t)){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this.request("getDataConsumerStats",{dataConsumerId:t}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"getSendTransportLocalStats",value:(u=di(pi().mark((function e(){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._sendTransport){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",this._sendTransport.getStats());case 3:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"getRecvTransportLocalStats",value:(c=di(pi().mark((function e(){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._recvTransport){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",this._recvTransport.getStats());case 3:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"getAudioLocalStats",value:(s=di(pi().mark((function e(){return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._micProducer){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",this._micProducer.getStats());case 3:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"getVideoLocalStats",value:(a=di(pi().mark((function e(){var t;return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._webcamProducer||this._shareProducer){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",t.getStats());case 4:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getConsumerLocalStats",value:(i=di(pi().mark((function e(t){var r;return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._consumers.get(t)){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",r.getStats());case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"applyNetworkThrottle",value:(o=di(pi().mark((function e(t){var r,n,o,i;return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.uplink,n=t.downlink,o=t.rtt,i=t.secret,e.prev=1,e.next=4,this.request("applyNetworkThrottle",{uplink:r,downlink:n,rtt:o,secret:i});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),Un.log.ERROR("applyNetworkThrottle() | failed:%o",e.t0);case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return o.apply(this,arguments)})},{key:"resetNetworkThrottle",value:(n=di(pi().mark((function e(t){var r,n,o;return pi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.silent,n=void 0!==r&&r,o=t.secret,e.prev=1,e.next=4,this.request("resetNetworkThrottle",{secret:o});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),n||Un.log.ERROR("resetNetworkThrottle() | failed:%o",e.t0);case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return n.apply(this,arguments)})},{key:"_getWebcamType",value:function(e){return/(back|rear)/i.test(e.label)?(Un.log.INFO("_getWebcamType() | it seems to be a back camera"),"back"):(Un.log.INFO("_getWebcamType() | it seems to be a front camera"),"front")}},{key:"disconnect",value:function(){this.socket&&this.socket.close(),this.socket=void 0,this.client=null,this.ioSuccessFN=null,this.ioFailedFN=null,window.clearTimeout(this.timeRelink),this.close()}},{key:"close",value:function(){this._sendTransport&&this._sendTransport.close(),this._recvTransport&&this._recvTransport.close()}}],r&&hi(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();const yi=mi;function gi(e){return gi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gi(e)}function bi(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==gi(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==gi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===gi(o)?o:String(o)),n)}var o}function wi(e,t){return wi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},wi(e,t)}function _i(e){return _i=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_i(e)}const Si=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&wi(e,t)}(a,e);var t,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=_i(n);if(o){var r=_i(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===gi(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this)).options=e||{},t.localStreams={},t.remoteStreams={},t.socket=void 0,t.state=0,t.host=t.options.host||"",t.mode=t.options.mode,t.timers={},t.attemps=1,t.service=t.options.service||0,t}return t=a,r=[{key:"init",value:function(e,t,r){var n=e.appID,o=e.host;if(Un.log.INFO([n,o],this),!o||"string"!=typeof o)return qn(r,xn.ERRORS.NO_SOCKET_HOST_PARAM);this.appID=n,this.host=o||this.host||"",this.socket=new yi,qn(t)}},{key:"join",value:function(e,t,r,n,o){var i=this;if(0!==this.state)return qn(o,On.ERROR_CODES.INVALID_OPERATION);this.token=e,this.uid=r,this.channel=t,this.state=1,this.socket.connect(this,(function(e){i.uid=e,i.state=2,qn(n,i.uid)}),(function(e){qn(o,e)}))}},{key:"leave",value:function(e,t){if(2!==this.state)return qn(t,On.ERROR_CODES.INVALID_OPERATION);for(var r in this.localStreams)if(Kn(this.localStreams,r)){var n=this.localStreams[r];delete this.localStreams[r],void 0!==n.pc&&n.pc&&n.pc.close&&n.pc.close(),n.pc=void 0}for(var o in this.remoteStreams)if(Kn(this.remoteStreams,o)){var i=this.remoteStreams[o];delete this.remoteStreams[o],void 0!==i.pc&&i.pc&&i.pc.close&&i.pc.close(),i.pc=void 0}try{this.state=0,this.socket.disconnect(),this.socket=void 0,qn(e)}catch(e){qn(t,e)}}},{key:"publish",value:function(e,t,r){var n=this;return"object"!==gi(e)||null===e||null===e.stream&&void 0===e.url?qn(r,On.ERROR_CODES.INVALID_LOCAL_STREAM):2!==this.state?qn(r,On.ERROR_CODES.INVALID_OPERATION):!e.local||this.localStreams[e.getId()]?qn(r,On.ERROR_CODES.INVALID_LOCAL_STREAM):e.hasAudio()||e.hasVideo()||e.hasScreen()?(this.localStreams[e.getId()]=e,e.pc={},e.pc.close=function(){},e.pc.onsignalingmessage=function(r){e.onClose=function(){n.unpublish(r)},e.unmuteAudio=function(){n.socket.unmuteMic()},e.unmuteVideo=function(){n.socket.unmuteVideo()},e.muteAudio=function(){n.socket.muteMic()},e.muteVideo=function(){n.socket.muteVideo()};var o=oo({type:"stream-published",stream:n.localStreams[e.getId()]});n.dispatchEvent(o),qn(t)},void this.socket._produceRoom(e,r)):qn(r,On.ERROR_CODES.INVALID_LOCAL_STREAM)}},{key:"unpublish",value:function(e,t,r){var n=this;return"object"!==gi(e)||null===e||null===e.stream&&void 0===e.url?qn(r,On.ERROR_CODES.INVALID_LOCAL_STREAM):2!==this.state?qn(r,On.ERROR_CODES.INVALID_OPERATION):e.local&&this.localStreams[e.getId()]?void this.socket._unProduceRoom(e,(function(){delete n.localStreams[e.getId()],(e.hasAudio()||e.hasVideo()||e.hasScreen())&&void 0!==e.pc&&(e.pc.close&&e.pc.close(),e.pc=void 0),e.onClose=void 0,e.unmuteAudio=void 0,e.muteAudio=void 0,e.unmuteVideo=void 0,e.muteVideo=void 0,qn(t)}),r):qn(r,On.ERROR_CODES.INVALID_LOCAL_STREAM)}},{key:"subscribe",value:function(e,t,r){var n=this;return"object"!==gi(e)||null===e?qn(r,On.ERROR_CODES.INVALID_REMOTE_STREAM):2!==this.state?qn(r,On.ERROR_CODES.INVALID_OPERATION):e.local?qn(r,On.ERROR_CODES.INVALID_REMOTE_STREAM):e.hasAudio()||e.hasVideo()||e.hasScreen()?(e.pc={},e.pc.close=function(){window.clearTimeout(e.timerSubscribedEvent),e.timerSubscribedEvent=null},e.pc.onaddstream=function(r){var o=n.remoteStreams[e.getId()];o.stream=r.stream,e.unmuteAudio=function(){n.socket._resumeConsumer(e.audioConsumer),e.unmutePlayerAudio()},e.muteAudio=function(){n.socket._pauseConsumer(e.audioConsumer),e.mutePlayerAudio()},e.unmuteVideo=function(){n.socket._resumeConsumer(e.videoConsumer),e.unmutePlayerVideo()},e.muteVideo=function(){n.socket._pauseConsumer(e.videoConsumer),e.mutePlayerVideo()},window.clearTimeout(e.timerSubscribedEvent),e.timerSubscribedEvent=window.setTimeout((function(){!function(){Un.log.INFO(["play---remoteStream subscribed start",e.getId()],o);var t=oo({type:"stream-subscribed",stream:n.remoteStreams[e.getId()]});n.dispatchEvent(t),Un.log.INFO(["play---remoteStream subscribed end",e.getId()],o)}(),qn(t)}),100)},void e.pc.onaddstream(e)):qn(r,On.ERROR_CODES.INVALID_REMOTE_STREAM)}},{key:"unsubscribe",value:function(e,t,r){return"object"!==gi(e)||null===e?qn(r,On.ERROR_CODES.INVALID_REMOTE_STREAM):2!==this.state?qn(r,On.ERROR_CODES.INVALID_OPERATION):e.local?qn(r,On.ERROR_CODES.INVALID_REMOTE_STREAM):(e.pc&&e.pc.close&&e.pc.close(),e.close(),void qn(t))}},{key:"sendClientMessage",value:function(){var e=oo({type:"definedMessage",stream:this,msg:arguments});this.dispatchEvent(e)}},{key:"joinRoom",value:function(){this.socket&&this.socket._joinRoom()}}],r&&bi(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),a}(Dn);function ki(e){return ki="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ki(e)}function xi(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==ki(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==ki(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===ki(o)?o:String(o)),n)}var o}const Ri=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t||{},this.id=t.id,this.stream=t.stream,this.elementID=t.elementID,this.createDom()}var t,r;return t=e,(r=[{key:"destroy",value:function(){this.audio.pause();var e=document.body;void 0!==this.elementID&&(e=this.div.parentNode),e&&e.removeChild(this.div)}},{key:"createDom",value:function(){var e=document.createElement("audio");if(e.setAttribute("id","stream-audio"+this.id),e.setAttribute("style","width: 100%; height: 100%; position: absolute"),e.muted=!0,this.stream.local?e.volume=0:e.volume=1,void 0!==this.elementID){var t=document.getElementById("player_"+this.id);t||((t=document.createElement("div")).setAttribute("id","player_"+this.id),t.setAttribute("style","width: 100%; height: 100%; position: relative; overflow: hidden;")),t.appendChild(e),this.div=t,this.container=document.getElementById(this.elementID),this.container.appendChild(t)}else document.body.appendChild(e);this.audio=e;var r=this.stream.getAudioStream();Un.log.INFO("AudioPlayer attachMediaStream ",r),window.attachMediaStream(document.getElementById("stream-audio"+this.id),r)}},{key:"mediaPause",value:function(){this.audio.muted=!0,this.audio.pause()}},{key:"mediaResume",value:function(){this.stream.local?this.audio.volume=0:this.audio.volume=1,this.audio.muted=!1,this.audio.play()}},{key:"mediaPlay",value:function(){var e=this;return new Promise((function(t,r){return e.audio?e.audio.play().then((function(r){Un.log.INFO(["play-- audio.play() success",e.id],r),t(r||null)})).catch((function(r){Un.log.INFO(["play-- audio.play() failed:%o",e.id],r),t(r)})):t(null)}))}}])&&xi(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Pi(e){return Pi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pi(e)}function Oi(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Pi(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Pi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Pi(o)?o:String(o)),n)}var o}const Ei=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t||{},this.id=t.id,this.stream=t.stream,this.elementID=t.elementID,this.container=null,this.createDom()}var t,r;return t=e,(r=[{key:"destroy",value:function(){this.video.pause(),delete this.resizer;var e=document.body;void 0!==this.elementID&&(e=this.div.parentNode),e&&e.removeChild(this.div)}},{key:"createDom",value:function(){var e=document.getElementById("player_"+this.id);e||(e=document.createElement("div")).setAttribute("id","player_"+this.id),this.stream.video?e.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"):e.setAttribute("style","width: 100%; height: 100%; position: relative; overflow: hidden;");var t=document.createElement("video");t.setAttribute("id","stream-video"+this.id),this.stream.local&&!this.stream.screen?t.setAttribute("style","width: 100%; height: 100%; position: absolute; transform: rotateY(0deg);"):this.stream.video?t.setAttribute("style","width: 100%; height: 100%; position: absolute;"):t.setAttribute("style","width: 100%; height: 100%; position: absolute; display: none;"),t.muted=!0,t.setAttribute("playsinline",""),void 0!==this.elementID?(document.getElementById(this.elementID).appendChild(e),this.container=document.getElementById(this.elementID)):(document.body.appendChild(e),this.container=document.body),e.appendChild(t),this.div=e,this.video=t;var r=this.stream.getVideoStream();Un.log.INFO("VideoPlayer attachMediaStream",r),window.attachMediaStream(document.getElementById("stream-video"+this.id),r)}},{key:"resize",value:function(){var e=this.container.offsetWidth,t=this.container.offsetHeight;this.stream.screen?.75*e<t?(this.video.style.width=e+"px",this.video.style.height=.75*e+"px",this.video.style.top=-(.75*e/2-t/2)+"px",this.video.style.left="0px"):(this.video.style.height=t+"px",this.video.style.width=4/3*t+"px",this.video.style.left=-(4/3*t/2-e/2)+"px",this.video.style.top="0px"):e===this.containerWidth&&t===this.containerHeight||(.75*e>t?(this.video.style.width=e+"px",this.video.style.height=.75*e+"px",this.video.style.top=-(.75*e/2-t/2)+"px",this.video.style.left="0px"):(this.video.style.height=t+"px",this.video.style.width=4/3*t+"px",this.video.style.left=-(4/3*t/2-e/2)+"px",this.video.style.top="0px")),this.containerWidth=e,this.containerHeight=t}},{key:"mediaPause",value:function(){this.video.pause()}},{key:"mediaResume",value:function(){this.video.muted=!0,this.video.play()}},{key:"mediaPlay",value:function(){var e=this;return new Promise((function(t,r){return e.video?e.video.play().then((function(r){Un.log.INFO(["play-- video.play() success",e.id],r),t(r||null)})).catch((function(r){Un.log.INFO(["play-- video.play() failed:%o",e.id],r),t(r)})):t(null)}))}}])&&Oi(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Ti(e){return Ti="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ti(e)}function Ci(){Ci=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof y?t:y,a=Object.create(i.prototype),s=new C(n||[]);return o(a,"_invoke",{value:P(e,r,s)}),a}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",d="suspendedYield",h="executing",v="completed",m={};function y(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var _=Object.getPrototypeOf,S=_&&_(_(j([])));S&&S!==r&&n.call(S,a)&&(w=S);var k=b.prototype=y.prototype=Object.create(w);function x(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function r(o,i,a,s){var c=p(e[o],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==Ti(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function P(t,r,n){var o=f;return function(i,a){if(o===h)throw new Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=O(s,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?v:d,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=v,n.method="throw",n.arg=u.arg)}}}function O(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,O(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=p(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function j(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(Ti(t)+" is not iterable")}return g.prototype=b,o(k,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(R.prototype),u(R.prototype,s,(function(){return this})),t.AsyncIterator=R,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new R(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(k),u(k,c,"Generator"),u(k,a,(function(){return this})),u(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=j,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:j(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function ji(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}var Li=function(){var e,t=(e=Ci().mark((function e(t,r,n){var o;return Ci().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,Un.log.INFO("navigator getUserMedia",t),e.prev=2,t.screen){e.next=6;break}return navigator.getMedia(t,r,n),e.abrupt("return",!0);case 6:return e.next=8,navigator.mediaDevices.getDisplayMedia({audio:!1,video:{displaySurface:"monitor",logicalSurface:!0,cursor:!0,width:{max:1920},height:{max:1080},frameRate:{max:30}}});case 8:o=e.sent,t.audio?navigator.getMedia(t,(function(e){qn(r,o,e)}),n):qn(r,o),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),qn(n,e.t0);case 15:case"end":return e.stop()}}),e,null,[[2,12]])})),function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){ji(i,n,o,a,s,"next",e)}function s(e){ji(i,n,o,a,s,"throw",e)}a(void 0)}))});return function(e,r,n){return t.apply(this,arguments)}}();function Di(e){return Di="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Di(e)}function Ii(){Ii=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof y?t:y,a=Object.create(i.prototype),s=new C(n||[]);return o(a,"_invoke",{value:P(e,r,s)}),a}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",d="suspendedYield",h="executing",v="completed",m={};function y(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var _=Object.getPrototypeOf,S=_&&_(_(j([])));S&&S!==r&&n.call(S,a)&&(w=S);var k=b.prototype=y.prototype=Object.create(w);function x(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function r(o,i,a,s){var c=p(e[o],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==Di(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function P(t,r,n){var o=f;return function(i,a){if(o===h)throw new Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=O(s,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?v:d,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=v,n.method="throw",n.arg=u.arg)}}}function O(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,O(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=p(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function j(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(Di(t)+" is not iterable")}return g.prototype=b,o(k,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(R.prototype),u(R.prototype,s,(function(){return this})),t.AsyncIterator=R,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new R(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(k),u(k,c,"Generator"),u(k,a,(function(){return this})),u(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=j,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:j(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function Mi(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Ai(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Di(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Di(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Di(o)?o:String(o)),n)}var o}var Ni=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n,o;return t=e,r=[{key:"getUserMedia",value:(n=Ii().mark((function e(t,r,n){return Ii().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Li(t,r,n));case 1:case"end":return e.stop()}}),e)})),o=function(){var e=this,t=arguments;return new Promise((function(r,o){var i=n.apply(e,t);function a(e){Mi(i,r,o,a,s,"next",e)}function s(e){Mi(i,r,o,a,s,"throw",e)}a(void 0)}))},function(e,t,r){return o.apply(this,arguments)})},{key:"getDevices",value:function(e){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices().then((function(t){e(t)}))}},{key:"checkSystemRequirements",value:function(){}},{key:"createClient",value:function(){return new Si(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}},{key:"createStream",value:function(){return new no(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}},{key:"videoPlayer",value:function(){return new Ei(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}},{key:"audioPlayer",value:function(){return new Ri(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}}],r&&Ai(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();const Fi=Ni;function Bi(e){return Bi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bi(e)}function Gi(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Bi(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Bi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Bi(o)?o:String(o)),n)}var o}function Vi(e,t){return Vi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Vi(e,t)}function Ui(e){return Ui=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ui(e)}window.AdapterJS=on,window.io=Gt,Un.log.INFO([null,window],window);var qi={},zi={},Wi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Vi(e,t)}(a,e);var t,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ui(n);if(o){var r=Ui(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Bi(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function a(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this)).VERSION="1.0.0",a.setInitOptions(t),e}return t=a,r=[{key:"getInitOptions",value:function(){return qi}},{key:"setInitOptions",value:function(e){qi=e}},{key:"setUserInitOptions",value:function(e){zi=e}},{key:"getUserInitOptions",value:function(){return zi}}],null&&Gi(t.prototype,null),r&&Gi(t,r),Object.defineProperty(t,"prototype",{writable:!1}),a}(Fi);window.GmRTC=new Wi;const Ki=window.GmRTC})(),n})()));